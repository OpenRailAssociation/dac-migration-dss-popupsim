{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"PopUpSim Documentation","text":"<p>This directory contains all documentation for PopUpSim, organized by topic.</p>"},{"location":"#documentation-structure","title":"Documentation Structure","text":"<pre><code>docs/\n\u251c\u2500\u2500 tutorial/              # Step-by-step configuration tutorial\n\u251c\u2500\u2500 mvp/                  # MVP implementation documentation\n\u251c\u2500\u2500 requirements/         # Requirements and use cases\n\u251c\u2500\u2500 adr/                  # Architecture Decision Records\n\u251c\u2500\u2500 ci-cd.md             # CI/CD pipeline documentation\n\u251c\u2500\u2500 DOCS_DEPLOYMENT.md   # Documentation deployment guide\n\u2514\u2500\u2500 DOCS_SETUP.md        # Documentation setup instructions\n</code></pre>"},{"location":"#quick-navigation","title":"Quick Navigation","text":""},{"location":"#getting-started","title":"Getting Started","text":"<ul> <li>Tutorial - Step-by-step configuration guide</li> <li>Installation Guide - Installing Python, uv, and PopUpSim</li> </ul>"},{"location":"#mvp-documentation","title":"MVP Documentation","text":"<ul> <li>MVP Architecture - Complete arc42 architecture for the MVP</li> <li>MVP Development Guide - Implementation details and examples</li> </ul>"},{"location":"#requirements-use-cases","title":"Requirements &amp; Use Cases","text":"<ul> <li>Use Cases - User stories and requirements</li> <li>Concept Document - Original concept</li> </ul>"},{"location":"#architecture-decisions","title":"Architecture Decisions","text":"<ul> <li>ADR Overview - Performance optimizations and architectural decisions</li> </ul>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<p>PopUpSim MVP uses a 3-context architecture:</p> Context Purpose Technology Configuration Input validation &amp; parsing Pydantic Workshop Operations Simulation execution SimPy Analysis &amp; Reporting Output generation Matplotlib, CSV"},{"location":"#getting-started_1","title":"Getting Started","text":"<ol> <li>For MVP Development: Start with MVP Architecture</li> <li>For Requirements: Review Use Cases</li> <li>For Architecture Decisions: Browse MVP ADRs</li> </ol>"},{"location":"#contributing-to-documentation","title":"Contributing to Documentation","text":"<ul> <li>Follow arc42 template for architecture documentation</li> <li>Keep documentation current with code changes</li> <li>Update cross-references when moving or renaming files</li> </ul>"},{"location":"#documentation-maintenance","title":"Documentation Maintenance","text":"<ul> <li>Tutorial: Updated when configuration format changes</li> <li>MVP Documentation: Updated during development</li> <li>Cross-References: Maintained manually</li> <li>Navigation: Keep README files current with structure changes</li> </ul>"},{"location":"DOCS_DEPLOYMENT/","title":"Documentation Deployment","text":""},{"location":"DOCS_DEPLOYMENT/#overview","title":"Overview","text":"<p>The documentation is automatically built and deployed using GitHub Actions:</p> <ul> <li>Production: Deployed to GitHub Pages on every push to <code>main</code></li> <li>Preview: Deployed as PR preview for every pull request</li> </ul>"},{"location":"DOCS_DEPLOYMENT/#urls","title":"URLs","text":"<ul> <li>Production: <code>https://openrailassociation.github.io/dac-migration-dss-popupsim/</code></li> <li>PR Preview: <code>https://openrailassociation.github.io/dac-migration-dss-popupsim/pr-preview/pr-&lt;number&gt;/</code></li> </ul>"},{"location":"DOCS_DEPLOYMENT/#setup","title":"Setup","text":""},{"location":"DOCS_DEPLOYMENT/#enable-github-pages","title":"Enable GitHub Pages","text":"<ol> <li>Go to repository Settings \u2192 Pages</li> <li>Set Source to \"Deploy from a branch\"</li> <li>Select branch: <code>gh-pages</code></li> <li>Select folder: <code>/ (root)</code></li> <li>Save</li> </ol>"},{"location":"DOCS_DEPLOYMENT/#workflow","title":"Workflow","text":"<p>The workflow runs on: - Push to <code>main</code> \u2192 Production deployment - Pull request \u2192 Preview deployment</p>"},{"location":"DOCS_DEPLOYMENT/#local-development","title":"Local Development","text":"<pre><code># Install dependencies\nuv sync --group docs\n\n# Serve locally\nuv run mkdocs serve\n\n# Build\nuv run mkdocs build\n</code></pre>"},{"location":"DOCS_DEPLOYMENT/#preview-deployments","title":"Preview Deployments","text":"<p>PR previews are automatically: - Created when PR is opened - Updated when PR is updated - Removed when PR is closed/merged</p> <p>Preview URL is posted as a comment on the PR.</p>"},{"location":"DOCS_SETUP/","title":"Documentation Setup","text":""},{"location":"DOCS_SETUP/#local-development","title":"Local Development","text":""},{"location":"DOCS_SETUP/#install-dependencies","title":"Install Dependencies","text":"<pre><code>uv sync --group docs\n</code></pre>"},{"location":"DOCS_SETUP/#serve-documentation-locally","title":"Serve Documentation Locally","text":"<pre><code>uv run mkdocs serve\n</code></pre> <p>The documentation will be available at <code>http://127.0.0.1:8000</code></p>"},{"location":"DOCS_SETUP/#build-static-site","title":"Build Static Site","text":"<pre><code>uv run mkdocs build\n</code></pre> <p>The static site will be generated in the <code>site/</code> directory.</p>"},{"location":"DOCS_SETUP/#commands","title":"Commands","text":"<ul> <li><code>uv run mkdocs serve</code> - Start live-reloading dev server</li> <li><code>uv run mkdocs build</code> - Build static site</li> <li><code>uv run mkdocs gh-deploy</code> - Deploy to GitHub Pages (future)</li> </ul>"},{"location":"ci-cd/","title":"CI/CD Pipeline Documentation","text":""},{"location":"ci-cd/#overview","title":"Overview","text":"<p>The PopUp-Sim project uses GitHub Actions for continuous integration and deployment. The pipeline ensures code quality through automated formatting, linting, type checking, and testing.</p>"},{"location":"ci-cd/#workflow-structure","title":"Workflow Structure","text":"<pre><code>graph TD\n    A[Pull Request/Push to main] --&gt; B{Change Type}\n    B --&gt;|Backend Changes| C[Format Job]\n    B --&gt;|Docs Changes| N[Build Docs]\n\n    C --&gt; D[Lint Jobs]\n    C --&gt; E[Security Scan]\n    C --&gt; F[Test Job]\n\n    D --&gt; G[Ruff Lint]\n    D --&gt; H[Pylint]\n    D --&gt; I[MyPy]\n\n    E --&gt; J[Syft SBOM]\n    J --&gt; K[Grype Scan]\n    K --&gt; L[Upload SARIF]\n\n    F --&gt; M[Pytest + Coverage]\n    M --&gt; O[Upload Coverage]\n\n    N --&gt; P{Event Type}\n    P --&gt;|PR| Q[Deploy Preview]\n    P --&gt;|Push to main| R[Deploy Production]\n\n    style C fill:#e1f5fe\n    style D fill:#f3e5f5\n    style E fill:#ffebee\n    style F fill:#e8f5e8\n    style O fill:#fff3e0\n    style N fill:#fff9c4\n    style Q fill:#e0f2f1\n    style R fill:#c8e6c9</code></pre>"},{"location":"ci-cd/#backend-pipeline-jobs","title":"Backend Pipeline Jobs","text":""},{"location":"ci-cd/#1-format-job","title":"1. Format Job","text":"<p>Purpose: Ensures code formatting consistency across the codebase.</p> <p>Steps: - Checkout code - Setup uv with Python version - Install dependencies with <code>uv sync --locked --all-extras --dev</code> - Run <code>ruff format --check --diff .</code></p> <p>Output: Shows formatting differences if any exist</p>"},{"location":"ci-cd/#2-lint-jobs-parallel","title":"2. Lint Jobs (Parallel)","text":"<p>Purpose: Code quality analysis through multiple linters.</p> <p>Matrix: 3 linters (ruff, pylint, mypy)</p> <p>Dependencies: Requires format job to pass first</p>"},{"location":"ci-cd/#ruff-linting","title":"Ruff Linting","text":"<ul> <li>Command: <code>uv run ruff check --output-format=github .</code></li> <li>Focus: Code quality, unused imports, simplifications</li> <li>Output: GitHub annotations on PR lines</li> </ul>"},{"location":"ci-cd/#pylint","title":"Pylint","text":"<ul> <li>Command: <code>uv run pylint backend/src/ --output-format=colorized</code></li> <li>Focus: Additional code quality checks</li> <li>Output: Colorized terminal output</li> </ul>"},{"location":"ci-cd/#mypy-type-checking","title":"MyPy Type Checking","text":"<ul> <li>Command: <code>uv run mypy backend/src/ --show-error-codes</code></li> <li>Focus: Static type analysis</li> <li>Output: Type errors with specific error codes</li> </ul>"},{"location":"ci-cd/#3-security-scan-job","title":"3. Security Scan Job","text":"<p>Purpose: Software Bill of Materials (SBOM) generation and vulnerability scanning.</p> <p>Dependencies: Requires format job to pass first</p> <p>Tools: - Syft: Generates SBOM in SPDX-JSON format - Grype: Scans SBOM for known vulnerabilities</p> <p>Steps: - Check if dependencies exist in <code>pyproject.toml</code> - Generate SBOM with Syft (if dependencies exist) - Scan vulnerabilities with Grype - Upload SARIF results to GitHub Security tab - Upload security reports as artifacts</p> <p>Output: - SBOM file (<code>sbom.spdx.json</code>) - Vulnerability report (SARIF format) - GitHub Security alerts for found vulnerabilities</p> <p>Note: Scan is skipped if no dependencies are present. Vulnerabilities do not fail the build (<code>fail-build: false</code>).</p>"},{"location":"ci-cd/#4-test-jobs-parallel","title":"4. Test Jobs (Parallel)","text":"<p>Purpose: Run test suite with coverage reporting.</p> <p>Dependencies: Requires format job to pass first</p> <p>Steps: - Run <code>uv run pytest --tb=short</code> - Upload coverage to Codecov</p>"},{"location":"ci-cd/#documentation-pipeline-jobs","title":"Documentation Pipeline Jobs","text":""},{"location":"ci-cd/#1-build-job","title":"1. Build Job","text":"<p>Purpose: Build documentation site with MkDocs.</p> <p>Triggers: - Changes to <code>docs/**</code> - Changes to <code>mkdocs.yml</code> - Changes to <code>.github/workflows/docs.yml</code></p> <p>Steps: - Checkout code - Setup Python 3.13 - Install uv - Install dependencies with <code>uv sync --group docs</code> - Build documentation with <code>uv run mkdocs build --strict</code> - Upload site artifact</p> <p>Output: Built documentation site artifact</p>"},{"location":"ci-cd/#2-deploy-preview-job","title":"2. Deploy Preview Job","text":"<p>Purpose: Deploy PR preview for documentation changes.</p> <p>Triggers: Pull requests only</p> <p>Dependencies: Requires build job to complete</p> <p>Steps: - Download site artifact - Deploy to <code>gh-pages</code> branch under <code>pr-preview/pr-{number}/</code> - Create GitHub deployment with preview URL</p> <p>Output: PR preview URL at <code>https://openrailassociation.github.io/dac-migration-dss-popupsim/pr-preview/pr-{number}/</code></p>"},{"location":"ci-cd/#3-deploy-production-job","title":"3. Deploy Production Job","text":"<p>Purpose: Deploy documentation to GitHub Pages.</p> <p>Triggers: Push to main branch only</p> <p>Dependencies: Requires build job to complete</p> <p>Steps: - Download site artifact - Deploy to GitHub Pages with force orphan</p> <p>Output: Production site at <code>https://openrailassociation.github.io/dac-migration-dss-popupsim/</code></p>"},{"location":"ci-cd/#scheduled-security-jobs","title":"Scheduled Security Jobs","text":""},{"location":"ci-cd/#openssf-scorecard-job","title":"OpenSSF Scorecard Job","text":"<p>Purpose: Security health metrics and best practices assessment.</p> <p>Triggers: - Weekly on Sundays at 02:00 - Push to main branch - Manual workflow dispatch</p> <p>Steps: - Checkout code with harden-runner - Run OpenSSF Scorecard analysis - Upload SARIF results to GitHub Security tab - Publish results to OpenSSF REST API</p> <p>Checks Performed: - Security policy presence - Dependency update tool usage - Branch protection configuration - Code review practices - CI/CD security practices - Pinned dependencies - Vulnerability disclosure</p> <p>Output: - SARIF results in GitHub Security tab - Public scorecard on OpenSSF REST API - Security badge for README</p>"},{"location":"ci-cd/#execution-flows","title":"Execution Flows","text":""},{"location":"ci-cd/#backend-pipeline-flow","title":"Backend Pipeline Flow","text":"<pre><code>sequenceDiagram\n    participant Dev as Developer\n    participant GH as GitHub\n    participant CI as Backend Pipeline\n    participant CC as Codecov\n\n    Dev-&gt;&gt;GH: Push/PR to main (backend changes)\n    GH-&gt;&gt;CI: Trigger python-backend.yaml\n\n    CI-&gt;&gt;CI: Format check\n\n    par Parallel execution after format\n        CI-&gt;&gt;CI: Ruff lint\n    and\n        CI-&gt;&gt;CI: Pylint\n    and\n        CI-&gt;&gt;CI: MyPy\n    and\n        CI-&gt;&gt;CI: Pytest\n    end\n\n    CI-&gt;&gt;CC: Upload coverage\n    CI-&gt;&gt;GH: Report results + annotations\n    GH-&gt;&gt;Dev: Show status</code></pre>"},{"location":"ci-cd/#documentation-pipeline-flow","title":"Documentation Pipeline Flow","text":"<pre><code>sequenceDiagram\n    participant Dev as Developer\n    participant GH as GitHub\n    participant CI as Docs Pipeline\n    participant Pages as GitHub Pages\n\n    Dev-&gt;&gt;GH: Push/PR to main (docs changes)\n    GH-&gt;&gt;CI: Trigger docs.yml\n\n    CI-&gt;&gt;CI: Build documentation\n\n    alt Pull Request\n        CI-&gt;&gt;Pages: Deploy to pr-preview/pr-N/\n        CI-&gt;&gt;GH: Create deployment + comment\n        GH-&gt;&gt;Dev: Show preview URL\n    else Push to main\n        CI-&gt;&gt;Pages: Deploy to production\n        Pages-&gt;&gt;Dev: Site updated\n    end</code></pre>"},{"location":"ci-cd/#scheduled-security-flow","title":"Scheduled Security Flow","text":"<pre><code>sequenceDiagram\n    participant Cron as GitHub Scheduler\n    participant CI as Scorecard Pipeline\n    participant OSSF as OpenSSF API\n    participant GH as GitHub Security\n\n    Cron-&gt;&gt;CI: Weekly trigger (Sunday 02:00)\n    CI-&gt;&gt;CI: Run Scorecard analysis\n    CI-&gt;&gt;GH: Upload SARIF results\n    CI-&gt;&gt;OSSF: Publish scorecard\n    OSSF-&gt;&gt;CI: Badge URL</code></pre>"},{"location":"ci-cd/#configuration-details","title":"Configuration Details","text":""},{"location":"ci-cd/#triggers","title":"Triggers","text":"<ul> <li>Pull Requests: Any PR targeting <code>main</code> branch</li> <li>Push Events: Direct pushes to <code>main</code> branch</li> </ul>"},{"location":"ci-cd/#matrix-strategy","title":"Matrix Strategy","text":"<ul> <li>Backend Jobs: 5 (1 format + 3 lint + 1 test)</li> <li>Documentation Jobs: 3 (1 build + 1 preview + 1 production)</li> <li>Security Jobs: 1 (OpenSSF Scorecard, commented out: Syft/Grype)</li> </ul>"},{"location":"ci-cd/#dependencies","title":"Dependencies","text":"<ul> <li>Uses <code>uv.lock</code> file for reproducible builds</li> <li>All jobs use <code>--locked</code> flag for consistent dependency versions</li> </ul>"},{"location":"ci-cd/#caching","title":"Caching","text":"<ul> <li>uv cache enabled for faster dependency installation</li> <li>Automatic caching of Python packages and uv metadata</li> </ul>"},{"location":"ci-cd/#tools-configuration","title":"Tools Configuration","text":""},{"location":"ci-cd/#ruff","title":"Ruff","text":"<ul> <li>Format: 120 char lines, single quotes, tabs</li> <li>Lint: Focus on bugs, unused code, simplifications</li> <li>Output: GitHub annotations for PR integration</li> </ul>"},{"location":"ci-cd/#pylint_1","title":"Pylint","text":"<ul> <li>Config: Uses <code>pyproject.toml</code> configuration</li> <li>Target: <code>backend/src/</code> directory only</li> <li>Output: Colorized for better readability</li> </ul>"},{"location":"ci-cd/#mypy","title":"MyPy","text":"<ul> <li>Config: Strict type checking enabled</li> <li>Target: <code>backend/src/</code> and <code>backend/tests/</code></li> <li>Output: Error codes for easier debugging</li> </ul>"},{"location":"ci-cd/#pytest","title":"Pytest","text":"<ul> <li>Config: Coverage reporting with 90% threshold</li> <li>Output: Terminal, HTML, and XML reports</li> <li>Upload: Coverage data sent to Codecov</li> </ul>"},{"location":"ci-cd/#failure-scenarios","title":"Failure Scenarios","text":""},{"location":"ci-cd/#format-failures","title":"Format Failures","text":"<ul> <li>Cause: Code not properly formatted</li> <li>Solution: Run <code>uv run ruff format .</code> locally</li> <li>Impact: Blocks all other jobs</li> </ul>"},{"location":"ci-cd/#lint-failures","title":"Lint Failures","text":"<ul> <li>Cause: Code quality issues, type errors</li> <li>Solution: Fix issues shown in GitHub annotations</li> <li>Impact: Independent failures, doesn't block tests</li> </ul>"},{"location":"ci-cd/#security-scan-failures","title":"Security Scan Failures","text":"<ul> <li>Cause: Known vulnerabilities in dependencies</li> <li>Solution: Update vulnerable dependencies or review risk</li> <li>Impact: Does not fail build, creates GitHub Security alerts</li> </ul>"},{"location":"ci-cd/#test-failures","title":"Test Failures","text":"<ul> <li>Cause: Failing tests or coverage below threshold</li> <li>Solution: Fix tests or improve coverage</li> <li>Impact: Independent of linting and security jobs</li> </ul>"},{"location":"ci-cd/#local-development","title":"Local Development","text":"<p>To run the same checks locally:</p> <pre><code># Format check\nuv run ruff format --check --diff .\n\n# Linting\nuv run ruff check .\nuv run pylint popupsim/backend/src/\nuv run mypy\n\n# Testing\nuv run pytest\n\n# Documentation build\nuv run mkdocs build --strict\nuv run mkdocs serve  # Preview locally at http://127.0.0.1:8000\n\n# Security scanning (requires Syft and Grype installed)\nsyft popupsim/backend/src -o spdx-json=sbom.spdx.json\ngrype sbom:sbom.spdx.json\n</code></pre>"},{"location":"ci-cd/#performance-optimization","title":"Performance Optimization","text":"<ul> <li>Parallel execution: Lint and test jobs run simultaneously</li> <li>Matrix optimization: Each linter runs in separate job for better visibility</li> <li>Caching: uv cache reduces dependency installation time</li> <li>Locked dependencies: Faster installs, no resolution needed</li> </ul>"},{"location":"ci-cd/#security-scanning-details","title":"Security Scanning Details","text":""},{"location":"ci-cd/#syft-sbom-generation","title":"Syft (SBOM Generation)","text":"<ul> <li>Purpose: Creates Software Bill of Materials</li> <li>Format: SPDX-JSON (industry standard)</li> <li>Scope: Scans <code>popupsim/backend/src</code> directory</li> <li>Output: <code>sbom.spdx.json</code> artifact</li> </ul>"},{"location":"ci-cd/#grype-vulnerability-scanning","title":"Grype (Vulnerability Scanning)","text":"<ul> <li>Purpose: Identifies known vulnerabilities in dependencies</li> <li>Input: SBOM from Syft</li> <li>Database: CVE and security advisory databases</li> <li>Output: SARIF format for GitHub Security integration</li> <li>Behavior: Non-blocking (does not fail build)</li> </ul>"},{"location":"ci-cd/#security-reports","title":"Security Reports","text":"<ul> <li>GitHub Security Tab: View vulnerability alerts</li> <li>SARIF Upload: Integrates with GitHub Advanced Security</li> <li>Artifacts: SBOM and vulnerability reports downloadable</li> </ul>"},{"location":"ci-cd/#dependency-management","title":"Dependency Management","text":""},{"location":"ci-cd/#dependabot","title":"Dependabot","text":"<p>Purpose: Automated dependency updates for security and maintenance.</p> <p>Configuration: - Python Dependencies (uv): Weekly updates on Mondays at 06:00 - GitHub Actions: Weekly updates on Mondays at 06:00 - PR Limit: 10 for Python, 5 for GitHub Actions - Auto-assign: jhw-db, 36b498c8 - Labels: dependencies, python/github-actions</p> <p>Commit Prefixes: - Python deps: <code>chore(backend): \u2b06\ufe0f deps</code> - Dev deps: <code>chore(backend): \u2b06\ufe0f dev deps</code> - GitHub Actions: <code>chore: \ud83d\udc9a ci</code></p>"},{"location":"ci-cd/#openssf-scorecard","title":"OpenSSF Scorecard","text":"<p>Purpose: Security health metrics and best practices assessment.</p> <p>Schedule: - Weekly on Sundays at 02:00 - On push to main branch - Manual trigger available</p> <p>Details: See \"Scheduled Security Jobs\" section above</p>"},{"location":"ci-cd/#monitoring","title":"Monitoring","text":"<ul> <li>GitHub Actions tab: View detailed logs and job status</li> <li>PR annotations: Inline code quality feedback</li> <li>GitHub Security tab: Vulnerability alerts, SBOM, and Scorecard results</li> <li>Codecov dashboard: Coverage trends and reports</li> <li>Status checks: Required checks before merge</li> <li>OpenSSF Scorecard: Security posture metrics and recommendations OpenSSF Scorecard: Security posture metrics and recommendations</li> </ul>"},{"location":"adr/","title":"Architecture Decision Records (ADR)","text":"<p>This directory contains Architecture Decision Records for the PopUpSim project.</p>"},{"location":"adr/#what-is-an-adr","title":"What is an ADR?","text":"<p>An Architecture Decision Record (ADR) captures an important architectural decision made along with its context and consequences.</p>"},{"location":"adr/#format","title":"Format","text":"<p>Each ADR follows this structure: - Status: Proposed | Accepted | Deprecated | Superseded - Date: When the decision was made - Context: What is the issue we're seeing that is motivating this decision - Decision: What is the change that we're proposing/doing - Consequences: What becomes easier or more difficult to do because of this change</p>"},{"location":"adr/#performance-optimizations-summary","title":"Performance Optimizations Summary","text":"<p>The PopUpSim project has undergone significant performance optimizations:</p> <p>The following ADRs document performance optimizations made to the PopUpSim codebase:</p> # Title Status Impact 001 Resource Pool Incremental Utilization Tracking Accepted 30-3000x speedup 002 Wagon Collector Memory Leak Fix and Simplification Accepted 5000x memory reduction 003 CSV Adapter Dict Grouping for Train Processing Accepted 10-16x speedup 004 Event Type Routing for Metrics Collection Accepted 1.7x speedup 005 Track Selection Cached Ratios Optimization Accepted 1.57x speedup (large) 006 Batch Collection Immediate Break Optimization Accepted 15% avg speedup 007 Lazy Logging String Formatting Accepted ~1% improvement 008 Track Length Caching Accepted Avoid recomputation 009 JSON Loading Strategy and Future Scalability Accepted Future planning # Title Status Impact 001 Resource Pool Incremental Utilization Tracking Accepted 30-3000x speedup 002 Wagon Collector Memory Leak Fix and Simplification Accepted 5000x memory reduction 003 CSV Adapter Dict Grouping for Train Processing Accepted 10-16x speedup 004 Event Type Routing for Metrics Collection Accepted 1.7x speedup 005 Track Selection Cached Ratios Optimization Accepted 1.57x speedup (large) 006 Batch Collection Immediate Break Optimization Accepted 15% avg speedup 007 Lazy Logging String Formatting Accepted ~1% improvement 008 Track Length Caching Accepted Avoid recomputation 009 JSON Loading Strategy and Future Scalability Accepted Future planning <p>Resource Pool Utilization - Problem: O(n*m) quadratic complexity - Solution: Incremental tracking with O(1) updates - Result: 3,128x speedup for large scenarios</p> <p>Wagon Collector Memory Management - Problem: Unbounded dictionary growth (50MB leak) - Solution: Cleanup on exit + design simplification - Result: 5,000x memory reduction</p> <p>CSV Adapter Performance - Problem: O(n*m) pandas iterrows() with nested filtering - Solution: Pure Python dict grouping O(n+m) - Result: 10.7x speedup for large scenarios</p>"},{"location":"adr/#high-priority-optimizations","title":"High Priority Optimizations","text":"<p>Event Broadcasting - Problem: Broadcasting all events to all collectors - Solution: Event type registration and routing - Result: 1.7x speedup, 67% fewer method calls</p> <p>Track Selection Lookups - Problem: 4 dictionary lookups per track in LEAST_OCCUPIED strategy - Solution: Cache occupancy ratios during filtering - Result: 1.57x speedup for large scenarios (20+ tracks)</p> <p>Batch Collection Timeouts - Problem: Timeout events created when collecting wagon batches - Solution: Immediate break when queue empty (no timeout) - Result: 15% average speedup, simpler code</p>"},{"location":"adr/#phase-3-polish-in-progress","title":"Phase 3: Polish (In Progress)","text":"<p>Issue #8: Lazy Logging String Formatting - Problem: F-strings evaluated even when log level filters them out - Solution: Use %-formatting for lazy evaluation - Result: ~1% improvement when debug logging disabled</p> <p>Issue #9: Track Length Caching - Problem: Track total length recalculated if needed elsewhere - Solution: Cache computed length in Track entity - Result: Avoid recomputation, better encapsulation</p>"},{"location":"adr/#phase-4-future-considerations","title":"Phase 4: Future Considerations","text":"<p>Issue #10: JSON Loading Strategy - Problem: Large JSON files loaded entirely into memory - Decision: Keep current for post-MVP (&lt;50MB files) - Future: Streaming, file splitting, database, or distributed architecture</p>"},{"location":"adr/#combined-impact","title":"Combined Impact","text":"<p>For a typical large scenario (20 resources, 10 trains, 500 wagons, 10,000 events): - Resource Pool: 12.04 ms \u2192 3.85 \u03bcs (3,128x faster) - Wagon Collector: 50 MB leak \u2192 10 KB stable (5,000x reduction) - CSV Loading: 25.35 ms \u2192 2.37 ms (10.7x faster)</p> <p>Total improvement: Simulation initialization and metrics calculation are now orders of magnitude faster with minimal memory footprint.</p>"},{"location":"mvp/architecture/","title":"PopUpSim MVP - arc42 Architecture Documentation","text":""},{"location":"mvp/architecture/#overview","title":"Overview","text":"<p>This documentation describes the MVP (Minimum Viable Product) architecture of PopUpSim.</p> <p>MVP Scope: Desktop application with file-based configuration, SimPy simulation engine, and Matplotlib visualization.</p>"},{"location":"mvp/architecture/#architecture-documentation","title":"Architecture Documentation","text":"<ol> <li>Introduction and Goals - Stakeholders, quality goals, requirements overview</li> <li>Constraints - Technical and organizational constraints</li> <li>Context and Scope - System boundaries and external interfaces</li> <li>Solution Strategy - Technology decisions and architecture approach</li> <li>Building Blocks - System decomposition (3 bounded contexts, Level 2 &amp; 3)</li> <li>5a. Level 3 Implementation Details - Complete implementation architecture</li> <li>Runtime View - Key scenarios and use case flows</li> <li>Deployment View - Infrastructure and deployment</li> <li>Cross-Cutting Concepts - Domain model, error handling, logging</li> <li>Architecture Decisions - ADRs for key technology choices</li> <li>Quality Requirements - Quality scenarios and metrics</li> <li>Risks and Technical Debt - Known risks and debt</li> <li>Glossary - Domain and technical terms</li> <li>Bibliography - References and resources</li> </ol>"},{"location":"mvp/architecture/#key-architecture-characteristics","title":"Key Architecture Characteristics","text":"<ul> <li>4 Bounded Contexts: Configuration, Retrofit Workflow, Railway Infrastructure, External Trains</li> <li>Layered Architecture: Clean separation within each context</li> <li>Technology Stack: Python 3.13+, SimPy, Pydantic, Matplotlib</li> <li>Deployment: Desktop application (local execution)</li> <li>Data Storage: File-based (JSON/CSV)</li> <li>Integration: Direct method calls (synchronous)</li> </ul>"},{"location":"mvp/architecture/#quick-links","title":"Quick Links","text":"<ul> <li>Quality Goals - Top 5 quality priorities</li> <li>Use Cases - 4 MVP use cases</li> <li>Technology Decisions - Key ADRs</li> <li>Building Blocks - System structure (4 contexts)</li> <li>Glossary - Domain and technical terms</li> </ul>"},{"location":"mvp/architecture/01-introduction-goals/","title":"1. Introduction and Goals","text":""},{"location":"mvp/architecture/01-introduction-goals/#11-task-description","title":"1.1 Task Description","text":"<p>PopUpSim is a microscopic simulation system for optimizing Pop-Up retrofitting sites during the DAC (Digital Automatic Coupling) \"Big Bang\" migration phase. The DAC migration involves retrofitting approximately 500,000 freight wagons across Europe (2029-2034) using the \"DAC-Ready\" method as describen in [1]. This two-phase approach first pre-equips wagons over 4 years while maintaining screw couplings, then performs rapid final conversion during a critical 3-week \"Big Bang\" period. PopUpSim focuses specifically on this three week period optimizing temporary Pop-Up workshops that handle the time-critical \"Big Bang\" conversions without disrupting regular railway operations.</p> <p>PopUpSim focuses on individual Pop-Up site simulation rather than modeling the entire 500,000 wagon migration. The system uses microscopic modeling to track individual wagons and resources as they move through workshop layouts, enabling iterative testing of different configurations to optimize throughput and identify bottlenecks. This approach supports all migration phases from strategic planning through implementation.</p> <p>The system consists of three main components working together to provide comprehensive simulation capabilities. The scenario setup component handles infrastructure and parameter configuration, allowing users to define track topology, allocate resources, set timing parameters, and establish operational rules. The simulation engine performs microscopic wagon movement simulation, tracking individual wagons through their journey while managing resource utilization, queue dynamics, and processing workflows. Finally, the analysis and visualization component processes simulation results to generate throughput metrics, utilization statistics, and bottleneck analysis, presenting findings through interactive charts and \"film\" playback of the simulation process.</p> <p>PopUpSim is developed as open source software under the Apache 2.0 license [5] to ensure transparency and enable cross-company collaboration across the European railway industry. The project is hosted at GitHub [3] under the umbrella of the Open Rail Association [6], facilitating cooperation between railway companies and supporting the development of a shared solution for the DAC migration challenge. This community-driven approach allows individual railway companies to adapt and extend the system for their specific requirements while contributing improvements back to the broader community. The development builds upon a successful prototype created during the 3-L\u00e4nderhack 2024 hackathon [4], demonstrating the feasibility of the core simulation concepts.</p>"},{"location":"mvp/architecture/01-introduction-goals/#12-quality-goals","title":"1.2 Quality Goals","text":"Priority Quality Goal Scenario Stakeholder 1 Rapid development MVP can be developend in 5 weeks PopUpSim team 2 Simulation Accuracy &amp; Reliability Simulation results are accurate and reliable for layout optimization decisions Strategic Migration Planner, Company Planner 3 Usability &amp; Accessibility Users can import infrastructure data, configure Pop-Up layouts, and run simulations efficiently Company Planner, Dispatcher 4 Simple installation PopUpSim can be easily installed on hardware like laptops All users 5 Testability The domain logic is testable Software Developers"},{"location":"mvp/architecture/01-introduction-goals/#13-stakeholders","title":"1.3 Stakeholders","text":"Role Contact Expectations Strategic Migration Planner DB Cargo Migration Team Develop standardized Pop-Up workshop designs, estimate workshop throughput capacity, validate migration strategies Company Planner Railway Undertakings (e.g. DB, SBB, \u00d6BB) Import infrastructure data easily, assess workshop capacity , get clear graphical/tabular output for internal planning Deployment Manager European Migration Coordination Validate company plans fit together, monitor implementation progress, ensure Big Bang timeline (2029-2034) is achievable Dispatcher Pop-Up Workshop Operations Get recommendations for next wagon assignments, support operational disposition decisions during 3-week Big Bang windows Open Rail Association Project Governance Ensure open source transparency, coordinate cross-company collaboration, maintain Apache 2.0 licensing compliance Open Rail Association Members e.g SNCF, SBB, \u00d6BB Possible contacts to other migration teams in other railway companies Software Developers Open Source Community Understand system architecture, contribute enhancements, adapt for company-specific DAC migration requirements Skydeck Accelarator DB Systel GmbH Demonstatration of results <p>[!NOTE] Harmonize with Stakeholder list.</p>"},{"location":"mvp/architecture/01-introduction-goals/#14-mvp-scope","title":"1.4 MVP Scope","text":"<p>PopUpSim MVP focuses on 4 priority use cases to validate the simulation approach:</p> <p>Strategic Phase: - US-001: Develop standardized Pop-Up workshops - US-002: Estimate throughput for workshop layouts</p> <p>Detail Planning Phase: - US-003: Import infrastructure data - US-004: Assess capacity for planned workshop</p> <p>Complete requirements: requirements/use-cases.md (8 use cases total)</p> <p>MVP Implementation: - File-based configuration (JSON/CSV) - SimPy discrete event simulation - CSV export + Matplotlib visualization</p> <p>Scope Reductions vs. Full Version: The scope is reduced compared to the full version: - Use Cases: 4 priority use cases (vs. 8 total) - Architecture: 3 simplified contexts (vs. more specialized contexts with event-driven architecture) - UI: Matplotlib charts (vs. web interface) - Data: File-based (vs. web interface) - Integration: Direct service calls (vs. event-driven messaging) - Deployment: Desktop only (vs. cloud-ready)</p>"},{"location":"mvp/architecture/02-constraints/","title":"2. Architecture Constraints (MVP)","text":""},{"location":"mvp/architecture/02-constraints/#21-organizational-and-business-constraints","title":"2.1 Organizational and Business Constraints","text":"Constraint Description MVP Impact Open Source License Apache 2.0 license under Open Rail Association All code publicly available and transparent License Compatibility All third-party dependencies must be compatible with Apache 2.0 Limits choice of libraries and frameworks Development Timeline Maximum 5 weeks development time Simplified 3-context architecture instead of more specialized contexts Team Size 3 backend developers No frontend developer, file-based UI only Multi-Company Collaboration European railway companies (DB, SBB, \u00d6BB) might use PopUpSim Architecture must be adaptable to different requirements Big Bang Timeline Support Must simulate 3-week Big Bang conversion periods Performance requirements for time-critical operations Single Site Simulation One Pop-Up site with one layout at a time Architecture focused on single-site efficiency Microscopic Simulation Individual wagons/resources modeling Cannot use macroscopic or aggregate approaches Workshop Operations Focus Pop-Up workshop operations only Cannot include general railway operations Prototype Foundation Reuse suitable components from 3-L\u00e4nderhack 2024 prototype Leverage proven SimPy approach"},{"location":"mvp/architecture/02-constraints/#22-technical-constraints","title":"2.2 Technical Constraints","text":"Constraint Description MVP Impact Operating System Support Windows, Linux, macOS Cross-platform Python compatibility GitHub Repository https://github.com/OpenRailAssociation/dac-migration-dss-popupsim Version control and collaboration platform Python Backend Python 3.13+ for backend development Backend limited to Python ecosystem SimPy Framework Discrete event simulation engine Event-driven simulation paradigm required Deterministic Simulation Reproducible results required Enables reliable testing and layout comparison File-Based Data CSV/JSON input/output only No database installation required Matplotlib Visualization Charts and graphs output No web frontend in MVP No Admin Rights Installation without administrator privileges Lightweight, self-contained architecture Laptop Hardware Must run on standard laptops (4GB RAM minimum) Memory and computational complexity constraints Offline Operation Core functionality works without internet Self-contained operation Simulation Scale Must handle up to 1,000 wagons Memory management and algorithm efficiency Code Format PEP-8 with type hints, Ruff formatting Python coding standards Type Checking MyPy type checking required Code quality and maintainability Testing Framework pytest for all tests Standardized testing approach Documentation Format Markdown for all documentation Documentation toolchain standard Architecture Documentation Must use arc42 template Standardized architecture documentation structure Architecture Decision Records Must document significant architectural decisions using ADRs Maintains decision history and rationale"},{"location":"mvp/architecture/03-context/","title":"3. System Scope and Context (MVP)","text":""},{"location":"mvp/architecture/03-context/#31-business-context","title":"3.1 Business Context","text":"<p>PopUpSim MVP's Role:</p> <p>PopUpSim MVP is a proof-of-concept desktop tool for simulating Pop-Up workshop operations during the DAC migration. The MVP validates the simulation approach with 4 priority use cases before building the full web-based version.</p> <p>MVP Business Logic: 1. Developers configure scenarios using JSON/CSV files 2. MVP simulates retrofit workflow using SimPy discrete event simulation 3. Results exported to CSV/PNG for manual analysis 4. Validates simulation approach for full version development</p> <pre><code>C4Context\n    title Business Context - PopUpSim MVP\n\n    Person(developer, \"Developer\", \"Creates scenarios, runs simulations, validates results\")\n    Person(planner, \"Workshop Planner\", \"Reviews results, provides feedback on simulation logic\")\n\n    System(popupsim_mvp, \"PopUpSim MVP\", \"Desktop simulation tool: file-based configuration, SimPy engine, Matplotlib output\")\n\n    SystemDb_Ext(config_files, \"Configuration Files\", \"JSON/CSV scenario definitions\")\n    SystemDb(results_files, \"Result Files\", \"CSV data + PNG charts\")\n\n    Rel(developer, config_files, \"Creates/edits\")\n    Rel(developer, popupsim_mvp, \"Runs simulation\")\n    Rel(popupsim_mvp, config_files, \"Reads configuration\")\n    Rel(popupsim_mvp, results_files, \"Writes results\")\n    Rel(developer, results_files, \"Analyzes\")\n    Rel(planner, results_files, \"Reviews for validation\")</code></pre>"},{"location":"mvp/architecture/03-context/#311-communication-partners","title":"3.1.1 Communication Partners","text":"External Entity Input to MVP Output from MVP Business Purpose Developer Scenario configurations, test data Simulation results, KPI data Develop and validate simulation logic Workshop Planner Requirements, feedback Result analysis, throughput estimates Validate simulation accuracy against real-world expectations Configuration Files Scenario definitions, workshop setup, train schedules - Define simulation parameters and input data Result Files - CSV data, PNG charts, JSON logs Store simulation results for analysis"},{"location":"mvp/architecture/03-context/#32-technical-context","title":"3.2 Technical Context","text":"<pre><code>C4Context\n    title Technical Context - PopUpSim MVP\n\n    Person(users, \"Users\", \"Developers/Planners\")\n\n    System_Boundary(mvp_boundary, \"PopUpSim MVP\") {\n        Container(main, \"Main Application\", \"Python Script\", \"Entry point, orchestrates simulation\")\n        Container(config_reader, \"Configuration Context\", \"Python + Pydantic\", \"Parses and validates JSON/CSV\")\n        Container(sim_engine, \"Workshop Operations Context\", \"Python + SimPy\", \"Discrete event simulation\")\n        Container(output_gen, \"Analysis &amp; Reporting Context\", \"Python + Matplotlib\", \"Creates CSV and PNG outputs\")\n    }\n\n    SystemDb_Ext(config_files, \"Configuration Files\", \"JSON/CSV on Local FS\")\n    SystemDb(results_storage, \"Results Storage\", \"Local File System\")\n\n    Rel(users, main, \"Executes\", \"Command line\")\n    Rel(main, config_reader, \"Loads configuration\")\n    Rel(config_reader, config_files, \"File I/O\", \"Read\")\n    Rel(main, sim_engine, \"Runs simulation\")\n    Rel(sim_engine, output_gen, \"Passes results\")\n    Rel(output_gen, results_storage, \"File I/O\", \"Write\")\n    Rel(users, results_storage, \"Analyzes\", \"Manual review\")</code></pre>"},{"location":"mvp/architecture/03-context/#321-technical-channels","title":"3.2.1 Technical Channels","text":"Channel Transmission Media Protocol/Format Direction Description Configuration Input Local File System File I/O (JSON/CSV) Input Scenario configuration files Results Output Local File System File I/O (CSV/PNG/JSON) Output Simulation results and visualizations Internal Communication Process Memory Python function calls Internal Direct method invocation between components"},{"location":"mvp/architecture/03-context/#322-security-and-quality-requirements","title":"3.2.2 Security and Quality Requirements","text":"<p>Local Deployment Security: - Input validation with Pydantic schema validation - File system permissions using standard OS user permissions - No network access required (fully offline)</p> <p>Operational Considerations: - Error logging to console and log files - Progress indicators for simulation execution - Input file validation before simulation starts</p>"},{"location":"mvp/architecture/03-context/#33-data-flow-context","title":"3.3 Data Flow Context","text":""},{"location":"mvp/architecture/03-context/#331-input-data-flow","title":"3.3.1 Input Data Flow","text":"<pre><code>flowchart LR\n    subgraph \"Input Sources\"\n        manual[\"Manual Files&lt;br/&gt;\u2022 JSON editing&lt;br/&gt;\u2022 CSV creation\"]\n        templates[\"Templates&lt;br/&gt;\u2022 Example configs&lt;br/&gt;\u2022 Test scenarios\"]\n    end\n\n    subgraph \"Processing\"\n        validation[\"Input Validation&lt;br/&gt;\u2022 Pydantic schemas&lt;br/&gt;\u2022 Business rules\"]\n        parsing[\"Data Parsing&lt;br/&gt;\u2022 JSON/CSV processing&lt;br/&gt;\u2022 Type conversion\"]\n    end\n\n    subgraph \"Configuration Data\"\n        scenario[\"Scenario Parameters\"]\n        workshop[\"Workshop Configuration\"]\n        schedule[\"Train Schedules\"]\n        routes[\"Routes\"]\n        topology[\"Track Infrastructure\"]\n    end\n\n    subgraph \"Simulation\"\n        simulation[\"SimPy Simulation&lt;br/&gt;\u2022 Event processing&lt;br/&gt;\u2022 State management\"]\n    end\n\n    manual --&gt; validation\n    templates --&gt; validation\n    validation --&gt; parsing\n    parsing --&gt; scenario\n    parsing --&gt; workshop\n    parsing --&gt; schedule\n    parsing --&gt; routes\n    parsing --&gt; topology\n\n    topology --&gt; routes\n    routes --&gt; schedule\n    topology --&gt; workshop\n\n    scenario --&gt; simulation\n    workshop --&gt; simulation\n    schedule --&gt; simulation\n    routes --&gt; simulation\n    topology --&gt; simulation\n\n    classDef input fill:#e3f2fd\n    classDef process fill:#fff3e0\n    classDef data fill:#f3e5f5\n    classDef sim fill:#e8f5e8\n\n    class manual,templates input\n    class validation,parsing process\n    class scenario,workshop,schedule data\n    class simulation sim</code></pre>"},{"location":"mvp/architecture/03-context/#332-output-data-flow","title":"3.3.2 Output Data Flow","text":"<pre><code>flowchart TB\n    subgraph \"Simulation Execution\"\n        sim_engine[\"Simulation Engine&lt;br/&gt;\u2022 SimPy event simulation&lt;br/&gt;\u2022 Generates events during runtime\"]\n        analysis_engine[\"Analysis Engine&lt;br/&gt;\u2022 Processes events in real-time&lt;br/&gt;\u2022 Calculates KPIs during simulation\"]\n    end\n\n    subgraph \"Output Processing\"\n        formatting[\"Output Formatting&lt;br/&gt;\u2022 CSV export&lt;br/&gt;\u2022 Chart generation\"]\n    end\n\n    sim_engine --&gt; analysis_engine\n    analysis_engine --&gt; formatting\n\n    subgraph \"File Output\"\n        files[\"Result Files&lt;br/&gt;\u2022 CSV (KPIs)&lt;br/&gt;\u2022 PNG (Charts)&lt;br/&gt;\u2022 JSON (Logs)\"]\n    end\n\n    formatting --&gt; files\n\n    classDef sim fill:#e8f5e8\n    classDef process fill:#fff3e0\n    classDef output fill:#f3e5f5\n\n    class sim_engine,analysis_engine sim\n    class formatting process\n    class files output</code></pre>"},{"location":"mvp/architecture/03-context/#34-critical-dependencies-analysis","title":"3.4 Critical Dependencies Analysis","text":""},{"location":"mvp/architecture/03-context/#341-current-critical-dependencies","title":"3.4.1 Current Critical Dependencies","text":"Dependency Criticality Failure Impact Mitigation Strategy Python Runtime (3.13+) High System inoperable Version pinning, startup checks SimPy Library High Simulation engine fails Version pinning, dependency monitoring Configuration Files High Cannot start simulation Validation, example files, clear error messages File System Access High Cannot save/load data Permission checks, error handling Matplotlib Medium No visualizations CSV output still available Pandas Medium Slower CSV processing Native Python CSV fallback"},{"location":"mvp/architecture/04-solution-strategy/","title":"4. Solution Strategy","text":""},{"location":"mvp/architecture/04-solution-strategy/#41-top-level-decomposition","title":"4.1 Top-Level Decomposition","text":"<p>Primary Decomposition: Domain-Driven Design with 4 bounded contexts.</p> <p>Rationale: Separating concerns by domain responsibility enables: - Clear ownership of functionality - Independent development and testing - Maintainable codebase with explicit boundaries - Scalable architecture for future enhancements</p> <pre><code>graph TB\n    subgraph \"PopUpSim - 4 Bounded Contexts\"\n        CFG[\"Configuration Context&lt;br/&gt;File loading &amp; validation&lt;br/&gt;Pydantic models\"]\n        RWF[\"Retrofit Workflow Context&lt;br/&gt;Core simulation logic&lt;br/&gt;SimPy coordinators\"]\n        RLY[\"Railway Infrastructure Context&lt;br/&gt;Track management&lt;br/&gt;Domain aggregates\"]\n        EXT[\"External Trains Context&lt;br/&gt;Train arrivals&lt;br/&gt;Event publishing\"]\n    end\n\n    CFG --&gt;|Scenario| RWF\n    CFG --&gt;|Scenario| RLY\n    CFG --&gt;|Scenario| EXT\n    RLY &lt;--&gt;|Track state| RWF\n    EXT --&gt;|Events| RWF\n\n    classDef context fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    class CFG,RWF,RLY,EXT context</code></pre>"},{"location":"mvp/architecture/04-solution-strategy/#context-responsibilities","title":"Context Responsibilities","text":"Context Core Responsibility Key Components Configuration Load and validate scenario files FileLoader, ConfigurationBuilder, Pydantic models Retrofit Workflow Execute simulation, coordinate wagon flow 4 coordinators, domain services, resource managers Railway Infrastructure Manage track capacity and occupancy TrackGroup, Track, TrackOccupancy, TrackSelector External Trains Handle train arrivals, create wagons TrainSchedule, ExternalTrain, Wagon entities"},{"location":"mvp/architecture/04-solution-strategy/#42-technology-decisions","title":"4.2 Technology Decisions","text":"Technology Purpose Rationale SimPy Discrete event simulation Deterministic, Python-native, proven in POC Pydantic 2.0 Data validation Type safety, excellent validation, performance Pandas CSV processing Efficient data loading, train schedule parsing Matplotlib Visualization Simple charts, no web server required Typer CLI interface User-friendly command-line interface uv Package management Fast, reliable dependency management"},{"location":"mvp/architecture/04-solution-strategy/#43-architectural-patterns","title":"4.3 Architectural Patterns","text":""},{"location":"mvp/architecture/04-solution-strategy/#431-bounded-contexts-ddd","title":"4.3.1 Bounded Contexts (DDD)","text":"<p>Each context has clear boundaries and responsibilities: - Configuration: Input boundary - loads external data - Retrofit Workflow: Core domain - simulation execution - Railway Infrastructure: Supporting domain - track management - External Trains: Supporting domain - wagon lifecycle</p>"},{"location":"mvp/architecture/04-solution-strategy/#432-layered-architecture","title":"4.3.2 Layered Architecture","text":"<p>Within each context:</p> <pre><code>Application Layer    \u2192 Coordinators, services, orchestration\nDomain Layer         \u2192 Entities, aggregates, domain services\nInfrastructure Layer \u2192 SimPy adapters, resource managers\n</code></pre>"},{"location":"mvp/architecture/04-solution-strategy/#433-coordinator-pattern","title":"4.3.3 Coordinator Pattern","text":"<p>Retrofit Workflow uses 4 specialized coordinators: 1. ArrivalCoordinator - Process train arrivals 2. CollectionCoordinator - Move wagons to retrofit track 3. WorkshopCoordinator - Execute retrofit operations 4. ParkingCoordinator - Move completed wagons to parking</p> <p>Each coordinator runs as independent SimPy process.</p>"},{"location":"mvp/architecture/04-solution-strategy/#434-domain-services-no-simpy-dependencies","title":"4.3.4 Domain Services (No SimPy Dependencies)","text":"<p>Business logic isolated from simulation framework: - BatchFormationService - Create wagon batches - RakeFormationService - Form/dissolve wagon rakes - TrainFormationService - Assemble trains - WorkshopSchedulingService - Schedule workshops - CouplingService - Calculate coupling times</p> <p>Benefits: - Testable without SimPy - Reusable across contexts - Clear business logic</p>"},{"location":"mvp/architecture/04-solution-strategy/#44-integration-strategy","title":"4.4 Integration Strategy","text":""},{"location":"mvp/architecture/04-solution-strategy/#441-event-driven-communication","title":"4.4.1 Event-Driven Communication","text":"<p>Contexts communicate via domain events: - TrainArrivedEvent - External Trains \u2192 Retrofit Workflow - WagonMovedEvent - Retrofit Workflow \u2192 Railway Infrastructure - SimulationLifecycleEvents - Broadcast to all contexts</p>"},{"location":"mvp/architecture/04-solution-strategy/#442-direct-dependencies","title":"4.4.2 Direct Dependencies","text":"<p>Some contexts have direct dependencies: - Retrofit Workflow queries Railway Infrastructure for track capacity - All contexts receive Scenario from Configuration</p>"},{"location":"mvp/architecture/04-solution-strategy/#443-single-source-of-truth","title":"4.4.3 Single Source of Truth","text":"<ul> <li>Wagons: External Trains Context owns wagon entities</li> <li>Tracks: Railway Infrastructure Context owns track state</li> <li>Simulation State: Retrofit Workflow Context coordinates execution</li> </ul>"},{"location":"mvp/architecture/04-solution-strategy/#45-simulation-execution-flow","title":"4.5 Simulation Execution Flow","text":"<pre><code>sequenceDiagram\n    participant Main\n    participant Config\n    participant ExtTrains\n    participant Railway\n    participant Retrofit\n\n    Main-&gt;&gt;Config: Load scenario\n    Config--&gt;&gt;Main: Validated scenario\n    Main-&gt;&gt;Railway: Initialize tracks\n    Main-&gt;&gt;ExtTrains: Set scenario\n    Main-&gt;&gt;Retrofit: Initialize context\n    Main-&gt;&gt;Retrofit: Start processes\n    Retrofit-&gt;&gt;Retrofit: Start coordinators\n    ExtTrains-&gt;&gt;Retrofit: TrainArrivedEvent\n    Retrofit-&gt;&gt;Railway: Query track capacity\n    Railway--&gt;&gt;Retrofit: Available capacity\n    Retrofit-&gt;&gt;Retrofit: Execute workflow\n    Retrofit--&gt;&gt;Main: Simulation complete\n    Main-&gt;&gt;Retrofit: Export results</code></pre>"},{"location":"mvp/architecture/04-solution-strategy/#46-key-design-decisions","title":"4.6 Key Design Decisions","text":""},{"location":"mvp/architecture/04-solution-strategy/#461-removed-legacy-code","title":"4.6.1 Removed Legacy Code","text":"<p>Cleaned up unused infrastructure: - Removed step-by-step configuration building (API-driven) - Removed legacy workflow strategies - Removed analytics context (metrics in Retrofit Workflow) - Simplified ConfigurationBuilder to file loading only</p>"},{"location":"mvp/architecture/04-solution-strategy/#462-coordinator-configuration-pattern","title":"4.6.2 Coordinator Configuration Pattern","text":"<p>Coordinators use configuration objects: <pre><code>@dataclass\nclass CollectionCoordinatorConfig:\n    env: Environment\n    collection_queue: Store\n    retrofit_queue: Store\n    batch_service: BatchFormationService\n    track_selector: TrackSelectionService\n    locomotive_manager: LocomotiveResourceManager\n    # ... event publishers, etc.\n</code></pre></p> <p>Benefits: - Clear dependencies - Easy testing with mocks - Reduced constructor complexity</p>"},{"location":"mvp/architecture/04-solution-strategy/#463-resource-management","title":"4.6.3 Resource Management","text":"<p>Three resource managers handle capacity: - LocomotiveResourceManager - SimPy Resource for locomotives - TrackCapacityManager - Track capacity and wagon placement - WorkshopResourceManager - SimPy Resource for workshop stations</p>"},{"location":"mvp/architecture/04-solution-strategy/#464-metrics-collection","title":"4.6.4 Metrics Collection","text":"<p>Retrofit Workflow collects metrics during simulation: - Real-time event collection - Post-simulation aggregation - CSV export with summary statistics</p>"},{"location":"mvp/architecture/04-solution-strategy/#47-quality-attributes","title":"4.7 Quality Attributes","text":""},{"location":"mvp/architecture/04-solution-strategy/#471-maintainability","title":"4.7.1 Maintainability","text":"<ul> <li>Clear context boundaries</li> <li>Domain services without framework dependencies</li> <li>Comprehensive type hints (MyPy strict mode)</li> <li>Consistent code formatting (Ruff)</li> </ul>"},{"location":"mvp/architecture/04-solution-strategy/#472-testability","title":"4.7.2 Testability","text":"<ul> <li>Unit tests for domain services</li> <li>Integration tests for coordinators</li> <li>Validation tests for full scenarios</li> <li>Mock-friendly architecture</li> </ul>"},{"location":"mvp/architecture/04-solution-strategy/#473-performance","title":"4.7.3 Performance","text":"<ul> <li>Deterministic simulation (reproducible results)</li> <li>Efficient track capacity queries</li> <li>Batch processing for locomotive utilization</li> <li>Minimal memory footprint</li> </ul>"},{"location":"mvp/architecture/04-solution-strategy/#474-extensibility","title":"4.7.4 Extensibility","text":"<ul> <li>New coordinators can be added</li> <li>Track selection strategies pluggable</li> <li>Event-driven allows new subscribers</li> <li>Configuration supports new parameters</li> </ul>"},{"location":"mvp/architecture/04-solution-strategy/#48-technology-stack","title":"4.8 Technology Stack","text":"<pre><code>Python 3.13+          \u2192 Latest stable Python\nSimPy                 \u2192 Discrete event simulation\nPydantic 2.0+         \u2192 Data validation\nPandas                \u2192 CSV processing\nMatplotlib            \u2192 Visualization\nTyper                 \u2192 CLI interface\nuv                    \u2192 Package management\npytest                \u2192 Testing framework\nmypy                  \u2192 Static type checking\nruff                  \u2192 Linting and formatting\npylint                \u2192 Code quality analysis\n</code></pre>"},{"location":"mvp/architecture/04-solution-strategy/#49-deployment-model","title":"4.9 Deployment Model","text":"<p>Single Application Deployment: - Desktop application with CLI - File-based input/output - No web server required - No database required - Runs on Windows/Linux/macOS</p> <p>Execution: <pre><code>uv run python src/main.py --scenario path/to/scenario --output path/to/output\n</code></pre></p>"},{"location":"mvp/architecture/04-solution-strategy/#410-future-enhancements","title":"4.10 Future Enhancements","text":"<p>Potential extensions (not in current scope): - Web interface for configuration and visualization - Real-time simulation monitoring - Database persistence for large scenarios - Distributed simulation for massive scale - API for integration with other systems - Advanced optimization algorithms</p>"},{"location":"mvp/architecture/05-building-blocks/","title":"5. Building Block View","text":""},{"location":"mvp/architecture/05-building-blocks/#51-level-1-system-context","title":"5.1 Level 1: System Context","text":"<p>PopUpSim consists of 4 bounded contexts following Domain-Driven Design principles.</p> <pre><code>graph TB\n    subgraph \"PopUpSim System\"\n        CFG[\"Configuration Context&lt;br/&gt;File loading &amp; validation\"]\n        RWF[\"Retrofit Workflow Context&lt;br/&gt;Core simulation logic\"]\n        RLY[\"Railway Infrastructure Context&lt;br/&gt;Track management\"]\n        EXT[\"External Trains Context&lt;br/&gt;Train arrivals\"]\n    end\n\n    subgraph \"External\"\n        Files[\"Configuration Files&lt;br/&gt;JSON/CSV\"]\n        Output[\"Results&lt;br/&gt;CSV/JSON\"]\n    end\n\n    Files --&gt;|Load| CFG\n    CFG --&gt;|Scenario| RWF\n    CFG --&gt;|Scenario| RLY\n    CFG --&gt;|Scenario| EXT\n    RLY &lt;--&gt;|Track state| RWF\n    EXT --&gt;|Train arrivals| RWF\n    RWF --&gt;|Export| Output\n\n    classDef context fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef external fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n\n    class CFG,RWF,RLY,EXT context\n    class Files,Output external</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#contained-building-blocks","title":"Contained Building Blocks","text":"Context Responsibility Technology Configuration Load and validate scenario files Pydantic, Pandas Retrofit Workflow Execute simulation, coordinate wagon flow SimPy, domain services Railway Infrastructure Manage track capacity and occupancy Domain aggregates External Trains Handle train arrivals and wagon creation Event publishing"},{"location":"mvp/architecture/05-building-blocks/#key-interfaces","title":"Key Interfaces","text":"Interface Source Target Description Scenario Configuration All contexts Validated configuration data Track Operations Railway Infrastructure Retrofit Workflow Track capacity queries and wagon placement Train Arrivals External Trains Retrofit Workflow TrainArrivedEvent with wagons Event Bus All contexts All contexts Domain event communication"},{"location":"mvp/architecture/05-building-blocks/#52-level-2-configuration-context","title":"5.2 Level 2: Configuration Context","text":""},{"location":"mvp/architecture/05-building-blocks/#responsibility","title":"Responsibility","text":"<p>Load scenario configuration from files and validate using Pydantic models.</p> <pre><code>graph TB\n    subgraph \"Configuration Context\"\n        Builder[\"ConfigurationBuilder&lt;br/&gt;Entry point\"]\n        Loader[\"FileLoader&lt;br/&gt;File parsing\"]\n        Models[\"Domain Models&lt;br/&gt;Pydantic validation\"]\n    end\n\n    Files[\"JSON/CSV Files\"] --&gt; Builder\n    Builder --&gt; Loader\n    Loader --&gt; Models\n    Models --&gt; Scenario[\"Validated Scenario\"]\n\n    classDef component fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef external fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n\n    class Builder,Loader,Models component\n    class Files,Scenario external</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#components","title":"Components","text":"Component Responsibility Implementation ConfigurationBuilder Load scenario from file path <code>configuration_builder.py</code> FileLoader Parse JSON/CSV files, handle references <code>file_loader.py</code> Scenario Root configuration model with validation <code>scenario.py</code> ProcessTimes Timing configuration for operations <code>process_times.py</code> DTOs Input data transfer objects <code>dtos/</code>"},{"location":"mvp/architecture/05-building-blocks/#code-example","title":"Code Example","text":"<pre><code>from pathlib import Path\nfrom contexts.configuration.domain.configuration_builder import ConfigurationBuilder\n\n# Load scenario\nscenario = ConfigurationBuilder(Path(\"scenario_dir\")).build()\n\n# Access configuration\nprint(f\"Scenario: {scenario.id}\")\nprint(f\"Workshops: {len(scenario.workshops)}\")\nprint(f\"Trains: {len(scenario.trains)}\")\n</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#53-level-2-retrofit-workflow-context","title":"5.3 Level 2: Retrofit Workflow Context","text":""},{"location":"mvp/architecture/05-building-blocks/#responsibility_1","title":"Responsibility","text":"<p>Execute discrete event simulation coordinating wagon flow through the retrofit process.</p> <pre><code>graph TB\n    subgraph \"Retrofit Workflow Context\"\n        Context[\"RetrofitWorkflowContext&lt;br/&gt;Initialization &amp; orchestration\"]\n        Arrival[\"ArrivalCoordinator&lt;br/&gt;Process train arrivals\"]\n        Collection[\"CollectionCoordinator&lt;br/&gt;Move to retrofit track\"]\n        Workshop[\"WorkshopCoordinator&lt;br/&gt;Retrofit operations\"]\n        Parking[\"ParkingCoordinator&lt;br/&gt;Move to parking\"]\n        Services[\"Domain Services&lt;br/&gt;Business logic\"]\n        Resources[\"Resource Managers&lt;br/&gt;Locomotives, tracks, workshops\"]\n    end\n\n    Context --&gt; Arrival\n    Context --&gt; Collection\n    Context --&gt; Workshop\n    Context --&gt; Parking\n    Arrival --&gt; Services\n    Collection --&gt; Services\n    Workshop --&gt; Services\n    Parking --&gt; Services\n    Services --&gt; Resources\n\n    classDef component fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n\n    class Context,Arrival,Collection,Workshop,Parking,Services,Resources component</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#components_1","title":"Components","text":""},{"location":"mvp/architecture/05-building-blocks/#coordinators-application-layer","title":"Coordinators (Application Layer)","text":"Coordinator Responsibility SimPy Process ArrivalCoordinator Receive trains, classify wagons, distribute to collection tracks Yes CollectionCoordinator Form batches, allocate locomotive, transport to retrofit track Yes WorkshopCoordinator Assign wagons to workshops, execute retrofit, return to retrofitted track Yes ParkingCoordinator Transport completed wagons to parking tracks Yes"},{"location":"mvp/architecture/05-building-blocks/#domain-services-no-simpy-dependencies","title":"Domain Services (No SimPy Dependencies)","text":"Service Responsibility BatchFormationService Create wagon batches based on capacity constraints RakeFormationService Form and dissolve wagon rakes with coupling logic TrainFormationService Assemble trains (locomotive + rake) with preparation times WorkshopSchedulingService Schedule wagon batches to available workshops CouplingService Calculate coupling/decoupling times RouteService Provide route durations between tracks"},{"location":"mvp/architecture/05-building-blocks/#resource-managers-infrastructure-layer","title":"Resource Managers (Infrastructure Layer)","text":"Manager Responsibility LocomotiveResourceManager Allocate and release locomotives (SimPy Resource) TrackCapacityManager Manage track capacity and wagon placement WorkshopResourceManager Manage workshop station availability (SimPy Resource)"},{"location":"mvp/architecture/05-building-blocks/#workflow-sequence","title":"Workflow Sequence","text":"<pre><code>sequenceDiagram\n    participant Train\n    participant Arrival\n    participant Collection\n    participant Workshop\n    participant Parking\n\n    Train-&gt;&gt;Arrival: TrainArrivedEvent\n    Arrival-&gt;&gt;Arrival: Classify wagons\n    Arrival-&gt;&gt;Collection: Add to collection queue\n    Collection-&gt;&gt;Collection: Form batch\n    Collection-&gt;&gt;Collection: Allocate locomotive\n    Collection-&gt;&gt;Workshop: Transport to retrofit track\n    Workshop-&gt;&gt;Workshop: Select workshop\n    Workshop-&gt;&gt;Workshop: Allocate stations\n    Workshop-&gt;&gt;Workshop: Execute retrofit\n    Workshop-&gt;&gt;Parking: Move to retrofitted track\n    Parking-&gt;&gt;Parking: Form batch\n    Parking-&gt;&gt;Parking: Transport to parking</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#code-example-coordinator-structure","title":"Code Example: Coordinator Structure","text":"<pre><code>class CollectionCoordinator:\n    \"\"\"Coordinates wagon movement from collection to retrofit track.\"\"\"\n\n    def __init__(self, config: CollectionCoordinatorConfig):\n        self.config = config\n        self.batch_counter = 0\n\n    def start(self) -&gt; None:\n        \"\"\"Start coordinator process.\"\"\"\n        self.config.env.process(self._collection_process())\n\n    def _collection_process(self) -&gt; Generator[Any, Any, None]:\n        \"\"\"Main collection process loop.\"\"\"\n        while True:\n            # Wait for wagons\n            wagon = yield self.config.collection_queue.get()\n\n            # Collect batch\n            wagons = yield from self._collect_batch(wagon)\n\n            # Select retrofit track\n            retrofit_track = self.config.track_selector.select_track_with_capacity('retrofit')\n\n            # Transport batch\n            yield from self._transport_batch(wagons, retrofit_track)\n</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#54-level-2-railway-infrastructure-context","title":"5.4 Level 2: Railway Infrastructure Context","text":""},{"location":"mvp/architecture/05-building-blocks/#responsibility_2","title":"Responsibility","text":"<p>Manage track capacity, occupancy, and wagon placement using domain aggregates.</p> <pre><code>graph TB\n    subgraph \"Railway Infrastructure Context\"\n        Context[\"RailwayContext&lt;br/&gt;Track building &amp; services\"]\n        TrackGroup[\"TrackGroup&lt;br/&gt;Group tracks by type\"]\n        Track[\"Track&lt;br/&gt;Individual track entity\"]\n        Occupancy[\"TrackOccupancy&lt;br/&gt;Wagon placement logic\"]\n        Selector[\"TrackSelector&lt;br/&gt;Selection strategies\"]\n    end\n\n    Context --&gt; TrackGroup\n    TrackGroup --&gt; Track\n    Track --&gt; Occupancy\n    Context --&gt; Selector\n    Selector --&gt; TrackGroup\n\n    classDef component fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n\n    class Context,TrackGroup,Track,Occupancy,Selector component</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#components_2","title":"Components","text":"Component Responsibility Pattern RailwayContext Build tracks from scenario, provide services Context TrackGroup Group tracks by type (collection, retrofit, parking, workshop) Aggregate Track Individual track with capacity and fill factor Entity TrackOccupancy Manage wagon placement and capacity Aggregate TrackSelector Select tracks using strategies (round-robin, least-occupied, etc.) Service"},{"location":"mvp/architecture/05-building-blocks/#track-selection-strategies","title":"Track Selection Strategies","text":"Strategy Behavior first_available Select first track with available capacity least_occupied Select track with lowest utilization round_robin Rotate through tracks sequentially best_fit Select track that best fits wagon length"},{"location":"mvp/architecture/05-building-blocks/#55-level-2-external-trains-context","title":"5.5 Level 2: External Trains Context","text":""},{"location":"mvp/architecture/05-building-blocks/#responsibility_3","title":"Responsibility","text":"<p>Handle train arrivals and create wagon entities as single source of truth.</p> <pre><code>graph TB\n    subgraph \"External Trains Context\"\n        Context[\"ExternalTrainsContext&lt;br/&gt;Train arrival processing\"]\n        Schedule[\"TrainSchedule&lt;br/&gt;Scheduled trains\"]\n        Train[\"ExternalTrain&lt;br/&gt;Train entity\"]\n        Wagon[\"Wagon&lt;br/&gt;Wagon entity\"]\n    end\n\n    Scenario[\"Scenario.trains\"] --&gt; Context\n    Context --&gt; Schedule\n    Schedule --&gt; Train\n    Train --&gt; Wagon\n    Wagon --&gt; Event[\"TrainArrivedEvent\"]\n\n    classDef component fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef external fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n\n    class Context,Schedule,Train,Wagon component\n    class Scenario,Event external</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#components_3","title":"Components","text":"Component Responsibility ExternalTrainsContext Process train arrivals, create wagons, publish events TrainSchedule Manage scheduled train arrivals ExternalTrain Train entity with arrival time and wagons Wagon Wagon entity (single source of truth)"},{"location":"mvp/architecture/05-building-blocks/#code-example_1","title":"Code Example","text":"<pre><code>class ExternalTrainsContext:\n    \"\"\"External Trains Context managing train arrivals.\"\"\"\n\n    def __init__(self, event_bus: EventBus):\n        self.event_bus = event_bus\n        self.scenario: Scenario | None = None\n        self._wagons: dict[str, Wagon] = {}  # Single source of truth\n\n    def start_processes(self) -&gt; None:\n        \"\"\"Start train arrival processes.\"\"\"\n        if self.infra and self.scenario:\n            for train in self.scenario.trains:\n                self.infra.engine.schedule_process(\n                    self._process_single_train_arrival(train)\n                )\n\n    def _process_single_train_arrival(self, train: Any) -&gt; Any:\n        \"\"\"Process a single train arrival.\"\"\"\n        # Wait for arrival time\n        arrival_delay = datetime_to_ticks(train.arrival_time, self.scenario.start_date)\n        yield from self.infra.engine.delay(arrival_delay)\n\n        # Create wagons\n        train_wagons = [Wagon(...) for wagon_dto in train.wagons]\n\n        # Store as single source of truth\n        for wagon in train_wagons:\n            self._wagons[wagon.id] = wagon\n\n        # Publish event\n        event = TrainArrivedEvent(\n            train_id=train.train_id,\n            wagons=train_wagons,\n            arrival_track='collection',\n            event_timestamp=self.infra.engine.current_time()\n        )\n        self.event_bus.publish(event)\n</code></pre>"},{"location":"mvp/architecture/05-building-blocks/#56-cross-cutting-concerns","title":"5.6 Cross-Cutting Concerns","text":""},{"location":"mvp/architecture/05-building-blocks/#event-bus","title":"Event Bus","text":"<p>All contexts communicate via domain events published through the event bus.</p> <p>Key Events: - <code>TrainArrivedEvent</code> - Train arrives with wagons - <code>WagonMovedEvent</code> - Wagon moves between tracks - <code>WagonRetrofitCompletedEvent</code> - Wagon completes retrofit - <code>SimulationStartedEvent</code> - Simulation begins - <code>SimulationEndedEvent</code> - Simulation completes</p>"},{"location":"mvp/architecture/05-building-blocks/#metrics-collection","title":"Metrics Collection","text":"<p>The Retrofit Workflow Context collects metrics during simulation: - Wagon journey events (arrived, classified, retrofit started/completed, parked) - Locomotive movements and allocations - Batch formation and transport events - Workshop utilization statistics</p>"},{"location":"mvp/architecture/05-building-blocks/#time-conversion","title":"Time Conversion","text":"<p>Shared utilities convert between datetime and SimPy simulation ticks: - <code>datetime_to_ticks()</code> - Convert datetime to simulation time - <code>timedelta_to_sim_ticks()</code> - Convert timedelta to simulation duration</p>"},{"location":"mvp/architecture/05-building-blocks/#57-deployment-units","title":"5.7 Deployment Units","text":"<p>The system is deployed as a single Python application with CLI interface:</p> <pre><code>popupsim/\n\u251c\u2500\u2500 backend/\n\u2502   \u2514\u2500\u2500 src/\n\u2502       \u251c\u2500\u2500 main.py                    # CLI entry point\n\u2502       \u251c\u2500\u2500 application/               # Application services\n\u2502       \u251c\u2500\u2500 contexts/                  # Bounded contexts\n\u2502       \u2502   \u251c\u2500\u2500 configuration/\n\u2502       \u2502   \u251c\u2500\u2500 retrofit_workflow/\n\u2502       \u2502   \u251c\u2500\u2500 railway_infrastructure/\n\u2502       \u2502   \u2514\u2500\u2500 external_trains/\n\u2502       \u251c\u2500\u2500 shared/                    # Shared kernel\n\u2502       \u2514\u2500\u2500 infrastructure/            # Technical infrastructure\n</code></pre> <p>Execution: <pre><code>uv run python src/main.py --scenario path/to/scenario --output path/to/output\n</code></pre></p>"},{"location":"mvp/architecture/05a-level3-implementation/","title":"5a. Level 3 Implementation Details","text":""},{"location":"mvp/architecture/05a-level3-implementation/#overview","title":"Overview","text":"<p>This document provides Level 3 architectural details for the actual MVP implementation with 4 bounded contexts: Configuration, Retrofit Workflow, Railway Infrastructure, and External Trains.</p>"},{"location":"mvp/architecture/05a-level3-implementation/#5a1-configuration-context-level-3","title":"5a.1 Configuration Context - Level 3","text":""},{"location":"mvp/architecture/05a-level3-implementation/#component-diagram","title":"Component Diagram","text":"<pre><code>graph TB\n    subgraph \"Configuration Context - Level 3\"\n        Builder[\"ConfigurationBuilder&lt;br/&gt;Load from files\"]\n        Loader[\"FileLoader&lt;br/&gt;Parse JSON/CSV\"]\n\n        subgraph \"Domain Models (Pydantic)\"\n            Scenario[Scenario]\n            Train[Train]\n            Wagon[Wagon]\n            Track[Track]\n            Workshop[Workshop]\n            Locomotive[Locomotive]\n            Routes[Routes]\n            ProcessTimes[ProcessTimes]\n        end\n    end\n\n    Files[JSON/CSV Files] --&gt; Builder\n    Builder --&gt; Loader\n    Loader --&gt; Scenario\n    Loader --&gt; Train\n    Loader --&gt; Wagon\n    Loader --&gt; Track\n    Loader --&gt; Workshop\n    Loader --&gt; Locomotive\n    Loader --&gt; Routes\n    Loader --&gt; ProcessTimes\n\n    classDef builder fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef model fill:#c5e1a5,stroke:#558b2f,stroke-width:2px\n\n    class Builder,Loader builder\n    class Scenario,Train,Wagon,Track,Workshop,Locomotive,Routes,ProcessTimes model</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#components","title":"Components","text":"Component File Responsibility ConfigurationBuilder <code>configuration_builder.py</code> Load scenario from file path FileLoader <code>file_loader.py</code> Parse JSON/CSV files, handle references Scenario <code>scenario.py</code> Root configuration model with validation ProcessTimes <code>process_times.py</code> Timing configuration for operations DTOs <code>dtos/</code> Input data transfer objects"},{"location":"mvp/architecture/05a-level3-implementation/#code-example","title":"Code Example","text":"<pre><code>from pathlib import Path\nfrom contexts.configuration.domain.configuration_builder import ConfigurationBuilder\n\n# Load scenario\nscenario = ConfigurationBuilder(Path(\"scenario_dir\")).build()\n\n# Access configuration\nprint(f\"Scenario: {scenario.id}\")\nprint(f\"Workshops: {len(scenario.workshops)}\")\nprint(f\"Trains: {len(scenario.trains)}\")\n</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#5a2-retrofit-workflow-context-level-3","title":"5a.2 Retrofit Workflow Context - Level 3","text":""},{"location":"mvp/architecture/05a-level3-implementation/#component-diagram_1","title":"Component Diagram","text":"<pre><code>graph TB\n    subgraph \"Retrofit Workflow Context - Level 3\"\n        Context[\"RetrofitWorkflowContext&lt;br/&gt;Initialization &amp; orchestration\"]\n\n        subgraph \"Coordinators (Application Layer)\"\n            Arrival[\"ArrivalCoordinator&lt;br/&gt;Process train arrivals\"]\n            Collection[\"CollectionCoordinator&lt;br/&gt;Move to retrofit track\"]\n            Workshop[\"WorkshopCoordinator&lt;br/&gt;Retrofit operations\"]\n            Parking[\"ParkingCoordinator&lt;br/&gt;Move to parking\"]\n        end\n\n        subgraph \"Domain Services (No SimPy)\"\n            Batch[\"BatchFormationService\"]\n            Rake[\"RakeFormationService\"]\n            TrainForm[\"TrainFormationService\"]\n            Schedule[\"WorkshopSchedulingService\"]\n            Coupling[\"CouplingService\"]\n            Route[\"RouteService\"]\n        end\n\n        subgraph \"Resource Managers (Infrastructure)\"\n            LocoMgr[\"LocomotiveResourceManager\"]\n            TrackMgr[\"TrackCapacityManager\"]\n            WorkshopMgr[\"WorkshopResourceManager\"]\n        end\n\n        subgraph \"Metrics Collection\"\n            Metrics[\"SimulationMetrics\"]\n            WagonCol[\"WagonCollector\"]\n            LocoCol[\"LocomotiveCollector\"]\n            WorkshopCol[\"WorkshopCollector\"]\n        end\n    end\n\n    Context --&gt; Arrival\n    Context --&gt; Collection\n    Context --&gt; Workshop\n    Context --&gt; Parking\n\n    Arrival --&gt; Batch\n    Collection --&gt; Rake\n    Workshop --&gt; Schedule\n    Parking --&gt; TrainForm\n\n    Arrival --&gt; LocoMgr\n    Collection --&gt; TrackMgr\n    Workshop --&gt; WorkshopMgr\n\n    Context --&gt; Metrics\n    Metrics --&gt; WagonCol\n    Metrics --&gt; LocoCol\n    Metrics --&gt; WorkshopCol\n\n    classDef coord fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef domain fill:#c5e1a5,stroke:#558b2f,stroke-width:2px\n    classDef resource fill:#fff9c4,stroke:#f57f17,stroke-width:2px\n    classDef metrics fill:#ffccbc,stroke:#bf360c,stroke-width:2px\n\n    class Context,Arrival,Collection,Workshop,Parking coord\n    class Batch,Rake,TrainForm,Schedule,Coupling,Route domain\n    class LocoMgr,TrackMgr,WorkshopMgr resource\n    class Metrics,WagonCol,LocoCol,WorkshopCol metrics</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#coordinators-application-layer","title":"Coordinators (Application Layer)","text":"Coordinator Responsibility SimPy Process ArrivalCoordinator Receive trains, classify wagons, distribute to collection tracks Yes CollectionCoordinator Form batches, allocate locomotive, transport to retrofit track Yes WorkshopCoordinator Assign wagons to workshops, execute retrofit, return to retrofitted track Yes ParkingCoordinator Transport completed wagons to parking tracks Yes"},{"location":"mvp/architecture/05a-level3-implementation/#domain-services-no-simpy-dependencies","title":"Domain Services (No SimPy Dependencies)","text":"Service Responsibility BatchFormationService Create wagon batches based on capacity constraints RakeFormationService Form and dissolve wagon rakes with coupling logic TrainFormationService Assemble trains (locomotive + rake) with preparation times WorkshopSchedulingService Schedule wagon batches to available workshops CouplingService Calculate coupling/decoupling times RouteService Provide route durations between tracks"},{"location":"mvp/architecture/05a-level3-implementation/#resource-managers-infrastructure-layer","title":"Resource Managers (Infrastructure Layer)","text":"Manager Responsibility LocomotiveResourceManager Allocate and release locomotives (SimPy Resource) TrackCapacityManager Manage track capacity and wagon placement WorkshopResourceManager Manage workshop station availability (SimPy Resource)"},{"location":"mvp/architecture/05a-level3-implementation/#workflow-sequence","title":"Workflow Sequence","text":"<pre><code>sequenceDiagram\n    participant Train\n    participant Arrival\n    participant Collection\n    participant Workshop\n    participant Parking\n\n    Train-&gt;&gt;Arrival: TrainArrivedEvent\n    Arrival-&gt;&gt;Arrival: Classify wagons\n    Arrival-&gt;&gt;Collection: Add to collection queue\n    Collection-&gt;&gt;Collection: Form batch\n    Collection-&gt;&gt;Collection: Allocate locomotive\n    Collection-&gt;&gt;Workshop: Transport to retrofit track\n    Workshop-&gt;&gt;Workshop: Select workshop\n    Workshop-&gt;&gt;Workshop: Allocate stations\n    Workshop-&gt;&gt;Workshop: Execute retrofit\n    Workshop-&gt;&gt;Parking: Move to retrofitted track\n    Parking-&gt;&gt;Parking: Form batch\n    Parking-&gt;&gt;Parking: Transport to parking</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#5a3-railway-infrastructure-context-level-3","title":"5a.3 Railway Infrastructure Context - Level 3","text":""},{"location":"mvp/architecture/05a-level3-implementation/#component-diagram_2","title":"Component Diagram","text":"<pre><code>graph TB\n    subgraph \"Railway Infrastructure Context - Level 3\"\n        Context[\"RailwayContext&lt;br/&gt;Track building &amp; services\"]\n\n        subgraph \"Aggregates\"\n            TrackGroup[\"TrackGroup&lt;br/&gt;Group tracks by type\"]\n            Track[\"Track&lt;br/&gt;Individual track entity\"]\n            Occupancy[\"TrackOccupancy&lt;br/&gt;Wagon placement logic\"]\n        end\n\n        subgraph \"Services\"\n            Selector[\"TrackSelector&lt;br/&gt;Selection strategies\"]\n            Capacity[\"CapacityService&lt;br/&gt;Capacity queries\"]\n        end\n    end\n\n    Context --&gt; TrackGroup\n    TrackGroup --&gt; Track\n    Track --&gt; Occupancy\n    Context --&gt; Selector\n    Context --&gt; Capacity\n    Selector --&gt; TrackGroup\n    Capacity --&gt; Track\n\n    classDef component fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n\n    class Context,TrackGroup,Track,Occupancy,Selector,Capacity component</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#components_1","title":"Components","text":"Component Responsibility Pattern RailwayContext Build tracks from scenario, provide services Context TrackGroup Group tracks by type (collection, retrofit, parking, workshop) Aggregate Track Individual track with capacity and fill factor Entity TrackOccupancy Manage wagon placement and capacity Aggregate TrackSelector Select tracks based on strategies Service CapacityService Query track capacity and availability Service"},{"location":"mvp/architecture/05a-level3-implementation/#track-selection-strategies","title":"Track Selection Strategies","text":"<ul> <li>LEAST_OCCUPIED: Select track with lowest occupancy ratio</li> <li>ROUND_ROBIN: Cycle through available tracks</li> <li>FIRST_AVAILABLE: Select first track with capacity</li> <li>RANDOM: Random selection from available tracks</li> </ul>"},{"location":"mvp/architecture/05a-level3-implementation/#5a4-external-trains-context-level-3","title":"5a.4 External Trains Context - Level 3","text":""},{"location":"mvp/architecture/05a-level3-implementation/#component-diagram_3","title":"Component Diagram","text":"<pre><code>graph TB\n    subgraph \"External Trains Context - Level 3\"\n        Context[\"ExternalTrainsContext&lt;br/&gt;Train arrival management\"]\n\n        subgraph \"Components\"\n            Publisher[\"EventPublisher&lt;br/&gt;Publish train arrivals\"]\n            Factory[\"WagonFactory&lt;br/&gt;Create wagon entities\"]\n        end\n\n        subgraph \"Events\"\n            TrainEvent[\"TrainArrivedEvent&lt;br/&gt;Train + wagons\"]\n        end\n    end\n\n    Context --&gt; Publisher\n    Context --&gt; Factory\n    Publisher --&gt; TrainEvent\n    Factory --&gt; TrainEvent\n\n    classDef component fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n\n    class Context,Publisher,Factory,TrainEvent component</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#components_2","title":"Components","text":"Component Responsibility ExternalTrainsContext Initialize train arrivals from scenario EventPublisher Publish TrainArrivedEvent to event bus WagonFactory Create wagon entities from train data"},{"location":"mvp/architecture/05a-level3-implementation/#train-arrival-flow","title":"Train Arrival Flow","text":"<pre><code>sequenceDiagram\n    participant Scenario\n    participant ExternalTrains\n    participant EventBus\n    participant RetrofitWorkflow\n\n    Scenario-&gt;&gt;ExternalTrains: Initialize with trains\n    ExternalTrains-&gt;&gt;ExternalTrains: Schedule arrivals\n    loop For each train\n        ExternalTrains-&gt;&gt;EventBus: Publish TrainArrivedEvent\n        EventBus-&gt;&gt;RetrofitWorkflow: Deliver event\n        RetrofitWorkflow-&gt;&gt;RetrofitWorkflow: Process wagons\n    end</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#5a5-integration-patterns","title":"5a.5 Integration Patterns","text":""},{"location":"mvp/architecture/05a-level3-implementation/#event-bus-communication","title":"Event Bus Communication","text":"<pre><code>from contexts.shared.domain.events import EventBus, TrainArrivedEvent\n\n# External Trains publishes event\nevent_bus.publish(TrainArrivedEvent(\n    train_id=\"T001\",\n    wagons=[wagon1, wagon2, wagon3],\n    arrival_time=100.0\n))\n\n# Retrofit Workflow subscribes\nevent_bus.subscribe(TrainArrivedEvent, arrival_coordinator.handle_train_arrival)\n</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#track-capacity-queries","title":"Track Capacity Queries","text":"<pre><code>from contexts.railway_infrastructure.application.railway_context import RailwayContext\n\n# Query track capacity\nrailway = RailwayContext(scenario)\ntrack = railway.track_selector.select_track_with_capacity('collection', required_length=50.0)\n\n# Place wagons on track\nrailway.place_wagons_on_track(track.id, wagons)\n</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#resource-allocation","title":"Resource Allocation","text":"<pre><code>from contexts.retrofit_workflow.infrastructure.resource_managers import LocomotiveResourceManager\n\n# Allocate locomotive\nloco_manager = LocomotiveResourceManager(env, locomotives)\nlocomotive = yield loco_manager.allocate()\n\n# Use locomotive\nyield from transport_wagons(locomotive, wagons, destination)\n\n# Release locomotive\nloco_manager.release(locomotive)\n</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#5a6-file-organization","title":"5a.6 File Organization","text":"<pre><code>popupsim/backend/src/\n\u251c\u2500\u2500 main.py                                    # CLI entry point\n\u251c\u2500\u2500 application/\n\u2502   \u2514\u2500\u2500 simulation_service.py                  # Orchestrates all contexts\n\u251c\u2500\u2500 contexts/\n\u2502   \u251c\u2500\u2500 configuration/                         # Configuration Context\n\u2502   \u2502   \u251c\u2500\u2500 domain/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 configuration_builder.py       # Load from files\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 models/\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 scenario.py\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 process_times.py\n\u2502   \u2502   \u2502       \u2514\u2500\u2500 ...\n\u2502   \u2502   \u2514\u2500\u2500 infrastructure/\n\u2502   \u2502       \u2514\u2500\u2500 file_loader.py                 # Parse JSON/CSV\n\u2502   \u251c\u2500\u2500 retrofit_workflow/                     # Retrofit Workflow Context\n\u2502   \u2502   \u251c\u2500\u2500 application/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 retrofit_workflow_context.py   # Main context\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 coordinators/\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 arrival_coordinator.py\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 collection_coordinator.py\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 workshop_coordinator.py\n\u2502   \u2502   \u2502       \u2514\u2500\u2500 parking_coordinator.py\n\u2502   \u2502   \u251c\u2500\u2500 domain/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 services/\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 batch_formation_service.py\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 rake_formation_service.py\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 train_formation_service.py\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 workshop_scheduling_service.py\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 coupling_service.py\n\u2502   \u2502   \u2502       \u2514\u2500\u2500 route_service.py\n\u2502   \u2502   \u2514\u2500\u2500 infrastructure/\n\u2502   \u2502       \u251c\u2500\u2500 resource_managers/\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 locomotive_resource_manager.py\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 track_capacity_manager.py\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 workshop_resource_manager.py\n\u2502   \u2502       \u2514\u2500\u2500 metrics/\n\u2502   \u2502           \u251c\u2500\u2500 simulation_metrics.py\n\u2502   \u2502           \u251c\u2500\u2500 wagon_collector.py\n\u2502   \u2502           \u251c\u2500\u2500 locomotive_collector.py\n\u2502   \u2502           \u2514\u2500\u2500 workshop_collector.py\n\u2502   \u251c\u2500\u2500 railway_infrastructure/                # Railway Infrastructure Context\n\u2502   \u2502   \u251c\u2500\u2500 application/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 railway_context.py             # Track building &amp; services\n\u2502   \u2502   \u251c\u2500\u2500 domain/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 aggregates/\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 track_group.py\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 track.py\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 track_occupancy.py\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 services/\n\u2502   \u2502   \u2502       \u251c\u2500\u2500 track_selector.py\n\u2502   \u2502   \u2502       \u2514\u2500\u2500 capacity_service.py\n\u2502   \u2502   \u2514\u2500\u2500 infrastructure/\n\u2502   \u2502       \u2514\u2500\u2500 track_repository.py\n\u2502   \u251c\u2500\u2500 external_trains/                       # External Trains Context\n\u2502   \u2502   \u251c\u2500\u2500 application/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 external_trains_context.py     # Train arrival management\n\u2502   \u2502   \u251c\u2500\u2500 domain/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 wagon_factory.py\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 events/\n\u2502   \u2502   \u2502       \u2514\u2500\u2500 train_arrived_event.py\n\u2502   \u2502   \u2514\u2500\u2500 infrastructure/\n\u2502   \u2502       \u2514\u2500\u2500 event_publisher.py\n\u2502   \u2514\u2500\u2500 shared/                                # Shared Kernel\n\u2502       \u251c\u2500\u2500 domain/\n\u2502       \u2502   \u251c\u2500\u2500 events/\n\u2502       \u2502   \u2502   \u2514\u2500\u2500 event_bus.py\n\u2502       \u2502   \u2514\u2500\u2500 value_objects/\n\u2502       \u2514\u2500\u2500 infrastructure/\n\u2502           \u2514\u2500\u2500 simpy_adapter.py\n\u2514\u2500\u2500 tests/\n    \u2514\u2500\u2500 unit/\n        \u251c\u2500\u2500 configuration/\n        \u251c\u2500\u2500 retrofit_workflow/\n        \u251c\u2500\u2500 railway_infrastructure/\n        \u2514\u2500\u2500 external_trains/\n</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#5a7-wagon-state-machine","title":"5a.7 Wagon State Machine","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; ARRIVING: Train arrives\n    ARRIVING --&gt; SELECTING: At hump\n    SELECTING --&gt; SELECTED: Needs retrofit + capacity available\n    SELECTING --&gt; REJECTED: No capacity\n    SELECTED --&gt; MOVING_TO_COLLECTION: Locomotive pickup\n    MOVING_TO_COLLECTION --&gt; ON_COLLECTION_TRACK: Delivered\n    ON_COLLECTION_TRACK --&gt; MOVING_TO_RETROFIT: Batch formed\n    MOVING_TO_RETROFIT --&gt; ON_RETROFIT_TRACK: At retrofit track\n    ON_RETROFIT_TRACK --&gt; MOVING_TO_WORKSHOP: Workshop ready\n    MOVING_TO_WORKSHOP --&gt; RETROFITTING: At station\n    RETROFITTING --&gt; RETROFITTED: Retrofit complete\n    RETROFITTED --&gt; MOVING_TO_RETROFITTED: Pickup batch\n    MOVING_TO_RETROFITTED --&gt; ON_RETROFITTED_TRACK: At retrofitted track\n    ON_RETROFITTED_TRACK --&gt; MOVING_TO_PARKING: To parking\n    MOVING_TO_PARKING --&gt; PARKING: At parking track\n    REJECTED --&gt; [*]\n    PARKING --&gt; [*]</code></pre>"},{"location":"mvp/architecture/05a-level3-implementation/#5a8-technology-integration","title":"5a.8 Technology Integration","text":""},{"location":"mvp/architecture/05a-level3-implementation/#simpy-integration","title":"SimPy Integration","text":"<p>SimPyAdapter provides abstraction: <pre><code>class SimPyAdapter:\n    def delay(self, duration: float) -&gt; Generator\n    def run_process(self, process: Callable, *args) -&gt; None\n    def create_store(self, capacity: int) -&gt; Any\n    def create_event(self) -&gt; Any\n    def current_time(self) -&gt; float\n    def run(self, until: float) -&gt; None\n</code></pre></p>"},{"location":"mvp/architecture/05a-level3-implementation/#pydantic-integration","title":"Pydantic Integration","text":"<p>All domain models use Pydantic for: - Type safety - Automatic validation - JSON serialization - Field constraints - Custom validators</p>"},{"location":"mvp/architecture/05a-level3-implementation/#event-bus-integration","title":"Event Bus Integration","text":"<pre><code>from contexts.shared.domain.events import EventBus\n\n# Initialize event bus\nevent_bus = EventBus()\n\n# Subscribe to events\nevent_bus.subscribe(TrainArrivedEvent, handler)\n\n# Publish events\nevent_bus.publish(TrainArrivedEvent(...))\n</code></pre>"},{"location":"mvp/architecture/06-runtime/","title":"6. Runtime View (MVP)","text":""},{"location":"mvp/architecture/06-runtime/#61-runtime-scenario-develop-standardized-pop-up-workshop-us-001","title":"6.1 Runtime Scenario: Develop Standardized Pop-Up Workshop (US-001)","text":"<p>Use Case: US-001 - Strategic Migration Planner develops standardized workshop designs</p> <p>Goal: Test different workshop configurations to find optimal standardized design</p>"},{"location":"mvp/architecture/06-runtime/#scenario-description","title":"Scenario Description","text":"<p>Strategic planner creates multiple workshop configuration variants (2 stations, 4 stations, 6 stations) and runs simulations to compare throughput and identify optimal design.</p>"},{"location":"mvp/architecture/06-runtime/#runtime-interaction","title":"Runtime Interaction","text":"<pre><code>sequenceDiagram\n    participant Planner as Strategic Planner\n    participant CLI as CLI\n    participant Config as Configuration Context\n    participant Retrofit as Retrofit Workflow Context\n    participant Railway as Railway Infrastructure Context\n    participant External as External Trains Context\n    participant Files as File System\n\n    Planner-&gt;&gt;Files: Create workshop_2stations.json\n    Planner-&gt;&gt;Files: Create workshop_4stations.json\n    Planner-&gt;&gt;Files: Create workshop_6stations.json\n\n    loop For each configuration\n        Planner-&gt;&gt;CLI: python main.py --config workshop_Xstations.json\n        CLI-&gt;&gt;Config: load_configuration()\n        Config-&gt;&gt;Files: Read JSON/CSV\n        Config-&gt;&gt;Config: Validate with Pydantic\n        Config--&gt;&gt;CLI: Validated scenario\n\n        CLI-&gt;&gt;Railway: build_tracks(scenario)\n        Railway--&gt;&gt;CLI: Track infrastructure ready\n\n        CLI-&gt;&gt;External: initialize_trains(scenario)\n        External--&gt;&gt;CLI: Train arrivals scheduled\n\n        CLI-&gt;&gt;Retrofit: initialize(scenario, railway, external)\n        Retrofit--&gt;&gt;CLI: Workflow ready\n\n        CLI-&gt;&gt;Retrofit: run_simulation(24h)\n\n        loop Simulation time (24h)\n            External-&gt;&gt;Retrofit: TrainArrivedEvent\n            Retrofit-&gt;&gt;Railway: Query track capacity\n            Retrofit-&gt;&gt;Retrofit: Process wagons\n            Retrofit-&gt;&gt;Retrofit: Calculate KPIs\n        end\n\n        Retrofit-&gt;&gt;Retrofit: Aggregate results\n        Retrofit-&gt;&gt;Files: Write simulation_results_Xstations.csv\n        Retrofit-&gt;&gt;Files: Write kpi_charts_Xstations.png\n        Retrofit--&gt;&gt;CLI: Simulation complete\n        CLI--&gt;&gt;Planner: Results available\n    end\n\n    Planner-&gt;&gt;Files: Compare CSV results\n    Planner-&gt;&gt;Planner: Select optimal configuration</code></pre>"},{"location":"mvp/architecture/06-runtime/#key-runtime-aspects","title":"Key Runtime Aspects","text":"Aspect Description Quality Goal Configuration Validation Pydantic validates workshop parameters before simulation starts Reliability Iterative Testing Planner runs multiple configurations sequentially Usability Real-time KPI Calculation Analysis Engine calculates metrics during simulation Accuracy File-based Comparison Results exported to CSV for manual comparison Simplicity"},{"location":"mvp/architecture/06-runtime/#performance-characteristics","title":"Performance Characteristics","text":"<p>Note: Performance metrics will be measured during MVP implementation. Estimates are placeholders for architecture documentation.</p>"},{"location":"mvp/architecture/06-runtime/#62-runtime-scenario-estimate-workshop-throughput-us-002","title":"6.2 Runtime Scenario: Estimate Workshop Throughput (US-002)","text":"<p>Use Case: US-002 - Strategic planner estimates throughput capacity</p> <p>Goal: Determine maximum wagon throughput for a given workshop layout</p>"},{"location":"mvp/architecture/06-runtime/#scenario-description_1","title":"Scenario Description","text":"<p>Strategic planner runs simulation with increasing wagon arrival rates to find throughput limits and identify bottlenecks.</p>"},{"location":"mvp/architecture/06-runtime/#runtime-interaction_1","title":"Runtime Interaction","text":"<pre><code>sequenceDiagram\n    participant Planner as Strategic Planner\n    participant CLI as CLI\n    participant Config as Configuration Context\n    participant Retrofit as Retrofit Workflow Context\n    participant Railway as Railway Infrastructure Context\n    participant External as External Trains Context\n    participant Metrics as Metrics Collection\n    participant Files as File System\n\n    Planner-&gt;&gt;Files: Create scenario_high_load.json\n    Note over Files: 30 wagons/hour arrival rate\n\n    Planner-&gt;&gt;CLI: python main.py --config scenario_high_load.json\n    CLI-&gt;&gt;Config: load_configuration()\n    Config--&gt;&gt;CLI: Validated scenario\n\n    CLI-&gt;&gt;Railway: build_tracks(scenario)\n    Railway--&gt;&gt;CLI: Track infrastructure ready\n\n    CLI-&gt;&gt;External: initialize_trains(scenario)\n    External--&gt;&gt;CLI: Train arrivals scheduled\n\n    CLI-&gt;&gt;Retrofit: initialize(scenario, railway, external)\n    Retrofit--&gt;&gt;CLI: Workflow ready\n\n    CLI-&gt;&gt;Retrofit: run_simulation(24h)\n\n    loop Every simulation hour\n        External-&gt;&gt;Retrofit: TrainArrivedEvent (30 wagons)\n        Retrofit-&gt;&gt;Railway: Query workshop capacity\n\n        alt Workshop available\n            Retrofit-&gt;&gt;Retrofit: Start retrofit process\n            Retrofit-&gt;&gt;Metrics: Record: wagon_processing_started\n        else All workshops busy\n            Retrofit-&gt;&gt;Retrofit: Add to queue\n            Retrofit-&gt;&gt;Metrics: Record: wagon_queued\n            Metrics-&gt;&gt;Metrics: Calculate queue length\n        end\n\n        Retrofit-&gt;&gt;Retrofit: Complete retrofits\n        Retrofit-&gt;&gt;Metrics: Record: wagon_completed\n        Metrics-&gt;&gt;Metrics: Calculate throughput\n        Metrics-&gt;&gt;Metrics: Calculate utilization\n\n        alt Queue length &gt; threshold\n            Metrics-&gt;&gt;Metrics: Flag: bottleneck detected\n        end\n    end\n\n    Retrofit-&gt;&gt;Metrics: Get aggregated KPIs\n    Metrics--&gt;&gt;Retrofit: Throughput, utilization, bottlenecks\n\n    Retrofit-&gt;&gt;Files: Write throughput_analysis.csv\n    Retrofit-&gt;&gt;Files: Write bottleneck_chart.png\n    Retrofit--&gt;&gt;CLI: Analysis complete\n\n    CLI--&gt;&gt;Planner: Results with bottleneck identification\n    Planner-&gt;&gt;Files: Review bottleneck_chart.png\n    Planner-&gt;&gt;Planner: Decide: Add stations or optimize layout</code></pre>"},{"location":"mvp/architecture/06-runtime/#key-runtime-aspects_1","title":"Key Runtime Aspects","text":"Aspect Description Quality Goal Real-time Bottleneck Detection Analysis Engine identifies bottlenecks during simulation Accuracy Queue Monitoring Tracks queue length at each station Reliability Utilization Tracking Calculates station utilization continuously Accuracy Threshold-based Alerts Flags when queue exceeds acceptable limits Usability"},{"location":"mvp/architecture/06-runtime/#state-transitions-wagon-processing","title":"State Transitions: Wagon Processing","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Arrived: Train arrival\n    Arrived --&gt; Queued: No station available\n    Arrived --&gt; InRetrofit: Station available\n    Queued --&gt; InRetrofit: Station becomes available\n    InRetrofit --&gt; Completed: Retrofit finished\n    Completed --&gt; [*]\n\n    note right of Queued\n        Analysis Engine tracks\n        queue length here\n    end note\n\n    note right of InRetrofit\n        Analysis Engine calculates\n        utilization here\n    end note</code></pre> <p>Note: This needs to be updated since it does not reflect the process correctly.</p>"},{"location":"mvp/architecture/06-runtime/#performance-characteristics_1","title":"Performance Characteristics","text":"<p>Note: Performance metrics will be measured during MVP implementation. Actual timing depends on hardware and simulation complexity.</p>"},{"location":"mvp/architecture/06-runtime/#63-runtime-scenario-import-infrastructure-data-us-003","title":"6.3 Runtime Scenario: Import Infrastructure Data (US-003)","text":"<p>Use Case: US-003 - Company Planner imports existing infrastructure data</p> <p>Goal: Import track topology and workshop layout from existing railway infrastructure data</p>"},{"location":"mvp/architecture/06-runtime/#scenario-description_2","title":"Scenario Description","text":"<p>Company planner has existing infrastructure data (track layouts, station locations) in CSV format and wants to import it into PopUpSim for capacity assessment.</p>"},{"location":"mvp/architecture/06-runtime/#runtime-interaction_2","title":"Runtime Interaction","text":"<pre><code>sequenceDiagram\n    participant Planner as Company Planner\n    participant CLI as CLI\n    participant Config as Configuration Context\n    participant Parser as CSV Parser\n    participant Validator as Pydantic Validator\n    participant Files as File System\n\n    Planner-&gt;&gt;Files: Prepare infrastructure_topology.csv\n    Note over Files: Contains: track_id, length, connections\n    Planner-&gt;&gt;Files: Prepare workshop_layout.csv\n    Note over Files: Contains: station_id, location, capacity\n\n    Planner-&gt;&gt;CLI: python main.py --import-infra infrastructure_topology.csv workshop_layout.csv\n    CLI-&gt;&gt;Config: import_infrastructure()\n\n    Config-&gt;&gt;Files: Read infrastructure_topology.csv\n    Files--&gt;&gt;Config: CSV data (tracks)\n    Config-&gt;&gt;Parser: Parse track data\n    Parser-&gt;&gt;Parser: Convert to Track objects\n    Parser--&gt;&gt;Config: Parsed tracks\n\n    Config-&gt;&gt;Files: Read workshop_layout.csv\n    Files--&gt;&gt;Config: CSV data (workshops)\n    Config-&gt;&gt;Parser: Parse workshop data\n    Parser-&gt;&gt;Parser: Convert to Workshop objects\n    Parser--&gt;&gt;Config: Parsed workshops\n\n    Config-&gt;&gt;Validator: Validate infrastructure consistency\n    Validator-&gt;&gt;Validator: Check track connections valid\n    Validator-&gt;&gt;Validator: Check workshop locations on tracks\n    Validator-&gt;&gt;Validator: Check capacity constraints\n\n    alt Validation successful\n        Validator--&gt;&gt;Config: Infrastructure valid\n        Config-&gt;&gt;Files: Write validated_scenario.json\n        Config--&gt;&gt;CLI: Import successful\n        CLI--&gt;&gt;Planner: Infrastructure imported, ready for simulation\n    else Validation failed\n        Validator--xConfig: ValidationError: Invalid track connections\n        Config--&gt;&gt;CLI: Import failed with errors\n        CLI--&gt;&gt;Planner: Error summary + data issues\n    end</code></pre>"},{"location":"mvp/architecture/06-runtime/#key-runtime-aspects_2","title":"Key Runtime Aspects","text":"Aspect Description Quality Goal CSV Parsing Flexible parsing of company-specific CSV formats Usability Data Validation Validates infrastructure consistency (track connections, locations) Reliability Error Reporting Clear feedback on data quality issues Usability JSON Export Converts imported data to PopUpSim format Accessibility"},{"location":"mvp/architecture/06-runtime/#data-validation-checks","title":"Data Validation Checks","text":"<p>Infrastructure Consistency: - Track connections form valid network (no orphaned tracks) - Workshop locations reference existing tracks - Station capacities are positive integers - Track lengths are positive values</p> <p>Business Rules: - At least one workshop station defined - Track network is connected (no isolated segments) - Workshop locations don't overlap</p>"},{"location":"mvp/architecture/06-runtime/#performance-characteristics_2","title":"Performance Characteristics","text":"<p>Note: Import performance depends on infrastructure size. Will be measured during MVP implementation.</p>"},{"location":"mvp/architecture/06-runtime/#64-runtime-scenario-assess-planned-workshop-capacity-us-004","title":"6.4 Runtime Scenario: Assess Planned Workshop Capacity (US-004)","text":"<p>Use Case: US-004 - Company Planner assesses capacity for planned workshop</p> <p>Goal: Evaluate if planned workshop layout meets company's retrofit capacity requirements</p>"},{"location":"mvp/architecture/06-runtime/#scenario-description_3","title":"Scenario Description","text":"<p>Company planner has imported infrastructure data (US-003) and now runs simulation with company-specific wagon schedules to assess if planned workshop meets capacity targets.</p>"},{"location":"mvp/architecture/06-runtime/#runtime-interaction_3","title":"Runtime Interaction","text":"<pre><code>sequenceDiagram\n    participant Planner as Company Planner\n    participant CLI as CLI\n    participant Config as Configuration Context\n    participant Railway as Railway Infrastructure Context\n    participant External as External Trains Context\n    participant Retrofit as Retrofit Workflow Context\n    participant Metrics as Metrics Collection\n    participant Files as File System\n\n    Note over Planner: Has imported infrastructure (US-003)\n\n    Planner-&gt;&gt;Files: Create company_wagon_schedule.csv\n    Note over Files: Company-specific arrival patterns\n    Planner-&gt;&gt;Files: Update validated_scenario.json\n    Note over Files: Add capacity target: 500 wagons/week\n\n    Planner-&gt;&gt;CLI: python main.py --config validated_scenario.json --schedule company_wagon_schedule.csv\n    CLI-&gt;&gt;Config: load_configuration()\n    Config-&gt;&gt;Files: Read validated_scenario.json\n    Config-&gt;&gt;Files: Read company_wagon_schedule.csv\n    Config--&gt;&gt;CLI: Configuration with capacity target\n\n    CLI-&gt;&gt;Railway: build_tracks(scenario)\n    Railway-&gt;&gt;Railway: Create imported infrastructure\n    Railway--&gt;&gt;CLI: Track infrastructure ready\n\n    CLI-&gt;&gt;External: initialize_trains(scenario)\n    External-&gt;&gt;External: Load company wagon schedule\n    External--&gt;&gt;CLI: Train arrivals scheduled\n\n    CLI-&gt;&gt;Retrofit: initialize(scenario, railway, external)\n    Retrofit--&gt;&gt;CLI: Workflow ready\n\n    CLI-&gt;&gt;Retrofit: run_simulation(168h)\n    Note over Retrofit: 1 week simulation\n\n    loop Every hour (168 hours)\n        External-&gt;&gt;Retrofit: Process scheduled arrivals\n        Retrofit-&gt;&gt;Retrofit: Wagon processing\n        Retrofit-&gt;&gt;Metrics: Record wagon events\n        Metrics-&gt;&gt;Metrics: Track throughput\n    end\n\n    Retrofit-&gt;&gt;Metrics: Get capacity\n    Metrics-&gt;&gt;Metrics: Calculate: actual vs target\n\n    alt Capacity target met\n        Metrics--&gt;&gt;Retrofit: Throughput: 520 wagons (target: 500)\n        Retrofit-&gt;&gt;Files: Write capacity_assessment_PASS.csv\n        Retrofit-&gt;&gt;Files: Write capacity_chart.png\n        Retrofit--&gt;&gt;CLI: Capacity target achieved\n        CLI--&gt;&gt;Planner: Workshop layout sufficient\n    else Capacity target not met\n        Metrics--&gt;&gt;Retrofit: Throughput: 450 wagons (target: 500)\n        Retrofit-&gt;&gt;Files: Write capacity_assessment_FAIL.csv\n        Retrofit-&gt;&gt;Files: Write bottleneck_analysis.png\n        Retrofit--&gt;&gt;CLI: Capacity target missed\n        CLI--&gt;&gt;Planner: Workshop needs optimization\n        Planner-&gt;&gt;Planner: Review bottlenecks, adjust layout\n    end</code></pre>"},{"location":"mvp/architecture/06-runtime/#key-runtime-aspects_3","title":"Key Runtime Aspects","text":"Aspect Description Quality Goal Company-Specific Schedules Uses actual wagon arrival patterns from company data Accuracy Capacity Target Comparison Compares simulation results against company requirements Reliability Pass/Fail Assessment Clear indication if workshop meets capacity needs Usability Bottleneck Identification Identifies specific constraints when target not met Accuracy"},{"location":"mvp/architecture/06-runtime/#capacity-assessment-logic","title":"Capacity Assessment Logic","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; RunSimulation: Load config + schedule\n    RunSimulation --&gt; CalculateCapacity: Simulation complete\n    CalculateCapacity --&gt; CompareTarget: Throughput calculated\n\n    CompareTarget --&gt; CapacityMet: Actual &gt;= Target\n    CompareTarget --&gt; CapacityMissed: Actual &lt; Target\n\n    CapacityMet --&gt; GenerateReport: PASS\n    CapacityMissed --&gt; AnalyzeBottlenecks: FAIL\n    AnalyzeBottlenecks --&gt; GenerateReport: With recommendations\n\n    GenerateReport --&gt; [*]\n\n    note right of CompareTarget\n        Target from company requirements\n        Actual from simulation results\n    end note\n\n    note right of AnalyzeBottlenecks\n        Identify limiting factors:\n        - Station capacity\n        - Track congestion\n        - Resource availability\n    end note</code></pre>"},{"location":"mvp/architecture/06-runtime/#performance-characteristics_3","title":"Performance Characteristics","text":"<p>Note:  Performance will be measured during MVP implementation.</p>"},{"location":"mvp/architecture/06-runtime/#65-error-scenarios","title":"6.5 Error Scenarios","text":""},{"location":"mvp/architecture/06-runtime/#651-invalid-configuration","title":"6.5.1 Invalid Configuration","text":"<p>Trigger: User provides configuration with multiple validation errors</p> <pre><code>sequenceDiagram\n    participant User\n    participant CLI\n    participant Config as Configuration Context\n    participant Validator as Pydantic Validator\n    participant Files as File System\n\n    User-&gt;&gt;CLI: python main.py --config invalid.json\n    CLI-&gt;&gt;Config: load_configuration()\n    Config-&gt;&gt;Files: Read invalid.json\n    Files--&gt;&gt;Config: JSON data\n\n    Config-&gt;&gt;Validator: Validate all fields\n    Validator-&gt;&gt;Validator: Collect all validation errors\n    Note over Validator: Does NOT stop at first error\n    Validator-&gt;&gt;Validator: Check station_count &lt;= 0\n    Validator-&gt;&gt;Validator: Check workers_per_station &gt; 10\n    Validator-&gt;&gt;Validator: Check retrofit_time &lt; 0\n    Validator--&gt;&gt;Config: ValidationError with 3 errors\n\n    Config-&gt;&gt;Config: Format error summary\n    Config--xCLI: ValidationError with error list\n\n    CLI-&gt;&gt;CLI: Print validation summary:\n    Note over CLI: Configuration validation failed (3 errors):&lt;br/&gt;1. station_count must be &gt; 0 (got: -1)&lt;br/&gt;2. workers_per_station must be &lt;= 10 (got: 15)&lt;br/&gt;3. retrofit_time must be &gt; 0 (got: -5)\n\n    CLI--&gt;&gt;User: Complete error summary + example config\n    Note over User: User fixes all errors at once</code></pre> <p>Key Behavior: - Pydantic collects ALL validation errors before reporting - User sees complete list of issues in one summary - Enables fixing all problems in single iteration</p> <p>Recovery: User corrects all configuration errors based on comprehensive error summary</p>"},{"location":"mvp/architecture/06-runtime/#652-simulation-failure","title":"6.5.2 Simulation Failure","text":"<p>Trigger: Unexpected error during simulation execution</p> <pre><code>sequenceDiagram\n    participant CLI\n    participant Control as Analysis &amp; Reporting Context\n    participant Domain as Workshop Operations Context\n    participant Files as File System\n\n    CLI-&gt;&gt;Control: run_simulation()\n    Control-&gt;&gt;Domain: Start SimPy\n    Domain-&gt;&gt;Domain: Processing...\n    Domain--xControl: SimulationError: Resource conflict\n    Control-&gt;&gt;Control: Catch exception\n    Control-&gt;&gt;Files: Write partial_results.csv\n    Control-&gt;&gt;Files: Write error_log.json\n    Control--&gt;&gt;CLI: Simulation failed (partial results saved)\n    CLI--&gt;&gt;CLI: Log error details</code></pre> <p>Recovery: Partial results saved for debugging, user can adjust configuration</p>"},{"location":"mvp/architecture/06-runtime/#66-performance-considerations","title":"6.6 Performance Considerations","text":"<p>Note: Performance requirements and actual measurements will be determined during MVP implementation. The following aspects will be evaluated:</p>"},{"location":"mvp/architecture/06-runtime/#performance-aspects-to-measure","title":"Performance Aspects to Measure","text":"Aspect Measurement Goal Rationale Configuration Loading Time to load and validate JSON/CSV files Affects user experience for iterative testing Domain Setup Time to create simulation entities Impacts startup time Simulation Execution Time to run 24h simulation with varying wagon counts Core performance metric Output Generation Time to create CSV files and charts Affects result availability"},{"location":"mvp/architecture/06-runtime/#scalability-testing-plan","title":"Scalability Testing Plan","text":"<p>Test scenarios to evaluate: - Small workshop (one Workshop with two retrofit stations, low wagon volume) - Standard workshop (two workshops with three retrofit stations, medium wagon volume) - High-load scenario (four workshops with three, high wagon volume)</p> <p>Success criteria: - Simulation completes without errors - Results are accurate and reproducible - User experience is acceptable for iterative testing (see Quality Goal 1: Rapid development)</p>"},{"location":"mvp/architecture/07-deployment/","title":"7. Deployment View (MVP)","text":""},{"location":"mvp/architecture/07-deployment/#71-deployment-overview","title":"7.1 Deployment Overview","text":""},{"location":"mvp/architecture/07-deployment/#desktop-application-architecture","title":"Desktop Application Architecture","text":"<pre><code>graph TB\n    subgraph \"Developer Machine\"\n        subgraph \"PopUpSim MVP\"\n            Python[Python 3.13+&lt;br/&gt;Runtime Environment]\n            App[PopUpSim Application&lt;br/&gt;main.py + src/]\n            Config[Configuration Files&lt;br/&gt;config/]\n            Output[Output Directory&lt;br/&gt;output/]\n        end\n\n        subgraph \"Dependencies\"\n            SimPy[SimPy Framework]\n            Matplotlib[Matplotlib]\n            Pandas[Pandas]\n            Pydantic[Pydantic]\n        end\n    end\n\n    App --&gt; Python\n    App --&gt; Config\n    App --&gt; Output\n    Python --&gt; SimPy\n    Python --&gt; Matplotlib\n    Python --&gt; Pandas\n    Python --&gt; Pydantic\n\n    classDef app fill:#4caf50,stroke:#2e7d32,stroke-width:2px,color:#fff\n    classDef deps fill:#ff9800,stroke:#e65100,stroke-width:2px,color:#fff\n    classDef files fill:#9e9e9e,stroke:#616161,stroke-width:2px,color:#fff\n\n    class Python,App app\n    class SimPy,Matplotlib,Pandas,Pydantic deps\n    class Config,Output files</code></pre>"},{"location":"mvp/architecture/07-deployment/#72-installation","title":"7.2 Installation","text":""},{"location":"mvp/architecture/07-deployment/#setup-process","title":"Setup Process","text":"Step Command Description 1. Python Setup <code>python --version</code> Verify Python 3.13+ installed 2. uv Installation <code>pip install uv</code> Install uv package manager 3. Dependencies <code>uv sync</code> Install packages and create lock file 4. Test Run <code>uv run python main.py --help</code> Verify installation"},{"location":"mvp/architecture/07-deployment/#dependencies","title":"Dependencies","text":"<p>Core dependencies are managed in <code>pyproject.toml</code>. Key requirements:</p> <ul> <li>Python 3.13+ - Latest stable Python version (October 2024), provides improved type system and performance</li> <li>SimPy 4.0.1+ - Discrete event simulation (ADR MVP-001)</li> <li>Pydantic 2.0.0+ - Data validation (ADR MVP-003)</li> <li>Matplotlib 3.7.0+ - Visualization (ADR MVP-004)</li> <li>Pandas 2.0.0+ - CSV processing</li> <li>NumPy 1.24.0+ - Numerical operations</li> </ul> <p>Development tools: - Ruff (formatting &amp; linting) - MyPy (type checking with <code>disallow_untyped_defs = true</code>) - Pytest (unit testing)</p> <p>Optional dependencies: - MkDocs toolchain (documentation generation)</p> <p>See <code>pyproject.toml</code> and Section 7.10 for complete dependency list.</p>"},{"location":"mvp/architecture/07-deployment/#73-directory-structure","title":"7.3 Directory Structure","text":""},{"location":"mvp/architecture/07-deployment/#current-project-structure","title":"Current Project Structure","text":"<pre><code>dac-migration-dss-popupsim/\n\u251c\u2500\u2500 popupsim/                   # Main Package\n\u2502   \u251c\u2500\u2500 backend/               # Backend Application\n\u2502   \u2502   \u251c\u2500\u2500 src/               # Source Code\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 configuration/ # Configuration Context\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 service.py         # Configuration service\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 validation.py      # Pydantic validators\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 model_scenario.py  # Scenario model\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 model_workshop.py  # Workshop model\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 model_track.py     # Track model\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 model_route.py     # Route model\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 model_routes.py    # Routes collection\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 model_train.py     # Train model\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 model_wagon.py     # Wagon model\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 simulation/        # Analysis &amp; Reporting Context\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 popupsim.py        # Main simulation orchestrator\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 sim_adapter.py     # SimPy adapter\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 core/              # Core utilities\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 i18n/              # Internationalization\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 main.py            # Entry point\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 tests/             # Unit Tests\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 unit/          # Unit test modules\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 test_model_*.py    # Model tests\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 test_service.py    # Service tests\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 test_validation.py # Validation tests\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 test_sim_*.py      # Simulation tests\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 fixtures/      # Test fixtures\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 config/        # Test configuration files\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 conftest.py    # Pytest configuration\n\u2502   \u2502   \u2514\u2500\u2500 README.md          # Backend documentation\n\u2502   \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 Data/                       # Example Data\n\u2502   \u251c\u2500\u2500 examples/              # Example scenarios\n\u2502   \u2502   \u251c\u2500\u2500 small_scenario/\n\u2502   \u2502   \u251c\u2500\u2500 medium_scenario/\n\u2502   \u2502   \u2514\u2500\u2500 large_scenario/\n\u2502   \u2514\u2500\u2500 README.md\n\u251c\u2500\u2500 docs/                       # Documentation\n\u2502   \u251c\u2500\u2500 architecture/          # Full architecture docs\n\u2502   \u251c\u2500\u2500 mvp/                   # MVP architecture docs\n\u2502   \u2502   \u251c\u2500\u2500 architecture/\n\u2502   \u2502   \u2514\u2500\u2500 development/\n\u2502   \u251c\u2500\u2500 requirements/          # Requirements &amp; use cases\n\u2502   \u2514\u2500\u2500 README.md\n\u251c\u2500\u2500 .github/                    # GitHub Configuration\n\u2502   \u251c\u2500\u2500 workflows/             # CI/CD workflows\n\u2502   \u2502   \u251c\u2500\u2500 python-backend.yaml    # Backend CI\n\u2502   \u2502   \u2514\u2500\u2500 docs.yml               # Docs deployment\n\u2502   \u2514\u2500\u2500 actions/               # Custom actions\n\u251c\u2500\u2500 setup/                      # Setup Scripts\n\u2502   \u2514\u2500\u2500 dev/\n\u2502       \u2514\u2500\u2500 set_commit_msg_hooks.py\n\u251c\u2500\u2500 pyproject.toml              # Project configuration\n\u251c\u2500\u2500 uv.lock                     # Dependency lock file\n\u251c\u2500\u2500 mkdocs.yml                  # Documentation config\n\u251c\u2500\u2500 README.md                   # Project README\n\u251c\u2500\u2500 LICENSE                     # Apache 2.0 License\n\u2514\u2500\u2500 CONTRIBUTING.md             # Contribution guidelines\n</code></pre>"},{"location":"mvp/architecture/07-deployment/#building-block-to-deployment-mapping","title":"Building Block to Deployment Mapping","text":"<p>This table maps the bounded contexts from Section 5 to their deployment locations:</p> Building Block (Section 5) Deployed As Runtime Location Process Storage Configuration Context Python module <code>popupsim/backend/src/contexts/configuration/</code> Main process memory N/A \u2514\u2500 ConfigurationBuilder Python class <code>configuration/domain/configuration_builder.py</code> Main process memory N/A \u2514\u2500 FileLoader Python class <code>configuration/infrastructure/file_loader.py</code> Main process memory N/A \u2514\u2500 Domain Models Pydantic classes <code>configuration/domain/models/</code> Main process memory N/A Retrofit Workflow Context Python module <code>popupsim/backend/src/contexts/retrofit_workflow/</code> Main process memory N/A \u2514\u2500 RetrofitWorkflowContext Python class <code>retrofit_workflow/application/retrofit_workflow_context.py</code> Main process memory N/A \u2514\u2500 Coordinators Python classes <code>retrofit_workflow/application/coordinators/</code> Main process memory N/A \u2514\u2500 Domain Services Python classes <code>retrofit_workflow/domain/services/</code> Main process memory N/A \u2514\u2500 Resource Managers Python classes <code>retrofit_workflow/infrastructure/resource_managers/</code> Main process memory N/A \u2514\u2500 Metrics Collection Python classes <code>retrofit_workflow/infrastructure/metrics/</code> Main process memory N/A Railway Infrastructure Context Python module <code>popupsim/backend/src/contexts/railway_infrastructure/</code> Main process memory N/A \u2514\u2500 RailwayContext Python class <code>railway_infrastructure/application/railway_context.py</code> Main process memory N/A \u2514\u2500 Track Aggregates Python classes <code>railway_infrastructure/domain/aggregates/</code> Main process memory N/A \u2514\u2500 Track Services Python classes <code>railway_infrastructure/domain/services/</code> Main process memory N/A External Trains Context Python module <code>popupsim/backend/src/contexts/external_trains/</code> Main process memory N/A \u2514\u2500 ExternalTrainsContext Python class <code>external_trains/application/external_trains_context.py</code> Main process memory N/A \u2514\u2500 WagonFactory Python class <code>external_trains/domain/wagon_factory.py</code> Main process memory N/A \u2514\u2500 EventPublisher Python class <code>external_trains/infrastructure/event_publisher.py</code> Main process memory N/A External Dependencies \u2514\u2500 SimPy Framework Python library Virtual environment Main process memory N/A \u2514\u2500 Pydantic Python library Virtual environment Main process memory N/A \u2514\u2500 Matplotlib Python library Virtual environment Main process memory N/A Data Artifacts \u2514\u2500 Configuration Files JSON/CSV files <code>Data/examples/</code> or custom path N/A File system \u2514\u2500 Result Files CSV/PNG/JSON <code>output/</code> directory N/A File system <p>Key Observations: - All bounded contexts run in single Python process (desktop application) - All components reside in process memory (no distributed deployment) - Only data artifacts (config files, results) use file system storage - No database - all state is transient or file-based - No network - all communication is in-process method calls or event bus</p>"},{"location":"mvp/architecture/07-deployment/#current-implementation-status","title":"Current Implementation Status","text":"<p>Implemented:</p> Component Status Directory Purpose Configuration Context \u2705 Implemented <code>contexts/configuration/</code> Load and validate scenarios Retrofit Workflow Context \u2705 Implemented <code>contexts/retrofit_workflow/</code> Core simulation logic Railway Infrastructure Context \u2705 Implemented <code>contexts/railway_infrastructure/</code> Track management External Trains Context \u2705 Implemented <code>contexts/external_trains/</code> Train arrivals"},{"location":"mvp/architecture/07-deployment/#74-execution-environment","title":"7.4 Execution Environment","text":""},{"location":"mvp/architecture/07-deployment/#runtime-requirements","title":"Runtime Requirements","text":"<p>Note: Resource requirements will be measured during MVP implementation with realistic scenarios. The following are known requirements:</p> Component Requirement Notes Python 3.13+ Latest stable version (October 2024) OS Windows 10+, macOS 10.15+, Ubuntu 20.04+ Cross-platform support RAM To be measured Depends on scenario size (wagon count, simulation duration). Estimated minimum: 4GB CPU To be measured Single-threaded SimPy execution Storage To be measured Estimated: ~100 MB + results (dependencies ~50 MB, code ~10 MB, results vary by scenario)"},{"location":"mvp/architecture/07-deployment/#command-line-interface","title":"Command Line Interface","text":"<pre><code># Basic execution\nuv run python main.py\n\n# With custom models\nuv run python main.py --config custom_config/\n\n# With custom output directory\nuv run python main.py --output results/\n\n# Import infrastructure data (US-003)\nuv run python main.py --import-infra topology.csv workshop.csv\n\n# Debug mode\nuv run python main.py --debug --verbose\n\n# Help\nuv run python main.py --help\n</code></pre>"},{"location":"mvp/architecture/07-deployment/#75-configuration-management","title":"7.5 Configuration Management","text":""},{"location":"mvp/architecture/07-deployment/#configuration-file-locations","title":"Configuration File Locations","text":"<pre><code>graph TB\n    subgraph \"Configuration Sources\"\n        Default[Default Config&lt;br/&gt;Built-in Values]\n        Files[Config Files&lt;br/&gt;config/ directory]\n        CLI[Command Line&lt;br/&gt;Arguments]\n    end\n\n    subgraph \"Configuration Merge\"\n        Merger[Config Merger&lt;br/&gt;Priority Order]\n    end\n\n    subgraph \"Final Config\"\n        Runtime[Runtime Configuration&lt;br/&gt;Used by Simulation]\n    end\n\n    Default --&gt; Merger\n    Files --&gt; Merger\n    CLI --&gt; Merger\n    Merger --&gt; Runtime\n\n    classDef source fill:#e3f2fd\n    classDef process fill:#e8f5e8\n    classDef result fill:#fff3e0\n\n    class Default,Files,CLI source\n    class Merger process\n    class Runtime result</code></pre>"},{"location":"mvp/architecture/07-deployment/#configuration-priority","title":"Configuration Priority","text":"<ol> <li>Command Line Arguments (Highest Priority)</li> <li>Config Files (config/ directory)</li> <li>Default Values (Built-in)</li> </ol>"},{"location":"mvp/architecture/07-deployment/#76-output-management","title":"7.6 Output Management","text":""},{"location":"mvp/architecture/07-deployment/#result-files","title":"Result Files","text":"<pre><code>graph TB\n    subgraph \"MVP Output Generation\"\n        Simulation[Simulation Results]\n\n        subgraph \"Output Formats\"\n            CSV[CSV Files&lt;br/&gt;Structured Data]\n            PNG[PNG Charts&lt;br/&gt;Matplotlib Plots]\n            JSON[JSON Logs&lt;br/&gt;Event Timeline]\n        end\n\n        subgraph \"Output Locations\"\n            OutputDir[output/&lt;br/&gt;Default Directory]\n            CustomDir[Custom Directory&lt;br/&gt;--output parameter]\n        end\n    end\n\n    Simulation --&gt; CSV\n    Simulation --&gt; PNG\n    Simulation --&gt; JSON\n\n    CSV --&gt; OutputDir\n    PNG --&gt; OutputDir\n    JSON --&gt; OutputDir\n\n    CSV -.-&gt; CustomDir\n    PNG -.-&gt; CustomDir\n    JSON -.-&gt; CustomDir\n\n    classDef simulation fill:#4caf50,stroke:#2e7d32\n    classDef format fill:#ff9800,stroke:#e65100\n    classDef location fill:#9e9e9e,stroke:#616161\n\n    class Simulation simulation\n    class CSV,PNG,JSON format\n    class OutputDir,CustomDir location</code></pre>"},{"location":"mvp/architecture/07-deployment/#77-error-handling-logging","title":"7.7 Error Handling &amp; Logging","text":""},{"location":"mvp/architecture/07-deployment/#logging-configuration","title":"Logging Configuration","text":"<pre><code># Logging Setup\nimport logging\nfrom typing import NoReturn\n\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n    handlers=[\n        logging.FileHandler('output/simulation.log'),\n        logging.StreamHandler()  # Console output\n    ]\n)\n</code></pre>"},{"location":"mvp/architecture/07-deployment/#error-recovery-strategy","title":"Error Recovery Strategy","text":"Error Type MVP Behavior Recovery Action Configuration Error Exit with comprehensive error summary Fix all reported configuration issues Simulation Error Save partial results Check system resources, adjust configuration Output Error Continue without failed output Check file permissions Dependency Error Exit with installation instructions Install missing packages with <code>uv sync</code>"},{"location":"mvp/architecture/07-deployment/#78-performance-monitoring","title":"7.8 Performance Monitoring","text":""},{"location":"mvp/architecture/07-deployment/#resource-usage","title":"Resource Usage","text":"<p>Note: Actual resource usage will be measured during MVP implementation. The following aspects will be monitored:</p> <pre><code>graph TB\n    subgraph \"MVP Performance Metrics\"\n        subgraph \"Memory Usage\"\n            ConfigMem[Config Loading&lt;br/&gt;To be measured]\n            SimMem[Simulation Runtime&lt;br/&gt;To be measured]\n            OutputMem[Output Generation&lt;br/&gt;To be measured]\n        end\n\n        subgraph \"CPU Usage\"\n            SetupCPU[Setup Phase&lt;br/&gt;Low CPU]\n            SimCPU[Simulation Phase&lt;br/&gt;High CPU]\n            OutputCPU[Output Phase&lt;br/&gt;Medium CPU]\n        end\n\n        subgraph \"Disk I/O\"\n            ReadIO[Config Reading&lt;br/&gt;Sequential]\n            WriteIO[Result Writing&lt;br/&gt;Sequential]\n        end\n    end\n\n    classDef memory fill:#e3f2fd\n    classDef cpu fill:#e8f5e8\n    classDef disk fill:#fff3e0\n\n    class ConfigMem,SimMem,OutputMem memory\n    class SetupCPU,SimCPU,OutputCPU cpu\n    class ReadIO,WriteIO disk</code></pre>"},{"location":"mvp/architecture/07-deployment/#79-distribution-strategy","title":"7.9 Distribution Strategy","text":""},{"location":"mvp/architecture/07-deployment/#packaging-options","title":"Packaging Options","text":"Option Advantages Disadvantages Use Case Source Code Simple development, full control Requires Python setup Development team Zip Archive Easy distribution Still requires Python Internal testing PyInstaller Single executable file Large file size End users (future) Docker Consistent environment Overhead Cloud deployment (future)"},{"location":"mvp/architecture/07-deployment/#distribution-flow","title":"Distribution Flow","text":"<pre><code>graph LR\n    A[Source Code&lt;br/&gt;Git Repository] --&gt; B[Zip Archive&lt;br/&gt;Release Package]\n    B --&gt; C[PyInstaller&lt;br/&gt;Executable]\n    C --&gt; D[Docker Image&lt;br/&gt;Container]\n\n    A -.-&gt;|MVP Current| B\n    B -.-&gt;|Future| C\n    C -.-&gt;|Future| D\n\n    classDef current fill:#4caf50,stroke:#2e7d32\n    classDef future fill:#ff9800,stroke:#e65100\n\n    class A,B current\n    class C,D future</code></pre>"},{"location":"mvp/architecture/07-deployment/#710-technology-stack-summary","title":"7.10 Technology Stack Summary","text":""},{"location":"mvp/architecture/07-deployment/#core-technologies","title":"Core Technologies","text":"Technology Version Purpose Decision Reference Python 3.13+ Runtime environment Latest stable version with improved type system uv Latest Package manager Fast, reliable dependency management SimPy 4.0.1+ Discrete event simulation ADR MVP-001 Pydantic 2.0.0+ Data validation ADR MVP-003 Matplotlib 3.7.0+ Visualization ADR MVP-004 Pandas 2.0.0+ CSV processing Data manipulation NumPy 1.24.0+ Numerical operations KPI calculations"},{"location":"mvp/architecture/07-deployment/#development-tools","title":"Development Tools","text":"Tool Purpose Configuration Ruff Formatting &amp; linting <code>pyproject.toml</code> MyPy Type checking <code>disallow_untyped_defs = true</code> Pytest Unit testing <code>tests/</code> directory MkDocs Documentation Optional dependency group"},{"location":"mvp/architecture/07-deployment/#deployment-model","title":"Deployment Model","text":"<p>MVP: Desktop application (local execution) - File-based configuration (JSON/CSV) - File-based output (CSV/PNG/JSON) - No network dependencies - Single-user, single-threaded</p> <p>Future: Web application (cloud-ready) - Web interface - Database storage - Multi-user support - Distributed execution</p>"},{"location":"mvp/architecture/07-deployment/#711-quality-goals-and-deployment","title":"7.11 Quality Goals and Deployment","text":"<p>The MVP deployment model directly supports the quality goals defined in Section 1.2:</p> Quality Goal Deployment Decision How It Supports Trade-offs Rapid Development (Priority 1) Desktop application, no server setup, local execution Developers run simulations locally with immediate feedback, no deployment pipeline needed, fast iteration cycles Limited to single user, no real-time collaboration, no shared simulation state Simulation Accuracy &amp; Reliability (Priority 2) Single-threaded SimPy execution, deterministic event processing Reproducible results, no race conditions, predictable behavior, easier debugging Cannot leverage multi-core CPUs for parallel execution, slower for large scenarios Usability &amp; Accessibility (Priority 3) File-based configuration (JSON/CSV), command-line interface, example scenarios in <code>Data/</code> Familiar file formats, easy to edit with any text editor, version control friendly, no GUI learning curve Requires text editor skills, no visual configuration, command-line knowledge needed Simple Installation (Priority 4) uv package manager, Python 3.13+ (latest stable), no database, no web server One-command installation (<code>uv sync</code>), minimal dependencies, no infrastructure setup, works offline Requires Python 3.13+ (latest stable) installed, command-line familiarity, no installer wizard Testability (Priority 5) Pytest in same environment, test fixtures in repository, CI/CD with GitHub Actions Tests run in identical setup as production, fast feedback, easy to reproduce issues, automated testing No separate test infrastructure, tests share same environment as development"},{"location":"mvp/architecture/07-deployment/#deployment-rationale","title":"Deployment Rationale","text":"<p>The desktop deployment model was chosen to maximize rapid development (Priority 1) and simple installation (Priority 4) for the MVP phase:</p> <ul> <li>No infrastructure complexity - Eliminates server setup, database configuration, and network dependencies</li> <li>Fast feedback loops - Developers can test changes immediately without deployment</li> <li>Minimal barriers - Strategic planners can run simulations with basic Python knowledge</li> <li>Version control friendly - All configuration is text-based and can be tracked in Git</li> </ul> <p>Future evolution: The full version will add web interface and database storage while maintaining the core simulation engine developed in the MVP.</p>"},{"location":"mvp/architecture/07-deployment/#712-deployment-scenarios","title":"7.12 Deployment Scenarios","text":""},{"location":"mvp/architecture/07-deployment/#scenario-1-developer-deployment","title":"Scenario 1: Developer Deployment","text":"<p>User: Software developer working on PopUpSim MVP</p> <p>Goal: Set up development environment for implementing new features</p> <p>Prerequisites: - Git installed - Python 3.13+ installed - Text editor or IDE</p> <p>Deployment Steps:</p> <pre><code># 1. Clone repository\ngit clone https://github.com/open-rail-association/dac-migration-dss-popupsim.git\ncd dac-migration-dss-popupsim\n\n# 2. Install uv package manager\npip install uv\n\n# 3. Install dependencies\nuv sync\n\n# 4. Run tests to verify setup\nuv run pytest\n\n# 5. Run simulation with example data\nuv run python popupsim/backend/src/main.py --config Data/examples/small_scenario/\n\n# 6. Set up pre-commit hooks (optional)\nuv run python setup/dev/set_commit_msg_hooks.py\n</code></pre> <p>Environment: - Full source code access - Read/write permissions - Can modify code and run tests - CI/CD runs on push to GitHub</p> <p>Typical Workflow: 1. Create feature branch 2. Implement changes with type hints 3. Run <code>uv run ruff format .</code> and <code>uv run mypy backend/src/</code> 4. Run <code>uv run pytest</code> to verify tests pass 5. Commit and push for CI/CD validation</p>"},{"location":"mvp/architecture/07-deployment/#scenario-2-strategic-planner-deployment","title":"Scenario 2: Strategic Planner Deployment","text":"<p>User: Strategic Migration Planner testing standardized workshop designs (US-001, US-002)</p> <p>Goal: Run simulations to compare different workshop configurations</p> <p>Prerequisites: - Python 3.13+ installed - Basic command-line knowledge - Received PopUpSim release package (zip archive)</p> <p>Deployment Steps:</p> <pre><code># 1. Extract release package\nunzip popupsim-mvp-v0.1.0.zip\ncd popupsim-mvp-v0.1.0\n\n# 2. Install uv package manager\npip install uv\n\n# 3. Install dependencies\nuv sync\n\n# 4. Verify installation\nuv run python popupsim/backend/src/main.py --help\n\n# 5. Run simulation with example scenario\nuv run python popupsim/backend/src/main.py --config Data/examples/medium_scenario/\n\n# 6. Review results\nls output/\n# simulation_results.csv, kpi_charts.png, simulation_log.json\n</code></pre> <p>Environment: - Read-only source code - Can create custom configuration files - Can run simulations with different parameters - Results saved to <code>output/</code> directory</p> <p>Typical Workflow (US-001): 1. Copy example scenario: <code>cp -r Data/examples/medium_scenario/ my_workshop_4stations/</code> 2. Edit <code>my_workshop_4stations/scenario.json</code> (change station count to 4) 3. Run simulation: <code>uv run python popupsim/backend/src/main.py --config my_workshop_4stations/</code> 4. Repeat for 2 stations and 6 stations 5. Compare results in <code>output/</code> directory 6. Select optimal configuration</p>"},{"location":"mvp/architecture/07-deployment/#scenario-3-company-planner-deployment","title":"Scenario 3: Company Planner Deployment","text":"<p>User: Company Planner assessing capacity for planned workshop (US-003, US-004)</p> <p>Goal: Import company infrastructure data and assess if workshop meets capacity targets</p> <p>Prerequisites: - Python 3.13+ installed - Company infrastructure data (CSV files) - Received PopUpSim release package</p> <p>Deployment Steps:</p> <pre><code># 1-3. Same as Strategic Planner (extract, install uv, uv sync)\n\n# 4. Prepare company data\nmkdir my_company_data\ncp company_track_topology.csv my_company_data/topology.csv\ncp company_workshop_layout.csv my_company_data/workshop.csv\ncp company_train_schedule.csv my_company_data/schedule.csv\n\n# 5. Import infrastructure data (US-003)\nuv run python popupsim/backend/src/main.py --import-infra \\\n  my_company_data/topology.csv \\\n  my_company_data/workshop.csv\n\n# 6. Run capacity assessment (US-004)\nuv run python popupsim/backend/src/main.py \\\n  --config validated_scenario.json \\\n  --schedule my_company_data/schedule.csv\n\n# 7. Review capacity assessment\ncat output/capacity_assessment.csv\n# Check if actual throughput &gt;= target throughput\n</code></pre> <p>Environment: - Read-only source code - Company-specific data files - Can import and validate infrastructure - Results show pass/fail for capacity targets</p> <p>Typical Workflow (US-004): 1. Import company infrastructure (US-003) 2. Set capacity target in scenario (e.g., 500 wagons/week) 3. Run week-long simulation (168 hours) 4. Review capacity assessment results 5. If target not met, analyze bottlenecks 6. Adjust workshop layout and re-run</p>"},{"location":"mvp/architecture/07-deployment/#deployment-comparison","title":"Deployment Comparison","text":"Aspect Developer Strategic Planner Company Planner Source Access Full (read/write) Read-only Read-only Installation Git clone Zip archive Zip archive Data Example scenarios Example + custom configs Company infrastructure Typical Use Cases US-001, US-002, US-003, US-004 US-001, US-002 US-003, US-004 Output Test results + simulation Simulation results Capacity assessment Environment Development Production-like Production-like Updates Git pull New zip release New zip release"},{"location":"mvp/architecture/08-concepts/","title":"8. Cross-Cutting Concepts (MVP)","text":"<p>This section describes architectural concepts and patterns that apply across multiple building blocks. Code examples illustrate these concepts but are not production code.</p>"},{"location":"mvp/architecture/08-concepts/#81-layered-architecture","title":"8.1 Layered Architecture","text":"<p>Note: Each bounded context follows a layered architecture pattern (ADR MVP-005).</p>"},{"location":"mvp/architecture/08-concepts/#layer-structure-applied-to-each-context","title":"Layer Structure (Applied to Each Context)","text":"<pre><code>graph TB\n    subgraph \"MVP Layers\"\n        subgraph \"Presentation\"\n            CLI[CLI Interface]\n        end\n\n        subgraph \"Business Logic\"\n            ConfigService[Configuration Service]\n            DomainService[Workshop Operations Service]\n            SimulationService[Analysis &amp; Reporting Service]\n        end\n\n        subgraph \"Data Access\"\n            JSONReader[JSON Reader]\n            CSVWriter[CSV Writer]\n        end\n\n        subgraph \"Infrastructure\"\n            SimPy[SimPy Framework]\n            Matplotlib[Matplotlib]\n        end\n    end\n\n    CLI --&gt; ConfigService\n    CLI --&gt; SimulationService\n    ConfigService --&gt; JSONReader\n    DomainService --&gt; SimPy\n    SimulationService --&gt; CSVWriter\n    SimulationService --&gt; Matplotlib\n\n    classDef presentation fill:#4caf50,stroke:#2e7d32,stroke-width:2px,color:#fff\n    classDef business fill:#2196f3,stroke:#1565c0,stroke-width:2px,color:#fff\n    classDef data fill:#ff9800,stroke:#e65100,stroke-width:2px,color:#fff\n    classDef infrastructure fill:#9e9e9e,stroke:#616161,stroke-width:2px,color:#fff\n\n    class CLI presentation\n    class ConfigService,DomainService,SimulationService business\n    class JSONReader,CSVWriter data\n    class SimPy,Matplotlib infrastructure</code></pre> Layer Responsibility Components Application Coordinators, context orchestration ArrivalCoordinator, CollectionCoordinator, WorkshopCoordinator, ParkingCoordinator Domain Business logic, domain services BatchFormationService, RakeFormationService, TrainFormationService, WorkshopSchedulingService Infrastructure External frameworks, resource management SimPy, LocomotiveResourceManager, TrackCapacityManager, WorkshopResourceManager <p>Rationale: Layered architecture provides clear separation of concerns within each bounded context, enabling rapid MVP development while maintaining code organization. See Section 4.3 for architectural pattern decision.</p>"},{"location":"mvp/architecture/08-concepts/#82-domain-model-with-standardized-field-names","title":"8.2 Domain Model with Standardized Field Names","text":"<p>Field Name Standardization: All entity IDs use consistent naming: <code>id</code> (not <code>prefix_id</code>) and <code>track</code> (not <code>track_id</code>) for track references.</p> <p>WARNING: Code examples in this section are simplified illustrations for architecture documentation only. They are NOT production-ready and lack: - Complete validation logic - Full type hints and error handling - Business rules and edge cases - Comprehensive docstrings</p> <p>DO NOT copy-paste these examples into production code.</p>"},{"location":"mvp/architecture/08-concepts/#mvp-core-entities","title":"MVP Core Entities","text":"<pre><code>classDiagram\n    class Workshop {\n        +id: str\n        +track: str\n        +retrofit_stations: int\n        +get_available_capacity()\n        +calculate_throughput()\n    }\n\n    class Locomotive {\n        +id: str\n        +track: str\n        +status: LocomotiveStatus\n        +is_available()\n        +assign_to_job()\n    }\n\n    class Wagon {\n        +id: str\n        +track: str\n        +length: float\n        +needs_retrofit: bool\n        +status: WagonStatus\n    }\n\n    class Train {\n        +id: str\n        +locomotive_id: str\n        +route_id: str\n        +wagons: List[Wagon]\n        +arrival_time: datetime\n    }\n\n    Workshop --o Station\n    Station --o Worker\n    Station --o Wagon</code></pre>"},{"location":"mvp/architecture/08-concepts/#mvp-configuration-models","title":"MVP Configuration Models","text":"<p>Actual implementation: <code>popupsim/backend/src/configuration/model_*.py</code></p> <pre><code># SIMPLIFIED EXAMPLE - See actual files for complete implementation\nfrom datetime import date\nfrom pydantic import BaseModel, Field\n\nclass ScenarioConfig(BaseModel):\n    \"\"\"Configuration model for simulation scenarios.\"\"\"\n    scenario_id: str = Field(pattern=r'^[a-zA-Z0-9_-]+$', min_length=1, max_length=50)\n    start_date: date\n    end_date: date\n    workshop: Workshop | None = None\n    train_schedule_file: str\n    routes_file: str | None = None\n    workshop_tracks_file: str | None = None\n    # ... additional fields and validators in actual implementation\n\nclass Workshop(BaseModel):\n    \"\"\"Workshop models with available tracks.\"\"\"\n    tracks: list[WorkshopTrack] = Field(min_length=1)\n    # ... additional validators in actual implementation\n\nclass WorkshopTrack(BaseModel):\n    \"\"\"Individual track within workshop.\"\"\"\n    id: str\n    function: TrackFunction\n    capacity: int = Field(ge=1)\n    retrofit_time_min: int = Field(ge=0)\n    # ... additional fields in actual implementation\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#mvp-result-models","title":"MVP Result Models","text":"<pre><code># SIMPLIFIED EXAMPLE - Actual structure to be defined during implementation\nclass SimulationResults(BaseModel):\n    total_wagons_processed: int\n    simulation_duration_hours: float\n    throughput_per_hour: float\n    average_waiting_time: float\n    station_utilization: float\n    # ... additional KPIs to be determined\n\nclass KPIData(BaseModel):\n    timestamp: str\n    throughput: float\n    utilization: float\n    queue_length: int\n    waiting_time: float\n    # ... additional metrics to be determined\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#83-error-handling","title":"8.3 Error Handling","text":"<p>Error handling strategy supports the quality goals defined in Section 1.2, particularly Simulation Accuracy &amp; Reliability (Priority 2). See Section 6 for error scenarios in runtime view.</p>"},{"location":"mvp/architecture/08-concepts/#mvp-exception-hierarchy","title":"MVP Exception Hierarchy","text":"<pre><code># CONCEPTUAL EXAMPLE - Illustrates exception hierarchy pattern\nclass PopUpSimError(Exception):\n    \"\"\"Base exception for PopUpSim MVP\"\"\"\n    pass\n\nclass ConfigurationError(PopUpSimError):\n    \"\"\"Configuration loading/validation errors\"\"\"\n    pass\n\nclass SimulationError(PopUpSimError):\n    \"\"\"Simulation runtime errors\"\"\"\n    pass\n\nclass OutputError(PopUpSimError):\n    \"\"\"Output generation errors\"\"\"\n    pass\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#mvp-error-handling-strategy","title":"MVP Error Handling Strategy","text":"<pre><code>graph TB\n    subgraph \"MVP Error Handling\"\n        Try[Try Operation]\n        Catch[Catch Exception]\n        Log[Log Error]\n        Recover[Attempt Recovery]\n        Fail[Graceful Failure]\n    end\n\n    Try --&gt; Catch\n    Catch --&gt; Log\n    Log --&gt; Recover\n    Recover --&gt; Fail\n\n    classDef error fill:#ffebee,stroke:#d32f2f\n    classDef recovery fill:#e8f5e8,stroke:#388e3c\n\n    class Try,Catch,Log error\n    class Recover,Fail recovery</code></pre>"},{"location":"mvp/architecture/08-concepts/#84-logging-concept","title":"8.4 Logging Concept","text":"<p>Logging configuration is defined in Section 7.7.</p>"},{"location":"mvp/architecture/08-concepts/#mvp-logging-levels","title":"MVP Logging Levels","text":"Level MVP Usage Example DEBUG Detailed development info SimPy event details INFO Normal program execution \"Simulation started\" WARNING Potential problems \"High queue length detected\" ERROR Errors with recovery \"Config file not found, using defaults\" CRITICAL Severe errors \"Simulation failed completely\""},{"location":"mvp/architecture/08-concepts/#mvp-log-format","title":"MVP Log Format","text":"<pre><code># CONCEPTUAL EXAMPLE - Illustrates logging pattern\nLOG_FORMAT = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n\n# Example log output:\n# 2025-10-15 10:00:00,123 - ConfigService - INFO - Loading scenario.json\n# 2025-10-15 10:00:01,456 - WorkshopService - INFO - Created 4 stations\n# 2025-10-15 10:00:02,789 - SimulationService - INFO - Starting simulation\n# 2025-10-15 10:05:30,012 - SimulationService - WARNING - Queue length: 25\n# 2025-10-15 10:10:45,345 - OutputService - INFO - Generated results.csv\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#85-configuration-management","title":"8.5 Configuration Management","text":"<p>Configuration management supports Usability &amp; Accessibility (Priority 3) through file-based configuration. See Section 5.2 for Configuration Context details.</p>"},{"location":"mvp/architecture/08-concepts/#mvp-configuration-loading","title":"MVP Configuration Loading","text":"<pre><code>sequenceDiagram\n    participant Main as main.py\n    participant CS as ConfigService\n    participant Validator as Validator\n    participant Files as File System\n\n    Main-&gt;&gt;CS: load_configuration()\n    CS-&gt;&gt;Files: read scenario.json\n    Files-&gt;&gt;CS: json_data\n    CS-&gt;&gt;Files: read workshop_config.csv\n    Files-&gt;&gt;CS: csv_data\n    CS-&gt;&gt;Validator: validate_config(data)\n    Validator-&gt;&gt;CS: validation_result\n    CS-&gt;&gt;Main: merged_config</code></pre>"},{"location":"mvp/architecture/08-concepts/#mvp-configuration-validation","title":"MVP Configuration Validation","text":"<pre><code># CONCEPTUAL EXAMPLE - Illustrates validation pattern\ndef validate_scenario_config(config: dict) -&gt; List[str]:\n    \"\"\"MVP Configuration Validation\"\"\"\n    errors = []\n\n    # Basic validation rules\n    if config.get('duration_hours', 0) &lt;= 0:\n        errors.append(\"Duration must be positive\")\n\n    if config.get('stations', 0) &lt; 1:\n        errors.append(\"At least one station required\")\n\n    if config.get('workers_per_station', 0) &lt; 1:\n        errors.append(\"At least one worker per station required\")\n\n    return errors\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#86-testing-concept","title":"8.6 Testing Concept","text":"<p>Testing strategy supports Testability (Priority 5) quality goal. See Section 7.10 for testing tools (Pytest, MyPy, Ruff).</p>"},{"location":"mvp/architecture/08-concepts/#mvp-test-strategy","title":"MVP Test Strategy","text":"<pre><code>graph TB\n    subgraph \"MVP Testing Pyramid\"\n        subgraph \"Unit Tests\"\n            ConfigTests[Configuration Tests]\n            ModelTests[Domain Model Tests]\n            ServiceTests[Service Logic Tests]\n        end\n\n        subgraph \"Integration Tests\"\n            FileTests[File I/O Tests]\n            SimPyTests[SimPy Integration Tests]\n        end\n\n        subgraph \"System Tests\"\n            E2ETests[End-to-End Simulation Tests]\n        end\n    end\n\n    ConfigTests --&gt; FileTests\n    ModelTests --&gt; SimPyTests\n    ServiceTests --&gt; E2ETests\n\n    classDef unit fill:#4caf50,stroke:#2e7d32\n    classDef integration fill:#ff9800,stroke:#e65100\n    classDef system fill:#2196f3,stroke:#1565c0\n\n    class ConfigTests,ModelTests,ServiceTests unit\n    class FileTests,SimPyTests integration\n    class E2ETests system</code></pre>"},{"location":"mvp/architecture/08-concepts/#mvp-test-examples","title":"MVP Test Examples","text":"<pre><code># CONCEPTUAL EXAMPLES - Illustrate testing patterns\n\n# Unit Test Example\ndef test_workshop_station_availability():\n    station = Station(id=\"WS001\", capacity=2, workers=[], current_wagons=1)\n    assert station.is_available() == True\n\n    station.current_wagons = 2\n    assert station.is_available() == False\n\n# Integration Test Example\ndef test_configuration_loading():\n    config_service = ConfigurationService()\n    config = config_service.load_scenario(\"test_data/\")\n    assert config.duration_hours &gt; 0\n    assert len(config.workshop.stations) &gt; 0\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#87-performance-concept","title":"8.7 Performance Concept","text":"<p>Performance monitoring will measure actual resource usage during MVP implementation. See Section 7.8 for performance metrics.</p>"},{"location":"mvp/architecture/08-concepts/#mvp-performance-monitoring","title":"MVP Performance Monitoring","text":"<pre><code># CONCEPTUAL EXAMPLE - Illustrates performance monitoring pattern\nimport time\nfrom functools import wraps\nfrom typing import Any, Callable, TypeVar\n\nT = TypeVar('T')\n\ndef measure_time(func: Callable[..., T]) -&gt; Callable[..., T]:\n    \"\"\"MVP Performance Decorator\"\"\"\n    @wraps(func)\n    def wrapper(*args: Any, **kwargs: Any) -&gt; T:\n        start_time = time.time()\n        result = func(*args, **kwargs)\n        end_time = time.time()\n\n        duration = end_time - start_time\n        logging.info(f\"{func.__name__} took {duration:.2f} seconds\")\n\n        return result\n    return wrapper\n\n# Usage\n@measure_time\ndef run_simulation(duration_hours: int) -&gt; None:\n    # Simulation logic\n    pass\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#mvp-memory-management","title":"MVP Memory Management","text":"<pre><code># CONCEPTUAL EXAMPLE - Illustrates memory monitoring pattern\nimport gc\nimport psutil\nimport os\n\ndef log_memory_usage(phase: str) -&gt; None:\n    \"\"\"MVP Memory Monitoring\"\"\"\n    process = psutil.Process(os.getpid())\n    memory_mb = process.memory_info().rss / 1024 / 1024\n\n    logging.info(f\"Memory usage in {phase}: {memory_mb:.1f} MB\")\n\n    # Force garbage collection for MVP\n    gc.collect()\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#88-4-layer-validation-framework","title":"8.8 4-Layer Validation Framework","text":"<p>Enterprise-grade validation with comprehensive error stacking ensures Simulation Accuracy &amp; Reliability (Priority 2). See validation framework documentation in the codebase for complete details.</p>"},{"location":"mvp/architecture/08-concepts/#4-layer-validation-architecture","title":"4-Layer Validation Architecture","text":"<pre><code>graph TB\n    subgraph \"Validation Pipeline\"\n        Input[\"Scenario Data\"]\n\n        subgraph \"Layer 1: SYNTAX\"\n            Syntax[\"Field format validation&lt;br/&gt;Type checking&lt;br/&gt;Required fields\"]\n        end\n\n        subgraph \"Layer 2: SEMANTIC\"\n            Semantic[\"Business rules&lt;br/&gt;Date logic&lt;br/&gt;Strategy validation\"]\n        end\n\n        subgraph \"Layer 3: INTEGRITY\"\n            Integrity[\"Cross-references&lt;br/&gt;Data consistency&lt;br/&gt;Duplicate detection\"]\n        end\n\n        subgraph \"Layer 4: FEASIBILITY\"\n            Feasibility[\"Capacity constraints&lt;br/&gt;Resource allocation&lt;br/&gt;Simulation readiness\"]\n        end\n\n        Result[\"ValidationResult&lt;br/&gt;All issues stacked\"]\n    end\n\n    Input --&gt; Syntax\n    Syntax --&gt; Semantic\n    Semantic --&gt; Integrity\n    Integrity --&gt; Feasibility\n    Feasibility --&gt; Result\n\n    classDef layer fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef validation fill:#e8f5e8,stroke:#388e3c,stroke-width:2px\n    classDef external fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n\n    class Syntax,Semantic,Integrity,Feasibility layer\n    class Result validation\n    class Input external</code></pre>"},{"location":"mvp/architecture/08-concepts/#error-stacking-vs-fail-fast-comparison","title":"Error Stacking vs Fail-Fast Comparison","text":"Approach User Experience Development Efficiency Error Quality Fail-Fast (Traditional) \u274c Fix 1 error \u2192 Run again \u2192 Fix 1 error \u2b50\u2b50 Slow iteration \u2b50\u2b50 Limited context Error Stacking (PopUpSim) \u2705 See ALL issues at once \u2192 Fix all \u2b50\u2b50\u2b50\u2b50\u2b50 Fast iteration \u2b50\u2b50\u2b50\u2b50\u2b50 Complete context"},{"location":"mvp/architecture/08-concepts/#validation-layer-examples","title":"Validation Layer Examples","text":"<pre><code># ACTUAL IMPLEMENTATION - Layer 3: Integrity Validator\nclass IntegrityValidator:\n    \"\"\"Validates cross-references and data consistency.\"\"\"\n\n    def validate(self, scenario: Scenario) -&gt; ValidationResult:\n        result = ValidationResult(is_valid=True)\n\n        # Collect all available IDs\n        locomotive_ids = {loco.id for loco in scenario.locomotives or []}\n        route_ids = {route.id for route in scenario.routes or []}\n\n        # Validate train references\n        for i, train in enumerate(scenario.trains or []):\n            if train.locomotive_id not in locomotive_ids:\n                result.add_error(\n                    f\"Train {train.id} references non-existent locomotive '{train.locomotive_id}'\",\n                    field=f\"trains[{i}].locomotive_id\",\n                    category=ValidationCategory.INTEGRITY,\n                    suggestion=f\"Use one of: {', '.join(locomotive_ids)}\"\n                )\n\n        return result\n\n# ACTUAL IMPLEMENTATION - Validation Pipeline Usage\nfrom shared.validation.pipeline import ValidationPipeline\n\npipeline = ValidationPipeline()\nresult = pipeline.validate(scenario)\n\nif not result.is_valid:\n    result.print_summary()  # Shows categorized issues\n    print(f\"Found {len(result.get_errors())} errors, {len(result.get_warnings())} warnings\")\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#validation-result-output-example","title":"Validation Result Output Example","text":"<pre><code>\ud83d\udccb Validation Summary: 5 errors, 2 warnings\n\nSYNTAX ERRORS:\n- Scenario ID too long (Field: id)\n  \u2192 Suggestion: Keep scenario ID under 50 characters\n\nINTEGRITY ERRORS:\n- Train T1 references non-existent locomotive 'L99' (Field: trains[0].locomotive_id)\n  \u2192 Suggestion: Use one of: L1, L2, L3\n- Route R1 references non-existent track 'T99' (Field: routes[0].track_sequence[2])\n  \u2192 Suggestion: Use existing track ID from: T1, T2, T3\n- No locomotives configured (Field: locomotives)\n  \u2192 Suggestion: Add at least one locomotive for wagon transport\n\nFEASIBILITY WARNINGS:\n- High wagon-to-station ratio (150.0:1) may cause bottlenecks (Field: workshops)\n  \u2192 Suggestion: Consider adding more retrofit stations\n- Long simulation duration (400 days) may impact performance (Field: end_date)\n  \u2192 Suggestion: Consider shorter simulation periods\n</code></pre>"},{"location":"mvp/architecture/08-concepts/#89-security-concept","title":"8.9 Security Concept","text":"<p>Security measures for MVP desktop application focus on input validation and safe file handling.</p>"},{"location":"mvp/architecture/08-concepts/#mvp-security-considerations","title":"MVP Security Considerations","text":"Area MVP Measure Rationale Input Validation Pydantic Models Prevents invalid data File Access Relative Paths Only Prevents directory traversal Error Messages No system paths Prevents information disclosure Logging No credentials Prevents credential leakage"},{"location":"mvp/architecture/08-concepts/#mvp-file-security","title":"MVP File Security","text":"<pre><code># CONCEPTUAL EXAMPLE - Illustrates path traversal prevention pattern\nimport os\nfrom pathlib import Path\n\ndef safe_file_path(base_dir: str, filename: str) -&gt; Path:\n    \"\"\"MVP Safe File Path Resolution\"\"\"\n    base_path = Path(base_dir).resolve()\n    file_path = (base_path / filename).resolve()\n\n    # Ensure file is within base directory\n    if not str(file_path).startswith(str(base_path)):\n        raise ValueError(f\"Invalid file path: {filename}\")\n\n    return file_path\n</code></pre>"},{"location":"mvp/architecture/09-architecture-decisions/","title":"9. Architecture Decisions (MVP)","text":""},{"location":"mvp/architecture/09-architecture-decisions/#91-mvp-architecture-decisions-overview","title":"9.1 MVP Architecture Decisions Overview","text":""},{"location":"mvp/architecture/09-architecture-decisions/#mvp-adr-status","title":"MVP ADR Status","text":"ADR Title Status Impact ADR-001 Hexagonal Pipeline Architecture \u2705 Accepted Clean separation of concerns ADR-002 4-Layer Validation Framework \u2705 Accepted Comprehensive input validation ADR-003 Field Name Standardization \u2705 Accepted Consistent naming conventions ADR-004 4 Bounded Context Architecture \u2705 Accepted Domain separation (updated to 4 contexts) ADR-005 Type Hints Mandatory \u2705 Accepted Code quality and safety ADR-006 SimPy for Discrete Event Simulation \u2705 Accepted Proven simulation framework ADR-007 File-Based Data Storage \u2705 Accepted Simple deployment ADR-008 Pydantic for Data Validation \u2705 Accepted Type safety and validation ADR-009 Matplotlib for Visualization \u2705 Accepted Simple offline charts ADR-010 Layered Architecture \u2705 Accepted Rapid development ADR-011 4 Bounded Contexts \u2705 Accepted Minimal viable domain decomposition (updated to 4 contexts) ADR-012 Direct Method Calls \u2705 Accepted Simple integration ADR-013 Hexagonal Architecture for Data Sources \u2705 Accepted Multi-format input support ADR-014 Wagon Tracking and Queue Management \u2705 Implemented Resolved wagon tracking issues ADR-015 SimPy Workshop Modeling \u2705 Implemented Complete SimPy integration ADR-016 Capacity Management Integration \u2705 Implemented Physical capacity validation <p>Note: Full version architectural decisions (ADR-001 through ADR-013) are documented in ../../full-version/architecture/decisions/.</p>"},{"location":"mvp/architecture/09-architecture-decisions/#92-mvp-architecture-decisions","title":"9.2 MVP Architecture Decisions","text":"<p>All MVP architectural decisions are documented as separate ADR files in the decisions directory. This section provides an overview and links to the detailed decisions.</p>"},{"location":"mvp/architecture/09-architecture-decisions/#architecture-pattern-decisions","title":"Architecture Pattern Decisions","text":"<ul> <li>ADR-001: Hexagonal Pipeline Architecture - Clean separation of concerns</li> <li>ADR-004: 4 Bounded Context Architecture - Domain separation (Configuration, Retrofit Workflow, Railway Infrastructure, External Trains)</li> <li>ADR-010: Layered Architecture - Simple architecture for rapid development</li> <li>ADR-011: 4 Bounded Contexts - Minimal viable domain decomposition</li> <li>ADR-012: Direct Method Calls - Simple integration between contexts</li> </ul>"},{"location":"mvp/architecture/09-architecture-decisions/#technology-decisions","title":"Technology Decisions","text":"<ul> <li>ADR-006: SimPy for Discrete Event Simulation - Proven simulation framework</li> <li>ADR-007: File-Based Data Storage - Simple deployment without database</li> <li>ADR-008: Pydantic for Data Validation - Type safety and validation</li> <li>ADR-009: Matplotlib for Visualization - Simple offline charts</li> </ul>"},{"location":"mvp/architecture/09-architecture-decisions/#quality-standards-decisions","title":"Quality &amp; Standards Decisions","text":"<ul> <li>ADR-002: 4-Layer Validation Framework - Comprehensive input validation</li> <li>ADR-003: Field Name Standardization - Consistent naming conventions</li> <li>ADR-005: Type Hints Mandatory - Code quality and safety</li> </ul>"},{"location":"mvp/architecture/09-architecture-decisions/#integration-decisions","title":"Integration Decisions","text":"<ul> <li>ADR-013: Hexagonal Architecture for Data Sources - Multi-format input support</li> </ul>"},{"location":"mvp/architecture/09-architecture-decisions/#implementation-decisions-resolved-issues","title":"Implementation Decisions (Resolved Issues)","text":"<ul> <li>ADR-014: Wagon Tracking and Queue Management - Resolved wagon tracking issues</li> <li>ADR-015: SimPy Workshop Modeling - Complete SimPy integration</li> <li>ADR-016: Capacity Management Integration - Physical capacity validationr testing</li> <li>Maintainability: Clear separation between data access and business logic</li> <li>Extensibility: New data sources without changing core logic</li> <li>Type safety: Consistent DTOs across all adapters</li> </ul> <p>Implementation: - DataSourcePort: Interface defining adapter contract - JsonDataSourceAdapter: Wraps existing JSON functionality - CsvDataSourceAdapter: New CSV directory support - DataSourceFactory: Auto-detects source type - ScenarioLoader: Orchestrates using adapters</p> <p>Alternatives Considered: - Hexagonal Architecture \u2705 Chosen - Direct CSV parsing: Tight coupling, hard to test - Single JSON format: Doesn't meet CSV requirement - Full hexagonal everywhere: Too complex for MVP timeline</p> <p>Consequences: - Positive: Multi-format support, future-ready, testable, maintainable - Negative: Additional complexity (justified by requirements) - Benefit: Foundation for full hexagonal architecture migration</p> <p>CSV Directory Structure: <pre><code>csv_scenario/\n\u251c\u2500\u2500 scenario.csv      # Basic metadata (ID, dates, seed)\n\u251c\u2500\u2500 trains.csv        # Train schedule with arrival times\n\u251c\u2500\u2500 wagons.csv        # Wagon data linked to trains\n\u251c\u2500\u2500 workshops.csv     # Workshop configuration\n\u251c\u2500\u2500 tracks.csv        # Track definitions\n\u251c\u2500\u2500 routes.csv        # Route definitions\n\u2514\u2500\u2500 locomotives.csv   # Locomotive fleet data\n</code></pre></p> <p>Usage Examples: <pre><code># Auto-detect source type\nloader = ScenarioLoader()\nscenario = loader.load_scenario('path/to/csv_directory')  # CSV\nscenario = loader.load_scenario('path/to/scenario.json')  # JSON\n\n# Use specific adapter\ncsv_adapter = CsvDataSourceAdapter()\nscenario = csv_adapter.load_scenario('csv_directory')\n</code></pre></p>"},{"location":"mvp/architecture/09-architecture-decisions/#93-rejected-alternatives","title":"9.3 Rejected Alternatives","text":""},{"location":"mvp/architecture/09-architecture-decisions/#rejected-architecture-options","title":"Rejected Architecture Options","text":"Alternative Reason for Rejection MVP Decision Hexagonal Architecture Too complex for 5-week timeline Layered Architecture Microservices Deployment complexity Monolith Event-driven Implementation effort Direct calls Web Frontend No frontend developer Matplotlib Database Installation complexity Files"},{"location":"mvp/architecture/09-architecture-decisions/#rejected-technology-options","title":"Rejected Technology Options","text":"Technology Reason for Rejection MVP Alternative FastAPI Web API not required Direct Python calls PostgreSQL Database setup too complex CSV/JSON files Docker Container overhead Native Python Vue.js Frontend development Matplotlib PNG WebSocket Real-time not required Batch processing"},{"location":"mvp/architecture/09-architecture-decisions/#94-migration-path","title":"9.4 Migration Path","text":""},{"location":"mvp/architecture/09-architecture-decisions/#mvp-full-version-evolution","title":"MVP \u2192 Full Version Evolution","text":"Aspect MVP (Current) Transition (Prepared) Full Version (Future) Architecture Layered within contexts Interface preparation Hexagonal architecture Integration Direct method calls + Event bus Repository pattern Event-driven Storage File-based (JSON/CSV) Repository abstraction Database + Event Store Visualization Matplotlib (PNG) JSON data export Web frontend (interactive) Contexts 4 bounded contexts Interface boundaries Multiple contexts (TBD) Deployment Desktop application Containerization prep Cloud-ready web app <p>Migration Strategy: - MVP decisions prioritize rapid development (5-week timeline) - Transition preparations embedded in MVP (repository pattern, interfaces) - Full version evolution planned but not blocking MVP delivery</p>"},{"location":"mvp/architecture/10-quality-requirements/","title":"10. Quality Requirements (MVP)","text":""},{"location":"mvp/architecture/10-quality-requirements/#101-mvp-quality-goals","title":"10.1 MVP Quality Goals","text":"<p>Quality goals are defined in Section 1.2. This section details how they are measured and implemented.</p>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-quality-priorities","title":"MVP Quality Priorities","text":"Priority Quality Goal MVP Scenario Measurability 1 Rapid Development MVP deliverable in 5 weeks Functional prototype 2 Simulation Accuracy &amp; Reliability Same inputs \u2192 identical results Reproducible simulation runs 3 Usability &amp; Accessibility No complex installation File-based configuration 4 Simple Installation One-command setup <code>uv sync</code> 5 Testability Business logic isolated Unit tests possible"},{"location":"mvp/architecture/10-quality-requirements/#102-mvp-performance-requirements","title":"10.2 MVP Performance Requirements","text":"<p>Note: Performance targets will be measured during MVP implementation. See Section 7.8 for monitoring approach.</p>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-performance-goals","title":"MVP Performance Goals","text":"<pre><code>graph TB\n    subgraph \"MVP Performance Goals\"\n        subgraph \"Execution Time\"\n            Config[Load configuration&lt;br/&gt;To be measured]\n            Setup[Configure workshop&lt;br/&gt;To be measured]\n            Sim[Simulation execution&lt;br/&gt;To be measured]\n            Output[Generate output&lt;br/&gt;To be measured]\n        end\n\n        subgraph \"Resource Usage\"\n            Memory[Memory usage&lt;br/&gt;To be measured]\n            CPU[CPU utilization&lt;br/&gt;Single-threaded]\n            Disk[Disk space&lt;br/&gt;Estimated: ~100 MB + results]\n        end\n\n        subgraph \"Scalability\"\n            Small[100 wagons&lt;br/&gt;To be measured]\n            Medium[1000 wagons&lt;br/&gt;To be measured]\n            Large[5000 wagons&lt;br/&gt;To be measured]\n        end\n    end\n\n    classDef time fill:#e3f2fd\n    classDef resource fill:#e8f5e8\n    classDef scale fill:#fff3e0\n\n    class Config,Setup,Sim,Output time\n    class Memory,CPU,Disk resource\n    class Small,Medium,Large scale</code></pre>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-performance-measurements","title":"MVP Performance Measurements","text":"Metric Measurement Method Acceptance Criterion Startup time <code>time python main.py --help</code> To be measured on standard laptop Configuration loading Logging timestamps JSON/CSV parsing Simulation speed SimPy profiling Discrete event processing Memory usage <code>psutil</code> monitoring To be measured Output generation File creation time CSV + PNG generation"},{"location":"mvp/architecture/10-quality-requirements/#103-mvp-usability-requirements","title":"10.3 MVP Usability Requirements","text":""},{"location":"mvp/architecture/10-quality-requirements/#mvp-usability-goals","title":"MVP Usability Goals","text":"<pre><code>graph TB\n    subgraph \"MVP Usability Goals\"\n        subgraph \"Ease of Use\"\n            Install[Simple installation&lt;br/&gt;uv sync]\n            Config[Simple configuration&lt;br/&gt;JSON/CSV files]\n            Run[Simple execution&lt;br/&gt;uv run python main.py]\n        end\n\n        subgraph \"Error Handling\"\n            Clear[Clear error messages&lt;br/&gt;Actionable feedback]\n            Recovery[Graceful degradation&lt;br/&gt;Partial results on error]\n            Help[Built-in help&lt;br/&gt;--help parameter]\n        end\n\n        subgraph \"Output Quality\"\n            Readable[Readable output&lt;br/&gt;CSV format]\n            Visual[Visualization&lt;br/&gt;Matplotlib PNG]\n            Logs[Detailed logs&lt;br/&gt;Debugging information]\n        end\n    end\n\n    classDef ease fill:#4caf50,stroke:#2e7d32\n    classDef error fill:#ff9800,stroke:#e65100\n    classDef output fill:#2196f3,stroke:#1565c0\n\n    class Install,Config,Run ease\n    class Clear,Recovery,Help error\n    class Readable,Visual,Logs output</code></pre>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-usability-criteria","title":"MVP Usability Criteria","text":"Aspect MVP Requirement Measurement Criterion Installation Simple setup Documented steps Configuration Example files available Template files in <code>Data/examples/</code> Execution One command starts simulation <code>uv run python main.py</code> Error messages Understandable descriptions Pydantic comprehensive error summary Help Integrated documentation <code>--help</code> parameter"},{"location":"mvp/architecture/10-quality-requirements/#104-mvp-reliability-requirements","title":"10.4 MVP Reliability Requirements","text":""},{"location":"mvp/architecture/10-quality-requirements/#mvp-reliability-goals","title":"MVP Reliability Goals","text":"<pre><code>graph TB\n    subgraph \"MVP Reliability\"\n        subgraph \"Error Tolerance\"\n            InputErrors[Input validation&lt;br/&gt;Catch invalid data]\n            RuntimeErrors[Runtime stability&lt;br/&gt;No crashes during simulation]\n            OutputErrors[Output robustness&lt;br/&gt;Partial results on error]\n        end\n\n        subgraph \"Determinism\"\n            Reproducible[Reproducible results&lt;br/&gt;Same input \u2192 same output]\n            Seeded[Seeded random&lt;br/&gt;Controlled randomness]\n            Consistent[Consistent behavior&lt;br/&gt;Cross-platform]\n        end\n\n        subgraph \"Recovery\"\n            Logging[Comprehensive logging&lt;br/&gt;Debug information]\n            Cleanup[Resource cleanup&lt;br/&gt;No memory leaks]\n            Restart[Easy restart&lt;br/&gt;No persistent state issues]\n        end\n    end\n\n    classDef tolerance fill:#e3f2fd\n    classDef determinism fill:#e8f5e8\n    classDef recovery fill:#fff3e0\n\n    class InputErrors,RuntimeErrors,OutputErrors tolerance\n    class Reproducible,Seeded,Consistent determinism\n    class Logging,Cleanup,Restart recovery</code></pre>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-reliability-metrics","title":"MVP Reliability Metrics","text":"Category MVP Goal Measurement Method Crash rate &lt; 1% with valid inputs Automated tests Determinism 100% identical results Repeated execution with same inputs Error handling Graceful handling of all input errors Negative tests Memory leaks No memory leaks Memory profiling"},{"location":"mvp/architecture/10-quality-requirements/#105-mvp-maintainability-requirements","title":"10.5 MVP Maintainability Requirements","text":""},{"location":"mvp/architecture/10-quality-requirements/#mvp-code-quality-standards","title":"MVP Code Quality Standards","text":"<pre><code># MVP Code Quality Standards\nclass CodeQualityMetrics:\n    MAX_FUNCTION_LENGTH = 50      # Lines per function\n    MAX_CLASS_LENGTH = 200        # Lines per class\n    MAX_COMPLEXITY = 10           # Cyclomatic complexity\n    MIN_TEST_COVERAGE = 90        # Percent\n    MAX_DEPENDENCIES = 5          # Per module\n</code></pre>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-maintainability-metrics","title":"MVP Maintainability Metrics","text":"Aspect MVP Goal Measurement Method Code coverage &gt; 90% for business logic pytest-cov Documentation All public APIs documented Docstring coverage Complexity Cyclomatic complexity &lt; 10 radon Dependencies &lt; 10 external packages pyproject.toml Refactoring Easy extension possible Architecture review"},{"location":"mvp/architecture/10-quality-requirements/#106-mvp-portability-requirements","title":"10.6 MVP Portability Requirements","text":""},{"location":"mvp/architecture/10-quality-requirements/#mvp-platform-support","title":"MVP Platform Support","text":"<pre><code>graph TB\n    subgraph \"MVP Platform Support\"\n        subgraph \"Operating Systems\"\n            Windows[Windows 10+&lt;br/&gt;Primary target]\n            MacOS[macOS 10.15+&lt;br/&gt;Primary target]\n            Linux[Ubuntu 20.04+&lt;br/&gt;Primary target]\n        end\n\n        subgraph \"Python Versions\"\n            Python313[Python 3.13+&lt;br/&gt;Required]\n        end\n\n        subgraph \"Hardware\"\n            Laptop[Standard laptop&lt;br/&gt;Estimated: 4GB RAM minimum]\n            Desktop[Desktop PC&lt;br/&gt;Estimated: 4GB RAM minimum]\n        end\n    end\n\n    classDef primary fill:#4caf50,stroke:#2e7d32\n    classDef secondary fill:#ff9800,stroke:#e65100\n    classDef hardware fill:#2196f3,stroke:#1565c0\n\n    class Windows,MacOS,Linux,Python313 primary\n    class Laptop,Desktop hardware</code></pre>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-portability-tests","title":"MVP Portability Tests","text":"Platform Test Status Critical Features Windows 10+ \u2705 Primary File paths, CSV encoding macOS 10.15+ \u2705 Primary Path separators, matplotlib Ubuntu 20.04+ \u2705 Primary Dependencies, file permissions"},{"location":"mvp/architecture/10-quality-requirements/#107-mvp-security-requirements","title":"10.7 MVP Security Requirements","text":""},{"location":"mvp/architecture/10-quality-requirements/#mvp-security-goals","title":"MVP Security Goals","text":"<pre><code>graph TB\n    subgraph \"MVP Security\"\n        subgraph \"Input Security\"\n            Validation[Input validation&lt;br/&gt;Pydantic models]\n            Sanitization[Path sanitization&lt;br/&gt;No directory traversal]\n            Limits[Resource limits&lt;br/&gt;File size, memory]\n        end\n\n        subgraph \"Data Security\"\n            NoCredentials[No credentials&lt;br/&gt;No sensitive data stored]\n            LocalOnly[Local processing&lt;br/&gt;No network communication]\n            TempFiles[Safe temp files&lt;br/&gt;Proper cleanup]\n        end\n\n        subgraph \"Error Security\"\n            NoLeakage[No information leakage&lt;br/&gt;Safe error messages]\n            Logging[Safe logging&lt;br/&gt;No sensitive data in logs]\n        end\n    end\n\n    classDef input fill:#e3f2fd\n    classDef data fill:#e8f5e8\n    classDef error fill:#fff3e0\n\n    class Validation,Sanitization,Limits input\n    class NoCredentials,LocalOnly,TempFiles data\n    class NoLeakage,Logging error</code></pre>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-security-measures","title":"MVP Security Measures","text":"Area MVP Measure Implementation Input validation Pydantic models Automatic type validation File access Relative paths only Path sanitization Error handling Safe error messages No system paths in errors Logging No sensitive data Filtered logging Dependencies Known packages only pyproject.toml with versions"},{"location":"mvp/architecture/10-quality-requirements/#108-mvp-testability-requirements","title":"10.8 MVP Testability Requirements","text":""},{"location":"mvp/architecture/10-quality-requirements/#mvp-test-strategy","title":"MVP Test Strategy","text":"<pre><code>graph TB\n    subgraph \"MVP Testing Strategy\"\n        subgraph \"Unit Tests\"\n            Models[Domain Models&lt;br/&gt;Business Logic]\n            Services[Service classes&lt;br/&gt;Isolated testing]\n            Utils[Utility functions&lt;br/&gt;Pure functions]\n        end\n\n        subgraph \"Integration Tests\"\n            FileIO[File I/O&lt;br/&gt;JSON/CSV processing]\n            SimPy[SimPy integration&lt;br/&gt;Simulation engine]\n            EndToEnd[End-to-end&lt;br/&gt;Complete scenarios]\n        end\n\n        subgraph \"Manual Tests\"\n            Scenarios[Test scenarios&lt;br/&gt;Real configurations]\n            Performance[Performance tests&lt;br/&gt;Large datasets]\n            Platforms[Platform tests&lt;br/&gt;Cross-platform]\n        end\n    end\n\n    classDef unit fill:#4caf50,stroke:#2e7d32\n    classDef integration fill:#ff9800,stroke:#e65100\n    classDef manual fill:#9e9e9e,stroke:#616161\n\n    class Models,Services,Utils unit\n    class FileIO,SimPy,EndToEnd integration\n    class Scenarios,Performance,Platforms manual</code></pre>"},{"location":"mvp/architecture/10-quality-requirements/#mvp-test-metrics","title":"MVP Test Metrics","text":"Test Type MVP Goal Automation Unit tests &gt; 80% coverage \u2705 pytest Integration tests All main paths \u2705 pytest Performance tests Benchmark scenarios \u26a0\ufe0f Manual Platform tests Windows + Linux + macOS \u26a0\ufe0f Manual (can be automated via GitHub Actions matrix)"},{"location":"mvp/architecture/11-risks-technical-debt/","title":"11. Risks and Technical Debt (MVP)","text":""},{"location":"mvp/architecture/11-risks-technical-debt/#111-mvp-risk-overview","title":"11.1 MVP Risk Overview","text":""},{"location":"mvp/architecture/11-risks-technical-debt/#mvp-risk-matrix","title":"MVP Risk Matrix","text":"<pre><code>graph TB\n    subgraph \"MVP Risk Assessment\"\n        subgraph \"High Impact\"\n            HH[High Probability&lt;br/&gt;High Impact]\n            LH[Low Probability&lt;br/&gt;High Impact]\n        end\n\n        subgraph \"Low Impact\"\n            HL[High Probability&lt;br/&gt;Low Impact]\n            LL[Low Probability&lt;br/&gt;Low Impact]\n        end\n    end\n\n    HH --&gt; |Critical| R1[SimPy integration fails]\n    LH --&gt; |Major| R2[Performance bottlenecks]\n    HL --&gt; |Minor| R3[Platform compatibility]\n    LL --&gt; |Negligible| R4[Output format issues]\n\n    classDef critical fill:#d32f2f,stroke:#b71c1c,color:#fff\n    classDef major fill:#ff9800,stroke:#e65100,color:#fff\n    classDef minor fill:#ffc107,stroke:#ff8f00,color:#000\n    classDef negligible fill:#4caf50,stroke:#2e7d32,color:#fff\n\n    class R1 critical\n    class R2 major\n    class R3 minor\n    class R4 negligible</code></pre>"},{"location":"mvp/architecture/11-risks-technical-debt/#112-mvp-technical-risks","title":"11.2 MVP Technical Risks","text":""},{"location":"mvp/architecture/11-risks-technical-debt/#risk-1-simpy-integration-complexity","title":"Risk 1: SimPy Integration Complexity","text":"Aspect Details Description Direct SimPy integration could become too complex Probability Medium (40%) Impact High - Simulation doesn't work Symptoms Unexpected SimPy behavior, hard-to-debug processes <p>Mitigation: - \u2705 Simple SimPy processes: Use only basic events - \u2705 Early prototyping: Implement SimPy integration first (validated in 3-L\u00e4nderhack POC) - \u2705 Documentation: Document SimPy patterns - \u2705 Team expertise: Leverage POC experience from hackathon</p>"},{"location":"mvp/architecture/11-risks-technical-debt/#risk-2-performance-issues-with-larger-scenarios","title":"Risk 2: Performance Issues with Larger Scenarios","text":"Aspect Details Description MVP could become too slow with &gt; 1000 wagons Probability Medium (30%) Impact Medium - Limited scenario size Symptoms Long execution times, high memory usage <p>Mitigation: - \u2705 Profiling: Early performance measurements - \u2705 Optimization: Algorithm improvements - \u2705 Limits: Define accepted scenario sizes - \u2705 Monitoring: Memory/CPU monitoring</p>"},{"location":"mvp/architecture/11-risks-technical-debt/#risk-3-schedule-overrun","title":"Risk 3: Schedule Overrun","text":"Aspect Details Description 5-week development time might not be sufficient Probability High (60%) Impact High - MVP goals not achieved Symptoms Milestone delays, unfinished features <p>Mitigation: - \u2705 Scope reduction: Cut additional features if necessary - \u2705 Parallel development: Optimize team coordination - \u2705 Weekly reviews: Early risk detection - \u2705 Minimum MVP: Define absolutely minimal functionality</p>"},{"location":"mvp/architecture/11-risks-technical-debt/#113-mvp-technical-debt","title":"11.3 MVP Technical Debt","text":""},{"location":"mvp/architecture/11-risks-technical-debt/#debt-1-direct-framework-dependencies","title":"Debt 1: Direct Framework Dependencies","text":"<pre><code># MVP: Direct SimPy usage (Technical Debt)\nimport simpy\n\nclass WorkshopService:\n    def __init__(self):\n        self.env = simpy.Environment()  # Direct dependency\n\n    def run_process(self):\n        self.env.process(self.retrofit_process())  # Tight coupling\n\n# Future: Abstracted interface\nclass WorkshopService:\n    def __init__(self, simulation_engine: SimulationEnginePort):\n        self._sim_engine = simulation_engine  # Dependency injection\n</code></pre> <p>Debt Details: - Type: Architecture debt - Priority: High - Effort: Estimated 2-3 days refactoring (to be validated) - Created by: ADR MVP-001 (SimPy decision) - Full version solution: Hexagonal architecture with ports</p>"},{"location":"mvp/architecture/11-risks-technical-debt/#debt-2-missing-event-architecture","title":"Debt 2: Missing Event Architecture","text":"<pre><code># MVP: Direct service calls (Technical Debt)\nclass SimulationService:\n    def run(self):\n        config = self.config_service.load()  # Direct call\n        workshop = self.workshop_service.setup(config)  # Direct call\n        results = self.workshop_service.run(workshop)  # Direct call\n\n# Future: Event-driven\nclass SimulationService:\n    def run(self):\n        self.event_bus.publish(ConfigurationRequested())\n        # Asynchronous event handling\n</code></pre> <p>Debt Details: - Type: Integration debt - Priority: Medium - Effort: Estimated 1-2 weeks refactoring (to be validated) - Created by: ADR MVP-007 (Direct calls decision) - Full version solution: Event-driven architecture</p>"},{"location":"mvp/architecture/11-risks-technical-debt/#debt-3-file-based-persistence","title":"Debt 3: File-Based Persistence","text":"<pre><code># MVP: File-based storage (Technical Debt)\nclass ConfigurationService:\n    def load_scenario(self, path: str):\n        with open(f\"{path}/scenario.json\") as f:  # Direct file access\n            return json.load(f)\n\n# Future: Repository pattern\nclass ConfigurationService:\n    def __init__(self, repo: ConfigurationRepository):\n        self._repo = repo  # Abstracted storage\n\n    def load_scenario(self, id: str):\n        return self._repo.find_by_id(id)  # Storage-agnostic\n</code></pre> <p>Debt Details: - Type: Persistence debt - Priority: Low - Effort: Estimated 3-5 days refactoring (to be validated) - Created by: ADR MVP-002 (File storage decision) - Full version solution: Database + Repository pattern</p>"},{"location":"mvp/architecture/11-risks-technical-debt/#114-mvp-quality-risks","title":"11.4 MVP Quality Risks","text":""},{"location":"mvp/architecture/11-risks-technical-debt/#code-quality-risks","title":"Code Quality Risks","text":"<pre><code>graph TB\n    subgraph \"MVP Quality Risks\"\n        subgraph \"Code Quality\"\n            Complexity[High complexity&lt;br/&gt;Monolithic functions]\n            Coverage[Low test coverage&lt;br/&gt;&lt; 70% coverage]\n            Documentation[Missing documentation&lt;br/&gt;Undocumented APIs]\n        end\n\n        subgraph \"Architecture Quality\"\n            Coupling[High coupling&lt;br/&gt;Direct dependencies]\n            Cohesion[Low cohesion&lt;br/&gt;Mixed responsibilities]\n            Flexibility[Low flexibility&lt;br/&gt;Hard to extend]\n        end\n\n        subgraph \"Maintainability\"\n            Understanding[Hard to understand&lt;br/&gt;Complex business logic]\n            Changes[Hard to change&lt;br/&gt;Ripple effects]\n            Testing[Hard to test&lt;br/&gt;Integrated components]\n        end\n    end\n\n    classDef quality fill:#ff9800,stroke:#e65100\n    classDef architecture fill:#2196f3,stroke:#1565c0\n    classDef maintainability fill:#9c27b0,stroke:#6a1b9a\n\n    class Complexity,Coverage,Documentation quality\n    class Coupling,Cohesion,Flexibility architecture\n    class Understanding,Changes,Testing maintainability</code></pre>"},{"location":"mvp/architecture/11-risks-technical-debt/#quality-metrics-monitoring","title":"Quality Metrics Monitoring","text":"Metric MVP Goal Current Status Risk Cyclomatic complexity &lt; 10 TBD Medium Test coverage &gt; 70% TBD High Documentation coverage &gt; 80% TBD Low Number of dependencies &lt; 10 7 Low"},{"location":"mvp/architecture/11-risks-technical-debt/#115-mvp-migration-risks","title":"11.5 MVP Migration Risks","text":""},{"location":"mvp/architecture/11-risks-technical-debt/#migration-to-full-version","title":"Migration to Full Version","text":"<pre><code>graph TB\n    subgraph \"Migration Risks\"\n        subgraph \"Architecture Migration\"\n            LayerToHex[Layered \u2192 Hexagonal&lt;br/&gt;Major refactoring]\n            DirectToEvent[Direct calls \u2192 Events&lt;br/&gt;Integration changes]\n            FileToDb[Files \u2192 Database&lt;br/&gt;Data migration]\n        end\n\n        subgraph \"Technology Migration\"\n            MatplotlibToWeb[Matplotlib \u2192 Web UI&lt;br/&gt;Complete rewrite]\n            MonolithToServices[Monolith \u2192 Services&lt;br/&gt;Deployment changes]\n        end\n\n        subgraph \"Team Migration\"\n            SkillGap[Skill gaps&lt;br/&gt;New technologies]\n            TimeEstimation[Time estimation&lt;br/&gt;Unknown complexity]\n        end\n    end\n\n    classDef architecture fill:#e3f2fd\n    classDef technology fill:#e8f5e8\n    classDef team fill:#fff3e0\n\n    class LayerToHex,DirectToEvent,FileToDb architecture\n    class MatplotlibToWeb,MonolithToServices technology\n    class SkillGap,TimeEstimation team</code></pre>"},{"location":"mvp/architecture/11-risks-technical-debt/#migration-effort-estimation","title":"Migration Effort Estimation","text":"<p>Note: Effort estimates are preliminary and will be refined during MVP implementation based on actual complexity.</p> Migration Estimated Effort Risk Mitigation Layered \u2192 Hexagonal 2-3 weeks High Interface preparation Direct \u2192 Event-driven 1-2 weeks Medium Define event interfaces Files \u2192 Database 3-5 days Low Repository pattern Matplotlib \u2192 Web 4-6 weeks High Prepare JSON API"},{"location":"mvp/architecture/11-risks-technical-debt/#116-mvp-risk-mitigation","title":"11.6 MVP Risk Mitigation","text":""},{"location":"mvp/architecture/11-risks-technical-debt/#risk-monitoring","title":"Risk Monitoring","text":"<pre><code># MVP Risk Monitoring\nclass RiskMonitor:\n    def check_performance_risk(self, execution_time: float):\n        if execution_time &gt; 60:  # seconds\n            logging.warning(f\"Performance risk: {execution_time}s execution\")\n\n    def check_memory_risk(self, memory_mb: float):\n        if memory_mb &gt; 100:  # MB\n            logging.warning(f\"Memory risk: {memory_mb}MB usage\")\n\n    def check_complexity_risk(self, function_lines: int):\n        if function_lines &gt; 50:\n            logging.warning(f\"Complexity risk: {function_lines} lines\")\n</code></pre>"},{"location":"mvp/architecture/11-risks-technical-debt/#continuous-risk-assessment","title":"Continuous Risk Assessment","text":"Week Risk Review Actions Week 1 SimPy integration Create prototype Week 2 Performance tests Initial benchmarks Week 3 Code quality Refactoring if needed Week 4 Migration preparation Interface preparation Week 5 Final review Document debt"},{"location":"mvp/architecture/11-risks-technical-debt/#117-mvp-debt-repayment","title":"11.7 MVP Debt Repayment","text":""},{"location":"mvp/architecture/11-risks-technical-debt/#debt-prioritization","title":"Debt Prioritization","text":"<pre><code>graph TB\n    subgraph \"Technical Debt Prioritization\"\n        subgraph \"High Priority\"\n            HP1[SimPy abstraction&lt;br/&gt;Blocks hexagonal migration]\n            HP2[Service interfaces&lt;br/&gt;Blocks event architecture]\n        end\n\n        subgraph \"Medium Priority\"\n            MP1[Repository pattern&lt;br/&gt;Blocks database migration]\n            MP2[Error handling&lt;br/&gt;Blocks production use]\n        end\n\n        subgraph \"Low Priority\"\n            LP1[Code documentation&lt;br/&gt;Maintainability]\n            LP2[Test coverage&lt;br/&gt;Quality assurance]\n        end\n    end\n\n    classDef high fill:#d32f2f,stroke:#b71c1c,color:#fff\n    classDef medium fill:#ff9800,stroke:#e65100,color:#fff\n    classDef low fill:#4caf50,stroke:#2e7d32,color:#fff\n\n    class HP1,HP2 high\n    class MP1,MP2 medium\n    class LP1,LP2 low</code></pre>"},{"location":"mvp/architecture/11-risks-technical-debt/#debt-repayment-plan","title":"Debt Repayment Plan","text":"<p>Note: Effort estimates are preliminary and will be refined after MVP completion based on actual codebase complexity.</p> Phase Debt Estimated Effort Benefit Post-MVP SimPy abstraction ~3 days Hexagonal architecture possible Pre-Full Service interfaces ~5 days Event-driven architecture possible Full-Dev Repository pattern ~3 days Database integration possible Production Error handling ~2 days Production readiness"},{"location":"mvp/architecture/12-glossary/","title":"12. Glossary (MVP)","text":""},{"location":"mvp/architecture/12-glossary/#121-mvp-domain-terms","title":"12.1 MVP Domain Terms","text":""},{"location":"mvp/architecture/12-glossary/#railway-operations-mvp","title":"Railway Operations (MVP)","text":"Term MVP Definition Example DAC Digital Automatic Coupler - New coupling technology Replaces screw coupling Pop-Up Workshop Temporary retrofit workshop for DAC migration Multiple retrofit stations on workshop track, 3 weeks operation Retrofit Conversion from screw coupling to DAC ~30 minutes per wagon Parking Track Track where wagons are parked Capacity: Total length - 25m Workshop Track Track where wagons are retrofitted (<code>werkstattgleis</code>) Capacity: Number of retrofit stations + one locomotive Feeder Track Track feeding wagons into workshop (<code>werkstattzufuehrung</code>) Capacity: Varies by layout Exit Track Track for retrofitted wagons leaving workshop (<code>werkstattabfuehrung</code>) Capacity: Varies by layout Collection Track Track for intermediate wagon storage (<code>sammelgleis</code>) Capacity: Varies (synthetic examples: 20-50 wagons) Parking Track Track for temporary wagon storage (<code>parkgleis</code>) Capacity: Varies by layout Station Head Track Station head tracks (<code>bahnhofskopf</code>) Capacity: Varies by layout Retrofit Station Workplace for DAC retrofit 1-2 workers per station Wagon Freight wagon (railway vehicle) Various types, different retrofit times Wagon Group Multiple coupled freight wagons Wagon group of 3 wagons Train Composition of multiple wagons 10-30 or more wagons per train"},{"location":"mvp/architecture/12-glossary/#simulation-mvp","title":"Simulation (MVP)","text":"Term MVP Definition Usage Discrete Event Simulation Event-driven simulation with SimPy Time jumps between events SimPy Python framework for discrete event simulation Core of MVP simulation Event Simulation event (arrival, start, end) <code>TrainArrival</code>, <code>RetrofitComplete</code> Process SimPy process for business logic <code>retrofit_process()</code> Environment SimPy simulation environment Time control and event queue Determinism Reproducible simulation results Same inputs \u2192 same results"},{"location":"mvp/architecture/12-glossary/#122-mvp-architecture-terms","title":"12.2 MVP Architecture Terms","text":""},{"location":"mvp/architecture/12-glossary/#layered-architecture-mvp","title":"Layered Architecture (MVP)","text":"Term MVP Definition Layer Presentation Layer CLI and file output Top layer Business Logic Layer Domain services and business logic Core layer Data Access Layer File I/O (JSON/CSV) Data layer Infrastructure Layer SimPy, Matplotlib, file system Bottom layer Service Business logic component <code>ConfigurationService</code>, <code>WorkshopOperationsService</code> Model Data model/entity <code>Workshop</code>, <code>Station</code>, <code>Wagon</code>"},{"location":"mvp/architecture/12-glossary/#bounded-context-mvp","title":"Bounded Context (MVP)","text":"Term MVP Definition Responsibility Configuration Context JSON/CSV import and validation Scenario setup Workshop Operations Context DAC retrofit and SimPy integration Core business logic Analysis &amp; Reporting Context Orchestration and output generation Overall control Context Domain section with clear boundaries Bounded context per DDD Domain Model Domain data model of a context Entities, value objects"},{"location":"mvp/architecture/12-glossary/#architecture-patterns-mvp","title":"Architecture Patterns (MVP)","text":"Term MVP Definition Usage Repository Pattern Abstraction layer for data access Planned for database migration Adapter Pattern Interface between incompatible interfaces SimPy adapter for simulation engine Port Interface defining external dependency Part of hexagonal architecture (future) Dependency Injection Passing dependencies to components Prepared for hexagonal migration Service Layer Business logic orchestration Current MVP architecture"},{"location":"mvp/architecture/12-glossary/#123-mvp-technical-terms","title":"12.3 MVP Technical Terms","text":""},{"location":"mvp/architecture/12-glossary/#pythonsimpy-mvp","title":"Python/SimPy (MVP)","text":"Term MVP Definition Usage Pydantic Python library for data validation Configuration models Matplotlib Python library for charts Chart generation Pandas Python library for data processing CSV processing (optional) Type Hints Python typing Code documentation and IDE support Dataclass Python decorator for data classes Domain models Virtual Environment Isolated Python environment Dependency management"},{"location":"mvp/architecture/12-glossary/#development-tools-mvp","title":"Development Tools (MVP)","text":"Term MVP Definition Purpose uv Fast Python package manager Dependency management and virtual environments Ruff Fast Python linter and formatter Code formatting and linting MyPy Static type checker for Python Type checking with <code>disallow_untyped_defs = true</code> Pylint Python code analysis tool Static code analysis pytest Python testing framework Unit and integration testing pytest-cov Coverage plugin for pytest Test coverage measurement"},{"location":"mvp/architecture/12-glossary/#file-formats-mvp","title":"File Formats (MVP)","text":"Term MVP Definition Structure JSON JavaScript Object Notation Configuration files CSV Comma-Separated Values Tabular data PNG Portable Network Graphics Matplotlib charts uv.lock Python uv lockfile Dependency lockfile"},{"location":"mvp/architecture/12-glossary/#124-mvp-quality-terms","title":"12.4 MVP Quality Terms","text":""},{"location":"mvp/architecture/12-glossary/#performance-mvp","title":"Performance (MVP)","text":"Term MVP Definition Target Value Throughput Processed wagons per hour To be measured Latency Time until simulation start To be measured Memory usage Application memory consumption To be measured Execution time Total simulation duration To be measured Scalability Maximum scenario size To be measured"},{"location":"mvp/architecture/12-glossary/#testing-mvp","title":"Testing (MVP)","text":"Term MVP Definition Tool Unit Test Test of individual functions/classes pytest Integration Test Test of component interaction pytest End-to-End Test Test of complete simulation runs Manual Test Coverage Percentage of tested code lines pytest-cov Mock Simulated dependency for tests unittest.mock"},{"location":"mvp/architecture/12-glossary/#125-mvp-process-terms","title":"12.5 MVP Process Terms","text":""},{"location":"mvp/architecture/12-glossary/#development-mvp","title":"Development (MVP)","text":"Term MVP Definition Duration MVP Minimum Viable Product 5 weeks Sprint Development iteration 1 week Milestone Important development step End of each week Code Review Peer review of code changes Continuous Refactoring Code improvement without functional change As needed"},{"location":"mvp/architecture/12-glossary/#migration-mvp","title":"Migration (MVP)","text":"Term MVP Definition Effort Technical Debt Deliberate simplifications for speed Documented Migration Path Path from MVP to full version Planned Interface Preparation Preparation for architecture migration During MVP Hexagonal Architecture Target architecture of full version Post-MVP Event-driven Architecture Target integration of full version Post-MVP"},{"location":"mvp/architecture/12-glossary/#126-mvp-kpi-terms","title":"12.6 MVP KPI Terms","text":""},{"location":"mvp/architecture/12-glossary/#simulation-kpis-mvp","title":"Simulation KPIs (MVP)","text":"Term MVP Definition Calculation Throughput Retrofitted wagons per time unit <code>wagons_processed / simulation_hours</code> Utilization Percentage usage of stations <code>busy_time / total_time * 100</code> Waiting Time Average waiting time of wagons <code>sum(waiting_times) / wagon_count</code> Queue Length Number of waiting wagons <code>wagons_in_queue</code> Bottleneck Resource with highest utilization Station with <code>max(utilization)</code>"},{"location":"mvp/architecture/12-glossary/#output-kpis-mvp","title":"Output KPIs (MVP)","text":"Term MVP Definition Format CSV Export Structured KPI data <code>simulation_results.csv</code> Chart Visualized KPI data <code>kpi_charts.png</code> Log Event timeline <code>simulation_log.json</code> Summary Results summary Console output"},{"location":"mvp/architecture/12-glossary/#127-mvp-error-terms","title":"12.7 MVP Error Terms","text":""},{"location":"mvp/architecture/12-glossary/#error-handling-mvp","title":"Error Handling (MVP)","text":"Term MVP Definition Handling Configuration Error Error loading configuration Immediate exit with error message Validation Error Invalid input data List of all validation errors Simulation Error Runtime error during simulation Graceful degradation Output Error Error during result generation Continue without failed output Graceful Degradation Partial functionality on errors Partial results"},{"location":"mvp/architecture/12-glossary/#128-mvp-abbreviations","title":"12.8 MVP Abbreviations","text":""},{"location":"mvp/architecture/12-glossary/#technical-abbreviations","title":"Technical Abbreviations","text":"Abbreviation Full Form Context MVP Minimum Viable Product Development phase DDD Domain-Driven Design Architecture approach CLI Command Line Interface User interface I/O Input/Output File operations API Application Programming Interface Interface JSON JavaScript Object Notation Data format CSV Comma-Separated Values Data format PNG Portable Network Graphics Image format"},{"location":"mvp/architecture/12-glossary/#domain-abbreviations","title":"Domain Abbreviations","text":"Abbreviation Full Form Context DAC Digital Automatic Coupler Railway technology KPI Key Performance Indicator Performance metric SLA Service Level Agreement Quality target ROI Return on Investment Economic efficiency"},{"location":"mvp/architecture/13-bibliography/","title":"13. Bibliography","text":""},{"location":"mvp/architecture/13-bibliography/#primary-sources","title":"Primary Sources","text":"<p>[1] Sch\u00e4fer, F. (2025). Konzept PopUpSim zur Simulation der schlagartigen Umr\u00fcstung auf DAK. DB Cargo AG. Available: konzept.md</p> <p>[2] PopUpSim User Stories. (2025). User Stories - PopUpSim: 8 user stories across migration phases. Available: use-cases.md</p>"},{"location":"mvp/architecture/13-bibliography/#technical-resources","title":"Technical Resources","text":"<p>[3] Open Rail Association. (2024). DAC Migration DSS Repository. GitHub. Available: https://github.com/OpenRailAssociation/dac-migration-dss</p> <p>[4] PopUpSim Prototype. (2024). PopUpSim Demo - 3-L\u00e4nderhack 2024. Available: https://openrail-playground.github.io/PopupSim/</p>"},{"location":"mvp/architecture/13-bibliography/#standards-and-licensing","title":"Standards and Licensing","text":"<p>[5] Apache Software Foundation. (2004). Apache License, Version 2.0. Available: https://www.apache.org/licenses/LICENSE-2.0</p> <p>[6] Open Rail Association. (2024). Open Rail Association Project Guidelines. Available: https://www.openrailassociation.org/</p>"},{"location":"mvp/architecture/13-bibliography/#architecture-and-design","title":"Architecture and Design","text":"<p>[7] arc42 Template. (2024). arc42 Architecture Documentation Template. Available: https://arc42.org/</p> <p>[8] Brown, S. (2018). The C4 model for visualising software architecture. Available: https://c4model.com/</p>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/","title":"ADR-001: Hexagonal + Pipeline Architecture for Scenario Loading","text":""},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#status","title":"Status","text":"<p>Accepted</p>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#context","title":"Context","text":"<p>The PopUpSim configuration system needed to support multiple data sources (JSON files, CSV directories, future REST APIs) with consistent validation and error handling. We analyzed six architectural approaches:</p>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#original-implementation-scenariobuilder-pattern","title":"Original Implementation (ScenarioBuilder Pattern)","text":"<ul> <li>Lines of Code: 600+ across multiple components</li> <li>Complexity: High - monolithic builder with complex validation logic</li> <li>Extensibility: Low - adding new sources required modifying existing code</li> <li>Testability: Poor - tightly coupled validation and loading logic</li> <li>Maintainability: Low - duplicated validation across contexts</li> <li>Pattern: Builder pattern with complex forward references and DTO handling</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#evaluated-alternatives","title":"Evaluated Alternatives","text":""},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#1-pure-domain-driven-design-ddd","title":"1. Pure Domain-Driven Design (DDD)","text":"<ul> <li>Extensibility: \u2605\u2605\u2606\u2606\u2606\u2606 (2/6) - Domain services hard to extend for new sources</li> <li>Testability: \u2605\u2605\u2605\u2606\u2606\u2606 (3/6) - Domain logic testable, but infrastructure coupling</li> <li>Validation: \u2605\u2605\u2605\u2605\u2606\u2606 (4/6) - Rich domain validation, but scattered across aggregates</li> <li>Error Handling: \u2605\u2605\u2605\u2606\u2606\u2606 (3/6) - Domain exceptions, but inconsistent error formats</li> <li>Consistency: \u2605\u2605\u2605\u2606\u2606\u2606 (3/6) - Domain consistency, but infrastructure varies</li> <li>Async Support: \u2605\u2605\u2606\u2606\u2606\u2606 (2/6) - Domain events possible, but complex setup</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#2-enhanced-scenariobuilder-pattern","title":"2. Enhanced ScenarioBuilder Pattern","text":"<ul> <li>Extensibility: \u2605\u2605\u2606\u2606\u2606\u2606 (2/6) - Builder methods for new sources, but monolithic</li> <li>Testability: \u2605\u2605\u2606\u2606\u2606\u2606 (2/6) - Builder testable, but complex mocking required</li> <li>Validation: \u2605\u2605\u2605\u2606\u2606\u2606 (3/6) - Centralized in builder, but tightly coupled</li> <li>Error Handling: \u2605\u2605\u2606\u2606\u2606\u2606 (2/6) - Builder exceptions, but limited error context</li> <li>Consistency: \u2605\u2605\u2605\u2605\u2606\u2606 (4/6) - Single builder ensures consistency</li> <li>Async Support: \u2605\u2606\u2606\u2606\u2606\u2606 (1/6) - Builder pattern not async-friendly</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#3-pure-hexagonal-architecture","title":"3. Pure Hexagonal Architecture","text":"<ul> <li>Extensibility: \u2605\u2605\u2605\u2606\u2606\u2606 (3/6) - Easy to add adapters, but inconsistent validation</li> <li>Testability: \u2605\u2605\u2605\u2606\u2606\u2606 (3/6) - Adapters testable, but validation scattered</li> <li>Validation: \u2605\u2605\u2606\u2606\u2606\u2606 (2/6) - Each adapter handles own validation differently</li> <li>Error Handling: \u2605\u2605\u2606\u2606\u2606\u2606 (2/6) - Inconsistent error formats across adapters</li> <li>Consistency: \u2605\u2605\u2606\u2606\u2606\u2606 (2/6) - Different processing flows per adapter</li> <li>Async Support: \u2605\u2605\u2605\u2606\u2606\u2606 (3/6) - Possible but requires adapter-level implementation</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#4-pure-pipeline-architecture","title":"4. Pure Pipeline Architecture","text":"<ul> <li>Extensibility: \u2605\u2605\u2605\u2605\u2606\u2606 (4/6) - Easy to add stages, harder to add sources</li> <li>Testability: \u2605\u2605\u2605\u2605\u2606\u2606 (4/6) - Each stage independently testable</li> <li>Validation: \u2605\u2605\u2605\u2605\u2605\u2606 (5/6) - Consistent validation across all sources</li> <li>Error Handling: \u2605\u2605\u2605\u2605\u2605\u2606 (5/6) - Structured error collection and reporting</li> <li>Consistency: \u2605\u2605\u2605\u2605\u2605\u2605 (6/6) - Uniform processing flow</li> <li>Async Support: \u2605\u2605\u2605\u2605\u2606\u2606 (4/6) - Pipeline stages can be async</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#5-mixed-approach-hexagonal-pipeline","title":"5. Mixed Approach (Hexagonal + Pipeline)","text":"<ul> <li>Extensibility: \u2605\u2605\u2605\u2605\u2605\u2605 (6/6) - Easy to add both adapters and processing stages</li> <li>Testability: \u2605\u2605\u2605\u2605\u2605\u2605 (6/6) - Both adapters and pipeline stages testable</li> <li>Validation: \u2605\u2605\u2605\u2605\u2605\u2605 (6/6) - Consistent validation through pipeline</li> <li>Error Handling: \u2605\u2605\u2605\u2605\u2605\u2605 (6/6) - Structured error collection with adapter flexibility</li> <li>Consistency: \u2605\u2605\u2605\u2605\u2605\u2605 (6/6) - Uniform processing with adapter modularity</li> <li>Async Support: \u2605\u2605\u2605\u2605\u2605\u2605 (6/6) - Both pipeline and adapters can be async</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#decision","title":"Decision","text":"<p>We chose the Mixed Approach (Hexagonal + Pipeline) over all alternatives including the original ScenarioBuilder pattern for the following reasons:</p>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#comparison-summary","title":"Comparison Summary","text":"<ul> <li>Original ScenarioBuilder: 14/36 points - Monolithic, hard to extend</li> <li>Pure DDD: 17/36 points - Good domain logic, poor infrastructure flexibility</li> <li>Enhanced ScenarioBuilder: 14/36 points - Still monolithic despite improvements</li> <li>Pure Hexagonal: 17/36 points - Good modularity, poor consistency</li> <li>Pure Pipeline: 28/36 points - Good consistency, limited extensibility</li> <li>Mixed Approach: 36/36 points - Best of all patterns</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#technical-benefits","title":"Technical Benefits","text":"<ol> <li>Modularity: Hexagonal ports/adapters for data source flexibility</li> <li>Consistency: Pipeline ensures uniform validation and processing</li> <li>Extensibility: Easy to add new data sources and processing stages</li> <li>Testability: Both adapters and pipeline stages independently testable</li> <li>Error Handling: Structured validation results with detailed feedback</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#implementation-results","title":"Implementation Results","text":"<ul> <li>Lines of Code: 140 total (vs 600+ original)</li> <li>Components: 4 clean components vs 8+ complex ones</li> <li>Validation: Centralized in pipeline vs duplicated across contexts</li> <li>Data Sources: JSON, CSV supported; REST API ready</li> <li>Test Coverage: Each component independently testable</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#code-quality-improvements","title":"Code Quality Improvements","text":"<pre><code>Original Implementation:\n- ScenarioBuilder: 400+ lines\n- CsvDataSourceAdapter: 300+ lines  \n- ScenarioValidator: 200+ lines\n- Duplicated validation logic\n\nNew Implementation:\n- ScenarioPipeline: 40 lines\n- CsvScenarioAdapter: 45 lines\n- JsonScenarioAdapter: 25 lines\n- ScenarioService: 30 lines\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#positive","title":"Positive","text":"<ul> <li>Reduced Complexity: 76% reduction in code lines</li> <li>Better Separation: Clear boundaries between concerns</li> <li>Consistent Validation: Single pipeline for all sources</li> <li>Future-Proof: Ready for REST API, database sources</li> <li>Maintainable: Each component has single responsibility</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#negative","title":"Negative","text":"<ul> <li>Learning Curve: Developers need to understand both patterns</li> <li>Initial Setup: More files than monolithic approach</li> <li>Abstraction: Additional layer between service and data loading</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#migration-impact","title":"Migration Impact","text":"<ul> <li>All existing JSON scenarios work unchanged</li> <li>CSV scenarios use new simplified format</li> <li>Tests updated to use new architecture</li> <li>Main.py updated to handle validation results</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-001-hexagonal-pipeline-architecture/#implementation","title":"Implementation","text":"<ul> <li>Pipeline: 3-stage validation (source \u2192 loading \u2192 domain)</li> <li>Adapters: JSON and CSV with consistent interface</li> <li>Service: Hexagonal service using pipeline for processing</li> <li>Validation: Structured results with error aggregation</li> </ul> <p>This architecture provides the best balance of modularity, consistency, and extensibility for PopUpSim's evolving requirements.</p>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/","title":"ADR-002: 4-Layer Validation Framework with Error Stacking","text":""},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#status","title":"Status","text":"<p>ACCEPTED - Implemented January 2025</p>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#context","title":"Context","text":"<p>PopUpSim requires comprehensive validation of complex scenario configurations with multiple interdependent entities (trains, wagons, workshops, locomotives, routes, tracks). Traditional fail-fast validation approaches create poor user experience by requiring multiple validation cycles to identify all issues.</p>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#problems-with-traditional-validation","title":"Problems with Traditional Validation","text":"<ul> <li>Poor UX: Users must fix one error at a time, run validation again, discover next error</li> <li>Development Inefficiency: Multiple validation cycles slow down configuration development</li> <li>Limited Context: Single error messages provide insufficient information for complex fixes</li> <li>Inconsistent Validation: Different validation rules scattered across codebase without coordination</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#requirements","title":"Requirements","text":"<ul> <li>Validate complex cross-references between entities</li> <li>Provide comprehensive error reporting in single validation run</li> <li>Categorize validation issues by type and severity</li> <li>Support enterprise-grade error messages with actionable suggestions</li> <li>Enable extensible validation framework for future requirements</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#decision","title":"Decision","text":"<p>Implement a 4-Layer Validation Pipeline with comprehensive Error Stacking instead of traditional fail-fast validation.</p>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#architecture-decision","title":"Architecture Decision","text":"<pre><code>Layer 1: SYNTAX     \u2192 Field format, types, required fields\nLayer 2: SEMANTIC   \u2192 Business rules within entities  \nLayer 3: INTEGRITY  \u2192 Cross-references, data consistency\nLayer 4: FEASIBILITY \u2192 Operational constraints, simulation readiness\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#key-components","title":"Key Components","text":"<ul> <li>ValidationPipeline: Orchestrates all 4 validation layers</li> <li>ValidationResult: Collects and categorizes all issues (no fail-fast)</li> <li>ValidationCategory: Enum for layer categorization (SYNTAX, SEMANTIC, INTEGRITY, FEASIBILITY)</li> <li>ValidationCoordinator: Cross-context validation coordination</li> <li>Layer-Specific Validators: Focused validators for each validation concern</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#error-stacking-strategy","title":"Error Stacking Strategy","text":"<ul> <li>Collect ALL Issues: Run all validation layers regardless of errors found</li> <li>Categorize by Layer: Group issues by validation layer for clarity</li> <li>Actionable Suggestions: Each error includes specific fix recommendation</li> <li>Professional Reporting: Enterprise-grade error summaries with issue counts</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#alternatives-considered","title":"Alternatives Considered","text":""},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#alternative-1-fail-fast-validation-traditional","title":"Alternative 1: Fail-Fast Validation (Traditional)","text":"<ul> <li>Pros: Simple implementation, fast failure on first error</li> <li>Cons: Poor user experience, multiple validation cycles required, limited error context</li> <li>Rejected: Inadequate for complex scenario validation requirements</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#alternative-2-pydantic-only-validation","title":"Alternative 2: Pydantic-Only Validation","text":"<ul> <li>Pros: Built-in validation, type safety</li> <li>Cons: Limited to field-level validation, no cross-reference validation, poor error categorization</li> <li>Rejected: Insufficient for complex business rule validation</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#alternative-3-single-layer-comprehensive-validation","title":"Alternative 3: Single-Layer Comprehensive Validation","text":"<ul> <li>Pros: All validation in one place</li> <li>Cons: Monolithic validator, difficult to maintain, poor separation of concerns</li> <li>Rejected: Not scalable or maintainable for complex validation requirements</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#alternative-4-event-driven-validation","title":"Alternative 4: Event-Driven Validation","text":"<ul> <li>Pros: Flexible, extensible</li> <li>Cons: Complex implementation, difficult to coordinate, potential performance issues</li> <li>Rejected: Over-engineered for current requirements</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#implementation","title":"Implementation","text":""},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#core-framework","title":"Core Framework","text":"<pre><code># shared/validation/pipeline.py\nclass ValidationPipeline:\n    def validate(self, scenario: Scenario) -&gt; ValidationResult:\n        result = ValidationResult(is_valid=True)\n\n        # Run all layers - no fail-fast\n        result.merge(self.syntax_validator.validate(scenario))\n        result.merge(self.semantic_validator.validate(scenario))\n        result.merge(self.integrity_validator.validate(scenario))\n        result.merge(self.feasibility_validator.validate(scenario))\n\n        return result\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#error-stacking","title":"Error Stacking","text":"<pre><code># shared/validation/base.py\nclass ValidationResult:\n    def merge(self, other: ValidationResult) -&gt; None:\n        \"\"\"Stack errors from multiple validation layers.\"\"\"\n        self.issues.extend(other.issues)\n        if other.has_errors():\n            self.is_valid = False\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#layer-implementation-example","title":"Layer Implementation Example","text":"<pre><code># shared/validation/validators/integrity_validator.py\nclass IntegrityValidator:\n    def validate(self, scenario: Scenario) -&gt; ValidationResult:\n        result = ValidationResult(is_valid=True)\n\n        # Validate cross-references\n        locomotive_ids = {loco.id for loco in scenario.locomotives or []}\n        for train in scenario.trains or []:\n            if train.locomotive_id not in locomotive_ids:\n                result.add_error(\n                    f\"Train {train.id} references non-existent locomotive '{train.locomotive_id}'\",\n                    field=f\"trains[{train.id}].locomotive_id\",\n                    category=ValidationCategory.INTEGRITY,\n                    suggestion=f\"Use one of: {', '.join(locomotive_ids)}\"\n                )\n\n        return result\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#positive","title":"Positive","text":"<ul> <li>Superior User Experience: Users see ALL validation issues at once</li> <li>Development Efficiency: Single validation cycle to identify all problems</li> <li>Professional Error Reporting: Enterprise-grade validation summaries</li> <li>Extensible Framework: Easy to add new validation layers or rules</li> <li>Clear Categorization: Issues grouped by validation concern</li> <li>Actionable Feedback: Each error includes specific fix suggestions</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#negative","title":"Negative","text":"<ul> <li>Implementation Complexity: More complex than simple fail-fast validation</li> <li>Performance Impact: Runs all validation layers even when errors found</li> <li>Memory Usage: Collects all validation issues in memory</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#risks-and-mitigation","title":"Risks and Mitigation","text":"<ul> <li>Risk: Performance degradation with large scenarios</li> <li>Mitigation: Validation typically completes in &lt;100ms, acceptable for user experience</li> <li>Risk: Complex error messages overwhelming users</li> <li>Mitigation: Clear categorization and professional formatting make errors manageable</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#validation-results","title":"Validation Results","text":""},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#before-fail-fast","title":"Before (Fail-Fast)","text":"<p><pre><code>\u274c \"Invalid scenario ID\" \u2192 Fix \u2192 Run again\n\u274c \"Missing locomotives\" \u2192 Fix \u2192 Run again  \n\u274c \"Invalid track reference\" \u2192 Fix \u2192 Run again\n</code></pre> Result: 3+ validation cycles required</p>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#after-error-stacking","title":"After (Error Stacking)","text":"<p><pre><code>\ud83d\udccb Validation Summary: 3 errors, 1 warning\n\nSYNTAX ERRORS:\n- Invalid scenario ID format (Field: id)\n\nINTEGRITY ERRORS:  \n- Missing locomotives (Field: locomotives)\n- Route 'R1' references non-existent track 'T99'\n\nWARNINGS:\n- Long simulation duration may impact performance\n</code></pre> Result: 1 validation cycle shows all issues</p>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#compliance","title":"Compliance","text":"<p>This decision supports the following quality goals: - Usability &amp; Accessibility (Priority 3): Professional validation UX - Simulation Accuracy &amp; Reliability (Priority 2): Comprehensive validation prevents invalid configurations - Testability (Priority 5): Layer-specific validation enables focused testing</p>"},{"location":"mvp/architecture/decisions/ADR-002-4-layer-validation-framework/#references","title":"References","text":"<ul> <li>Building Blocks Documentation</li> <li>Cross-Cutting Concepts</li> </ul> <p>Decision Date: January 2025 Decision Makers: Architecture Team Implementation Status: \u2705 Complete</p>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/","title":"ADR-003: Field Name Standardization","text":""},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#status","title":"Status","text":"<p>ACCEPTED - Implemented January 2025</p>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#context","title":"Context","text":"<p>PopUpSim codebase had inconsistent field naming patterns that created confusion and maintenance overhead:</p>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#problems-with-inconsistent-naming","title":"Problems with Inconsistent Naming","text":"<ul> <li>Prefix Inconsistency: Mixed patterns like <code>scenario_id</code>, <code>wagon_id</code>, <code>workshop_id</code> vs <code>id</code></li> <li>Reference Confusion: <code>track_id</code> vs <code>track</code> for entity references</li> <li>Maintenance Overhead: Different naming patterns across contexts</li> <li>Developer Confusion: Unclear which field name pattern to use</li> <li>Code Duplication: Mapping between different field name patterns</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#examples-of-inconsistency","title":"Examples of Inconsistency","text":"<pre><code># Before - Inconsistent patterns\nclass Scenario:\n    scenario_id: str  # prefix_id pattern\n\nclass Wagon:\n    wagon_id: str     # prefix_id pattern\n    track_id: str     # reference with _id suffix\n\nclass Workshop:\n    workshop_id: str  # prefix_id pattern\n    track_id: str     # reference with _id suffix\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#decision","title":"Decision","text":"<p>Implement systematic field name standardization across the entire codebase:</p>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#standardization-rules","title":"Standardization Rules","text":"<ol> <li>Entity IDs: Use <code>id</code> (not <code>prefix_id</code>)</li> <li>Entity References: Use <code>track</code> (not <code>track_id</code>) for track references</li> <li>Consistency: Apply same pattern across all contexts</li> <li>Backward Compatibility: Update all DTOs, domain models, and test fixtures</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#implementation-strategy","title":"Implementation Strategy","text":"<pre><code># After - Consistent patterns\nclass Scenario:\n    id: str           # standardized\n\nclass Wagon:\n    id: str           # standardized\n    track: str        # reference without _id suffix\n\nclass Workshop:\n    id: str           # standardized\n    track: str        # reference without _id suffix\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#alternatives-considered","title":"Alternatives Considered","text":""},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#alternative-1-keep-existing-inconsistent-naming","title":"Alternative 1: Keep Existing Inconsistent Naming","text":"<ul> <li>Pros: No refactoring required</li> <li>Cons: Continued confusion, maintenance overhead, poor developer experience</li> <li>Rejected: Technical debt would continue to grow</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#alternative-2-use-prefix-pattern-everywhere","title":"Alternative 2: Use Prefix Pattern Everywhere","text":"<ul> <li>Pros: Explicit field identification</li> <li>Cons: Verbose, redundant (class name already provides context)</li> <li>Rejected: Unnecessarily verbose for clean code</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#alternative-3-use-full-reference-names","title":"Alternative 3: Use Full Reference Names","text":"<ul> <li>Pros: Very explicit (<code>locomotive_id</code>, <code>route_id</code>)</li> <li>Cons: Verbose, inconsistent with modern naming conventions</li> <li>Rejected: Modern frameworks favor concise, context-aware naming</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#implementation","title":"Implementation","text":""},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#systematic-refactoring","title":"Systematic Refactoring","text":"<ol> <li>Domain Models: Updated all entity classes</li> <li>DTOs: Updated all input/output DTOs</li> <li>Test Fixtures: Updated JSON test files</li> <li>Validation: Updated field references in validators</li> <li>Analytics: Updated collector attribute names</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#key-changes","title":"Key Changes","text":"<pre><code># Domain Models\nclass Scenario(BaseModel):\n    id: str  # was: scenario_id\n\nclass Locomotive(BaseModel):\n    id: str    # was: locomotive_id\n    track: str # was: track_id\n\n# DTOs\nclass WagonInputDTO(BaseModel):\n    id: str    # was: wagon_id\n    track: str # was: track_id\n\n# Analytics\nclass WorkshopCollector:\n    idle_time: float        # was: workshop_idle_time\n    active_time: float      # was: workshop_active_time\n    station_usage: dict     # was: workshop_station_usage\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#validation-updates","title":"Validation Updates","text":"<ul> <li>Updated all validation error messages</li> <li>Fixed field path references in validation results</li> <li>Updated cross-reference validation logic</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#positive","title":"Positive","text":"<ul> <li>Consistent Naming: Single, clear naming pattern across codebase</li> <li>Reduced Confusion: Developers know which pattern to use</li> <li>Cleaner Code: More concise, readable field names</li> <li>Better Maintainability: Consistent patterns easier to maintain</li> <li>Professional Appearance: Modern, clean naming conventions</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#negative","title":"Negative","text":"<ul> <li>Breaking Changes: Existing configurations need field name updates</li> <li>Refactoring Effort: Required systematic updates across codebase</li> <li>Migration Required: Test fixtures and example scenarios updated</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#migration-impact","title":"Migration Impact","text":"<ul> <li>Test Fixtures: All JSON test files updated with new field names</li> <li>Example Scenarios: Updated to use standardized field names</li> <li>Documentation: Updated to reflect new naming conventions</li> <li>Validation: All field references updated in validation framework</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#validation","title":"Validation","text":""},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#before-standardization","title":"Before Standardization","text":"<pre><code>{\n  \"scenario_id\": \"test-scenario\",\n  \"locomotives\": [\n    {\n      \"locomotive_id\": \"L1\",\n      \"track_id\": \"PARKING_1\"\n    }\n  ],\n  \"workshops\": [\n    {\n      \"workshop_id\": \"WS1\",\n      \"track_id\": \"WORKSHOP_1\"\n    }\n  ]\n}\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#after-standardization","title":"After Standardization","text":"<pre><code>{\n  \"id\": \"test-scenario\",\n  \"locomotives\": [\n    {\n      \"id\": \"L1\",\n      \"track\": \"PARKING_1\"\n    }\n  ],\n  \"workshops\": [\n    {\n      \"id\": \"WS1\",\n      \"track\": \"WORKSHOP_1\"\n    }\n  ]\n}\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#compliance","title":"Compliance","text":"<p>This decision supports: - Code Quality: Consistent, maintainable codebase - Developer Experience: Clear, predictable naming patterns - Maintainability: Reduced cognitive overhead for developers</p>"},{"location":"mvp/architecture/decisions/ADR-003-field-name-standardization/#references","title":"References","text":"<ul> <li>Building Blocks Documentation</li> <li>Domain Model Documentation</li> </ul> <p>Decision Date: January 2025 Decision Makers: Architecture Team Implementation Status: \u2705 Complete</p>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/","title":"ADR-004: 3-Bounded Context Architecture","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#status","title":"Status","text":"<p>ACCEPTED - Implemented January 2025</p>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#context","title":"Context","text":"<p>PopUpSim required clear architectural boundaries to manage complexity of freight rail simulation with multiple concerns: configuration management, simulation execution, and analytics reporting.</p>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#domain-complexity","title":"Domain Complexity","text":"<ul> <li>Configuration: Complex scenario loading, validation, and parsing</li> <li>Simulation: Discrete event simulation with 5 process coordinators</li> <li>Analytics: KPI calculation, metrics collection, and reporting</li> <li>Cross-Cutting: Validation, resource management, event handling</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#requirements","title":"Requirements","text":"<ul> <li>Clear separation of concerns</li> <li>Independent development and testing</li> <li>Scalable architecture for future growth</li> <li>Clean interfaces between contexts</li> <li>Domain-driven design principles</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#decision","title":"Decision","text":"<p>Implement 3-Bounded Context Architecture based on Domain-Driven Design principles:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Configuration  \u2502\u2500\u2500\u2500\u25b6\u2502 Workshop Ops     \u2502\u2500\u2500\u2500\u25b6\u2502   Analytics     \u2502\n\u2502    Context      \u2502    \u2502    Context       \u2502    \u2502   Context       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#context-definitions","title":"Context Definitions","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#1-configuration-context","title":"1. Configuration Context","text":"<ul> <li>Responsibility: Input validation, parsing, scenario building</li> <li>Core Concepts: Scenario, ValidationPipeline, ScenarioService</li> <li>Architecture: Hexagonal with 4-layer validation</li> <li>Technology: Pydantic, JSON/CSV adapters</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#2-workshop-operations-context","title":"2. Workshop Operations Context","text":"<ul> <li>Responsibility: Discrete event simulation execution</li> <li>Core Concepts: WorkshopOrchestrator, 5 Process Coordinators, Resource Management</li> <li>Architecture: Layered with domain services</li> <li>Technology: SimPy, resource pools, capacity managers</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#3-analytics-context","title":"3. Analytics Context","text":"<ul> <li>Responsibility: Metrics collection, KPI calculation, reporting</li> <li>Core Concepts: KPICalculator, MetricCollectors, Visualizer</li> <li>Architecture: Event-driven with observers</li> <li>Technology: Matplotlib, CSV export, statistical analysis</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#alternatives-considered","title":"Alternatives Considered","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#alternative-1-monolithic-architecture","title":"Alternative 1: Monolithic Architecture","text":"<ul> <li>Pros: Simple, single deployment unit</li> <li>Cons: Poor separation of concerns, difficult to test, scalability issues</li> <li>Rejected: Not suitable for complex domain with multiple concerns</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#alternative-2-microservices-architecture","title":"Alternative 2: Microservices Architecture","text":"<ul> <li>Pros: Independent deployment, technology diversity</li> <li>Cons: Over-engineered for MVP, network complexity, operational overhead</li> <li>Rejected: Premature optimization for current requirements</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#alternative-3-2-context-architecture-config-simulation","title":"Alternative 3: 2-Context Architecture (Config + Simulation)","text":"<ul> <li>Pros: Simpler than 3-context, clear separation</li> <li>Cons: Analytics mixed with simulation, unclear reporting boundaries</li> <li>Rejected: Analytics deserves separate context due to complexity</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#alternative-4-4-context-architecture","title":"Alternative 4: 4+ Context Architecture","text":"<ul> <li>Pros: Very fine-grained separation</li> <li>Cons: Over-engineered, too many boundaries, coordination complexity</li> <li>Rejected: Unnecessary complexity for current domain size</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#implementation","title":"Implementation","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#context-boundaries","title":"Context Boundaries","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#configuration-context-configuration","title":"Configuration Context (<code>configuration/</code>)","text":"<pre><code>\u251c\u2500\u2500 application/     # Services, DTOs, pipelines\n\u251c\u2500\u2500 domain/         # Models, factories, ports\n\u2514\u2500\u2500 infrastructure/ # Adapters, file I/O\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#workshop-operations-context-workshop_operations","title":"Workshop Operations Context (<code>workshop_operations/</code>)","text":"<pre><code>\u251c\u2500\u2500 application/     # Orchestrator, coordinators\n\u251c\u2500\u2500 domain/         # Entities, services, value objects\n\u2514\u2500\u2500 infrastructure/ # Resources, simulation, routing\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#analytics-context-analytics","title":"Analytics Context (<code>analytics/</code>)","text":"<pre><code>\u251c\u2500\u2500 application/     # Services, aggregators\n\u251c\u2500\u2500 domain/         # Collectors, models, observers\n\u2514\u2500\u2500 infrastructure/ # Exporters, visualization\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#shared-infrastructure-shared","title":"Shared Infrastructure (<code>shared/</code>)","text":"<pre><code>\u251c\u2500\u2500 validation/     # 4-layer validation framework\n\u2514\u2500\u2500 i18n/          # Internationalization\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#context-interactions","title":"Context Interactions","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#data-flow","title":"Data Flow","text":"<pre><code>Configuration \u2192 Validation \u2192 Workshop Simulation \u2192 Analytics \u2192 Export\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#interface-contracts","title":"Interface Contracts","text":"<ul> <li>Configuration \u2192 Workshop: Validated Scenario domain object</li> <li>Workshop \u2192 Analytics: Simulation metrics and events</li> <li>Analytics \u2192 External: CSV files, PNG charts</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#context-independence","title":"Context Independence","text":"<ul> <li>Each context can be developed independently</li> <li>Clear interface contracts between contexts</li> <li>Separate test suites for each context</li> <li>Independent technology choices within contexts</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#positive","title":"Positive","text":"<ul> <li>Clear Boundaries: Each context has well-defined responsibilities</li> <li>Independent Development: Teams can work on contexts independently</li> <li>Testability: Each context can be tested in isolation</li> <li>Scalability: Contexts can evolve independently</li> <li>Technology Flexibility: Different tech stacks per context</li> <li>Domain Alignment: Architecture reflects business domains</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#negative","title":"Negative","text":"<ul> <li>Coordination Overhead: Need to manage interfaces between contexts</li> <li>Initial Complexity: More complex than monolithic approach</li> <li>Integration Testing: Need to test context interactions</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#context-quality-assessment","title":"Context Quality Assessment","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#configuration-context-9510","title":"Configuration Context: 9.5/10","text":"<ul> <li>Excellent hexagonal architecture</li> <li>4-layer validation framework</li> <li>Clean DTO \u2192 Domain transformation</li> <li>Pluggable data source adapters</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#workshop-operations-context-9010","title":"Workshop Operations Context: 9.0/10","text":"<ul> <li>Rich domain model with aggregates</li> <li>5 specialized process coordinators</li> <li>Resource management abstraction</li> <li>Clean SimPy integration</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#analytics-context-9010","title":"Analytics Context: 9.0/10","text":"<ul> <li>Event-driven architecture</li> <li>Observer pattern for metrics</li> <li>Specification pattern for bottlenecks</li> <li>Multiple export formats</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#validation","title":"Validation","text":""},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#architecture-metrics","title":"Architecture Metrics","text":"<ul> <li>Maintainability: 9.5/10 - Clear separation, consistent patterns</li> <li>Testability: 9.0/10 - Independent context testing</li> <li>Extensibility: 9.5/10 - Easy to add features within contexts</li> <li>Performance: 8.5/10 - Good for MVP, optimization opportunities</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#context-cohesion","title":"Context Cohesion","text":"<ul> <li>Configuration: High cohesion around scenario management</li> <li>Workshop Operations: High cohesion around simulation execution  </li> <li>Analytics: High cohesion around metrics and reporting</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#context-coupling","title":"Context Coupling","text":"<ul> <li>Low Coupling: Clean interfaces, minimal dependencies</li> <li>Data Coupling: Only essential data passed between contexts</li> <li>No Temporal Coupling: Contexts don't depend on execution timing</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#compliance","title":"Compliance","text":"<p>This decision supports: - Domain-Driven Design: Clear bounded contexts aligned with business domains - Clean Architecture: Proper dependency direction and separation - SOLID Principles: Single responsibility, open/closed, dependency inversion</p>"},{"location":"mvp/architecture/decisions/ADR-004-3-bounded-context-architecture/#references","title":"References","text":"<ul> <li>Building Blocks Documentation</li> <li>Solution Strategy</li> </ul> <p>Decision Date: January 2025 Decision Makers: Architecture Team Implementation Status: \u2705 Complete</p>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/","title":"ADR-005: Mandatory Type Hints with MyPy Strict Mode","text":""},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#status","title":"Status","text":"<p>ACCEPTED - Implemented January 2025</p>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#context","title":"Context","text":"<p>PopUpSim is a complex simulation system with multiple contexts, intricate domain models, and extensive validation logic. Type safety is critical for:</p>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#code-quality-requirements","title":"Code Quality Requirements","text":"<ul> <li>Simulation Accuracy: Type errors could lead to incorrect simulation results</li> <li>Complex Domain Models: Rich entities with multiple relationships need type safety</li> <li>Validation Framework: 4-layer validation requires precise type definitions</li> <li>Cross-Context Integration: Clear interfaces between bounded contexts</li> <li>Maintainability: Large codebase needs type-driven development</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#problems-without-type-hints","title":"Problems Without Type Hints","text":"<ul> <li>Runtime Errors: Type mismatches discovered only during execution</li> <li>Poor IDE Support: Limited autocomplete and refactoring capabilities</li> <li>Documentation Gaps: Unclear function signatures and return types</li> <li>Integration Issues: Unclear interfaces between contexts</li> <li>Maintenance Overhead: Difficult to understand code without type information</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#decision","title":"Decision","text":"<p>Implement mandatory type hints across the entire codebase with MyPy strict mode enforcement.</p>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#type-hint-requirements","title":"Type Hint Requirements","text":"<ul> <li>All Functions: Must have explicit return type annotations</li> <li>All Methods: Must have explicit return type annotations</li> <li>All Parameters: Must have type annotations</li> <li>Complex Variables: Must have type hints when type unclear</li> <li>Generic Types: Must use proper generic type annotations</li> <li>Optional Types: Must use <code>Optional</code> or union syntax explicitly</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#mypy-configuration","title":"MyPy Configuration","text":"<pre><code># pyproject.toml\n[tool.mypy]\ndisallow_untyped_defs = true\ndisallow_incomplete_defs = true\ndisallow_untyped_calls = true\nwarn_return_any = true\nwarn_unused_ignores = true\nstrict = true\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#enforcement-strategy","title":"Enforcement Strategy","text":"<ul> <li>Pre-commit Hooks: MyPy runs on every commit</li> <li>CI/CD Pipeline: Type checking in continuous integration</li> <li>Development Workflow: <code>uv run mypy backend/src/</code> in quality checks</li> <li>Code Reviews: Type hints required for all new code</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#alternatives-considered","title":"Alternatives Considered","text":""},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#alternative-1-optional-type-hints","title":"Alternative 1: Optional Type Hints","text":"<ul> <li>Pros: Gradual adoption, less initial work</li> <li>Cons: Inconsistent type safety, partial benefits</li> <li>Rejected: Insufficient for complex simulation system</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#alternative-2-runtime-type-checking-eg-pydantic-everywhere","title":"Alternative 2: Runtime Type Checking (e.g., Pydantic everywhere)","text":"<ul> <li>Pros: Runtime validation, automatic type checking</li> <li>Cons: Performance overhead, limited to data models</li> <li>Rejected: Not suitable for all code, performance impact</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#alternative-3-typescript-style-gradual-typing","title":"Alternative 3: TypeScript-style Gradual Typing","text":"<ul> <li>Pros: Flexible adoption</li> <li>Cons: Python's type system not as mature as TypeScript</li> <li>Rejected: Python type hints work differently than TypeScript</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#alternative-4-no-type-hints-dynamic-python","title":"Alternative 4: No Type Hints (Dynamic Python)","text":"<ul> <li>Pros: Faster initial development</li> <li>Cons: Poor maintainability, runtime errors, unclear interfaces</li> <li>Rejected: Unacceptable for enterprise-grade simulation system</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#implementation","title":"Implementation","text":""},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#type-hint-examples","title":"Type Hint Examples","text":""},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#functions-and-methods","title":"Functions and Methods","text":"<pre><code>def validate_scenario(scenario: Scenario) -&gt; ValidationResult:\n    \"\"\"Validate scenario with explicit types.\"\"\"\n    return ValidationResult(is_valid=True)\n\ndef calculate_throughput(\n    wagons: list[Wagon],\n    duration: float\n) -&gt; ThroughputKPI:\n    \"\"\"Calculate throughput metrics.\"\"\"\n    return ThroughputKPI(wagons_per_hour=len(wagons) / duration)\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#complex-generic-types","title":"Complex Generic Types","text":"<pre><code>from typing import Dict, List, Optional, Union, Generator\nfrom pathlib import Path\n\ndef load_scenario_data(\n    source: Path | str\n) -&gt; dict[str, list[dict[str, Any]]]:\n    \"\"\"Load scenario data with complex return type.\"\"\"\n    return {}\n\ndef process_wagons() -&gt; Generator[Wagon, None, None]:\n    \"\"\"Generator with explicit type parameters.\"\"\"\n    yield Wagon(id=\"W1\", track=\"T1\")\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#class-definitions","title":"Class Definitions","text":"<pre><code>class ValidationPipeline:\n    \"\"\"Pipeline with typed methods.\"\"\"\n\n    def __init__(self, validators: list[Validator]) -&gt; None:\n        self.validators = validators\n\n    def validate(self, scenario: Scenario) -&gt; ValidationResult:\n        \"\"\"Validate with explicit return type.\"\"\"\n        result = ValidationResult(is_valid=True)\n        return result\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#domain-models-with-pydantic","title":"Domain Models with Pydantic","text":"<pre><code>from pydantic import BaseModel, Field\nfrom typing import Optional\n\nclass Wagon(BaseModel):\n    \"\"\"Wagon entity with type-safe fields.\"\"\"\n    id: str = Field(min_length=1, max_length=50)\n    track: str\n    length: float = Field(gt=0)\n    needs_retrofit: bool = True\n    status: WagonStatus = WagonStatus.ARRIVED\n\n    def update_status(self, new_status: WagonStatus) -&gt; None:\n        \"\"\"Update status with type safety.\"\"\"\n        self.status = new_status\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#import-strategy","title":"Import Strategy","text":"<pre><code># Standard typing imports\nfrom typing import Any, Dict, List, Optional, Union, Generator\nfrom typing_extensions import TypedDict, Literal  # For newer features\nfrom pathlib import Path\nfrom datetime import datetime\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#quality-assurance","title":"Quality Assurance","text":"<pre><code># Development workflow\nuv run ruff format .                    # Format code\nuv run ruff check .                     # Lint code\nuv run mypy backend/src/                # Type checking\nuv run pylint backend/src/              # Code quality\nuv run pytest                          # Run tests\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#positive","title":"Positive","text":"<ul> <li>Type Safety: Catch type errors at development time</li> <li>Better IDE Support: Excellent autocomplete, refactoring, navigation</li> <li>Self-Documenting Code: Function signatures clearly show expected types</li> <li>Reduced Bugs: Many runtime errors prevented by type checking</li> <li>Better Refactoring: Safe refactoring with type-aware tools</li> <li>Team Productivity: Clear interfaces reduce integration issues</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#negative","title":"Negative","text":"<ul> <li>Initial Development Overhead: More typing required upfront</li> <li>Learning Curve: Developers need to understand Python type system</li> <li>Verbose Code: Some type annotations can be lengthy</li> <li>MyPy Complexity: Advanced type features can be complex</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#migration-impact","title":"Migration Impact","text":"<ul> <li>Existing Code: All functions updated with type hints</li> <li>New Development: Type hints mandatory from start</li> <li>CI/CD: MyPy integrated into quality checks</li> <li>Documentation: Type hints serve as inline documentation</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#validation","title":"Validation","text":""},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#type-coverage-metrics","title":"Type Coverage Metrics","text":"<ul> <li>Functions: 100% have return type annotations</li> <li>Methods: 100% have return type annotations</li> <li>Parameters: 100% have type annotations</li> <li>MyPy Score: 100% pass rate with strict mode</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#quality-improvements","title":"Quality Improvements","text":"<ul> <li>IDE Experience: Excellent autocomplete and error detection</li> <li>Code Reviews: Type information makes reviews more effective</li> <li>Debugging: Type errors caught before runtime</li> <li>Documentation: Self-documenting function signatures</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#examples-of-prevented-errors","title":"Examples of Prevented Errors","text":"<pre><code># Type error caught by MyPy\ndef process_wagon(wagon: Wagon) -&gt; None:\n    wagon.update_status(\"COMPLETED\")  # Error: expected WagonStatus, got str\n\n# Correct usage\ndef process_wagon(wagon: Wagon) -&gt; None:\n    wagon.update_status(WagonStatus.COMPLETED)  # \u2705 Type safe\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#compliance","title":"Compliance","text":"<p>This decision supports: - Code Quality: Type safety prevents runtime errors - Maintainability: Clear interfaces and self-documenting code - Team Productivity: Better IDE support and refactoring capabilities - Simulation Accuracy: Type safety critical for correct simulation results</p>"},{"location":"mvp/architecture/decisions/ADR-005-type-hints-mandatory/#references","title":"References","text":"<ul> <li>Project Rules (see <code>.amazonq/rules/project-rules.md</code> in repository root)</li> <li>Python Type Hints Documentation</li> <li>MyPy Documentation</li> </ul> <p>Decision Date: January 2025 Decision Makers: Architecture Team Implementation Status: \u2705 Complete</p>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/","title":"ADR-006: SimPy for Discrete Event Simulation","text":"<p>Status: IMPLEMENTED - 2025-01-15</p>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#context","title":"Context","text":"<p>Need a discrete event simulation framework for modeling Pop-Up workshop operations with individual wagon tracking and resource management.</p>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#decision","title":"Decision","text":"<p>Use SimPy as the simulation engine.</p>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#rationale","title":"Rationale","text":"<ul> <li>Proven in POC: Successfully validated during 3-L\u00e4nderhack 2024 hackathon</li> <li>Python native: Integrates seamlessly with Python ecosystem</li> <li>Discrete event paradigm: Perfect fit for workshop operations simulation</li> <li>Deterministic: Supports reproducible results</li> <li>Well-documented: Mature library with good community support</li> <li>Lightweight: No heavy infrastructure requirements</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#alternatives-considered","title":"Alternatives Considered","text":"<ul> <li>SimPy \u2705 Chosen</li> <li>Mesa: Agent-based, overkill for our use case</li> <li>Custom simulation: Too much development effort</li> <li>AnyLogic: Commercial, not open source</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#implementation-in-mvp","title":"Implementation in MVP","text":""},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#core-simpy-usage","title":"Core SimPy Usage","text":"<pre><code># workshop_operations/infrastructure/simulation/simpy_adapter.py\nclass SimulationAdapter:\n    def __init__(self):\n        self.env = simpy.Environment()\n\n    def create_resource(self, capacity: int) -&gt; simpy.Resource:\n        return simpy.Resource(self.env, capacity)\n\n    def create_store(self, capacity: int = float('inf')) -&gt; simpy.Store:\n        return simpy.Store(self.env, capacity)\n\n# workshop_operations/application/orchestrator.py\nclass WorkshopOrchestrator:\n    def run(self, until: float) -&gt; None:\n        self.sim.run_process(process_train_arrivals, self)\n        self.sim.run_process(pickup_wagons_to_retrofit, self)\n        self.sim.run_process(move_wagons_to_stations, self)\n        self.sim.run(until)\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#simpy-resources-and-stores","title":"SimPy Resources and Stores","text":"<ul> <li>Workshop Stations: <code>simpy.Resource</code> for retrofit station capacity</li> <li>Locomotive Pool: <code>simpy.Store</code> for locomotive availability</li> <li>Workflow Coordination: <code>simpy.Store</code> for wagon flow between processes</li> <li>Event Scheduling: <code>simpy.Environment</code> for deterministic time progression</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#achieved","title":"Achieved","text":"<ul> <li>\u2705 Deterministic Results: Reproducible simulation runs with same seed</li> <li>\u2705 Resource Management: SimPy Resources handle workshop station blocking</li> <li>\u2705 Event-Driven Workflow: SimPy Stores eliminate polling delays</li> <li>\u2705 Process Coordination: 5 concurrent processes coordinate via SimPy primitives</li> <li>\u2705 Abstraction Layer: SimulationAdapter isolates SimPy dependencies</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-006-simpy-discrete-event-simulation/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>workshop_operations/infrastructure/simulation/simpy_adapter.py</code> - SimPy abstraction</li> <li><code>workshop_operations/application/orchestrator.py</code> - Main simulation orchestration</li> <li><code>workshop_operations/infrastructure/resources/</code> - Resource management with SimPy</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/","title":"ADR-007: File-Based Data Storage","text":"<p>Status: IMPLEMENTED - 2025-01-15</p>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#context","title":"Context","text":"<p>Need data storage for configuration and results. Full version will use database, but MVP needs simplest approach.</p>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#decision","title":"Decision","text":"<p>Use file-based storage with JSON/CSV formats.</p>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#rationale","title":"Rationale","text":"<ul> <li>Local deployment: No server infrastructure needed</li> <li>Small data volume: Typical scenarios have &lt;1000 wagons</li> <li>Simple installation: No database setup required</li> <li>Transparency: Human-readable formats</li> <li>Version control: Git-friendly text files</li> <li>Portability: Easy to share and backup</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#alternatives-considered","title":"Alternatives Considered","text":"<ul> <li>Files (JSON/CSV) \u2705 Chosen</li> <li>SQLite: Overkill for MVP data volume</li> <li>PostgreSQL: Requires installation and setup</li> <li>In-memory only: No persistence</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#implementation-in-mvp","title":"Implementation in MVP","text":""},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#file-formats-supported","title":"File Formats Supported","text":"<pre><code># JSON scenario files\n{\n  \"id\": \"small-scenario\",\n  \"trains\": [...],\n  \"wagons\": [...],\n  \"workshops\": [...]\n}\n\n# CSV directory structure\ncsv_scenario/\n\u251c\u2500\u2500 scenario.csv\n\u251c\u2500\u2500 trains.csv\n\u251c\u2500\u2500 wagons.csv\n\u2514\u2500\u2500 workshops.csv\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#data-access-layer","title":"Data Access Layer","text":"<pre><code># configuration/infrastructure/adapters/\nclass JsonDataSourceAdapter:\n    def load_scenario(self, path: Path) -&gt; ScenarioInputDTO:\n        with open(path) as f:\n            return ScenarioInputDTO.model_validate(json.load(f))\n\nclass CsvDataSourceAdapter:\n    def load_scenario(self, directory: Path) -&gt; ScenarioInputDTO:\n        # Load from multiple CSV files\n        return self._build_scenario_from_csvs(directory)\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#results-export","title":"Results Export","text":"<ul> <li>CSV Files: Simulation metrics and KPIs</li> <li>PNG Charts: Matplotlib visualizations</li> <li>JSON Data: Raw metrics for future web interface</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#achieved","title":"Achieved","text":"<ul> <li>\u2705 Zero Installation: No database setup required</li> <li>\u2705 Transparent Data: Human-readable JSON/CSV formats</li> <li>\u2705 Version Control: Git-friendly text files</li> <li>\u2705 Multi-Format Support: JSON and CSV input via hexagonal adapters</li> <li>\u2705 Export Flexibility: Multiple output formats for different use cases</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-007-file-based-data-storage/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>configuration/infrastructure/adapters/</code> - File format adapters</li> <li><code>analytics/infrastructure/exporters/</code> - Results export</li> <li><code>Data/examples/</code> - Example scenarios in JSON and CSV</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/","title":"ADR-008: Pydantic for Data Validation","text":"<p>Status: IMPLEMENTED - 2025-01-15</p>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#context","title":"Context","text":"<p>Need robust input validation for JSON/CSV configuration files with clear error messages.</p>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#decision","title":"Decision","text":"<p>Use Pydantic for data validation and parsing.</p>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#rationale","title":"Rationale","text":"<ul> <li>Type safety: Excellent integration with Python type hints (matches project rules)</li> <li>Validation: Automatic validation with clear error messages</li> <li>Performance: Fast (Rust-based core in Pydantic v2)</li> <li>JSON Schema: Can generate schemas for documentation</li> <li>IDE support: Great autocomplete and type checking</li> <li>Standard: De facto standard in modern Python projects</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#alternatives-considered","title":"Alternatives Considered","text":"<ul> <li>Pydantic \u2705 Chosen</li> <li>dataclasses: No validation capabilities</li> <li>attrs: Less popular, fewer features</li> <li>marshmallow: Older, slower, less type-safe</li> <li>cerberus: Less Pythonic, no type hints</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#implementation-in-mvp","title":"Implementation in MVP","text":""},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#domain-models-with-pydantic","title":"Domain Models with Pydantic","text":"<pre><code># configuration/domain/models/scenario.py\nclass Scenario(BaseModel):\n    id: str = Field(min_length=1, max_length=100)\n    start_date: datetime\n    end_date: datetime\n    trains: list[Train] | None = None\n    wagons: list[Wagon] | None = None\n\n    @field_validator('end_date')\n    def end_after_start(cls, v, info):\n        if 'start_date' in info.data and v &lt;= info.data['start_date']:\n            raise ValueError('end_date must be after start_date')\n        return v\n\n# workshop_operations/domain/entities/wagon.py\nclass Wagon(BaseModel):\n    id: str = Field(min_length=1, max_length=50)\n    track: str\n    length: float = Field(gt=0, le=30)\n    needs_retrofit: bool = True\n    status: WagonStatus = WagonStatus.ARRIVED\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#validation-integration","title":"Validation Integration","text":"<pre><code># shared/validation/validators/syntax_validator.py\nclass SyntaxValidator:\n    def validate(self, scenario: Scenario) -&gt; ValidationResult:\n        try:\n            # Pydantic validation happens automatically\n            validated = Scenario.model_validate(scenario.model_dump())\n            return ValidationResult(is_valid=True)\n        except ValidationError as e:\n            return self._convert_pydantic_errors(e)\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#achieved","title":"Achieved","text":"<ul> <li>\u2705 Type Safety: Automatic validation with Python type hints</li> <li>\u2705 Clear Error Messages: Detailed validation errors with field paths</li> <li>\u2705 JSON Schema: Auto-generated schemas for documentation</li> <li>\u2705 IDE Support: Excellent autocomplete and type checking</li> <li>\u2705 Performance: Fast validation with Rust-based core</li> <li>\u2705 Integration: Seamless integration with 4-layer validation framework</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-008-pydantic-data-validation/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>configuration/domain/models/</code> - All domain models use Pydantic</li> <li><code>workshop_operations/domain/entities/</code> - Entity models with validation</li> <li><code>shared/validation/validators/syntax_validator.py</code> - Pydantic integration</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/","title":"ADR-009: Matplotlib for Visualization","text":"<p>Status: IMPLEMENTED - 2025-01-15</p>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#context","title":"Context","text":"<p>Need visualization for simulation results. Full version will have web interface, but MVP needs simple charts.</p>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#decision","title":"Decision","text":"<p>Use Matplotlib for generating static charts (PNG files).</p>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#rationale","title":"Rationale","text":"<ul> <li>Simple: Easy to use, well-known library</li> <li>Offline: No web server required</li> <li>Sufficient: Meets MVP visualization needs</li> <li>Python native: Integrated in Python ecosystem</li> <li>No frontend developer: Backend team can handle it</li> <li>Fast development: Quick to implement basic charts</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#alternatives-considered","title":"Alternatives Considered","text":"<ul> <li>Matplotlib \u2705 Chosen</li> <li>Plotly: Interactive but requires web server</li> <li>Bokeh: Overkill for static charts</li> <li>Seaborn: Built on Matplotlib, no significant advantage</li> <li>Custom web charts: Requires frontend development</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#implementation-in-mvp","title":"Implementation in MVP","text":""},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#visualization-components","title":"Visualization Components","text":"<pre><code># analytics/infrastructure/visualization/visualizer.py\nclass Visualizer:\n    def create_throughput_chart(self, kpis: ThroughputKPI) -&gt; Path:\n        fig, ax = plt.subplots(figsize=(10, 6))\n        ax.bar(['Wagons/Hour', 'Total Processed'], \n               [kpis.wagons_per_hour, kpis.total_wagons])\n        plt.savefig('throughput_chart.png')\n        return Path('throughput_chart.png')\n\n    def create_gantt_chart(self, events: list[Event]) -&gt; Path:\n        # Generate Gantt chart for locomotive and wagon activities\n        return self._create_gantt_visualization(events)\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#chart-types-generated","title":"Chart Types Generated","text":"<ul> <li>Throughput Charts: Wagons per hour, total processed</li> <li>Utilization Charts: Workshop station usage over time</li> <li>Gantt Charts: Locomotive and wagon activity timelines</li> <li>Bottleneck Analysis: Resource utilization heatmaps</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#achieved","title":"Achieved","text":"<ul> <li>\u2705 Fast Implementation: Charts generated in &lt;1 second</li> <li>\u2705 No Web Complexity: Offline PNG files, no server required</li> <li>\u2705 Professional Output: Publication-ready charts for reports</li> <li>\u2705 Multiple Chart Types: Comprehensive visualization suite</li> <li>\u2705 Export Ready: PNG files easy to include in presentations</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-009-matplotlib-visualization/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>analytics/infrastructure/visualization/visualizer.py</code> - Chart generation</li> <li><code>analytics/application/services/visualization_service.py</code> - Visualization orchestration</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/","title":"ADR-010: Layered Architecture","text":"<p>Status: IMPLEMENTED - 2025-01-15</p>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#context","title":"Context","text":"<p>Need simple architecture for rapid MVP development (5-week timeline) that can evolve to hexagonal architecture.</p>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#decision","title":"Decision","text":"<p>Use layered architecture within each bounded context: - Presentation Layer: CLI + File I/O - Business Logic Layer: Domain services - Data Access Layer: File operations - Infrastructure Layer: SimPy, Matplotlib, Pydantic</p>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#rationale","title":"Rationale","text":"<ul> <li>Fast development: Simple, well-understood pattern</li> <li>Team experience: Familiar to all developers</li> <li>Clear separation: Easy to test business logic</li> <li>Migration ready: Foundation for hexagonal architecture</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#alternatives-considered","title":"Alternatives Considered","text":"<ul> <li>Layered \u2705 Chosen</li> <li>Hexagonal: Too complex for 5-week MVP</li> <li>Microservices: Deployment overhead</li> <li>Monolithic spaghetti: Unmaintainable</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#implementation-in-mvp","title":"Implementation in MVP","text":""},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#layer-structure-per-context","title":"Layer Structure per Context","text":"<pre><code>configuration/\n\u251c\u2500\u2500 application/     # Services, DTOs (Presentation)\n\u251c\u2500\u2500 domain/         # Models, business logic\n\u2514\u2500\u2500 infrastructure/ # File I/O, adapters (Data Access)\n\nworkshop_operations/\n\u251c\u2500\u2500 application/     # Orchestrator, coordinators\n\u251c\u2500\u2500 domain/         # Entities, services, business rules\n\u2514\u2500\u2500 infrastructure/ # SimPy, resources, routing\n\nanalytics/\n\u251c\u2500\u2500 application/     # KPI services, aggregators\n\u251c\u2500\u2500 domain/         # Collectors, models\n\u2514\u2500\u2500 infrastructure/ # Matplotlib, CSV export\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#dependency-direction","title":"Dependency Direction","text":"<pre><code>Presentation \u2192 Business Logic \u2192 Data Access\nApplication  \u2192 Domain         \u2192 Infrastructure\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#achieved","title":"Achieved","text":"<ul> <li>\u2705 Rapid Development: 5-week MVP timeline met</li> <li>\u2705 Clear Structure: Consistent layering across all contexts</li> <li>\u2705 Testable Business Logic: Domain layer isolated from infrastructure</li> <li>\u2705 Migration Ready: Clean interfaces prepared for hexagonal transition</li> <li>\u2705 Team Productivity: Familiar pattern, easy to understand</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-010-layered-architecture/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li>All contexts follow consistent layered structure</li> <li>Domain layers contain pure business logic</li> <li>Infrastructure layers handle external dependencies</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/","title":"ADR-011: 3 Bounded Contexts","text":"<p>Status: IMPLEMENTED - 2025-01-15</p>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#context","title":"Context","text":"<p>Full version will have multiple bounded contexts. MVP needs minimal viable domain decomposition.</p>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#decision","title":"Decision","text":"<p>Use 3 bounded contexts: 1. Configuration Context: Input validation &amp; parsing 2. Workshop Operations Context: Simulation execution &amp; analysis (workshops, tracks, trains) 3. Analysis &amp; Reporting Context: Orchestration &amp; output</p>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#rationale","title":"Rationale","text":"<ul> <li>Time constraint: 5-week development with 3 developers</li> <li>Clear ownership: 1 context per developer</li> <li>Essential separation: Minimum viable domain boundaries</li> <li>Extensible: Can split into more contexts in full version</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#alternatives-considered","title":"Alternatives Considered","text":"<ul> <li>3 contexts \u2705 Chosen</li> <li>1 monolith: No domain separation</li> <li>More specialized contexts: Too complex for MVP timeline</li> <li>2 contexts: Insufficient separation</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#implementation-in-mvp","title":"Implementation in MVP","text":""},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#context-responsibilities","title":"Context Responsibilities","text":"<pre><code># Configuration Context\nclass ScenarioService:\n    def load_and_validate_scenario(self, source: Path) -&gt; Scenario:\n        # Handles all input validation and parsing\n\n# Workshop Operations Context  \nclass WorkshopOrchestrator:\n    def run(self, until: float) -&gt; None:\n        # Handles all simulation execution\n\n# Analytics Context\nclass KPICalculator:\n    def calculate_all_kpis(self, metrics: SimulationMetrics) -&gt; AllKPIs:\n        # Handles all metrics and reporting\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#context-integration","title":"Context Integration","text":"<pre><code># main.py - Context coordination\ndef main():\n    # 1. Configuration Context\n    scenario = scenario_service.load_and_validate_scenario(args.config)\n\n    # 2. Workshop Operations Context\n    orchestrator = WorkshopOrchestrator(sim, scenario)\n    orchestrator.run()\n\n    # 3. Analytics Context\n    kpis = kpi_calculator.calculate_all_kpis(orchestrator.get_metrics())\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#achieved","title":"Achieved","text":"<ul> <li>\u2705 Clear Responsibilities: Each context owns distinct domain area</li> <li>\u2705 Independent Development: 3 developers worked on separate contexts</li> <li>\u2705 Clean Interfaces: Simple data transfer between contexts</li> <li>\u2705 Testable: Each context tested independently</li> <li>\u2705 Extensible: Foundation for full version context splitting</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-011-3-bounded-contexts/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>configuration/</code> - Complete input processing context</li> <li><code>workshop_operations/</code> - Complete simulation execution context</li> <li><code>analytics/</code> - Complete metrics and reporting context</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/","title":"ADR-012: Direct Method Calls Between Contexts","text":"<p>Status: IMPLEMENTED - 2025-01-15</p>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#context","title":"Context","text":"<p>Need integration strategy between bounded contexts. Full version will use event-driven architecture.</p>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#decision","title":"Decision","text":"<p>Use direct method calls between contexts (synchronous).</p>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#rationale","title":"Rationale","text":"<ul> <li>Simplest approach: No message bus, no events</li> <li>Synchronous workflow: Matches file-based processing</li> <li>Easy debugging: Clear call chain</li> <li>Fast development: Minimal infrastructure</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#alternatives-considered","title":"Alternatives Considered","text":"<ul> <li>Direct calls \u2705 Chosen</li> <li>Event bus: Too complex for MVP</li> <li>Message queue: Infrastructure overhead</li> <li>REST API: Unnecessary for single process</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#implementation-in-mvp","title":"Implementation in MVP","text":""},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#direct-integration-pattern","title":"Direct Integration Pattern","text":"<pre><code># main.py - Synchronous context calls\ndef main():\n    # Direct method call to Configuration Context\n    scenario = scenario_service.load_and_validate_scenario(config_path)\n\n    # Direct instantiation with Workshop Operations Context\n    orchestrator = WorkshopOrchestrator(sim, scenario)\n    orchestrator.run()\n\n    # Direct method call to Analytics Context\n    metrics = orchestrator.get_metrics()\n    kpis = kpi_calculator.calculate_all_kpis(metrics)\n\n    # Direct call to export results\n    exporter.export_results(kpis, output_path)\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#interface-preparation","title":"Interface Preparation","text":"<pre><code># Interfaces prepared for future event-driven migration\nclass ScenarioServiceInterface(ABC):\n    @abstractmethod\n    def load_and_validate_scenario(self, source: Path) -&gt; Scenario: ...\n\nclass KPICalculatorInterface(ABC):\n    @abstractmethod\n    def calculate_all_kpis(self, metrics: SimulationMetrics) -&gt; AllKPIs: ...\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#achieved","title":"Achieved","text":"<ul> <li>\u2705 Fast Development: No message bus or event infrastructure needed</li> <li>\u2705 Easy Debugging: Clear call stack, simple error tracing</li> <li>\u2705 Synchronous Flow: Matches file-based processing workflow</li> <li>\u2705 Interface Ready: Abstract interfaces prepared for future migration</li> <li>\u2705 Simple Testing: Direct method calls easy to test</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-012-direct-method-calls/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>main.py</code> - Direct context coordination</li> <li>Context interfaces prepared for future event-driven architecture</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/","title":"ADR-013: Hexagonal Architecture for Data Sources","text":"<p>Status: IMPLEMENTED - 2025-01-16</p>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#context","title":"Context","text":"<p>Need to support multiple input formats (JSON, CSV) and prepare for future API integration while maintaining clean separation between domain logic and data access.</p>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#decision","title":"Decision","text":"<p>Implement hexagonal architecture specifically for the Configuration Context with data source adapters.</p>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#rationale","title":"Rationale","text":"<ul> <li>Multi-format support: CSV import requirement from stakeholders</li> <li>Future API readiness: Planned integration with external systems</li> <li>Testability: Easy to mock data sources for testing</li> <li>Maintainability: Clear separation between data access and business logic</li> <li>Extensibility: New data sources without changing core logic</li> <li>Type safety: Consistent DTOs across all adapters</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#implementation","title":"Implementation","text":"<ul> <li>DataSourcePort: Interface defining adapter contract</li> <li>JsonDataSourceAdapter: Wraps existing JSON functionality</li> <li>CsvDataSourceAdapter: New CSV directory support</li> <li>DataSourceFactory: Auto-detects source type</li> <li>ScenarioLoader: Orchestrates using adapters</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#alternatives-considered","title":"Alternatives Considered","text":"<ul> <li>Hexagonal Architecture \u2705 Chosen</li> <li>Direct CSV parsing: Tight coupling, hard to test</li> <li>Single JSON format: Doesn't meet CSV requirement</li> <li>Full hexagonal everywhere: Too complex for MVP timeline</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#implementation-in-mvp","title":"Implementation in MVP","text":""},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#hexagonal-architecture-components","title":"Hexagonal Architecture Components","text":"<pre><code># configuration/domain/ports/data_source_port.py\nclass DataSourcePort(ABC):\n    @abstractmethod\n    def load_scenario(self, source: Path) -&gt; ScenarioInputDTO: ...\n\n# configuration/infrastructure/adapters/\nclass JsonDataSourceAdapter(DataSourcePort):\n    def load_scenario(self, path: Path) -&gt; ScenarioInputDTO:\n        with open(path) as f:\n            return ScenarioInputDTO.model_validate(json.load(f))\n\nclass CsvDataSourceAdapter(DataSourcePort):\n    def load_scenario(self, directory: Path) -&gt; ScenarioInputDTO:\n        return self._load_from_csv_directory(directory)\n\n# configuration/application/services/scenario_service.py\nclass ScenarioService:\n    def __init__(self, data_source: DataSourcePort):\n        self._data_source = data_source  # Dependency injection\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#auto-detection-factory","title":"Auto-Detection Factory","text":"<pre><code>class DataSourceFactory:\n    @staticmethod\n    def create_adapter(source: Path) -&gt; DataSourcePort:\n        if source.is_file() and source.suffix == '.json':\n            return JsonDataSourceAdapter()\n        elif source.is_dir():\n            return CsvDataSourceAdapter()\n        else:\n            raise UnsupportedDataSourceError(f\"Unsupported source: {source}\")\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#achieved","title":"Achieved","text":"<ul> <li>\u2705 Multi-Format Support: JSON and CSV scenarios supported</li> <li>\u2705 Future-Ready: Easy to add REST API, database adapters</li> <li>\u2705 Testable: Mock adapters for unit testing</li> <li>\u2705 Maintainable: Clear separation between data access and business logic</li> <li>\u2705 Type Safety: Consistent DTOs across all adapters</li> <li>\u2705 Auto-Detection: Automatic format detection based on file/directory</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>configuration/domain/ports/data_source_port.py</code> - Port interface</li> <li><code>configuration/infrastructure/adapters/</code> - JSON and CSV adapters</li> <li><code>configuration/application/factories/data_source_factory.py</code> - Auto-detection</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-013-hexagonal-data-sources/#csv-directory-structure","title":"CSV Directory Structure","text":"<pre><code>csv_scenario/\n\u251c\u2500\u2500 scenario.csv      # Basic metadata (ID, dates, seed)\n\u251c\u2500\u2500 trains.csv        # Train schedule with arrival times\n\u251c\u2500\u2500 wagons.csv        # Wagon data linked to trains\n\u251c\u2500\u2500 workshops.csv     # Workshop configuration\n\u251c\u2500\u2500 tracks.csv        # Track definitions\n\u251c\u2500\u2500 routes.csv        # Route definitions\n\u2514\u2500\u2500 locomotives.csv   # Locomotive fleet data\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/","title":"ADR-014: Wagon Tracking and Queue Management Architecture","text":""},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#status","title":"Status","text":"<p>IMPLEMENTED - Resolved in MVP</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#context","title":"Context","text":"<p>PopUpSim had a fundamental issue with wagon tracking and queue management that caused wagons to be \"lost\" during the simulation workflow. The root cause was a dual-purpose <code>wagons_queue</code> that served both as a processing queue and a global wagon registry, leading to data inconsistency.</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#problem-resolved","title":"Problem (Resolved)","text":"<ul> <li>W07 stuck on retrofit track: Wagons moved to retrofitted track were not added back to <code>wagons_queue</code>, making them invisible to <code>move_to_parking</code> process</li> <li>Dual-purpose queue: <code>popupsim.wagons_queue</code> used for both processing workflow and wagon tracking</li> <li>Broken workflow chain: Train \u2192 Collection \u2192 Retrofit \u2192 Workshop \u2192 Retrofitted \u2192 \u274c LOST \u2192 Parking</li> <li>Data inconsistency: Wagons removed from queue during processing but needed for later stages</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#current-architecture-issues","title":"Current Architecture Issues","text":"<pre><code># Problematic dual-purpose usage\nself.wagons_queue: list[Wagon] = []  # Both processing queue AND global registry\n\n# Broken lookup in move_to_parking\nwagons_on_retrofitted = [\n    w for w in popupsim.wagons_queue  # \u274c Wagons not in queue anymore!\n    if w.track == retrofitted_track.id and w.status == WagonStatus.RETROFITTED\n]\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#decision","title":"Decision","text":"<p>IMPLEMENTED: Option 1 (Separation of Concerns - Registry + Queues) with SimPy store integration.</p> <p>The MVP implements a hybrid approach combining: - WagonStateManager: Handles wagon state transitions and tracking - SimPy Stores: Separate workflow coordination stores for each stage - TrackCapacityManager: Physical capacity management separate from workflow</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#implementation-in-mvp","title":"Implementation in MVP","text":"<pre><code>class WorkshopOrchestrator:\n    def __init__(self, sim, scenario):\n        # Separate stores for workflow coordination (no dual-purpose queue)\n        self.retrofitted_wagons_ready = sim.create_store()\n        self.wagons_ready_for_stations = {}\n        self.wagons_completed = {}\n\n        # State management (replaces dual-purpose wagons_queue)\n        self.wagon_state = WagonStateManager()\n        self.track_capacity = TrackCapacityManager()\n\n    def put_wagon_if_fits_retrofitted(self, wagon):\n        \"\"\"Capacity-validated workflow coordination.\"\"\"\n        if self.track_capacity.can_add_wagon(track_id, wagon.length):\n            yield self.retrofitted_wagons_ready.put(wagon)\n            return True\n        return False\n</code></pre> <p>Result: No more lost wagons - complete workflow chain with proper separation of concerns.</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#decision-options-evaluated","title":"Decision Options (Evaluated)","text":""},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#option-1-separation-of-concerns-registry-queues","title":"Option 1: Separation of Concerns - Registry + Queues","text":"<p>Principle: Single Responsibility - separate tracking from workflow coordination</p> <pre><code>class WagonTracker:\n    \"\"\"Single responsibility: Track all wagons in system\"\"\"\n    def __init__(self):\n        self.registry: dict[str, Wagon] = {}  # Never remove wagons\n\n    def get_wagons_by_track(self, track_id: str) -&gt; list[Wagon]: ...\n    def get_wagons_by_status(self, status: WagonStatus) -&gt; list[Wagon]: ...\n\nclass WorkflowQueues:\n    \"\"\"Single responsibility: Manage processing workflows\"\"\"\n    def __init__(self, sim):\n        self.collection_queue: list[Wagon] = []\n        self.retrofit_queue: list[Wagon] = []\n        self.retrofitted_ready = sim.create_store()  # For move_to_parking\n        self.parking_queue: list[Wagon] = []\n</code></pre> <p>Pros: - Clear separation of concerns - No data loss - registry never loses wagons - Easy debugging - clear data ownership - Solves W07 problem directly</p> <p>Cons: - More complexity - multiple data structures - Need to maintain consistency across structures</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#option-2-event-driven-state-machine","title":"Option 2: Event-Driven State Machine","text":"<p>Principle: Reactive architecture with event-driven workflow coordination</p> <pre><code>class WagonEventManager:\n    def __init__(self, sim):\n        self.wagon_states: dict[str, Wagon] = {}\n        self.wagon_events: dict[WagonStatus, SimPy.Store] = {\n            WagonStatus.RETROFITTED: sim.create_store(),\n            WagonStatus.READY_FOR_PARKING: sim.create_store(),\n        }\n\n    def handle_wagon_retrofitted(self, wagon: Wagon) -&gt; None:\n        self.wagon_states[wagon.id] = wagon\n        self.wagon_events[WagonStatus.RETROFITTED].put(wagon)\n</code></pre> <p>Pros: - Reactive - no polling required - Clear workflow triggers - Natural event integration - Scalable architecture</p> <p>Cons: - More complex event handling - Still needs state storage for analytics - Higher learning curve</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#option-3-single-registry-status-based-queries","title":"Option 3: Single Registry + Status-Based Queries","text":"<p>Principle: Single source of truth with query-based access</p> <pre><code>class WagonRegistry:\n    def __init__(self):\n        self.all_wagons: dict[str, Wagon] = {}\n\n    def get_wagons_by_status_and_track(self, status: WagonStatus, track_id: str) -&gt; list[Wagon]:\n        return [w for w in self.all_wagons.values() \n                if w.status == status and w.track == track_id]\n</code></pre> <p>Pros: - Simple - single source of truth - No data synchronization issues - Easy to understand and maintain</p> <p>Cons: - O(n) queries - potential performance issues - No workflow coordination mechanism - Polling-based approach</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#option-4-track-based-wagon-management","title":"Option 4: Track-Based Wagon Management","text":"<p>Principle: Each track manages its own wagons</p> <pre><code>class TrackBasedWagonManager:\n    def __init__(self):\n        self.track_wagons: dict[str, list[Wagon]] = {\n            \"collection\": [],\n            \"retrofit\": [],\n            \"retrofitted\": [],\n            \"parking\": []\n        }\n\n    def move_wagon(self, wagon: Wagon, from_track: str, to_track: str): ...\n</code></pre> <p>Pros: - Natural organization by physical location - Efficient lookups by track - Mirrors real-world track organization</p> <p>Cons: - Need to maintain consistency across moves - Complex cross-track operations - Potential data duplication</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#option-5-resource-state-machines","title":"Option 5: Resource State Machines","text":"<p>Principle: Explicit state management with automatic transitions and side effects</p> <pre><code>class WagonStateMachine:\n    states = [\n        'ARRIVING', 'SELECTING', 'ON_COLLECTION', 'MOVING_TO_RETROFIT',\n        'ON_RETROFIT', 'RETROFITTING', 'RETROFITTED', 'MOVING_TO_PARKING', 'PARKING'\n    ]\n\n    def on_enter_RETROFITTED(self, wagon: Wagon):\n        # Automatic queue management\n        self.orchestrator.parking_queue.put(wagon)\n        # Automatic event firing\n        self.metrics.record_event(WagonRetrofittedEvent.create(wagon_id=wagon.id))\n\n    def can_move_to_retrofit(self, wagon: Wagon) -&gt; bool:\n        return (self.workshop_capacity.has_available_stations() and\n                self.track_capacity.can_add_wagon(wagon.length))\n</code></pre> <p>Pros: - Explicit state management - no \"lost\" wagons - Automatic queue coordination - Built-in validation with guards - Natural event integration - Excellent debugging capabilities - Prevents invalid state transitions</p> <p>Cons: - Added complexity and abstraction - Learning curve for state machine concepts - Potential over-engineering for simple workflows</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#analytics-considerations","title":"Analytics Considerations","text":"<p>All options must support analytics requirements:</p> <pre><code># Analytics needs access to:\nwagon.retrofit_start_time    # When did retrofit begin?\nwagon.retrofit_end_time      # When did it complete?  \nwagon.waiting_time          # How long did wagon wait?\nwagon.track                 # Where is wagon now?\nwagon.status               # What state is it in?\n</code></pre> <p>Analytics Compatibility: - Option 1: \u2705 Complete state in registry - Option 2: \u26a0\ufe0f Needs separate state storage - Option 3: \u2705 Direct state access - Option 4: \u2705 State distributed across tracks - Option 5: \u2705 State in machines + automatic events</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#implementation-phases","title":"Implementation Phases","text":""},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#mvp-phase-immediate","title":"MVP Phase (Immediate)","text":"<p>Goal: Solve W07 problem with minimal changes - Recommended: Option 1 (Registry + Queues) or Option 5 (Wagon State Machine) - Rationale: Clear separation, solves immediate problem, foundation for future</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#post-mvp-phase-enhanced","title":"Post-MVP Phase (Enhanced)","text":"<p>Goal: Improved analytics and workflow coordination - Recommended: Hybrid of Option 1 + Option 2 (Registry + Events) - Add: Enhanced event projections, real-time analytics</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#full-version-enterprise","title":"Full Version (Enterprise)","text":"<p>Goal: Scalable, enterprise-grade architecture - Recommended: Event Sourcing + CQRS + State Machines - Features: Time-travel debugging, what-if analysis, microservices ready</p>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#migration-strategy","title":"Migration Strategy","text":"<pre><code>Phase 1: MVP \u2192 Registry + Queues (solve W07)\nPhase 2: Enhanced \u2192 Add event projections  \nPhase 3: Full \u2192 Event sourcing + CQRS\nPhase 4: Enterprise \u2192 Microservices + real-time analytics\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#open-questions","title":"Open Questions","text":"<ol> <li>Performance vs. Simplicity: How important is O(1) lookup performance vs. code simplicity?</li> <li>State Machine Scope: Should state machines apply to all resources or just critical ones (Wagon, Locomotive)?</li> <li>Event Integration: How tightly should new architecture integrate with existing event system?</li> <li>Migration Path: Should we implement incrementally or do a complete refactor?</li> <li>Testing Strategy: How do we ensure no regressions during architecture changes?</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#implementation-results","title":"Implementation Results","text":""},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#achieved-in-mvp","title":"Achieved in MVP","text":"<ul> <li>\u2705 W07 Problem Solved: Wagons no longer get lost during workflow</li> <li>\u2705 Separation of Concerns: WagonStateManager handles state, SimPy stores handle workflow</li> <li>\u2705 No Dual-Purpose Queue: Clear separation between tracking and coordination</li> <li>\u2705 Complete Analytics: All wagon states tracked for metrics and visualization</li> <li>\u2705 Event-Driven Architecture: SimPy stores eliminate polling and manual searches</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>workshop_operations/application/orchestrator.py</code> - Workflow coordination with separate stores</li> <li><code>workshop_operations/domain/services/wagon_operations.py</code> - WagonStateManager and WagonSelector</li> <li><code>analytics/domain/collectors/wagon_collector.py</code> - Wagon state tracking for analytics</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-014-wagon-tracking-queue-management/#references","title":"References","text":"<ul> <li>Current issue: W07 wagon stuck on retrofit track</li> <li>Existing events: <code>WagonDeliveredEvent</code>, <code>WagonRetrofittedEvent</code></li> <li>Analytics requirements: KPI calculation, throughput metrics</li> <li>MVP constraints: Direct context calls, file-based configuration</li> </ul> <p>Authors: Development Team Date: 2024-12-19 Review Date: TBD</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/","title":"ADR-015: SimPy Workshop Modeling and Queue Coordination","text":""},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#status","title":"Status","text":"<p>IMPLEMENTED - Resolved in MVP</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#context","title":"Context","text":"<p>PopUpSim had a hybrid approach to SimPy usage - some components used SimPy resources and stores effectively, while others relied on manual queue management and polling. This inconsistency led to the W07 wagon tracking issue and required better SimPy integration.</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#current-simpy-usage-analysis","title":"Current SimPy Usage Analysis","text":"<p>\u2705 Already Using SimPy Well: <pre><code># Workshop stations as SimPy Resources\nself.resources[track_id] = sim.create_resource(capacity=workshop.retrofit_stations)\n\n# Workflow coordination with SimPy Stores\nself.wagons_ready_for_stations[track_id] = sim.create_store(capacity=1000)\nself.wagons_completed[track_id] = sim.create_store(capacity=1000)\n\n# Proper resource blocking in process_single_wagon\nwith workshop_resource.request() as station_req:\n    yield station_req  # Blocks until station available\n</code></pre></p> <p>\u274c Missing SimPy Opportunities: <pre><code># W07 problem: No SimPy Store for retrofitted wagons\n# move_to_parking searches wagons_queue instead of using SimPy coordination\nwagons_on_retrofitted = [\n    w for w in popupsim.wagons_queue  # Manual search + polling\n    if w.track == retrofitted_track.id and w.status == WagonStatus.RETROFITTED\n]\n\n# Polling-based approach instead of event-driven\nif not wagons_on_retrofitted:\n    yield popupsim.sim.delay(1.0)  # Inefficient polling\n    continue\n</code></pre></p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#root-cause","title":"Root Cause","text":"<p>The fundamental issue is incomplete SimPy workflow coordination. We have SimPy stores for some workflow stages but not others, creating gaps where manual queue management and polling are required.</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#decision","title":"Decision","text":"<p>IMPLEMENTED: Option 1 (Minimal SimPy Store Fix) - Added missing SimPy store to complete the workflow chain.</p> <p>The MVP implements complete SimPy workflow coordination:</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#implementation-in-mvp","title":"Implementation in MVP","text":"<pre><code>class WorkshopOrchestrator:\n    def __init__(self, sim, scenario):\n        # Complete SimPy store workflow (no polling)\n        self.retrofitted_wagons_ready = sim.create_store()  # \u2705 Added missing store\n        self.wagons_ready_for_stations = {track_id: sim.create_store() for track_id in workshops}\n        self.wagons_completed = {track_id: sim.create_store() for track_id in workshops}\n\n        # SimPy Resources for workshop stations\n        self.workshop_capacity = WorkshopCapacityManager(sim, workshops)\n\ndef move_to_parking(popupsim):\n    while True:\n        # \u2705 Event-driven coordination (no polling)\n        wagon = yield from popupsim.get_wagon_from_retrofitted()\n        # Process wagon...\n</code></pre> <p>Result: Complete event-driven workflow with no polling delays.</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#decision-options-evaluated","title":"Decision Options (Evaluated)","text":""},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#option-1-minimal-simpy-store-fix","title":"Option 1: Minimal SimPy Store Fix","text":"<p>Principle: Add missing SimPy store to complete the workflow chain</p> <pre><code>class WorkshopOrchestrator:\n    def __init__(self, sim, scenario):\n        # Add missing store for retrofitted wagons\n        self.retrofitted_wagons_ready = sim.create_store(capacity=1000)\n\n# In _pickup_track_batches - after moving to retrofitted track:\nfor wagon in batch:\n    popupsim.track_capacity.add_wagon(retrofitted_track.id, wagon.length)\n    popupsim.wagon_state.complete_arrival(wagon, retrofitted_track.id, WagonStatus.RETROFITTED)\n    # \u2705 Add to SimPy store for move_to_parking\n    yield popupsim.retrofitted_wagons_ready.put(wagon)\n\n# In move_to_parking - use SimPy store instead of searching wagons_queue:\ndef move_to_parking(popupsim: WorkshopOrchestrator) -&gt; Generator[Any]:\n    while True:\n        # \u2705 Block until wagons available (no polling!)\n        wagon = yield popupsim.retrofitted_wagons_ready.get()\n        # Process wagon for parking...\n</code></pre> <p>Pros: - Solves W07 problem immediately (5 lines of code) - No polling - event-driven coordination - Consistent with existing SimPy usage - Minimal risk - small, focused change</p> <p>Cons: - Doesn't address broader architectural issues - Still maintains dual-purpose wagons_queue - Partial solution to larger problem</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#option-2-complete-simpy-workflow-stores","title":"Option 2: Complete SimPy Workflow Stores","text":"<p>Principle: Replace wagons_queue with stage-specific SimPy stores throughout</p> <pre><code>class SimPyWorkshopFlow:\n    def __init__(self, sim):\n        # Stage-specific stores (replaces dual-purpose wagons_queue)\n        self.collection_ready = sim.create_store(capacity=100)\n        self.retrofit_ready = sim.create_store(capacity=100)\n        self.workshop_input = sim.create_store(capacity=100)\n        self.workshop_output = sim.create_store(capacity=100)\n        self.retrofitted_ready = sim.create_store(capacity=100)  # Solves W07\n        self.parking_ready = sim.create_store(capacity=100)\n\n# Natural workflow chain:\n# Train \u2192 collection_ready \u2192 retrofit_ready \u2192 workshop_input \u2192 \n# workshop_output \u2192 retrofitted_ready \u2192 parking_ready\n</code></pre> <p>Pros: - Complete SimPy integration - no manual queue management - Event-driven throughout - no polling anywhere - Natural workflow modeling - Automatic capacity management - Solves W07 and prevents similar issues</p> <p>Cons: - Larger refactor - affects multiple components - Need to migrate existing wagons_queue usage - More complex migration path</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#option-3-simpy-workshop-entity-model","title":"Option 3: SimPy Workshop Entity Model","text":"<p>Principle: Model workshop as complete SimPy entity with input/output queues</p> <pre><code>class SimPyWorkshop:\n    \"\"\"Model entire workshop workflow with SimPy primitives\"\"\"\n    def __init__(self, sim, workshop_config):\n        # Input queue (wagons waiting for retrofit)\n        self.input_queue = sim.create_store(capacity=workshop_config.max_input)\n\n        # Processing stations (SimPy Resources)\n        self.stations = sim.create_resource(capacity=workshop_config.retrofit_stations)\n\n        # Output queue (retrofitted wagons ready for pickup)\n        self.output_queue = sim.create_store(capacity=workshop_config.max_output)\n\n        # Start continuous workshop process\n        sim.run_process(self._workshop_process)\n\n    def _workshop_process(self) -&gt; Generator:\n        \"\"\"Continuous workshop processing\"\"\"\n        while True:\n            # Get wagon from input\n            wagon = yield self.input_queue.get()\n\n            # Request station\n            with self.stations.request() as station:\n                yield station\n                # Process wagon\n                yield self.sim.delay(self.retrofit_time)\n                wagon.status = WagonStatus.RETROFITTED\n\n            # Send to output\n            yield self.output_queue.put(wagon)\n\n# Usage:\nworkshop = SimPyWorkshop(sim, workshop_config)\nyield workshop.input_queue.put(wagon)  # Send wagon to workshop\nretrofitted_wagon = yield workshop.output_queue.get()  # Get completed wagon\n</code></pre> <p>Pros: - Most natural SimPy modeling approach - Encapsulates workshop behavior completely - Automatic internal workflow management - Easy to test and reason about - Scales to complex workshop configurations</p> <p>Cons: - Significant architectural change - Need to redesign workshop interactions - Higher complexity for simple scenarios</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#option-4-hybrid-simpy-manual-approach","title":"Option 4: Hybrid SimPy + Manual Approach","text":"<p>Principle: Use SimPy where it adds value, manual management where simpler</p> <pre><code># SimPy for resource contention and blocking\nworkshop_resource = sim.create_resource(capacity=stations)\nwith workshop_resource.request() as req:\n    yield req\n\n# SimPy for workflow coordination\nretrofitted_ready = sim.create_store()\nyield retrofitted_ready.put(wagon)\n\n# Manual for simple state tracking\nwagon_registry: dict[str, Wagon] = {}  # Simple lookup\n</code></pre> <p>Pros: - Pragmatic approach - best tool for each job - Leverages SimPy strengths without over-engineering - Easier migration path - Maintains flexibility</p> <p>Cons: - Mixed paradigms - less consistent - Need to decide SimPy vs manual for each case - Potential for inconsistencies</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#current-simpy-infrastructure-assessment","title":"Current SimPy Infrastructure Assessment","text":"<p>Existing SimPy Components: - \u2705 <code>SimulationAdapter</code> - Good abstraction over SimPy - \u2705 <code>ResourcePool</code> - Uses SimPy Store for locomotive management - \u2705 <code>WorkshopCapacityManager</code> - Uses SimPy Resources for stations - \u2705 Workflow stores - <code>wagons_ready_for_stations</code>, <code>wagons_completed</code></p> <p>Missing SimPy Components: - \u274c Store for retrofitted wagons (causes W07 problem) - \u274c Consistent store-based workflow throughout - \u274c SimPy-based track capacity coordination</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#performance-considerations","title":"Performance Considerations","text":"<p>SimPy Store Benefits: - O(1) put/get operations - Automatic blocking/unblocking - Built-in capacity management - No polling overhead</p> <p>Manual Queue Drawbacks: - O(n) search operations (<code>wagons_queue</code> filtering) - Polling delays (1.0 second intervals) - Manual capacity tracking - Race condition potential</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#integration-with-existing-events","title":"Integration with Existing Events","text":"<p>All options must maintain compatibility with existing event system: <pre><code># Events still fired regardless of queue mechanism\nevent = WagonRetrofittedEvent.create(wagon_id=wagon.id)\npopupsim.metrics.record_event(event)\n</code></pre></p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#migration-strategies","title":"Migration Strategies","text":""},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#strategy-a-incremental-simpy-enhancement","title":"Strategy A: Incremental SimPy Enhancement","text":"<ol> <li>Phase 1: Add <code>retrofitted_wagons_ready</code> store (solve W07)</li> <li>Phase 2: Replace remaining manual queues with SimPy stores</li> <li>Phase 3: Evaluate full SimPy workshop modeling</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#strategy-b-complete-simpy-refactor","title":"Strategy B: Complete SimPy Refactor","text":"<ol> <li>Phase 1: Design complete SimPy workflow architecture</li> <li>Phase 2: Implement new SimPy-based components</li> <li>Phase 3: Migrate existing code to new architecture</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#strategy-c-hybrid-approach","title":"Strategy C: Hybrid Approach","text":"<ol> <li>Phase 1: Add SimPy stores where they solve specific problems</li> <li>Phase 2: Keep manual management where it's simpler</li> <li>Phase 3: Optimize based on performance and maintainability</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#open-questions","title":"Open Questions","text":"<ol> <li>Scope: Should we fix just W07 or redesign the entire workflow coordination?</li> <li>Performance: How important is eliminating polling vs. code simplicity?</li> <li>SimPy Modeling: Should workshops be modeled as complete SimPy entities?</li> <li>Migration Risk: What's the acceptable risk level for workflow changes?</li> <li>Testing: How do we ensure no regressions during SimPy migration?</li> <li>Capacity Management: Should track capacity also use SimPy resources?</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#recommendations","title":"Recommendations","text":""},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#for-immediate-w07-fix","title":"For Immediate W07 Fix","text":"<p>Option 1 (Minimal SimPy Store Fix) - Low risk, immediate solution</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#for-long-term-architecture","title":"For Long-term Architecture","text":"<p>Option 2 (Complete SimPy Workflow Stores) - Better architectural consistency</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#for-advanced-modeling","title":"For Advanced Modeling","text":"<p>Option 3 (SimPy Workshop Entity Model) - Most natural SimPy approach</p>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#implementation-results","title":"Implementation Results","text":""},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#achieved-in-mvp","title":"Achieved in MVP","text":"<ul> <li>\u2705 Complete SimPy Integration: All workflow stages use SimPy stores</li> <li>\u2705 No Polling: Event-driven coordination throughout the system</li> <li>\u2705 W07 Problem Solved: <code>retrofitted_wagons_ready</code> store added for complete workflow</li> <li>\u2705 Resource Management: SimPy Resources for workshop stations with proper blocking</li> <li>\u2705 Performance: Eliminated 1-second polling delays, immediate event response</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>workshop_operations/application/orchestrator.py</code> - Complete SimPy store workflow</li> <li><code>workshop_operations/infrastructure/resources/workshop_capacity_manager.py</code> - SimPy Resources</li> <li><code>workshop_operations/infrastructure/simulation/simpy_adapter.py</code> - SimPy abstraction layer</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-015-simpy-workshop-modeling/#references","title":"References","text":"<ul> <li>Current W07 issue: Wagon stuck on retrofit track due to missing SimPy store</li> <li>Existing SimPy usage: <code>WorkshopCapacityManager</code>, <code>ResourcePool</code>, workflow stores</li> <li>SimPy documentation: Resources, Stores, and Process coordination</li> <li>Related: ADR-001 (Wagon Tracking and Queue Management Architecture)</li> </ul> <p>Authors: Development Team Date: 2024-12-19 Review Date: TBD</p>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/","title":"ADR-016: Capacity Management Integration for SimPy Stores","text":""},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#status","title":"Status","text":"<p>IMPLEMENTED - Resolved in MVP</p>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#context","title":"Context","text":"<p>PopUpSim had dual capacity management systems: - TrackCapacityManager: Length-based physical capacity (75m track, wagons 10-20m each) - SimPy Stores: Count-based workflow coordination (unlimited capacity)</p> <p>This created potential inconsistencies where SimPy stores could accept wagons that exceeded physical track capacity.</p>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#current-implementation","title":"Current Implementation","text":"<pre><code># Physical capacity (correct)\nif track_capacity.can_add_wagon(\"retrofitted\", wagon.length):\n    track_capacity.add_wagon(\"retrofitted\", wagon.length)\n\n# Workflow coordination (separate)\nyield retrofitted_wagons_ready.put(wagon)\n</code></pre>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#problem","title":"Problem","text":"<p>No automatic validation between physical capacity and SimPy workflow stores.</p>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#decision","title":"Decision","text":"<p>IMPLEMENTED: Option A (SimPy Store with Capacity Validation) - Added validation wrapper around existing SimPy stores.</p> <p>The MVP implements capacity validation for all SimPy store operations:</p>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#implementation-in-mvp","title":"Implementation in MVP","text":"<pre><code>class WorkshopOrchestrator:\n    def put_wagon_if_fits_retrofitted(self, wagon: Wagon) -&gt; Generator[Any, Any, bool]:\n        \"\"\"Put wagon in retrofitted store only if track has physical capacity.\"\"\"\n        retrofitted_track_id = self.retrofitted_tracks[0].id\n        if self.track_capacity.can_add_wagon(retrofitted_track_id, wagon.length):\n            # \u2705 Capacity validation before SimPy store operation\n            yield self.retrofitted_wagons_ready.put(wagon)\n            return True\n        logger.warning('Cannot add wagon %s - track %s full', wagon.id, retrofitted_track_id)\n        return False\n\n    def get_wagon_from_retrofitted(self) -&gt; Generator[Any, Any, Wagon]:\n        \"\"\"Get wagon from retrofitted store and update capacity tracking.\"\"\"\n        wagon = yield self.retrofitted_wagons_ready.get()\n        # Physical capacity updated by transport job\n        return wagon\n</code></pre> <p>Result: No capacity inconsistencies - physical capacity always validated before SimPy operations.</p>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#decision-options-evaluated","title":"Decision Options (Evaluated)","text":""},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#option-a-simpy-store-with-capacity-validation","title":"Option A: SimPy Store with Capacity Validation","text":"<p>Approach: Add validation wrapper around existing SimPy stores</p> <pre><code>def put_wagon_if_fits(self, store_name: str, track_id: str, wagon: Wagon) -&gt; Generator:\n    \"\"\"Put wagon in store only if track has physical capacity.\"\"\"\n    if self.track_capacity.can_add_wagon(track_id, wagon.length):\n        self.track_capacity.add_wagon(track_id, wagon.length)\n        yield getattr(self, store_name).put(wagon)\n        return True\n    # Handle capacity exceeded (wait/reject)\n    return False\n</code></pre> <p>Pros: - \u2705 Minimal code changes - \u2705 Reuses existing TrackCapacityManager - \u2705 Maintains current SimPy store behavior - \u2705 Easy to implement incrementally</p> <p>Cons: - \u26a0\ufe0f Manual validation required at each put() - \u26a0\ufe0f Easy to forget validation in new code - \u26a0\ufe0f Dual responsibility (capacity + workflow)</p>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#option-b-custom-length-aware-store","title":"Option B: Custom Length-Aware Store","text":"<p>Approach: Create domain-specific store that encapsulates both concerns</p> <pre><code>class LengthAwareStore:\n    def __init__(self, sim: SimulationAdapter, track_capacity: TrackCapacityManager, track_id: str):\n        self._store = sim.create_store()\n        self._capacity = track_capacity\n        self._track_id = track_id\n\n    def put(self, wagon: Wagon) -&gt; Generator:\n        if not self._capacity.can_add_wagon(self._track_id, wagon.length):\n            raise CapacityExceededError(f\"Track {self._track_id} full\")\n        self._capacity.add_wagon(self._track_id, wagon.length)\n        return self._store.put(wagon)\n\n    def get(self) -&gt; Generator:\n        wagon = yield self._store.get()\n        self._capacity.remove_wagon(self._track_id, wagon.length)\n        return wagon\n</code></pre> <p>Pros: - \u2705 Automatic capacity validation - \u2705 Single responsibility per store - \u2705 Type-safe domain modeling - \u2705 Impossible to forget validation</p> <p>Cons: - \u26a0\ufe0f More complex implementation - \u26a0\ufe0f New abstraction to maintain - \u26a0\ufe0f Requires refactoring existing code</p>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#analysis","title":"Analysis","text":""},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#implementation-effort","title":"Implementation Effort","text":"<ul> <li>Option A: Low (wrapper functions)</li> <li>Option B: Medium (new class + refactoring)</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#maintainability","title":"Maintainability","text":"<ul> <li>Option A: Manual validation prone to errors</li> <li>Option B: Automatic validation, harder to misuse</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#domain-alignment","title":"Domain Alignment","text":"<ul> <li>Option A: Procedural approach</li> <li>Option B: Object-oriented domain modeling</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#risk-assessment","title":"Risk Assessment","text":"<ul> <li>Option A: Risk of missing validation calls</li> <li>Option B: Risk of over-engineering</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#recommendation","title":"Recommendation","text":"<p>Option A (SimPy Store with Capacity Validation) for the following reasons:</p> <ol> <li>Pragmatic: Solves the immediate problem with minimal changes</li> <li>Incremental: Can be implemented store-by-store</li> <li>Familiar: Uses existing patterns and components</li> <li>Testable: Easy to verify validation behavior</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#implementation-strategy","title":"Implementation Strategy","text":"<ol> <li>Create validation helper functions</li> <li>Update <code>move_to_parking</code> first (highest risk area)</li> <li>Add validation to other store operations incrementally</li> <li>Consider Option B if validation becomes too complex</li> </ol>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#consequences","title":"Consequences","text":""},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#positive","title":"Positive","text":"<ul> <li>Quick resolution of capacity inconsistency issue</li> <li>Maintains existing SimPy integration patterns</li> <li>Low risk of breaking current functionality</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#negative","title":"Negative","text":"<ul> <li>Requires discipline to use validation consistently</li> <li>Manual process prone to human error</li> <li>May need refactoring to Option B later if complexity grows</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#implementation-results","title":"Implementation Results","text":""},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#achieved-in-mvp","title":"Achieved in MVP","text":"<ul> <li>\u2705 W07 Problem Solved: Wagons no longer get lost between retrofit and parking</li> <li>\u2705 Complete Workflow Chain: Train \u2192 Collection \u2192 Retrofit \u2192 Workshop \u2192 Retrofitted \u2192 Parking</li> <li>\u2705 Separation of Concerns: WagonStateManager for tracking, SimPy stores for workflow</li> <li>\u2705 Event-Driven Coordination: No polling, all SimPy store-based coordination</li> <li>\u2705 Capacity Integration: Physical capacity validated before all store operations</li> </ul>"},{"location":"mvp/architecture/decisions/ADR-016-capacity-management-integration/#files-implementing-this-decision","title":"Files Implementing This Decision","text":"<ul> <li><code>workshop_operations/application/orchestrator.py</code> - Main workflow coordination</li> <li><code>workshop_operations/domain/services/wagon_operations.py</code> - WagonStateManager</li> <li><code>workshop_operations/infrastructure/resources/track_capacity_manager.py</code> - Capacity management</li> </ul>"},{"location":"mvp/development/","title":"MVP Development Documentation","text":""},{"location":"mvp/development/#overview","title":"Overview","text":"<p>This folder contains developer-focused documentation for implementing the PopUpSim MVP. These documents complement the main architecture documentation with implementation details, code examples, and development guidelines.</p>"},{"location":"mvp/development/#documentation-structure","title":"Documentation Structure","text":""},{"location":"mvp/development/#core-documents","title":"Core Documents","text":"<ol> <li>MVP Overview - System overview, goals, constraints</li> <li>Bounded Contexts - 4 MVP contexts and their responsibilities</li> <li>Domain Model - Domain entities, value objects, services</li> <li>SimPy Integration - Discrete event simulation integration</li> <li>Data Flow - Data flow through system</li> <li>Technology Stack - Detailed technology decisions</li> <li>File Formats - JSON/CSV format specifications</li> <li>Testing Strategy - Testing approach and examples</li> <li>Deployment - Deployment and installation</li> <li>Migration Path - Path from MVP to full version</li> <li>Domain Processes - Process flows, state machines, business rules (TEMPLATE)</li> </ol>"},{"location":"mvp/development/#reference-documents","title":"Reference Documents","text":"<ul> <li>Business Rules - Consolidated business rules</li> <li>Configuration Validation - Pydantic validation patterns</li> <li>Domain Models - Detailed domain model reference</li> <li>Examples - Real example scenarios</li> </ul>"},{"location":"mvp/development/#main-architecture-documentation","title":"Main Architecture Documentation","text":"<p>For complete architecture documentation, see: - MVP Architecture - arc42 architecture documentation (12 sections) - Requirements - User stories and requirements</p>"},{"location":"mvp/development/#key-differences","title":"Key Differences","text":"Aspect Architecture Docs Development Docs Audience Stakeholders, architects Developers, implementers Focus Decisions, structure, quality Implementation, code, patterns Format arc42 template Developer guides Code Examples Conceptual Detailed with type hints Status Complete Complete"},{"location":"mvp/development/#development-guidelines","title":"Development Guidelines","text":""},{"location":"mvp/development/#code-standards","title":"Code Standards","text":"<ul> <li>Python 3.13+ required</li> <li>Type hints mandatory on all functions/methods</li> <li>Pydantic 2.0+ for data validation</li> <li>Ruff for formatting and linting</li> <li>MyPy for type checking</li> <li>Pytest for testing</li> </ul>"},{"location":"mvp/development/#project-rules","title":"Project Rules","text":"<p>See <code>.amazonq/rules/project-rules.md</code> in the repository root for complete coding standards.</p>"},{"location":"mvp/development/#quick-start-for-developers","title":"Quick Start for Developers","text":"<ol> <li>Read architecture first: Start with MVP Architecture Overview</li> <li>Understand contexts: Review Bounded Contexts</li> <li>Study domain model: Check Domain Model</li> <li>Review actual code: See <code>popupsim/backend/src/</code> for implementation</li> <li>Run tests: Use <code>uv run pytest</code> to verify setup</li> </ol>"},{"location":"mvp/development/#documentation-status","title":"Documentation Status","text":"Document Status Notes Core Documents (1-11) \u2705 Complete Updated for 4 contexts Reference Documents \u2705 Complete Updated for 4 contexts Code Examples \u2705 Actual implementation Real code from codebase"},{"location":"mvp/development/#implementation-status","title":"Implementation Status","text":"Component Status Location Configuration Context \u2705 Implemented <code>contexts/configuration/</code> Retrofit Workflow Context \u2705 Implemented <code>contexts/retrofit_workflow/</code> Railway Infrastructure Context \u2705 Implemented <code>contexts/railway_infrastructure/</code> External Trains Context \u2705 Implemented <code>contexts/external_trains/</code> SimPy Integration \u2705 Implemented <code>contexts/shared/infrastructure/simpy_adapter.py</code> Resource Management \u2705 Implemented <code>contexts/retrofit_workflow/infrastructure/resource_managers/</code> Metrics Collection \u2705 Implemented <code>contexts/retrofit_workflow/infrastructure/metrics/</code> 4 Process Coordinators \u2705 Implemented <code>contexts/retrofit_workflow/application/coordinators/</code> Testing \u2705 Complete <code>popupsim/backend/tests/</code> (374 tests passing)"},{"location":"mvp/development/#contributing","title":"Contributing","text":"<p>When updating these development docs: 1. Keep consistent with main architecture 2. Include type hints in all code examples 3. Reference actual implementation files 4. Add cross-references to architecture sections 5. Use English language 6. Follow minimal code principle (no verbose examples)</p>"},{"location":"mvp/development/#questions","title":"Questions?","text":"<ul> <li>Architecture questions \u2192 See Architecture Documentation</li> <li>Implementation questions \u2192 Check actual code in <code>popupsim/backend/src/</code></li> <li>Requirements questions \u2192 See Use Cases</li> </ul>"},{"location":"mvp/development/01-mvp-overview/","title":"1. MVP System Overview","text":""},{"location":"mvp/development/01-mvp-overview/#11-mvp-scope-and-goals","title":"1.1 MVP Scope and Goals","text":""},{"location":"mvp/development/01-mvp-overview/#primary-goal","title":"Primary Goal","text":"<p>Functional prototype for Pop-Up workshop simulation that solves real business problems and serves as foundation for community development.</p>"},{"location":"mvp/development/01-mvp-overview/#mvp-user-stories-priority-1","title":"MVP User Stories (Priority 1)","text":"<ul> <li>US-001: Develop standardized Pop-Up workshops (Templates)</li> <li>US-002: Estimate throughput for workshop layouts</li> <li>US-003: Import infrastructure data (CSV/JSON)</li> <li>US-004: Assess capacity for planned workshop</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#not-in-mvp-scope","title":"Not in MVP Scope","text":"<ul> <li>US-005-008: Advanced visualization and real-time features</li> <li>Web UI: CLI-only, no web interface</li> <li>Database: File-based configuration only</li> <li>Advanced Security: Local application without authentication</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#12-system-context","title":"1.2 System Context","text":"<p>Note: See Architecture Section 3 for detailed context diagram.</p> <pre><code>graph TB\n    subgraph \"PopUpSim MVP System\"\n        PopUpSim[PopUpSim MVP&lt;br/&gt;Pop-Up Workshop Simulation]\n    end\n\n    subgraph \"Users\"\n        Planner[Strategic Planner&lt;br/&gt;Workshop Templates]\n        DetailPlanner[Company Planner&lt;br/&gt;Capacity Assessment]\n    end\n\n    subgraph \"External Systems\"\n        Files[Configuration Files&lt;br/&gt;JSON, CSV]\n        ExtSys[External Systems&lt;br/&gt;Infrastructure Data]\n        Results[Result Export&lt;br/&gt;CSV, PNG]\n    end\n\n    Planner --&gt;|Creates Templates| PopUpSim\n    DetailPlanner --&gt;|Configures Scenarios| PopUpSim\n\n    PopUpSim --&gt;|Loads Configuration| Files\n    PopUpSim --&gt;|Imports Infrastructure| ExtSys\n    PopUpSim --&gt;|Exports Results| Results\n\n    classDef system fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef user fill:#fff3e0,stroke:#e65100,stroke-width:2px\n    classDef external fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n\n    class PopUpSim system\n    class Planer,Detailplaner user\n    class Files,ExtSys,Results external</code></pre>"},{"location":"mvp/development/01-mvp-overview/#13-container-architecture-c4-level-2","title":"1.3 Container Architecture (C4 Level 2)","text":"<p>Note: See Architecture Section 5 for detailed building blocks.</p> <pre><code>graph TB\n    subgraph \"PopUpSim MVP - Desktop Application\"\n        subgraph \"Python Application\"\n            CFG[Configuration Context&lt;br/&gt;File loading &amp; validation&lt;br/&gt;CONTAINER]\n            RWF[Retrofit Workflow Context&lt;br/&gt;Core simulation logic&lt;br/&gt;CONTAINER]\n            RLY[Railway Infrastructure Context&lt;br/&gt;Track management&lt;br/&gt;CONTAINER]\n            EXT[External Trains Context&lt;br/&gt;Train arrivals&lt;br/&gt;CONTAINER]\n        end\n\n        subgraph \"Data (File System)\"\n            ConfigFiles[Input Files&lt;br/&gt;JSON/CSV&lt;br/&gt;DATA]\n            ResultFiles[Output Files&lt;br/&gt;CSV/PNG&lt;br/&gt;DATA]\n        end\n\n        subgraph \"External Libraries\"\n            SimPy[SimPy Framework&lt;br/&gt;EXTERNAL]\n            Matplotlib[Matplotlib&lt;br/&gt;EXTERNAL]\n            Pydantic[Pydantic&lt;br/&gt;EXTERNAL]\n        end\n    end\n\n    subgraph \"User\"\n        Developer[Developer&lt;br/&gt;CLI/Editor&lt;br/&gt;PERSON]\n    end\n\n    Developer --&gt;|Creates Config| ConfigFiles\n    Developer --&gt;|Starts| CFG\n    Developer --&gt;|Analyzes| ResultFiles\n\n    CFG --&gt;|Reads| ConfigFiles\n    CFG --&gt;|Validates| Pydantic\n    CFG --&gt;|Scenario| RWF\n    CFG --&gt;|Scenario| RLY\n    CFG --&gt;|Scenario| EXT\n\n    RLY &lt;--&gt;|Track state| RWF\n    EXT --&gt;|Train arrivals| RWF\n    RWF --&gt;|Uses| SimPy\n    RWF --&gt;|Uses| Matplotlib\n    RWF --&gt;|Writes| ResultFiles\n\n    classDef container fill:#1168bd,stroke:#0b4884,stroke-width:2px,color:#fff\n    classDef data fill:#2e7d32,stroke:#1b5e20,stroke-width:2px,color:#fff\n    classDef external fill:#999999,stroke:#6b6b6b,stroke-width:2px,color:#fff\n    classDef person fill:#08427b,stroke:#052e56,stroke-width:2px,color:#fff\n\n    class CFG,RWF,RLY,EXT container\n    class ConfigFiles,ResultFiles data\n    class SimPy,Matplotlib,Pydantic external\n    class Developer person</code></pre>"},{"location":"mvp/development/01-mvp-overview/#14-technology-stack","title":"1.4 Technology Stack","text":"<p>Note: See Architecture Section 7.10 for complete stack.</p>"},{"location":"mvp/development/01-mvp-overview/#core","title":"Core","text":"<ul> <li>Python 3.13+: Main language</li> <li>SimPy: Discrete event simulation</li> <li>Pydantic 2.0+: Data validation</li> <li>Matplotlib: Visualization (charts)</li> <li>Pandas: Data processing (CSV)</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#development","title":"Development","text":"<ul> <li>uv: Package manager</li> <li>pytest: Testing framework</li> <li>Ruff: Code formatting and linting</li> <li>MyPy: Type checking</li> <li>Pylint: Static analysis</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#not-in-mvp","title":"Not in MVP","text":"<ul> <li>\u274c Web Frontend: CLI/Desktop only</li> <li>\u274c REST API: Direct Python calls</li> <li>\u274c Database: File-based only</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#15-deployment-architecture","title":"1.5 Deployment Architecture","text":"<p>Note: See Architecture Section 7 for detailed deployment view.</p> <pre><code>graph TB\n    subgraph \"Developer Laptop\"\n        subgraph \"PopUpSim MVP\"\n            Python[Python 3.13+&lt;br/&gt;SimPy + Matplotlib]\n        end\n\n        subgraph \"File System\"\n            Input[config/&lt;br/&gt;scenario.json&lt;br/&gt;train_schedule.csv]\n            Output[results/&lt;br/&gt;*.csv&lt;br/&gt;charts/*.png]\n        end\n\n        CLI[Terminal/IDE&lt;br/&gt;python main.py]\n    end\n\n    CLI --&gt;|Starts| Python\n    Python --&gt;|Reads| Input\n    Python --&gt;|Writes| Output\n    CLI --&gt;|Opens| Output\n\n    classDef process fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef files fill:#fff3e0,stroke:#e65100,stroke-width:2px\n    classDef user fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n\n    class Python process\n    class Input,Output files\n    class CLI user</code></pre>"},{"location":"mvp/development/01-mvp-overview/#installation-requirements","title":"Installation Requirements","text":"<ul> <li>Python 3.13+ with uv</li> <li>RAM: To be measured during implementation</li> <li>Disk: ~500MB for installation and data</li> <li>No web browser required</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#16-quality-attributes-mvp","title":"1.6 Quality Attributes MVP","text":"<p>Note: See Architecture Section 1.2 for quality goals.</p>"},{"location":"mvp/development/01-mvp-overview/#performance-goals","title":"Performance Goals","text":"<ul> <li>Startup Time: To be measured</li> <li>Simulation Speed: To be measured</li> <li>Chart Generation: To be measured</li> <li>Memory Usage: To be measured</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#functional-goals","title":"Functional Goals","text":"<ul> <li>Determinism: Identical results with same inputs</li> <li>Accuracy: Plausible throughput estimates</li> <li>Completeness: All MVP user stories covered</li> <li>Usability: Quick scenario setup</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#technical-goals","title":"Technical Goals","text":"<ul> <li>Testability: High code coverage for domain logic</li> <li>Maintainability: Clear separation between contexts</li> <li>Extensibility: Easy to add new features</li> <li>Portability: Runs on Windows, macOS, Linux</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#17-constraints-and-assumptions","title":"1.7 Constraints and Assumptions","text":"<p>Note: See Architecture Section 2 for detailed constraints.</p>"},{"location":"mvp/development/01-mvp-overview/#technical-constraints","title":"Technical Constraints","text":"<ul> <li>Desktop Application: No web interface</li> <li>File-based I/O: No database</li> <li>CLI-based: No graphical user interface</li> <li>Synchronous Processing: No async/parallel processing</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#business-constraints","title":"Business Constraints","text":"<ul> <li>Pop-Up Workshops: Focus on DAC retrofit</li> <li>Microscopic Simulation: Individual wagons and resources</li> <li>Deterministic: Reproducible results</li> <li>Planning Tool: Not for real-time operations</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#assumptions","title":"Assumptions","text":"<ul> <li>Users: Developers and technical planners</li> <li>Data Quality: Correct and complete input data</li> <li>Hardware: Standard business laptop</li> <li>Network: No network dependencies</li> <li>Editor: Users can manually edit JSON/CSV</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#18-risks-and-mitigation","title":"1.8 Risks and Mitigation","text":"<p>Note: See Architecture Section 11 for detailed risks.</p>"},{"location":"mvp/development/01-mvp-overview/#technical-risks","title":"Technical Risks","text":"Risk Probability Impact Mitigation Performance with large scenarios Medium High Early benchmarking SimPy learning curve High Medium Prototyping and documentation Matplotlib limitations Low Low Simple 2D charts sufficient"},{"location":"mvp/development/01-mvp-overview/#business-risks","title":"Business Risks","text":"Risk Probability Impact Mitigation Incomplete domain model Medium High Close alignment with domain experts Unrealistic results Medium High Validation with real data User acceptance Low High Focus on visualization"},{"location":"mvp/development/01-mvp-overview/#19-success-criteria","title":"1.9 Success Criteria","text":""},{"location":"mvp/development/01-mvp-overview/#technical-metrics","title":"Technical Metrics","text":"<ul> <li>Development Time: 5 weeks</li> <li>Simulation Speed: To be measured</li> <li>Scalability: To be measured</li> <li>Portability: Runs on Windows/Mac/Linux with uv</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#functional-metrics","title":"Functional Metrics","text":"<ul> <li>Functionality: Basic retrofitting simulation works</li> <li>Output: KPIs are correctly calculated and exported</li> <li>Visualization: Matplotlib charts display simulation results</li> <li>Extensibility: Architecture foundation for full version established</li> </ul>"},{"location":"mvp/development/01-mvp-overview/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>\u2705 Template Creation: Standardized workshop templates can be created</li> <li>\u2705 Throughput Estimation: Plausible throughput calculations</li> <li>\u2705 Data Import: CSV/JSON import works without errors</li> <li>\u2705 Capacity Analysis: Capacity bottlenecks are identified</li> <li>\u2705 Stability: Multiple simulations run consecutively without crashes</li> <li>\u2705 Usability: Developer creates scenario quickly</li> <li>\u2705 Expert Validation: Positive evaluation by domain experts</li> </ul>"},{"location":"mvp/development/02-mvp-contexts/","title":"2. MVP Bounded Contexts","text":""},{"location":"mvp/development/02-mvp-contexts/#21-context-overview","title":"2.1 Context Overview","text":"<p>Note: See Architecture Section 5 for detailed building blocks.</p> <p>The MVP uses 4 bounded contexts following Domain-Driven Design principles:</p> <pre><code>graph TB\n    subgraph \"MVP PopUpSim - 4 Contexts\"\n        CFG[Configuration Context&lt;br/&gt;File loading &amp; validation]\n        RWF[Retrofit Workflow Context&lt;br/&gt;Core simulation logic]\n        RLY[Railway Infrastructure Context&lt;br/&gt;Track management]\n        EXT[External Trains Context&lt;br/&gt;Train arrivals]\n    end\n\n    subgraph \"External\"\n        Files[Config Files&lt;br/&gt;JSON/CSV]\n        Output[Results&lt;br/&gt;CSV/PNG]\n    end\n\n    Files --&gt;|Load| CFG\n    CFG --&gt;|Scenario| RWF\n    CFG --&gt;|Scenario| RLY\n    CFG --&gt;|Scenario| EXT\n    RLY &lt;--&gt;|Track state| RWF\n    EXT --&gt;|Train arrivals| RWF\n    RWF --&gt;|Export| Output\n\n    classDef context fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef external fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n\n    class CFG,RWF,RLY,EXT context\n    class Files,Output external</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#22-configuration-context","title":"2.2 Configuration Context","text":""},{"location":"mvp/development/02-mvp-contexts/#responsibilities","title":"Responsibilities","text":"<ul> <li>Load scenario configuration from files</li> <li>Validate using Pydantic models</li> <li>Provide validated scenario to other contexts</li> </ul>"},{"location":"mvp/development/02-mvp-contexts/#key-components","title":"Key Components","text":"<p>Location: <code>popupsim/backend/src/contexts/configuration/</code></p> <pre><code>configuration/\n\u251c\u2500\u2500 domain/\n\u2502   \u251c\u2500\u2500 configuration_builder.py    # Entry point\n\u2502   \u2514\u2500\u2500 models/\n\u2502       \u251c\u2500\u2500 scenario.py\n\u2502       \u251c\u2500\u2500 process_times.py\n\u2502       \u2514\u2500\u2500 dtos/\n\u2514\u2500\u2500 infrastructure/\n    \u2514\u2500\u2500 file_loader.py              # Parse JSON/CSV\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#implementation","title":"Implementation","text":"<p>File: <code>contexts/configuration/domain/configuration_builder.py</code></p> <pre><code>from pathlib import Path\nfrom contexts.configuration.infrastructure.file_loader import FileLoader\nfrom contexts.configuration.domain.models.scenario import Scenario\n\nclass ConfigurationBuilder:\n    \"\"\"Load scenario from file path.\"\"\"\n\n    def __init__(self, path: Path):\n        self.path = path\n\n    def build(self) -&gt; Scenario:\n        \"\"\"Load and validate scenario.\"\"\"\n        loader = FileLoader()\n        return loader.load_scenario(self.path)\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#23-retrofit-workflow-context","title":"2.3 Retrofit Workflow Context","text":""},{"location":"mvp/development/02-mvp-contexts/#responsibilities_1","title":"Responsibilities","text":"<ul> <li>Execute discrete event simulation</li> <li>Coordinate wagon flow through 4 coordinators</li> <li>Manage resources (locomotives, tracks, workshops)</li> <li>Collect metrics during simulation</li> <li>Export results and generate reports</li> </ul>"},{"location":"mvp/development/02-mvp-contexts/#key-components_1","title":"Key Components","text":"<p>Location: <code>popupsim/backend/src/contexts/retrofit_workflow/</code></p> <pre><code>retrofit_workflow/\n\u251c\u2500\u2500 application/\n\u2502   \u251c\u2500\u2500 retrofit_workflow_context.py    # Main context\n\u2502   \u2514\u2500\u2500 coordinators/\n\u2502       \u251c\u2500\u2500 arrival_coordinator.py      # Process train arrivals\n\u2502       \u251c\u2500\u2500 collection_coordinator.py   # Move to retrofit track\n\u2502       \u251c\u2500\u2500 workshop_coordinator.py     # Retrofit operations\n\u2502       \u2514\u2500\u2500 parking_coordinator.py      # Move to parking\n\u251c\u2500\u2500 domain/\n\u2502   \u2514\u2500\u2500 services/\n\u2502       \u251c\u2500\u2500 batch_formation_service.py\n\u2502       \u251c\u2500\u2500 rake_formation_service.py\n\u2502       \u251c\u2500\u2500 train_formation_service.py\n\u2502       \u251c\u2500\u2500 workshop_scheduling_service.py\n\u2502       \u251c\u2500\u2500 coupling_service.py\n\u2502       \u2514\u2500\u2500 route_service.py\n\u2514\u2500\u2500 infrastructure/\n    \u251c\u2500\u2500 resource_managers/\n    \u2502   \u251c\u2500\u2500 locomotive_resource_manager.py\n    \u2502   \u251c\u2500\u2500 track_capacity_manager.py\n    \u2502   \u2514\u2500\u2500 workshop_resource_manager.py\n    \u2514\u2500\u2500 metrics/\n        \u251c\u2500\u2500 simulation_metrics.py\n        \u251c\u2500\u2500 wagon_collector.py\n        \u251c\u2500\u2500 locomotive_collector.py\n        \u2514\u2500\u2500 workshop_collector.py\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#implementation-main-context","title":"Implementation: Main Context","text":"<p>File: <code>contexts/retrofit_workflow/application/retrofit_workflow_context.py</code></p> <pre><code>from typing import Generator, Any\nfrom contexts.configuration.domain.models.scenario import Scenario\nfrom contexts.railway_infrastructure.application.railway_context import RailwayContext\nfrom contexts.external_trains.application.external_trains_context import ExternalTrainsContext\n\nclass RetrofitWorkflowContext:\n    \"\"\"Main retrofit workflow simulation context.\"\"\"\n\n    def __init__(\n        self,\n        env: Any,\n        scenario: Scenario,\n        railway: RailwayContext,\n        external_trains: ExternalTrainsContext,\n    ):\n        self.env = env\n        self.scenario = scenario\n        self.railway = railway\n        self.external_trains = external_trains\n\n        # Initialize coordinators\n        self.arrival_coordinator = ArrivalCoordinator(...)\n        self.collection_coordinator = CollectionCoordinator(...)\n        self.workshop_coordinator = WorkshopCoordinator(...)\n        self.parking_coordinator = ParkingCoordinator(...)\n\n        # Initialize metrics\n        self.metrics = SimulationMetrics()\n\n    def run(self) -&gt; None:\n        \"\"\"Start all coordinators.\"\"\"\n        self.arrival_coordinator.start()\n        self.collection_coordinator.start()\n        self.workshop_coordinator.start()\n        self.parking_coordinator.start()\n\n        # Run simulation\n        self.env.run()\n\n    def get_metrics(self) -&gt; dict[str, Any]:\n        \"\"\"Get collected metrics.\"\"\"\n        return self.metrics.get_all()\n\n    def export_events(self, output_path: Path) -&gt; None:\n        \"\"\"Export simulation events.\"\"\"\n        self.metrics.export_to_csv(output_path)\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#implementation-coordinator-example","title":"Implementation: Coordinator Example","text":"<p>File: <code>contexts/retrofit_workflow/application/coordinators/collection_coordinator.py</code></p> <pre><code>from typing import Generator, Any\n\nclass CollectionCoordinator:\n    \"\"\"Coordinates wagon movement from collection to retrofit track.\"\"\"\n\n    def __init__(self, config: CollectionCoordinatorConfig):\n        self.config = config\n        self.batch_counter = 0\n\n    def start(self) -&gt; None:\n        \"\"\"Start coordinator process.\"\"\"\n        self.config.env.process(self._collection_process())\n\n    def _collection_process(self) -&gt; Generator[Any, Any, None]:\n        \"\"\"Main collection process loop.\"\"\"\n        while True:\n            # Wait for wagons\n            wagon = yield self.config.collection_queue.get()\n\n            # Collect batch\n            wagons = yield from self._collect_batch(wagon)\n\n            # Select retrofit track\n            retrofit_track = self.config.track_selector.select_track_with_capacity('retrofit')\n\n            # Transport batch\n            yield from self._transport_batch(wagons, retrofit_track)\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#implementation-domain-service-example","title":"Implementation: Domain Service Example","text":"<p>File: <code>contexts/retrofit_workflow/domain/services/batch_formation_service.py</code></p> <pre><code>class BatchFormationService:\n    \"\"\"Form wagon batches (no SimPy dependencies).\"\"\"\n\n    @staticmethod\n    def can_form_batch(\n        wagons: list[Wagon],\n        min_batch_size: int,\n        max_batch_size: int,\n    ) -&gt; bool:\n        \"\"\"Check if batch can be formed.\"\"\"\n        return min_batch_size &lt;= len(wagons) &lt;= max_batch_size\n\n    @staticmethod\n    def form_batch(\n        wagons: list[Wagon],\n        batch_size: int,\n    ) -&gt; list[Wagon]:\n        \"\"\"Form batch of specified size.\"\"\"\n        return wagons[:batch_size]\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#24-railway-infrastructure-context","title":"2.4 Railway Infrastructure Context","text":""},{"location":"mvp/development/02-mvp-contexts/#responsibilities_2","title":"Responsibilities","text":"<ul> <li>Build track infrastructure from scenario</li> <li>Manage track capacity and occupancy</li> <li>Provide track selection services</li> <li>Track wagon placement</li> </ul>"},{"location":"mvp/development/02-mvp-contexts/#key-components_2","title":"Key Components","text":"<p>Location: <code>popupsim/backend/src/contexts/railway_infrastructure/</code></p> <pre><code>railway_infrastructure/\n\u251c\u2500\u2500 application/\n\u2502   \u2514\u2500\u2500 railway_context.py          # Track building &amp; services\n\u251c\u2500\u2500 domain/\n\u2502   \u251c\u2500\u2500 aggregates/\n\u2502   \u2502   \u251c\u2500\u2500 track_group.py\n\u2502   \u2502   \u251c\u2500\u2500 track.py\n\u2502   \u2502   \u2514\u2500\u2500 track_occupancy.py\n\u2502   \u2514\u2500\u2500 services/\n\u2502       \u251c\u2500\u2500 track_selector.py\n\u2502       \u2514\u2500\u2500 capacity_service.py\n\u2514\u2500\u2500 infrastructure/\n    \u2514\u2500\u2500 track_repository.py\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#implementation_1","title":"Implementation","text":"<p>File: <code>contexts/railway_infrastructure/application/railway_context.py</code></p> <pre><code>from contexts.configuration.domain.models.scenario import Scenario\nfrom contexts.railway_infrastructure.domain.aggregates.track_group import TrackGroup\nfrom contexts.railway_infrastructure.domain.services.track_selector import TrackSelector\n\nclass RailwayContext:\n    \"\"\"Railway infrastructure management context.\"\"\"\n\n    def __init__(self, scenario: Scenario):\n        self.scenario = scenario\n\n        # Build track groups\n        self.track_groups = self._build_track_groups(scenario.tracks)\n\n        # Initialize services\n        self.track_selector = TrackSelector(self.track_groups)\n        self.capacity_service = CapacityService(self.track_groups)\n\n    def _build_track_groups(self, tracks: list[Track]) -&gt; dict[str, TrackGroup]:\n        \"\"\"Group tracks by type.\"\"\"\n        groups = {}\n        for track in tracks:\n            if track.track_type not in groups:\n                groups[track.track_type] = TrackGroup(track.track_type)\n            groups[track.track_type].add_track(track)\n        return groups\n\n    def place_wagons_on_track(self, track_id: str, wagons: list[Wagon]) -&gt; None:\n        \"\"\"Place wagons on specified track.\"\"\"\n        track = self._find_track(track_id)\n        track.occupancy.add_wagons(wagons)\n\n    def remove_wagons_from_track(self, track_id: str, wagons: list[Wagon]) -&gt; None:\n        \"\"\"Remove wagons from specified track.\"\"\"\n        track = self._find_track(track_id)\n        track.occupancy.remove_wagons(wagons)\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#25-external-trains-context","title":"2.5 External Trains Context","text":""},{"location":"mvp/development/02-mvp-contexts/#responsibilities_3","title":"Responsibilities","text":"<ul> <li>Initialize train arrivals from scenario</li> <li>Publish TrainArrivedEvent to event bus</li> <li>Create wagon entities from train data</li> </ul>"},{"location":"mvp/development/02-mvp-contexts/#key-components_3","title":"Key Components","text":"<p>Location: <code>popupsim/backend/src/contexts/external_trains/</code></p> <pre><code>external_trains/\n\u251c\u2500\u2500 application/\n\u2502   \u2514\u2500\u2500 external_trains_context.py  # Train arrival management\n\u251c\u2500\u2500 domain/\n\u2502   \u251c\u2500\u2500 wagon_factory.py\n\u2502   \u2514\u2500\u2500 events/\n\u2502       \u2514\u2500\u2500 train_arrived_event.py\n\u2514\u2500\u2500 infrastructure/\n    \u2514\u2500\u2500 event_publisher.py\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#implementation_2","title":"Implementation","text":"<p>File: <code>contexts/external_trains/application/external_trains_context.py</code></p> <pre><code>from contexts.configuration.domain.models.scenario import Scenario\nfrom contexts.shared.domain.events.event_bus import EventBus\nfrom contexts.external_trains.domain.events.train_arrived_event import TrainArrivedEvent\n\nclass ExternalTrainsContext:\n    \"\"\"External train arrival management.\"\"\"\n\n    def __init__(self, env: Any, scenario: Scenario, event_bus: EventBus):\n        self.env = env\n        self.scenario = scenario\n        self.event_bus = event_bus\n\n    def initialize_arrivals(self) -&gt; None:\n        \"\"\"Schedule all train arrivals.\"\"\"\n        for train in self.scenario.trains or []:\n            arrival_time = self._calculate_arrival_time(train)\n            self.env.process(self._arrival_process(train, arrival_time))\n\n    def _arrival_process(self, train: Train, arrival_time: float) -&gt; Generator[Any, Any, None]:\n        \"\"\"Process single train arrival.\"\"\"\n        yield self.env.timeout(arrival_time)\n\n        # Create event\n        event = TrainArrivedEvent(\n            train_id=train.id,\n            wagons=train.wagons,\n            arrival_time=self.env.now,\n        )\n\n        # Publish to event bus\n        self.event_bus.publish(event)\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#26-context-interactions","title":"2.6 Context Interactions","text":""},{"location":"mvp/development/02-mvp-contexts/#main-orchestration","title":"Main Orchestration","text":"<p>File: <code>popupsim/backend/src/application/simulation_service.py</code></p> <pre><code>from pathlib import Path\nfrom contexts.configuration.domain.configuration_builder import ConfigurationBuilder\nfrom contexts.railway_infrastructure.application.railway_context import RailwayContext\nfrom contexts.external_trains.application.external_trains_context import ExternalTrainsContext\nfrom contexts.retrofit_workflow.application.retrofit_workflow_context import RetrofitWorkflowContext\nfrom contexts.shared.domain.events.event_bus import EventBus\nfrom contexts.shared.infrastructure.simpy_adapter import SimPyAdapter\n\nclass SimulationService:\n    \"\"\"Orchestrates all contexts for simulation execution.\"\"\"\n\n    def run_simulation(self, scenario_path: Path, output_path: Path) -&gt; None:\n        \"\"\"Run complete simulation pipeline.\"\"\"\n\n        # 1. Configuration Context - Load scenario\n        config_builder = ConfigurationBuilder(scenario_path)\n        scenario = config_builder.build()\n\n        # 2. Initialize SimPy environment\n        env = SimPyAdapter.create_environment()\n        event_bus = EventBus()\n\n        # 3. Railway Infrastructure Context - Build tracks\n        railway = RailwayContext(scenario)\n\n        # 4. External Trains Context - Schedule arrivals\n        external_trains = ExternalTrainsContext(env, scenario, event_bus)\n        external_trains.initialize_arrivals()\n\n        # 5. Retrofit Workflow Context - Main simulation\n        retrofit_workflow = RetrofitWorkflowContext(\n            env, scenario, railway, external_trains\n        )\n        retrofit_workflow.run()\n\n        # 6. Export results\n        retrofit_workflow.export_events(output_path)\n        metrics = retrofit_workflow.get_metrics()\n\n        # Generate reports\n        self._generate_reports(metrics, output_path)\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#event-bus-communication","title":"Event Bus Communication","text":"<pre><code>from contexts.shared.domain.events.event_bus import EventBus\nfrom contexts.external_trains.domain.events.train_arrived_event import TrainArrivedEvent\n\n# External Trains publishes event\nevent_bus.publish(TrainArrivedEvent(\n    train_id=\"T001\",\n    wagons=[wagon1, wagon2, wagon3],\n    arrival_time=100.0\n))\n\n# Retrofit Workflow subscribes\nevent_bus.subscribe(TrainArrivedEvent, arrival_coordinator.handle_train_arrival)\n</code></pre>"},{"location":"mvp/development/02-mvp-contexts/#27-implementation-status","title":"2.7 Implementation Status","text":"Context Status Location Configuration Context \u2705 Implemented <code>contexts/configuration/</code> Retrofit Workflow Context \u2705 Implemented <code>contexts/retrofit_workflow/</code> Railway Infrastructure Context \u2705 Implemented <code>contexts/railway_infrastructure/</code> External Trains Context \u2705 Implemented <code>contexts/external_trains/</code> Event Bus \u2705 Implemented <code>contexts/shared/domain/events/</code> SimPy Adapter \u2705 Implemented <code>contexts/shared/infrastructure/</code> Testing \u2705 Complete 374 tests passing"},{"location":"mvp/development/02-mvp-contexts/#28-migration-path-to-full-version","title":"2.8 Migration Path to Full Version","text":"<p>The 4-context architecture provides a solid foundation for future evolution. Possible enhancements:</p> <ul> <li>Event-driven architecture: Replace direct calls with async messaging</li> <li>Database integration: Add repository pattern for persistence</li> <li>Web interface: Add API layer and frontend</li> <li>Distributed simulation: Split contexts into microservices</li> </ul> <p>Current architecture supports these migrations through: - Clear context boundaries - Event bus infrastructure - Domain services without SimPy dependencies - Layered architecture within each context</p>"},{"location":"mvp/development/03-mvp-domain-model/","title":"3. MVP Domain Model","text":""},{"location":"mvp/development/03-mvp-domain-model/#31-domain-model-overview","title":"3.1 Domain Model Overview","text":"<p>Note: See actual implementation in <code>popupsim/backend/src/contexts/</code></p> <p>The MVP domain model follows Domain-Driven Design principles across 4 bounded contexts.</p> <pre><code>classDiagram\n    class ScenarioConfig {\n        +str scenario_id\n        +date start_date\n        +date end_date\n        +Workshop workshop\n        +str train_schedule_file\n    }\n\n    class Workshop {\n        +list tracks\n        +validate_tracks()\n    }\n\n    class WorkshopTrack {\n        +str id\n        +TrackFunction function\n        +int retrofit_time_min\n    }\n\n    class Train {\n        +str id\n        +datetime arrival_time\n        +list wagons\n        +get_total_length() float\n    }\n\n    class Wagon {\n        +str id\n        +str train_id\n        +float length\n        +bool needs_retrofit\n        +str status\n    }\n\n    ScenarioConfig --o Workshop\n    Workshop --o WorkshopTrack\n    Train --o Wagon</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#32-configuration-context-models","title":"3.2 Configuration Context Models","text":"<p>Actual implementation: <code>popupsim/backend/src/contexts/configuration/domain/models/</code></p>"},{"location":"mvp/development/03-mvp-domain-model/#scenario","title":"Scenario","text":"<pre><code>from pydantic import BaseModel\nfrom datetime import datetime\n\nclass Scenario(BaseModel):\n    \"\"\"Root configuration model.\"\"\"\n    id: str\n    start_date: datetime\n    end_date: datetime\n    trains: list[Train] | None = None\n    tracks: list[Track] | None = None\n    workshops: list[Workshop] | None = None\n    locomotives: list[Locomotive] | None = None\n    routes: list[Route] | None = None\n    process_times: ProcessTimes | None = None\n</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#workshop","title":"Workshop","text":"<pre><code>class Workshop(BaseModel):\n    \"\"\"Workshop configuration.\"\"\"\n    workshop_id: str\n    track_id: str\n    retrofit_stations: int\n    name: str | None = None\n</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#33-retrofit-workflow-domain-services","title":"3.3 Retrofit Workflow Domain Services","text":"<p>Actual implementation: <code>popupsim/backend/src/contexts/retrofit_workflow/domain/services/</code></p>"},{"location":"mvp/development/03-mvp-domain-model/#batch-formation-service","title":"Batch Formation Service","text":"<pre><code>class BatchFormationService:\n    \"\"\"Form wagon batches (no SimPy dependencies).\"\"\"\n\n    @staticmethod\n    def can_form_batch(\n        wagons: list[Wagon],\n        min_batch_size: int,\n        max_batch_size: int,\n    ) -&gt; bool:\n        \"\"\"Check if batch can be formed.\"\"\"\n        return min_batch_size &lt;= len(wagons) &lt;= max_batch_size\n</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#workshop-scheduling-service","title":"Workshop Scheduling Service","text":"<pre><code>class WorkshopSchedulingService:\n    \"\"\"Schedule wagon batches to workshops (no SimPy dependencies).\"\"\"\n\n    @staticmethod\n    def select_workshop(\n        workshops: list[Workshop],\n        batch_size: int,\n    ) -&gt; Workshop | None:\n        \"\"\"Select workshop with sufficient capacity.\"\"\"\n        for workshop in workshops:\n            if workshop.retrofit_stations &gt;= batch_size:\n                return workshop\n        return None\n</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#34-value-objects","title":"3.4 Value Objects","text":"<pre><code>from dataclasses import dataclass\n\n@dataclass(frozen=True)\nclass ValidationResult:\n    \"\"\"Result of validation\"\"\"\n    is_valid: bool\n    errors: list[str]\n    warnings: list[str]\n\n    def has_errors(self) -&gt; bool:\n        return len(self.errors) &gt; 0\n\n@dataclass(frozen=True)\nclass SimulationResult:\n    \"\"\"Result of simulation\"\"\"\n    scenario_id: str\n    duration_hours: int\n    total_trains_processed: int\n    total_wagons_processed: int\n    average_processing_time_minutes: float\n    throughput_per_hour: float\n</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#35-domain-services","title":"3.5 Domain Services","text":"<pre><code>class ThroughputCalculationService:\n    \"\"\"Service for throughput calculations\"\"\"\n\n    def calculate_theoretical_throughput(\n        self,\n        workshop: Workshop\n    ) -&gt; float:\n        \"\"\"Calculates theoretical workshop throughput\"\"\"\n        total_capacity = sum(t.capacity for t in workshop.tracks)\n        avg_processing_time = sum(\n            t.retrofit_time_min for t in workshop.tracks\n        ) / len(workshop.tracks)\n\n        wagons_per_hour = (total_capacity * 60) / avg_processing_time\n        return wagons_per_hour\n\nclass ValidationService:\n    \"\"\"Service for data validation\"\"\"\n\n    def validate_scenario(\n        self,\n        config: ScenarioConfig\n    ) -&gt; ValidationResult:\n        \"\"\"Validates scenario models\"\"\"\n        errors = []\n        warnings = []\n\n        # Date validation\n        if config.end_date &lt;= config.start_date:\n            errors.append(\"end_date must be after start_date\")\n\n        # Workshop validation\n        if config.workshop and not config.workshop.tracks:\n            errors.append(\"Workshop must have at least one track\")\n\n        return ValidationResult(\n            is_valid=len(errors) == 0,\n            errors=errors,\n            warnings=warnings\n        )\n</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#36-exceptions","title":"3.6 Exceptions","text":"<pre><code>class PopUpSimDomainError(Exception):\n    \"\"\"Base for domain-specific errors\"\"\"\n    pass\n\nclass ValidationError(PopUpSimDomainError):\n    \"\"\"Configuration validation error\"\"\"\n    pass\n\nclass SimulationRuntimeError(PopUpSimDomainError):\n    \"\"\"Error during simulation\"\"\"\n    pass\n\nclass InsufficientCapacityError(PopUpSimDomainError):\n    \"\"\"Insufficient track/workshop capacity\"\"\"\n    pass\n</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#37-type-hints","title":"3.7 Type Hints","text":"<p>All code must include explicit type annotations per project rules:</p> <pre><code>from typing import Optional\n\ndef process_wagon(\n    wagon: Wagon,\n    track: WorkshopTrack\n) -&gt; Optional[float]:\n    \"\"\"Process wagon on track, returns completion time\"\"\"\n    if not track.capacity &gt; 0:\n        raise InsufficientCapacityError(f\"Track {track.id} is full\")\n\n    completion_time = track.retrofit_time_min\n    return completion_time\n\ndef validate_configuration(\n    config: ScenarioConfig\n) -&gt; ValidationResult:\n    \"\"\"Validate scenario models\"\"\"\n    # Implementation\n    pass\n</code></pre>"},{"location":"mvp/development/03-mvp-domain-model/#38-migration-path","title":"3.8 Migration Path","text":"<p>The simplified MVP domain model can be extended to full DDD implementation:</p>"},{"location":"mvp/development/03-mvp-domain-model/#phase-1-post-mvp-rich-domain-model","title":"Phase 1 (Post-MVP): Rich Domain Model","text":"<ul> <li>Aggregate roots with invariants</li> <li>Domain services for complex business logic</li> <li>Repository pattern for persistence</li> </ul>"},{"location":"mvp/development/03-mvp-domain-model/#phase-2-event-sourcing","title":"Phase 2: Event Sourcing","text":"<ul> <li>Event store implementation</li> <li>Event-driven state reconstruction</li> <li>Temporal queries</li> </ul>"},{"location":"mvp/development/03-mvp-domain-model/#phase-3-advanced-ddd","title":"Phase 3: Advanced DDD","text":"<ul> <li>Specification pattern for complex queries</li> <li>Domain events with saga pattern</li> <li>CQRS for read/write separation</li> </ul> <p>Effort: Estimated 2-3 weeks for full DDD migration (to be validated)</p>"},{"location":"mvp/development/04-mvp-simpy-integration/","title":"4. MVP SimPy Integration","text":""},{"location":"mvp/development/04-mvp-simpy-integration/#overview","title":"Overview","text":"<p>Location: <code>popupsim/backend/src/contexts/shared/infrastructure/simpy_adapter.py</code></p> <p>SimPy provides discrete event simulation for the Retrofit Workflow Context. Integration follows a thin adapter pattern to isolate SimPy dependencies.</p>"},{"location":"mvp/development/04-mvp-simpy-integration/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Retrofit Workflow Context            \u2502\n\u2502   - Coordinators (Application)         \u2502\n\u2502   - Domain Services (No SimPy)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u2502 Uses\n                  \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   SimPy Adapter (Shared/Infrastructure) \u2502\n\u2502   - Environment wrapper                 \u2502\n\u2502   - Process management                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   SimPy Framework                       \u2502\n\u2502   - Environment, Resource, Process      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"mvp/development/04-mvp-simpy-integration/#simpy-adapter","title":"SimPy Adapter","text":"<p>File: <code>contexts/shared/infrastructure/simpy_adapter.py</code></p> <pre><code>import simpy\nfrom typing import Any, Callable, Generator\n\nclass SimPyAdapter:\n    \"\"\"Thin adapter for SimPy environment.\"\"\"\n\n    def __init__(self, env: simpy.Environment):\n        self.env = env\n\n    @property\n    def now(self) -&gt; float:\n        \"\"\"Current simulation time.\"\"\"\n        return self.env.now\n\n    def timeout(self, delay: float) -&gt; Any:\n        \"\"\"Wait for delay time units.\"\"\"\n        return self.env.timeout(delay)\n\n    def process(self, generator: Generator) -&gt; Any:\n        \"\"\"Register a process.\"\"\"\n        return self.env.process(generator)\n\n    def run(self, until: float | None = None) -&gt; None:\n        \"\"\"Run simulation.\"\"\"\n        self.env.run(until=until)\n\n    @staticmethod\n    def create_environment() -&gt; simpy.Environment:\n        \"\"\"Create SimPy environment.\"\"\"\n        return simpy.Environment()\n</code></pre>"},{"location":"mvp/development/04-mvp-simpy-integration/#coordinator-pattern","title":"Coordinator Pattern","text":"<p>Coordinators use SimPy generators for discrete event simulation:</p> <p>File: <code>contexts/retrofit_workflow/application/coordinators/collection_coordinator.py</code></p> <pre><code>from typing import Generator, Any\n\nclass CollectionCoordinator:\n    \"\"\"Coordinates wagon collection.\"\"\"\n\n    def start(self) -&gt; None:\n        \"\"\"Start coordinator process.\"\"\"\n        self.config.env.process(self._collection_process())\n\n    def _collection_process(self) -&gt; Generator[Any, Any, None]:\n        \"\"\"Main collection loop.\"\"\"\n        while True:\n            # Wait for wagon\n            wagon = yield self.config.collection_queue.get()\n\n            # Collect batch\n            wagons = yield from self._collect_batch(wagon)\n\n            # Transport\n            yield from self._transport_batch(wagons)\n</code></pre>"},{"location":"mvp/development/04-mvp-simpy-integration/#resource-management","title":"Resource Management","text":"<p>SimPy Resources manage limited capacity:</p> <p>File: <code>contexts/retrofit_workflow/infrastructure/resource_managers/locomotive_resource_manager.py</code></p> <pre><code>import simpy\nfrom typing import Any\n\nclass LocomotiveResourceManager:\n    \"\"\"Manages locomotive resources.\"\"\"\n\n    def __init__(self, env: simpy.Environment, locomotives: list[Locomotive]):\n        self.env = env\n        self.resource = simpy.Resource(env, capacity=len(locomotives))\n        self.locomotives = {loco.locomotive_id: loco for loco in locomotives}\n\n    def allocate(self) -&gt; Any:\n        \"\"\"Allocate locomotive (blocks until available).\"\"\"\n        return self.resource.request()\n\n    def release(self, request: Any) -&gt; None:\n        \"\"\"Release locomotive.\"\"\"\n        self.resource.release(request)\n</code></pre>"},{"location":"mvp/development/04-mvp-simpy-integration/#event-bus-integration","title":"Event Bus Integration","text":"<p>External Trains Context publishes events via SimPy:</p> <p>File: <code>contexts/external_trains/application/external_trains_context.py</code></p> <pre><code>def _arrival_process(self, train: Train, arrival_time: float) -&gt; Generator[Any, Any, None]:\n    \"\"\"Process single train arrival.\"\"\"\n    yield self.env.timeout(arrival_time)\n\n    # Publish event\n    event = TrainArrivedEvent(\n        train_id=train.id,\n        wagons=train.wagons,\n        arrival_time=self.env.now\n    )\n    self.event_bus.publish(event)\n</code></pre>"},{"location":"mvp/development/04-mvp-simpy-integration/#testing","title":"Testing","text":""},{"location":"mvp/development/04-mvp-simpy-integration/#unit-tests-no-simpy","title":"Unit Tests (No SimPy)","text":"<p>Domain services don't depend on SimPy:</p> <pre><code>def test_batch_formation() -&gt; None:\n    \"\"\"Test without SimPy.\"\"\"\n    service = BatchFormationService()\n    wagons = [Wagon(...) for _ in range(5)]\n\n    assert service.can_form_batch(wagons, min_size=1, max_size=10)\n    batch = service.form_batch(wagons, batch_size=5)\n    assert len(batch) == 5\n</code></pre>"},{"location":"mvp/development/04-mvp-simpy-integration/#integration-tests-with-simpy","title":"Integration Tests (With SimPy)","text":"<pre><code>def test_collection_coordinator() -&gt; None:\n    \"\"\"Test with SimPy.\"\"\"\n    env = simpy.Environment()\n    queue = simpy.Store(env)\n\n    coordinator = CollectionCoordinator(...)\n    coordinator.start()\n\n    # Add wagon\n    queue.put(Wagon(...))\n\n    # Run simulation\n    env.run(until=100)\n\n    # Verify wagon processed\n    assert len(coordinator.processed_wagons) == 1\n</code></pre>"},{"location":"mvp/development/04-mvp-simpy-integration/#best-practices","title":"Best Practices","text":""},{"location":"mvp/development/04-mvp-simpy-integration/#dos","title":"\u2705 Do's","text":"<ul> <li>Keep domain logic SimPy-free</li> <li>Use generators for coordinators</li> <li>Isolate SimPy in infrastructure layer</li> <li>Test domain logic without SimPy</li> </ul>"},{"location":"mvp/development/04-mvp-simpy-integration/#donts","title":"\u274c Don'ts","text":"<ul> <li>Don't import SimPy in domain services</li> <li>Don't put business logic in generators</li> <li>Don't use global SimPy resources</li> </ul>"},{"location":"mvp/development/05-mvp-data-flow/","title":"5. MVP Data Flow","text":""},{"location":"mvp/development/05-mvp-data-flow/#overview","title":"Overview","text":"<p>Data flows through 4 bounded contexts: Configuration \u2192 Railway Infrastructure \u2192 External Trains \u2192 Retrofit Workflow.</p>"},{"location":"mvp/development/05-mvp-data-flow/#end-to-end-flow","title":"End-to-End Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   1. Configuration Context              \u2502\n\u2502   Load &amp; validate scenario              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 Scenario\n               \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n               \u2502                          \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 2. Railway Infrastructure\u2502  \u2502 3. External Trains   \u2502\n\u2502    Build tracks          \u2502  \u2502    Schedule arrivals \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 Track state              \u2502 Events\n               \u2502                          \u2502\n               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n               \u2502 4. Retrofit Workflow            \u2502\n               \u2502    Execute simulation           \u2502\n               \u2502    Collect metrics              \u2502\n               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502 Results\n                          \u25bc\n                    CSV + Charts\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#phase-1-configuration-loading","title":"Phase 1: Configuration Loading","text":""},{"location":"mvp/development/05-mvp-data-flow/#input","title":"Input","text":"<pre><code>scenario_dir/\n\u251c\u2500\u2500 scenario.json\n\u251c\u2500\u2500 tracks.json\n\u251c\u2500\u2500 workshops.json\n\u251c\u2500\u2500 locomotives.json\n\u251c\u2500\u2500 routes.json\n\u2514\u2500\u2500 trains.csv\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#process","title":"Process","text":"<pre><code>from contexts.configuration.domain.configuration_builder import ConfigurationBuilder\n\nbuilder = ConfigurationBuilder(Path(\"scenario_dir\"))\nscenario = builder.build()\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#output","title":"Output","text":"<pre><code>Scenario(\n    id=\"demo\",\n    start_date=datetime(2025, 1, 1),\n    end_date=datetime(2025, 1, 2),\n    trains=[...],\n    tracks=[...],\n    workshops=[...],\n    locomotives=[...],\n    routes=[...]\n)\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#phase-2-railway-infrastructure-setup","title":"Phase 2: Railway Infrastructure Setup","text":""},{"location":"mvp/development/05-mvp-data-flow/#input-scenario","title":"Input: Scenario","text":""},{"location":"mvp/development/05-mvp-data-flow/#process_1","title":"Process","text":"<pre><code>from contexts.railway_infrastructure.application.railway_context import RailwayContext\n\nrailway = RailwayContext(scenario)\n# Builds track groups, initializes capacity management\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#output_1","title":"Output","text":"<pre><code>RailwayContext(\n    track_groups={\n        'collection': TrackGroup([Track(...), Track(...)]),\n        'retrofit': TrackGroup([Track(...)]),\n        'parking': TrackGroup([Track(...)])\n    },\n    track_selector=TrackSelector(...),\n    capacity_service=CapacityService(...)\n)\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#phase-3-external-trains-initialization","title":"Phase 3: External Trains Initialization","text":""},{"location":"mvp/development/05-mvp-data-flow/#input-scenario_1","title":"Input: Scenario","text":""},{"location":"mvp/development/05-mvp-data-flow/#process_2","title":"Process","text":"<pre><code>from contexts.external_trains.application.external_trains_context import ExternalTrainsContext\n\nexternal_trains = ExternalTrainsContext(env, scenario, event_bus)\nexternal_trains.initialize_arrivals()\n# Schedules train arrival events\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#output_2","title":"Output","text":"<p>Scheduled SimPy processes that publish TrainArrivedEvent at specified times.</p>"},{"location":"mvp/development/05-mvp-data-flow/#phase-4-retrofit-workflow-execution","title":"Phase 4: Retrofit Workflow Execution","text":""},{"location":"mvp/development/05-mvp-data-flow/#input-scenario-railway-external-trains","title":"Input: Scenario + Railway + External Trains","text":""},{"location":"mvp/development/05-mvp-data-flow/#process_3","title":"Process","text":"<pre><code>from contexts.retrofit_workflow.application.retrofit_workflow_context import RetrofitWorkflowContext\n\nworkflow = RetrofitWorkflowContext(env, scenario, railway, external_trains)\nworkflow.run()\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#data-flow-within-workflow","title":"Data Flow Within Workflow","text":"<pre><code>TrainArrivedEvent\n    \u2193\nArrivalCoordinator\n    \u2193 (classify wagons)\nCollectionCoordinator\n    \u2193 (form batches)\nWorkshopCoordinator\n    \u2193 (retrofit)\nParkingCoordinator\n    \u2193 (to parking)\nMetrics Collection\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#output_3","title":"Output","text":"<pre><code>{\n    'wagon_events': [...],\n    'locomotive_events': [...],\n    'workshop_events': [...]\n}\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#phase-5-results-export","title":"Phase 5: Results Export","text":""},{"location":"mvp/development/05-mvp-data-flow/#input-metrics","title":"Input: Metrics","text":""},{"location":"mvp/development/05-mvp-data-flow/#process_4","title":"Process","text":"<pre><code>metrics = workflow.get_metrics()\nworkflow.export_events(output_path)\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#output_4","title":"Output","text":"<pre><code>output/\n\u251c\u2500\u2500 wagon_events.csv\n\u251c\u2500\u2500 locomotive_events.csv\n\u251c\u2500\u2500 workshop_events.csv\n\u2514\u2500\u2500 charts/\n    \u251c\u2500\u2500 throughput.png\n    \u2514\u2500\u2500 utilization.png\n</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#data-transformations","title":"Data Transformations","text":"Phase Input Output Context 1 JSON/CSV files Scenario Configuration 2 Scenario Track infrastructure Railway Infrastructure 3 Scenario Scheduled arrivals External Trains 4 All above Metrics Retrofit Workflow 5 Metrics CSV/Charts Retrofit Workflow"},{"location":"mvp/development/05-mvp-data-flow/#event-flow","title":"Event Flow","text":"<pre><code>sequenceDiagram\n    participant ET as External Trains\n    participant EB as Event Bus\n    participant AC as ArrivalCoordinator\n    participant CC as CollectionCoordinator\n    participant WC as WorkshopCoordinator\n    participant PC as ParkingCoordinator\n\n    ET-&gt;&gt;EB: TrainArrivedEvent\n    EB-&gt;&gt;AC: Deliver event\n    AC-&gt;&gt;AC: Classify wagons\n    AC-&gt;&gt;CC: Queue wagons\n    CC-&gt;&gt;CC: Form batch\n    CC-&gt;&gt;WC: Transport to workshop\n    WC-&gt;&gt;WC: Execute retrofit\n    WC-&gt;&gt;PC: Move to parking\n    PC-&gt;&gt;PC: Complete</code></pre>"},{"location":"mvp/development/05-mvp-data-flow/#error-handling","title":"Error Handling","text":"<pre><code>try:\n    # Load configuration\n    scenario = builder.build()\nexcept ValidationError as e:\n    logger.error(f\"Configuration error: {e}\")\n    sys.exit(1)\n\ntry:\n    # Run simulation\n    workflow.run()\nexcept SimulationError as e:\n    logger.error(f\"Simulation error: {e}\")\n    # Export partial results\n    workflow.export_events(output_path)\n    sys.exit(2)\n</code></pre>"},{"location":"mvp/development/06-mvp-technology-stack/","title":"6. MVP Technology Stack","text":""},{"location":"mvp/development/06-mvp-technology-stack/#core-technologies","title":"Core Technologies","text":"Technology Version Purpose Location Python 3.13+ Runtime All contexts SimPy 4.0.1+ Discrete event simulation Retrofit Workflow Pydantic 2.0+ Data validation Configuration Plotly 6.5+ Visualization Frontend dashboard Streamlit 1.52+ Dashboard UI Frontend Pandas 2.0+ CSV processing Configuration, Frontend"},{"location":"mvp/development/06-mvp-technology-stack/#development-tools","title":"Development Tools","text":"Tool Purpose Configuration uv Package manager <code>pyproject.toml</code> Ruff Formatting &amp; linting <code>pyproject.toml</code> MyPy Type checking <code>disallow_untyped_defs = true</code> Pylint Static analysis <code>pyproject.toml</code> Pytest Testing 374 tests passing"},{"location":"mvp/development/06-mvp-technology-stack/#context-specific-technologies","title":"Context-Specific Technologies","text":""},{"location":"mvp/development/06-mvp-technology-stack/#configuration-context","title":"Configuration Context","text":"<ul> <li>Pydantic 2.0+ - Model validation</li> <li>Pandas - CSV parsing</li> <li>JSON - File loading</li> </ul>"},{"location":"mvp/development/06-mvp-technology-stack/#retrofit-workflow-context","title":"Retrofit Workflow Context","text":"<ul> <li>SimPy - Simulation engine</li> <li>Matplotlib - Chart generation</li> <li>Dataclasses - Domain entities</li> </ul>"},{"location":"mvp/development/06-mvp-technology-stack/#railway-infrastructure-context","title":"Railway Infrastructure Context","text":"<ul> <li>Dataclasses - Track aggregates</li> <li>Enums - Track types</li> </ul>"},{"location":"mvp/development/06-mvp-technology-stack/#external-trains-context","title":"External Trains Context","text":"<ul> <li>SimPy - Event scheduling</li> <li>Dataclasses - Events</li> </ul>"},{"location":"mvp/development/06-mvp-technology-stack/#installation","title":"Installation","text":"<pre><code># Install uv\npip install uv\n\n# Install dependencies\nuv sync\n\n# Verify installation\nuv run pytest\n</code></pre>"},{"location":"mvp/development/06-mvp-technology-stack/#dependencies","title":"Dependencies","text":"<p>See <code>pyproject.toml</code> for complete dependency list.</p>"},{"location":"mvp/development/07-mvp-file-formats/","title":"7. MVP File Formats","text":""},{"location":"mvp/development/07-mvp-file-formats/#overview","title":"Overview","text":"<p>PopUpSim supports JSON and CSV configuration files. See actual examples in <code>Data/examples/</code>.</p>"},{"location":"mvp/development/07-mvp-file-formats/#json-format","title":"JSON Format","text":""},{"location":"mvp/development/07-mvp-file-formats/#scenariojson","title":"scenario.json","text":"<pre><code>{\n  \"id\": \"demo_scenario\",\n  \"start_date\": \"2025-01-01T00:00:00\",\n  \"end_date\": \"2025-01-02T00:00:00\",\n  \"tracks_file\": \"tracks.json\",\n  \"workshops_file\": \"workshops.json\",\n  \"locomotives_file\": \"locomotives.json\",\n  \"routes_file\": \"routes.json\",\n  \"trains_file\": \"trains.csv\",\n  \"process_times_file\": \"process_times.json\"\n}\n</code></pre>"},{"location":"mvp/development/07-mvp-file-formats/#tracksjson","title":"tracks.json","text":"<pre><code>[\n  {\n    \"track_id\": \"T001\",\n    \"track_type\": \"collection\",\n    \"length\": 200.0,\n    \"fill_factor\": 0.75\n  }\n]\n</code></pre>"},{"location":"mvp/development/07-mvp-file-formats/#workshopsjson","title":"workshops.json","text":"<pre><code>[\n  {\n    \"workshop_id\": \"W001\",\n    \"track_id\": \"T002\",\n    \"retrofit_stations\": 3,\n    \"name\": \"Main Workshop\"\n  }\n]\n</code></pre>"},{"location":"mvp/development/07-mvp-file-formats/#locomotivesjson","title":"locomotives.json","text":"<pre><code>[\n  {\n    \"locomotive_id\": \"L001\",\n    \"status\": \"available\"\n  }\n]\n</code></pre>"},{"location":"mvp/development/07-mvp-file-formats/#routesjson","title":"routes.json","text":"<pre><code>[\n  {\n    \"route_id\": \"R001\",\n    \"from_track_id\": \"T001\",\n    \"to_track_id\": \"T002\",\n    \"duration\": 5.0\n  }\n]\n</code></pre>"},{"location":"mvp/development/07-mvp-file-formats/#process_timesjson","title":"process_times.json","text":"<pre><code>{\n  \"coupling_time\": 2.0,\n  \"decoupling_time\": 2.0,\n  \"retrofit_time_per_wagon\": 30.0,\n  \"train_preparation_time\": 5.0\n}\n</code></pre>"},{"location":"mvp/development/07-mvp-file-formats/#csv-format","title":"CSV Format","text":""},{"location":"mvp/development/07-mvp-file-formats/#trainscsv","title":"trains.csv","text":"<pre><code>train_id,arrival_time,wagon_id,length,needs_retrofit\nT001,60.0,W001,15.5,true\nT001,60.0,W002,15.5,true\nT002,120.0,W003,18.0,true\n</code></pre>"},{"location":"mvp/development/07-mvp-file-formats/#validation","title":"Validation","text":"<p>All files are validated by Pydantic models. See configuration-validation.md for details.</p>"},{"location":"mvp/development/07-mvp-file-formats/#examples","title":"Examples","text":"<p>Real examples available in: - <code>Data/examples/two_trains/</code> - JSON format - <code>Data/examples/medium_scenario/</code> - JSON + CSV - <code>Data/examples/csv_scenario/</code> - CSV format</p> <p>See examples.md for complete list.</p>"},{"location":"mvp/development/08-mvp-testing-strategy/","title":"8. MVP Testing Strategy","text":""},{"location":"mvp/development/08-mvp-testing-strategy/#overview","title":"Overview","text":"<p>Location: <code>popupsim/backend/tests/</code></p> <p>Status: 374 tests passing</p>"},{"location":"mvp/development/08-mvp-testing-strategy/#test-organization","title":"Test Organization","text":"<pre><code>tests/\n\u251c\u2500\u2500 unit/\n\u2502   \u251c\u2500\u2500 configuration/          # Configuration Context tests\n\u2502   \u251c\u2500\u2500 retrofit_workflow/      # Retrofit Workflow tests\n\u2502   \u251c\u2500\u2500 railway_infrastructure/ # Railway Infrastructure tests\n\u2502   \u2514\u2500\u2500 external_trains/        # External Trains tests\n\u251c\u2500\u2500 integration/                # Cross-context tests\n\u2514\u2500\u2500 conftest.py                 # Pytest configuration\n</code></pre>"},{"location":"mvp/development/08-mvp-testing-strategy/#test-types","title":"Test Types","text":""},{"location":"mvp/development/08-mvp-testing-strategy/#unit-tests","title":"Unit Tests","text":"<p>Test individual components without external dependencies:</p> <pre><code>def test_batch_formation() -&gt; None:\n    \"\"\"Test domain service.\"\"\"\n    service = BatchFormationService()\n    wagons = [Wagon(...) for _ in range(5)]\n\n    assert service.can_form_batch(wagons, min_size=1, max_size=10)\n</code></pre>"},{"location":"mvp/development/08-mvp-testing-strategy/#integration-tests","title":"Integration Tests","text":"<p>Test context interactions:</p> <pre><code>def test_configuration_loading() -&gt; None:\n    \"\"\"Test file loading.\"\"\"\n    builder = ConfigurationBuilder(Path(\"test_scenario\"))\n    scenario = builder.build()\n\n    assert scenario.id == \"test\"\n    assert len(scenario.workshops) &gt; 0\n</code></pre>"},{"location":"mvp/development/08-mvp-testing-strategy/#simulation-tests","title":"Simulation Tests","text":"<p>Test with SimPy:</p> <pre><code>def test_collection_coordinator() -&gt; None:\n    \"\"\"Test coordinator with SimPy.\"\"\"\n    env = simpy.Environment()\n    coordinator = CollectionCoordinator(...)\n    coordinator.start()\n\n    env.run(until=100)\n\n    assert len(coordinator.processed_batches) &gt; 0\n</code></pre>"},{"location":"mvp/development/08-mvp-testing-strategy/#running-tests","title":"Running Tests","text":"<pre><code># All tests\nuv run pytest\n\n# Specific context\nuv run pytest popupsim/backend/tests/unit/configuration/\n\n# With coverage\nuv run pytest --cov=popupsim/backend/src/\n\n# Verbose\nuv run pytest -v\n</code></pre>"},{"location":"mvp/development/08-mvp-testing-strategy/#test-fixtures","title":"Test Fixtures","text":"<p>File: <code>tests/conftest.py</code></p> <pre><code>import pytest\nfrom pathlib import Path\n\n@pytest.fixture\ndef test_scenario_path() -&gt; Path:\n    \"\"\"Path to test scenario.\"\"\"\n    return Path(\"tests/fixtures/test_scenario\")\n\n@pytest.fixture\ndef sample_scenario() -&gt; Scenario:\n    \"\"\"Sample scenario for testing.\"\"\"\n    return Scenario(\n        id=\"test\",\n        start_date=datetime(2025, 1, 1),\n        end_date=datetime(2025, 1, 2),\n        ...\n    )\n</code></pre>"},{"location":"mvp/development/08-mvp-testing-strategy/#coverage-goals","title":"Coverage Goals","text":"<ul> <li>Domain services: &gt; 90%</li> <li>Coordinators: &gt; 80%</li> <li>Infrastructure: &gt; 70%</li> <li>Overall: &gt; 80%</li> </ul>"},{"location":"mvp/development/08-mvp-testing-strategy/#best-practices","title":"Best Practices","text":""},{"location":"mvp/development/08-mvp-testing-strategy/#dos","title":"\u2705 Do's","text":"<ul> <li>Test domain logic without SimPy</li> <li>Use fixtures for common test data</li> <li>Test error cases</li> <li>Keep tests fast</li> </ul>"},{"location":"mvp/development/08-mvp-testing-strategy/#donts","title":"\u274c Don'ts","text":"<ul> <li>Don't test external libraries</li> <li>Don't use real file I/O in unit tests</li> <li>Don't create complex test scenarios</li> </ul>"},{"location":"mvp/development/09-mvp-deployment/","title":"9. MVP Deployment","text":""},{"location":"mvp/development/09-mvp-deployment/#overview","title":"Overview","text":"<p>PopUpSim MVP is a desktop application with local execution.</p>"},{"location":"mvp/development/09-mvp-deployment/#deployment-model","title":"Deployment Model","text":"<pre><code>Developer Laptop\n\u251c\u2500\u2500 Python 3.13+\n\u251c\u2500\u2500 popupsim/backend/src/\n\u2502   \u2514\u2500\u2500 contexts/\n\u2502       \u251c\u2500\u2500 configuration/\n\u2502       \u251c\u2500\u2500 retrofit_workflow/\n\u2502       \u251c\u2500\u2500 railway_infrastructure/\n\u2502       \u2514\u2500\u2500 external_trains/\n\u251c\u2500\u2500 Data/examples/\n\u2514\u2500\u2500 output/\n</code></pre>"},{"location":"mvp/development/09-mvp-deployment/#installation","title":"Installation","text":"<pre><code># 1. Clone repository\ngit clone https://github.com/open-rail-association/dac-migration-dss-popupsim.git\ncd dac-migration-dss-popupsim\n\n# 2. Install uv\npip install uv\n\n# 3. Install dependencies\nuv sync\n\n# 4. Verify installation\nuv run pytest\n</code></pre>"},{"location":"mvp/development/09-mvp-deployment/#running-simulations","title":"Running Simulations","text":"<pre><code># Basic usage\nuv run python popupsim/backend/src/main.py --config Data/examples/two_trains/\n\n# With custom output\nuv run python popupsim/backend/src/main.py \\\n  --config Data/examples/medium_scenario/ \\\n  --output results/my_test/\n</code></pre>"},{"location":"mvp/development/09-mvp-deployment/#directory-structure","title":"Directory Structure","text":"<pre><code>popupsim/backend/src/\n\u251c\u2500\u2500 main.py                     # Entry point\n\u251c\u2500\u2500 application/\n\u2502   \u2514\u2500\u2500 simulation_service.py   # Orchestration\n\u2514\u2500\u2500 contexts/\n    \u251c\u2500\u2500 configuration/\n    \u251c\u2500\u2500 retrofit_workflow/\n    \u251c\u2500\u2500 railway_infrastructure/\n    \u2514\u2500\u2500 external_trains/\n</code></pre>"},{"location":"mvp/development/09-mvp-deployment/#requirements","title":"Requirements","text":"<ul> <li>Python: 3.13+</li> <li>OS: Windows 10+, macOS 10.15+, Ubuntu 20.04+</li> <li>RAM: Varies by scenario size</li> <li>Disk: ~500MB for installation</li> </ul>"},{"location":"mvp/development/09-mvp-deployment/#output","title":"Output","text":"<p>Results are written to <code>output/</code> directory:</p> <pre><code>output/\n\u251c\u2500\u2500 wagon_events.csv\n\u251c\u2500\u2500 locomotive_events.csv\n\u251c\u2500\u2500 workshop_events.csv\n\u2514\u2500\u2500 charts/\n    \u251c\u2500\u2500 throughput.png\n    \u2514\u2500\u2500 utilization.png\n</code></pre>"},{"location":"mvp/development/09-mvp-deployment/#development-commands","title":"Development Commands","text":"<pre><code># Format code\nuv run ruff format .\n\n# Lint\nuv run ruff check .\n\n# Type check\nuv run mypy popupsim/backend/src/\n\n# Static analysis\nuv run pylint popupsim/backend/src/\n\n# All checks\nuv run ruff format . &amp;&amp; \\\nuv run ruff check . &amp;&amp; \\\nuv run mypy popupsim/backend/src/ &amp;&amp; \\\nuv run pylint popupsim/backend/src/ &amp;&amp; \\\nuv run pytest\n</code></pre>"},{"location":"mvp/development/10-mvp-migration-path/","title":"10. MVP Migration Path","text":""},{"location":"mvp/development/10-mvp-migration-path/#overview","title":"Overview","text":"<p>Path from MVP (4 contexts, desktop) to full version (web-based, distributed).</p>"},{"location":"mvp/development/10-mvp-migration-path/#current-mvp-architecture","title":"Current MVP Architecture","text":"<pre><code>4 Bounded Contexts:\n\u251c\u2500\u2500 Configuration (file loading)\n\u251c\u2500\u2500 Retrofit Workflow (simulation)\n\u251c\u2500\u2500 Railway Infrastructure (track management)\n\u2514\u2500\u2500 External Trains (arrivals)\n\nIntegration: Direct calls + Event bus\nStorage: File-based (JSON/CSV)\nUI: CLI + Matplotlib\nDeployment: Desktop\n</code></pre>"},{"location":"mvp/development/10-mvp-migration-path/#full-version-target","title":"Full Version Target","text":"<pre><code>Multiple Contexts (TBD):\n\u251c\u2500\u2500 Configuration\n\u251c\u2500\u2500 Simulation Engine\n\u251c\u2500\u2500 Railway Infrastructure\n\u251c\u2500\u2500 Train Operations\n\u251c\u2500\u2500 Workshop Management\n\u251c\u2500\u2500 Resource Management\n\u2514\u2500\u2500 Analytics\n\nIntegration: Event-driven (async messaging)\nStorage: Database + Event Store\nUI: Web interface (interactive)\nDeployment: Cloud-ready\n</code></pre>"},{"location":"mvp/development/10-mvp-migration-path/#migration-phases","title":"Migration Phases","text":""},{"location":"mvp/development/10-mvp-migration-path/#phase-1-event-driven-architecture","title":"Phase 1: Event-Driven Architecture","text":"<p>Current: Direct method calls + simple event bus</p> <p>Target: Full event-driven with async messaging</p> <p>Changes: - Replace direct calls with domain events - Add event store for persistence - Implement saga pattern for workflows</p> <p>Effort: 2-3 weeks</p>"},{"location":"mvp/development/10-mvp-migration-path/#phase-2-database-integration","title":"Phase 2: Database Integration","text":"<p>Current: File-based configuration</p> <p>Target: Database storage with repository pattern</p> <p>Changes: - Add repository interfaces - Implement database repositories - Migrate file loading to database queries</p> <p>Effort: 1-2 weeks</p>"},{"location":"mvp/development/10-mvp-migration-path/#phase-3-web-interface","title":"Phase 3: Web Interface","text":"<p>Current: CLI + Matplotlib charts</p> <p>Target: Web UI with interactive visualization</p> <p>Changes: - Add REST API layer - Implement web frontend - Real-time simulation updates</p> <p>Effort: 4-6 weeks</p>"},{"location":"mvp/development/10-mvp-migration-path/#phase-4-context-refinement","title":"Phase 4: Context Refinement","text":"<p>Current: 4 contexts</p> <p>Target: More specialized contexts</p> <p>Changes: - Split Retrofit Workflow into smaller contexts - Add new contexts as needed - Refine boundaries based on learnings</p> <p>Effort: 2-3 weeks</p>"},{"location":"mvp/development/10-mvp-migration-path/#technical-debt-to-address","title":"Technical Debt to Address","text":""},{"location":"mvp/development/10-mvp-migration-path/#high-priority","title":"High Priority","text":"<ol> <li>SimPy Abstraction</li> <li>Current: Direct SimPy usage in coordinators</li> <li>Target: Full abstraction layer</li> <li> <p>Effort: 3 days</p> </li> <li> <p>Service Interfaces</p> </li> <li>Current: Concrete implementations</li> <li>Target: Interface-based design</li> <li>Effort: 5 days</li> </ol>"},{"location":"mvp/development/10-mvp-migration-path/#medium-priority","title":"Medium Priority","text":"<ol> <li>Repository Pattern</li> <li>Current: Direct file access</li> <li>Target: Repository interfaces</li> <li> <p>Effort: 3 days</p> </li> <li> <p>Error Handling</p> </li> <li>Current: Basic exception handling</li> <li>Target: Comprehensive error strategy</li> <li>Effort: 2 days</li> </ol>"},{"location":"mvp/development/10-mvp-migration-path/#compatibility-strategy","title":"Compatibility Strategy","text":""},{"location":"mvp/development/10-mvp-migration-path/#backward-compatibility","title":"Backward Compatibility","text":"<ul> <li>Keep file-based configuration support</li> <li>Maintain CLI interface alongside web UI</li> <li>Support both local and cloud deployment</li> </ul>"},{"location":"mvp/development/10-mvp-migration-path/#data-migration","title":"Data Migration","text":"<ul> <li>Provide migration scripts for file \u2192 database</li> <li>Support hybrid mode during transition</li> <li>Maintain data format compatibility</li> </ul>"},{"location":"mvp/development/10-mvp-migration-path/#risk-mitigation","title":"Risk Mitigation","text":"Risk Mitigation Breaking changes Maintain MVP as stable branch Performance degradation Benchmark before/after Complexity increase Incremental migration Team learning curve Training and documentation"},{"location":"mvp/development/11-mvp-domain-processes/","title":"11. MVP Domain Processes","text":""},{"location":"mvp/development/11-mvp-domain-processes/#overview","title":"Overview","text":"<p>This document describes the main process flows in the Retrofit Workflow Context.</p>"},{"location":"mvp/development/11-mvp-domain-processes/#wagon-flow-process","title":"Wagon Flow Process","text":"<pre><code>Train Arrival\n    \u2193\nArrival Coordinator (classify wagons)\n    \u2193\nCollection Coordinator (form batches)\n    \u2193\nWorkshop Coordinator (retrofit)\n    \u2193\nParking Coordinator (to parking)\n    \u2193\nComplete\n</code></pre>"},{"location":"mvp/development/11-mvp-domain-processes/#detailed-process-flows","title":"Detailed Process Flows","text":""},{"location":"mvp/development/11-mvp-domain-processes/#1-train-arrival-process","title":"1. Train Arrival Process","text":"<p>Coordinator: ArrivalCoordinator</p> <p>Steps: 1. Receive TrainArrivedEvent from External Trains 2. Classify wagons (needs retrofit vs. doesn't need) 3. Select collection track using TrackSelector 4. Place wagons on collection track 5. Add wagons to collection queue</p> <p>Domain Services Used: - WagonSelector (classify) - WagonStateManager (update status)</p>"},{"location":"mvp/development/11-mvp-domain-processes/#2-collection-process","title":"2. Collection Process","text":"<p>Coordinator: CollectionCoordinator</p> <p>Steps: 1. Wait for wagons in collection queue 2. Collect batch (up to batch_size) 3. Allocate locomotive 4. Form rake (couple wagons) 5. Form train (locomotive + rake) 6. Transport to retrofit track 7. Decouple wagons 8. Release locomotive</p> <p>Domain Services Used: - BatchFormationService - RakeFormationService - TrainFormationService - RouteService</p>"},{"location":"mvp/development/11-mvp-domain-processes/#3-workshop-process","title":"3. Workshop Process","text":"<p>Coordinator: WorkshopCoordinator</p> <p>Steps: 1. Wait for batch on retrofit track 2. Select workshop with capacity 3. Allocate locomotive 4. Transport batch to workshop track 5. Decouple wagons sequentially 6. Assign each wagon to retrofit station 7. Execute retrofit (parallel) 8. Couple completed wagons 9. Transport to retrofitted track 10. Release locomotive</p> <p>Domain Services Used: - WorkshopSchedulingService - CouplingService - RouteService</p>"},{"location":"mvp/development/11-mvp-domain-processes/#4-parking-process","title":"4. Parking Process","text":"<p>Coordinator: ParkingCoordinator</p> <p>Steps: 1. Wait for wagons on retrofitted track 2. Form batch 3. Allocate locomotive 4. Transport to parking track 5. Place wagons 6. Release locomotive</p> <p>Domain Services Used: - BatchFormationService - RouteService</p>"},{"location":"mvp/development/11-mvp-domain-processes/#state-machines","title":"State Machines","text":""},{"location":"mvp/development/11-mvp-domain-processes/#wagon-state-machine","title":"Wagon State Machine","text":"<pre><code>ARRIVING \u2192 SELECTING \u2192 SELECTED \u2192 MOVING \u2192 \nON_COLLECTION_TRACK \u2192 MOVING \u2192 ON_RETROFIT_TRACK \u2192 \nMOVING \u2192 RETROFITTING \u2192 RETROFITTED \u2192 MOVING \u2192 \nON_RETROFITTED_TRACK \u2192 MOVING \u2192 PARKING\n</code></pre>"},{"location":"mvp/development/11-mvp-domain-processes/#locomotive-state-machine","title":"Locomotive State Machine","text":"<pre><code>AVAILABLE \u2192 ALLOCATED \u2192 IN_USE \u2192 RETURNING \u2192 AVAILABLE\n</code></pre>"},{"location":"mvp/development/11-mvp-domain-processes/#timing","title":"Timing","text":"<p>All timing parameters defined in ProcessTimes: - coupling_time - decoupling_time - retrofit_time_per_wagon - train_preparation_time</p>"},{"location":"mvp/development/11-mvp-domain-processes/#resource-constraints","title":"Resource Constraints","text":"<ul> <li>Locomotives: Limited pool, allocated on demand</li> <li>Tracks: Capacity based on length and fill factor</li> <li>Workshops: Limited retrofit stations</li> </ul>"},{"location":"mvp/development/11-mvp-domain-processes/#error-handling","title":"Error Handling","text":"<ul> <li>Insufficient capacity: Wagon waits in queue</li> <li>No locomotive available: Process blocks until available</li> <li>Invalid route: Simulation error</li> </ul>"},{"location":"mvp/development/business-rules/","title":"Business Rules","text":""},{"location":"mvp/development/business-rules/#overview","title":"Overview","text":"<p>This document consolidates all business rules for the PopUpSim MVP. These rules must be validated during implementation.</p> <p>Status: \ud83d\udccb FOR REVIEW - Rules need validation by domain experts</p>"},{"location":"mvp/development/business-rules/#track-capacity-rules","title":"Track Capacity Rules","text":""},{"location":"mvp/development/business-rules/#rule-br-tc-001-track-capacity-limit","title":"Rule BR-TC-001: Track Capacity Limit","text":"<p>Description: TODO: Define maximum wagon capacity per track</p> <p>Validation: TODO: How is capacity enforced?</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#rule-br-tc-002-track-function-restrictions","title":"Rule BR-TC-002: Track Function Restrictions","text":"<p>Description: TODO: Define which operations are allowed per track function</p> <p>Validation: TODO: How are restrictions enforced?</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#retrofit-time-rules","title":"Retrofit Time Rules","text":""},{"location":"mvp/development/business-rules/#rule-br-rt-001-retrofit-duration","title":"Rule BR-RT-001: Retrofit Duration","text":"<p>Description: Retrofit takes approximately 30 minutes per wagon</p> <p>Validation: TODO: Is this fixed or variable?</p> <p>Exception: TODO: Different wagon types?</p>"},{"location":"mvp/development/business-rules/#rule-br-rt-002-werkstattgleis-retrofit-time","title":"Rule BR-RT-002: Werkstattgleis Retrofit Time","text":"<p>Description: Only werkstattgleis tracks have retrofit_time_min &gt; 0</p> <p>Validation: Enforced by Pydantic validation in WorkshopTrack model</p> <p>Exception: None</p>"},{"location":"mvp/development/business-rules/#workshop-validation-rules","title":"Workshop Validation Rules","text":""},{"location":"mvp/development/business-rules/#rule-br-wv-001-minimum-werkstattgleis","title":"Rule BR-WV-001: Minimum Werkstattgleis","text":"<p>Description: Workshop must have at least one WERKSTATTGLEIS track</p> <p>Validation: Enforced by Pydantic validation in Workshop model</p> <p>Exception: None</p>"},{"location":"mvp/development/business-rules/#rule-br-wv-002-unique-track-ids","title":"Rule BR-WV-002: Unique Track IDs","text":"<p>Description: All track IDs within a workshop must be unique</p> <p>Validation: Enforced by Pydantic validation in Workshop model</p> <p>Exception: None</p>"},{"location":"mvp/development/business-rules/#rule-br-wv-003-balanced-feederexit-tracks","title":"Rule BR-WV-003: Balanced Feeder/Exit Tracks","text":"<p>Description: If werkstattzufuehrung exists, werkstattabfuehrung must exist (and vice versa)</p> <p>Validation: Enforced by Pydantic validation in Workshop model</p> <p>Exception: None</p>"},{"location":"mvp/development/business-rules/#train-processing-rules","title":"Train Processing Rules","text":""},{"location":"mvp/development/business-rules/#rule-br-tp-001-train-arrival-processing","title":"Rule BR-TP-001: Train Arrival Processing","text":"<p>Description: TODO: Define how trains are processed on arrival</p> <p>Validation: TODO: How is this enforced?</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#rule-br-tp-002-wagon-decoupling","title":"Rule BR-TP-002: Wagon Decoupling","text":"<p>Description: TODO: Define wagon decoupling rules</p> <p>Validation: TODO: How is this enforced?</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#wagon-flow-rules","title":"Wagon Flow Rules","text":""},{"location":"mvp/development/business-rules/#rule-br-wf-001-wagon-state-transitions","title":"Rule BR-WF-001: Wagon State Transitions","text":"<p>Description: TODO: Define valid state transitions for wagons</p> <p>Validation: TODO: How is this enforced?</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#rule-br-wf-002-track-allocation-priority","title":"Rule BR-WF-002: Track Allocation Priority","text":"<p>Description: TODO: Define priority rules for track allocation</p> <p>Validation: TODO: How is this enforced?</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#capacity-management-rules","title":"Capacity Management Rules","text":""},{"location":"mvp/development/business-rules/#rule-br-cm-001-workshop-overflow","title":"Rule BR-CM-001: Workshop Overflow","text":"<p>Description: TODO: Define what happens when workshop is at capacity</p> <p>Validation: TODO: How is this enforced?</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#rule-br-cm-002-queue-management","title":"Rule BR-CM-002: Queue Management","text":"<p>Description: TODO: Define how waiting wagons are queued</p> <p>Validation: TODO: How is this enforced?</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#simulation-rules","title":"Simulation Rules","text":""},{"location":"mvp/development/business-rules/#rule-br-sim-001-deterministic-behavior","title":"Rule BR-SIM-001: Deterministic Behavior","text":"<p>Description: Same inputs must produce identical results</p> <p>Validation: TODO: How is determinism ensured?</p> <p>Exception: None</p>"},{"location":"mvp/development/business-rules/#rule-br-sim-002-time-progression","title":"Rule BR-SIM-002: Time Progression","text":"<p>Description: TODO: Define how simulation time progresses</p> <p>Validation: TODO: SimPy discrete event scheduling</p> <p>Exception: TODO: Any exceptions?</p>"},{"location":"mvp/development/business-rules/#data-validation-rules","title":"Data Validation Rules","text":""},{"location":"mvp/development/business-rules/#rule-br-dv-001-date-range-validation","title":"Rule BR-DV-001: Date Range Validation","text":"<p>Description: end_date must be after start_date</p> <p>Validation: Enforced by Pydantic validation in ScenarioConfig model</p> <p>Exception: None</p>"},{"location":"mvp/development/business-rules/#rule-br-dv-002-scenario-id-format","title":"Rule BR-DV-002: Scenario ID Format","text":"<p>Description: Scenario ID must match pattern ^[a-zA-Z0-9_-]+$ with length 1-50</p> <p>Validation: Enforced by Pydantic validation in ScenarioConfig model</p> <p>Exception: None</p>"},{"location":"mvp/development/business-rules/#review-checklist","title":"Review Checklist","text":"<ul> <li>[ ] All rules validated by domain experts</li> <li>[ ] All TODOs filled in</li> <li>[ ] Rules implemented in code</li> <li>[ ] Rules covered by tests</li> <li>[ ] Exceptions documented</li> <li>[ ] Cross-references to code added</li> </ul>"},{"location":"mvp/development/configuration-validation/","title":"Configuration Validation","text":""},{"location":"mvp/development/configuration-validation/#overview","title":"Overview","text":"<p>Note: See actual implementation in <code>popupsim/backend/src/contexts/configuration/domain/models/</code></p> <p>This document describes Pydantic validation patterns used across the 4 contexts.</p>"},{"location":"mvp/development/configuration-validation/#pydantic-20-validation","title":"Pydantic 2.0 Validation","text":""},{"location":"mvp/development/configuration-validation/#basic-model","title":"Basic Model","text":"<pre><code>from pydantic import BaseModel, Field\nfrom datetime import date\n\nclass ScenarioConfig(BaseModel):\n    \"\"\"Scenario models with validation\"\"\"\n    scenario_id: str = Field(\n        pattern=r'^[a-zA-Z0-9_-]+$',\n        min_length=1,\n        max_length=50,\n        description=\"Unique scenario identifier\"\n    )\n    start_date: date\n    end_date: date\n</code></pre>"},{"location":"mvp/development/configuration-validation/#field-validators","title":"Field Validators","text":"<pre><code>from pydantic import field_validator\n\nclass Workshop(BaseModel):\n    tracks: list[WorkshopTrack] = Field(min_length=1)\n\n    @field_validator('tracks')\n    @classmethod\n    def validate_unique_track_ids(\n        cls,\n        tracks: list[WorkshopTrack]\n    ) -&gt; list[WorkshopTrack]:\n        \"\"\"Ensure all track IDs are unique\"\"\"\n        track_ids = [t.id for t in tracks]\n        if len(track_ids) != len(set(track_ids)):\n            raise ValueError(\"Track IDs must be unique\")\n        return tracks\n\n    @field_validator('tracks')\n    @classmethod\n    def validate_track_functions(\n        cls,\n        tracks: list[WorkshopTrack]\n    ) -&gt; list[WorkshopTrack]:\n        \"\"\"Ensure at least one WERKSTATTGLEIS exists\"\"\"\n        functions = [t.function for t in tracks]\n        if TrackFunction.WERKSTATTGLEIS not in functions:\n            raise ValueError(\"At least one WERKSTATTGLEIS required\")\n        return tracks\n</code></pre>"},{"location":"mvp/development/configuration-validation/#model-validators","title":"Model Validators","text":"<pre><code>from pydantic import model_validator\n\nclass ScenarioConfig(BaseModel):\n    start_date: date\n    end_date: date\n\n    @model_validator(mode='after')\n    def validate_date_range(self) -&gt; 'ScenarioConfig':\n        \"\"\"Validate date range\"\"\"\n        if self.end_date &lt;= self.start_date:\n            raise ValueError(\"end_date must be after start_date\")\n\n        duration = (self.end_date - self.start_date).days\n        if duration &gt; 7:\n            raise ValueError(\"Simulation duration cannot exceed 7 days\")\n\n        return self\n</code></pre>"},{"location":"mvp/development/configuration-validation/#enum-validation","title":"Enum Validation","text":"<pre><code>from enum import Enum\n\nclass TrackFunction(str, Enum):\n    \"\"\"Track function types\"\"\"\n    WERKSTATTGLEIS = \"werkstattgleis\"\n    SAMMELGLEIS = \"sammelgleis\"\n    PARKGLEIS = \"parkgleis\"\n    WERKSTATTZUFUEHRUNG = \"werkstattzufuehrung\"\n    WERKSTATTABFUEHRUNG = \"werkstattabfuehrung\"\n    BAHNHOFSKOPF = \"bahnhofskopf\"\n\nclass WorkshopTrack(BaseModel):\n    id: str\n    function: TrackFunction  # Automatically validated\n    capacity: int = Field(ge=1, le=20)\n    retrofit_time_min: int = Field(ge=0, le=300)\n</code></pre>"},{"location":"mvp/development/configuration-validation/#validation-examples","title":"Validation Examples","text":""},{"location":"mvp/development/configuration-validation/#valid-configuration","title":"Valid Configuration","text":"<pre><code>config = ScenarioConfig(\n    scenario_id=\"demo_scenario\",\n    start_date=date(2025, 1, 1),\n    end_date=date(2025, 1, 2),\n    workshop=Workshop(\n        tracks=[\n            WorkshopTrack(\n                id=\"TRACK01\",\n                function=TrackFunction.WERKSTATTGLEIS,\n                capacity=5,\n                retrofit_time_min=30\n            )\n        ]\n    ),\n    train_schedule_file=\"schedule.csv\"\n)\n# \u2705 Valid\n</code></pre>"},{"location":"mvp/development/configuration-validation/#invalid-configurations","title":"Invalid Configurations","text":"<p>Invalid scenario_id: <pre><code>config = ScenarioConfig(\n    scenario_id=\"invalid scenario!\",  # Contains space and special char\n    ...\n)\n# \u274c ValidationError: string does not match regex\n</code></pre></p> <p>Invalid date range: <pre><code>config = ScenarioConfig(\n    start_date=date(2025, 1, 2),\n    end_date=date(2025, 1, 1),  # Before start_date\n    ...\n)\n# \u274c ValidationError: end_date must be after start_date\n</code></pre></p> <p>Missing required track function: <pre><code>workshop = Workshop(\n    tracks=[\n        WorkshopTrack(\n            id=\"TRACK01\",\n            function=TrackFunction.WERKSTATTZUFUEHRUNG,  # Not WERKSTATTGLEIS\n            capacity=5,\n            retrofit_time_min=0\n        )\n    ]\n)\n# \u274c ValidationError: At least one WERKSTATTGLEIS required\n</code></pre></p> <p>Duplicate track IDs: <pre><code>workshop = Workshop(\n    tracks=[\n        WorkshopTrack(id=\"TRACK01\", ...),\n        WorkshopTrack(id=\"TRACK01\", ...),  # Duplicate\n    ]\n)\n# \u274c ValidationError: Track IDs must be unique\n</code></pre></p>"},{"location":"mvp/development/configuration-validation/#error-handling","title":"Error Handling","text":""},{"location":"mvp/development/configuration-validation/#catching-validation-errors","title":"Catching Validation Errors","text":"<pre><code>from pydantic import ValidationError\nimport json\n\ntry:\n    config = ScenarioConfig(**data)\nexcept ValidationError as e:\n    print(\"Validation failed:\")\n    print(e.json(indent=2))\n\n    # Access individual errors\n    for error in e.errors():\n        print(f\"Field: {error['loc']}\")\n        print(f\"Error: {error['msg']}\")\n        print(f\"Type: {error['type']}\")\n</code></pre>"},{"location":"mvp/development/configuration-validation/#error-response-format","title":"Error Response Format","text":"<pre><code>[\n  {\n    \"type\": \"string_pattern_mismatch\",\n    \"loc\": [\"scenario_id\"],\n    \"msg\": \"String should match pattern '^[a-zA-Z0-9_-]+$'\",\n    \"input\": \"invalid scenario!\",\n    \"ctx\": {\n      \"pattern\": \"^[a-zA-Z0-9_-]+$\"\n    }\n  },\n  {\n    \"type\": \"value_error\",\n    \"loc\": [\"workshop\", \"tracks\"],\n    \"msg\": \"Value error, At least one WERKSTATTGLEIS required\",\n    \"input\": [...]\n  }\n]\n</code></pre>"},{"location":"mvp/development/configuration-validation/#custom-validators","title":"Custom Validators","text":""},{"location":"mvp/development/configuration-validation/#complex-business-rules","title":"Complex Business Rules","text":"<pre><code>class Workshop(BaseModel):\n    tracks: list[WorkshopTrack]\n\n    @model_validator(mode='after')\n    def validate_capacity_distribution(self) -&gt; 'Workshop':\n        \"\"\"Ensure capacity is reasonably distributed\"\"\"\n        total_capacity = sum(t.capacity for t in self.tracks)\n\n        if total_capacity &lt; 3:\n            raise ValueError(\"Total workshop capacity must be at least 3\")\n\n        if total_capacity &gt; 50:\n            raise ValueError(\"Total workshop capacity cannot exceed 50\")\n\n        # Check for balanced distribution\n        capacities = [t.capacity for t in self.tracks]\n        max_capacity = max(capacities)\n        min_capacity = min(capacities)\n\n        if max_capacity &gt; min_capacity * 3:\n            raise ValueError(\n                \"Capacity distribution too unbalanced \"\n                f\"(max: {max_capacity}, min: {min_capacity})\"\n            )\n\n        return self\n</code></pre>"},{"location":"mvp/development/configuration-validation/#cross-field-validation","title":"Cross-Field Validation","text":"<pre><code>class WorkshopTrack(BaseModel):\n    id: str\n    function: TrackFunction\n    capacity: int\n    retrofit_time_min: int\n\n    @model_validator(mode='after')\n    def validate_retrofit_time(self) -&gt; 'WorkshopTrack':\n        \"\"\"Validate retrofit time based on function\"\"\"\n        if self.function == TrackFunction.WERKSTATTGLEIS:\n            if self.retrofit_time_min &lt;= 0:\n                raise ValueError(\n                    \"WERKSTATTGLEIS must have retrofit_time_min &gt; 0\"\n                )\n        else:\n            if self.retrofit_time_min != 0:\n                raise ValueError(\n                    f\"{self.function} must have retrofit_time_min = 0\"\n                )\n\n        return self\n</code></pre>"},{"location":"mvp/development/configuration-validation/#json-schema-generation","title":"JSON Schema Generation","text":"<pre><code># Generate JSON schema\nschema = ScenarioConfig.model_json_schema()\n\n# Save to file\nwith open(\"scenario_schema.json\", \"w\") as f:\n    json.dump(schema, f, indent=2)\n\n# Use for validation in other tools\n</code></pre>"},{"location":"mvp/development/configuration-validation/#testing-validation","title":"Testing Validation","text":"<pre><code>import pytest\nfrom pydantic import ValidationError\n\ndef test_valid_scenario_config() -&gt; None:\n    config = ScenarioConfig(\n        scenario_id=\"test\",\n        start_date=date(2025, 1, 1),\n        end_date=date(2025, 1, 2),\n        workshop=Workshop(tracks=[...]),\n        train_schedule_file=\"schedule.csv\"\n    )\n    assert config.scenario_id == \"test\"\n\ndef test_invalid_scenario_id() -&gt; None:\n    with pytest.raises(ValidationError) as exc_info:\n        ScenarioConfig(\n            scenario_id=\"invalid scenario!\",\n            ...\n        )\n\n    errors = exc_info.value.errors()\n    assert any(e['type'] == 'string_pattern_mismatch' for e in errors)\n\ndef test_invalid_date_range() -&gt; None:\n    with pytest.raises(ValidationError) as exc_info:\n        ScenarioConfig(\n            start_date=date(2025, 1, 2),\n            end_date=date(2025, 1, 1),\n            ...\n        )\n\n    errors = exc_info.value.errors()\n    assert any('end_date must be after start_date' in e['msg'] for e in errors)\n</code></pre>"},{"location":"mvp/development/configuration-validation/#best-practices","title":"Best Practices","text":""},{"location":"mvp/development/configuration-validation/#dos","title":"Do's","text":"<ul> <li>\u2705 Use Field() for constraints</li> <li>\u2705 Use @field_validator for single-field validation</li> <li>\u2705 Use @model_validator for cross-field validation</li> <li>\u2705 Provide clear error messages</li> <li>\u2705 Test all validation rules</li> <li>\u2705 Use Enums for fixed choices</li> </ul>"},{"location":"mvp/development/configuration-validation/#donts","title":"Don'ts","text":"<ul> <li>\u274c Don't use @validator (Pydantic v1 syntax)</li> <li>\u274c Don't validate in init</li> <li>\u274c Don't catch ValidationError silently</li> <li>\u274c Don't use complex validation logic in validators</li> <li>\u274c Don't forget to add type hints</li> </ul>"},{"location":"mvp/development/domain-models/","title":"Domain Models Reference","text":""},{"location":"mvp/development/domain-models/#overview","title":"Overview","text":"<p>Location: <code>popupsim/backend/src/contexts/</code></p> <p>This document provides a quick reference for domain models across the 4 bounded contexts.</p>"},{"location":"mvp/development/domain-models/#configuration-context-models","title":"Configuration Context Models","text":"<p>Location: <code>contexts/configuration/domain/models/</code></p>"},{"location":"mvp/development/domain-models/#scenario","title":"Scenario","text":"<pre><code>from pydantic import BaseModel\nfrom datetime import datetime\n\nclass Scenario(BaseModel):\n    \"\"\"Root configuration model.\"\"\"\n    id: str\n    start_date: datetime\n    end_date: datetime\n    trains: list[Train] | None = None\n    tracks: list[Track] | None = None\n    workshops: list[Workshop] | None = None\n    locomotives: list[Locomotive] | None = None\n    routes: list[Route] | None = None\n    process_times: ProcessTimes | None = None\n</code></pre>"},{"location":"mvp/development/domain-models/#workshop","title":"Workshop","text":"<pre><code>class Workshop(BaseModel):\n    \"\"\"Workshop configuration.\"\"\"\n    workshop_id: str\n    track_id: str\n    retrofit_stations: int\n    name: str | None = None\n</code></pre>"},{"location":"mvp/development/domain-models/#track","title":"Track","text":"<pre><code>class Track(BaseModel):\n    \"\"\"Track configuration.\"\"\"\n    track_id: str\n    track_type: str\n    length: float\n    fill_factor: float = 0.75\n</code></pre>"},{"location":"mvp/development/domain-models/#processtimes","title":"ProcessTimes","text":"<pre><code>class ProcessTimes(BaseModel):\n    \"\"\"Timing parameters for all operations.\"\"\"\n    coupling_time: float\n    decoupling_time: float\n    retrofit_time_per_wagon: float\n    train_preparation_time: float\n</code></pre>"},{"location":"mvp/development/domain-models/#retrofit-workflow-domain-models","title":"Retrofit Workflow Domain Models","text":"<p>Location: <code>contexts/retrofit_workflow/domain/</code></p>"},{"location":"mvp/development/domain-models/#wagon-entity","title":"Wagon (Entity)","text":"<pre><code>from dataclasses import dataclass\nfrom enum import Enum\n\nclass WagonStatus(str, Enum):\n    ARRIVING = \"arriving\"\n    SELECTING = \"selecting\"\n    SELECTED = \"selected\"\n    REJECTED = \"rejected\"\n    MOVING = \"moving\"\n    RETROFITTING = \"retrofitting\"\n    RETROFITTED = \"retrofitted\"\n    PARKING = \"parking\"\n\n@dataclass\nclass Wagon:\n    \"\"\"Individual freight wagon.\"\"\"\n    wagon_id: str\n    train_id: str\n    length: float\n    needs_retrofit: bool\n    status: WagonStatus\n    track_id: str | None = None\n</code></pre>"},{"location":"mvp/development/domain-models/#batch-value-object","title":"Batch (Value Object)","text":"<pre><code>@dataclass(frozen=True)\nclass Batch:\n    \"\"\"Wagon batch for processing.\"\"\"\n    batch_id: str\n    wagons: tuple[Wagon, ...]\n    total_length: float\n\n    @property\n    def size(self) -&gt; int:\n        return len(self.wagons)\n</code></pre>"},{"location":"mvp/development/domain-models/#rake-aggregate","title":"Rake (Aggregate)","text":"<pre><code>@dataclass\nclass Rake:\n    \"\"\"Coupled wagon formation.\"\"\"\n    rake_id: str\n    wagons: list[Wagon]\n\n    def get_total_length(self) -&gt; float:\n        return sum(w.length for w in self.wagons)\n</code></pre>"},{"location":"mvp/development/domain-models/#railway-infrastructure-domain-models","title":"Railway Infrastructure Domain Models","text":"<p>Location: <code>contexts/railway_infrastructure/domain/aggregates/</code></p>"},{"location":"mvp/development/domain-models/#track-entity","title":"Track (Entity)","text":"<pre><code>@dataclass\nclass Track:\n    \"\"\"Track with capacity management.\"\"\"\n    track_id: str\n    track_type: str\n    length: float\n    fill_factor: float\n    occupancy: TrackOccupancy\n\n    def can_accommodate(self, wagon_length: float) -&gt; bool:\n        return self.occupancy.can_add(wagon_length, self.length, self.fill_factor)\n</code></pre>"},{"location":"mvp/development/domain-models/#trackoccupancy-aggregate","title":"TrackOccupancy (Aggregate)","text":"<pre><code>@dataclass\nclass TrackOccupancy:\n    \"\"\"Manages wagon placement on track.\"\"\"\n    current_length: float = 0.0\n    wagon_count: int = 0\n\n    def can_add(self, wagon_length: float, track_length: float, fill_factor: float) -&gt; bool:\n        max_capacity = track_length * fill_factor\n        return self.current_length + wagon_length &lt;= max_capacity\n\n    def add_wagon(self, wagon_length: float) -&gt; None:\n        self.current_length += wagon_length\n        self.wagon_count += 1\n\n    def remove_wagon(self, wagon_length: float) -&gt; None:\n        self.current_length = max(0.0, self.current_length - wagon_length)\n        self.wagon_count = max(0, self.wagon_count - 1)\n</code></pre>"},{"location":"mvp/development/domain-models/#trackgroup-aggregate","title":"TrackGroup (Aggregate)","text":"<pre><code>@dataclass\nclass TrackGroup:\n    \"\"\"Group of tracks by type.\"\"\"\n    track_type: str\n    tracks: list[Track]\n\n    def get_available_tracks(self, required_length: float) -&gt; list[Track]:\n        return [t for t in self.tracks if t.can_accommodate(required_length)]\n</code></pre>"},{"location":"mvp/development/domain-models/#external-trains-domain-models","title":"External Trains Domain Models","text":"<p>Location: <code>contexts/external_trains/domain/</code></p>"},{"location":"mvp/development/domain-models/#trainarrivedevent-domain-event","title":"TrainArrivedEvent (Domain Event)","text":"<pre><code>@dataclass(frozen=True)\nclass TrainArrivedEvent:\n    \"\"\"Train arrival event.\"\"\"\n    train_id: str\n    wagons: tuple[Wagon, ...]\n    arrival_time: float\n</code></pre>"},{"location":"mvp/development/domain-models/#shared-domain-models","title":"Shared Domain Models","text":"<p>Location: <code>contexts/shared/domain/</code></p>"},{"location":"mvp/development/domain-models/#locomotive-entity","title":"Locomotive (Entity)","text":"<pre><code>@dataclass\nclass Locomotive:\n    \"\"\"Locomotive resource.\"\"\"\n    locomotive_id: str\n    status: str\n    current_track_id: str | None = None\n</code></pre>"},{"location":"mvp/development/domain-models/#route-value-object","title":"Route (Value Object)","text":"<pre><code>@dataclass(frozen=True)\nclass Route:\n    \"\"\"Route between tracks.\"\"\"\n    route_id: str\n    from_track_id: str\n    to_track_id: str\n    duration: float\n</code></pre>"},{"location":"mvp/development/domain-models/#enums","title":"Enums","text":""},{"location":"mvp/development/domain-models/#trackselectionstrategy","title":"TrackSelectionStrategy","text":"<pre><code>class TrackSelectionStrategy(str, Enum):\n    ROUND_ROBIN = \"round_robin\"\n    LEAST_OCCUPIED = \"least_occupied\"\n    FIRST_AVAILABLE = \"first_available\"\n    RANDOM = \"random\"\n</code></pre>"},{"location":"mvp/development/domain-models/#locodeliverystrategy","title":"LocoDeliveryStrategy","text":"<pre><code>class LocoDeliveryStrategy(str, Enum):\n    RETURN_TO_PARKING = \"return_to_parking\"\n    STAY_AT_WORKSHOP = \"stay_at_workshop\"\n</code></pre>"},{"location":"mvp/development/domain-models/#exceptions","title":"Exceptions","text":"<pre><code>class PopUpSimError(Exception):\n    \"\"\"Base exception.\"\"\"\n    pass\n\nclass ConfigurationError(PopUpSimError):\n    \"\"\"Configuration error.\"\"\"\n    pass\n\nclass SimulationError(PopUpSimError):\n    \"\"\"Simulation runtime error.\"\"\"\n    pass\n\nclass InsufficientCapacityError(PopUpSimError):\n    \"\"\"Insufficient capacity.\"\"\"\n    pass\n</code></pre>"},{"location":"mvp/development/domain-models/#type-aliases","title":"Type Aliases","text":"<pre><code>from typing import TypeAlias\n\nWagonId: TypeAlias = str\nTrainId: TypeAlias = str\nTrackId: TypeAlias = str\nLocomotiveId: TypeAlias = str\nSimulationTime: TypeAlias = float\n</code></pre>"},{"location":"mvp/development/domain-models/#model-relationships","title":"Model Relationships","text":"<pre><code>Scenario (Configuration Context)\n\u251c\u2500\u2500 trains: list[Train]\n\u251c\u2500\u2500 tracks: list[Track]\n\u251c\u2500\u2500 workshops: list[Workshop]\n\u251c\u2500\u2500 locomotives: list[Locomotive]\n\u2514\u2500\u2500 routes: list[Route]\n\nTrain (External Trains Context)\n\u2514\u2500\u2500 wagons: list[Wagon]\n\nTrackGroup (Railway Infrastructure Context)\n\u2514\u2500\u2500 tracks: list[Track]\n    \u2514\u2500\u2500 occupancy: TrackOccupancy\n\nBatch (Retrofit Workflow Context)\n\u2514\u2500\u2500 wagons: tuple[Wagon, ...]\n\nRake (Retrofit Workflow Context)\n\u2514\u2500\u2500 wagons: list[Wagon]\n</code></pre>"},{"location":"mvp/development/domain-models/#usage-examples","title":"Usage Examples","text":""},{"location":"mvp/development/domain-models/#loading-configuration","title":"Loading Configuration","text":"<pre><code>from contexts.configuration.domain.configuration_builder import ConfigurationBuilder\nfrom pathlib import Path\n\nbuilder = ConfigurationBuilder(Path(\"scenario_dir\"))\nscenario = builder.build()\n</code></pre>"},{"location":"mvp/development/domain-models/#checking-track-capacity","title":"Checking Track Capacity","text":"<pre><code>from contexts.railway_infrastructure.application.railway_context import RailwayContext\n\nrailway = RailwayContext(scenario)\ntrack = railway.track_selector.select_track_with_capacity('collection', required_length=50.0)\n\nif track:\n    railway.place_wagons_on_track(track.track_id, wagons)\n</code></pre>"},{"location":"mvp/development/domain-models/#publishing-train-arrival","title":"Publishing Train Arrival","text":"<pre><code>from contexts.external_trains.domain.events.train_arrived_event import TrainArrivedEvent\nfrom contexts.shared.domain.events.event_bus import EventBus\n\nevent = TrainArrivedEvent(\n    train_id=\"T001\",\n    wagons=tuple(wagons),\n    arrival_time=env.now\n)\n\nevent_bus.publish(event)\n</code></pre>"},{"location":"mvp/development/domain-models/#forming-batch","title":"Forming Batch","text":"<pre><code>from contexts.retrofit_workflow.domain.services.batch_formation_service import BatchFormationService\n\nservice = BatchFormationService()\nif service.can_form_batch(wagons, min_size=1, max_size=10):\n    batch = service.form_batch(wagons, batch_size=5)\n</code></pre>"},{"location":"mvp/development/domain-models/#validation","title":"Validation","text":"<p>All Pydantic models are automatically validated:</p> <pre><code># Valid\nscenario = Scenario(\n    id=\"test\",\n    start_date=datetime(2025, 1, 1),\n    end_date=datetime(2025, 1, 2),\n    ...\n)\n\n# Invalid - raises ValidationError\nscenario = Scenario(\n    id=\"\",  # Empty ID not allowed\n    ...\n)\n</code></pre>"},{"location":"mvp/development/domain-models/#immutability","title":"Immutability","text":"<p>Value objects and events are immutable:</p> <pre><code># Immutable\nevent = TrainArrivedEvent(train_id=\"T001\", wagons=(...), arrival_time=100.0)\n# event.train_id = \"T002\"  # \u274c Error: frozen dataclass\n\n# Mutable entities\nwagon = Wagon(wagon_id=\"W001\", ...)\nwagon.status = WagonStatus.RETROFITTING  # \u2705 OK\n</code></pre>"},{"location":"mvp/development/domain-models/#type-checking","title":"Type Checking","text":"<p>All models include type hints for MyPy:</p> <pre><code># Type check\nuv run mypy popupsim/backend/src/\n</code></pre>"},{"location":"mvp/development/domain-models/#further-reading","title":"Further Reading","text":"<ul> <li>Configuration Validation - Pydantic validation patterns</li> <li>Domain Model - Domain model overview</li> <li>Bounded Contexts - Context architecture</li> </ul>"},{"location":"mvp/development/examples/","title":"Example Scenarios","text":""},{"location":"mvp/development/examples/#overview","title":"Overview","text":"<p>PopUpSim includes real example scenarios in <code>Data/examples/</code>. These scenarios demonstrate different configurations and use cases.</p> <p>Location: <code>Data/examples/</code></p>"},{"location":"mvp/development/examples/#available-scenarios","title":"Available Scenarios","text":""},{"location":"mvp/development/examples/#small-scenarios","title":"Small Scenarios","text":""},{"location":"mvp/development/examples/#two_trains","title":"two_trains","text":"<ul> <li>Purpose: Minimal test scenario</li> <li>Configuration: 2 trains, basic workshop setup</li> <li>Files: JSON format (scenario.json, tracks.json, workshops.json, trains.csv)</li> <li>Use case: Quick functionality testing</li> </ul>"},{"location":"mvp/development/examples/#seven_wagons_two_locos","title":"seven_wagons_two_locos","text":"<ul> <li>Purpose: Test locomotive allocation</li> <li>Configuration: 7 wagons, 2 locomotives</li> <li>Files: JSON format</li> <li>Use case: Resource management testing</li> </ul>"},{"location":"mvp/development/examples/#seven_wagons_two_workshops","title":"seven_wagons_two_workshops","text":"<ul> <li>Purpose: Test workshop distribution</li> <li>Configuration: 7 wagons, 2 workshops</li> <li>Files: JSON format</li> <li>Use case: Workshop scheduling testing</li> </ul>"},{"location":"mvp/development/examples/#medium-scenarios","title":"Medium Scenarios","text":""},{"location":"mvp/development/examples/#medium_scenario","title":"medium_scenario","text":"<ul> <li>Purpose: Standard workshop simulation</li> <li>Configuration: Multiple trains, realistic workshop</li> <li>Files: JSON + CSV (scenario.json, train_schedule.csv, routes.csv, workshop_tracks.csv)</li> <li>Use case: Capacity assessment</li> <li>README: See <code>Data/examples/medium_scenario/README.md</code></li> </ul>"},{"location":"mvp/development/examples/#ten_trains_two_days","title":"ten_trains_two_days","text":"<ul> <li>Purpose: Multi-day simulation</li> <li>Configuration: 10 trains over 2 days</li> <li>Files: JSON format</li> <li>Use case: Throughput estimation</li> </ul>"},{"location":"mvp/development/examples/#large-scenarios","title":"Large Scenarios","text":""},{"location":"mvp/development/examples/#large_scenario","title":"large_scenario","text":"<ul> <li>Purpose: High-volume testing</li> <li>Configuration: Many trains, complex workshop</li> <li>Files: JSON + CSV</li> <li>Use case: Stress testing, bottleneck identification</li> <li>README: See <code>Data/examples/large_scenario/README.md</code></li> </ul>"},{"location":"mvp/development/examples/#special-test-scenarios","title":"Special Test Scenarios","text":""},{"location":"mvp/development/examples/#retrofit_overflow","title":"retrofit_overflow","text":"<ul> <li>Purpose: Test retrofit track overflow handling</li> <li>Configuration: Designed to exceed retrofit track capacity</li> <li>Use case: Capacity limit testing</li> </ul>"},{"location":"mvp/development/examples/#ten_trains_two_days_collection_track_overflow","title":"ten_trains_two_days_collection_track_overflow","text":"<ul> <li>Purpose: Test collection track overflow</li> <li>Configuration: Designed to exceed collection track capacity</li> <li>Use case: Queue management testing</li> </ul>"},{"location":"mvp/development/examples/#csv_scenario","title":"csv_scenario","text":"<ul> <li>Purpose: Demonstrate CSV-based configuration</li> <li>Configuration: All configuration in CSV files</li> <li>Files: CSV format (scenario.csv, trains.csv, wagons.csv, tracks.csv, workshops.csv, locomotives.csv, routes.csv)</li> <li>Use case: CSV import testing</li> <li>README: See <code>Data/examples/csv_scenario/README.md</code></li> </ul>"},{"location":"mvp/development/examples/#running-examples","title":"Running Examples","text":""},{"location":"mvp/development/examples/#basic-usage","title":"Basic Usage","text":"<pre><code># Run small scenario\nuv run python popupsim/backend/src/main.py --config Data/examples/two_trains/\n\n# Run medium scenario\nuv run python popupsim/backend/src/main.py --config Data/examples/medium_scenario/\n\n# Run large scenario\nuv run python popupsim/backend/src/main.py --config Data/examples/large_scenario/\n</code></pre>"},{"location":"mvp/development/examples/#with-custom-output","title":"With Custom Output","text":"<pre><code># Specify output directory\nuv run python popupsim/backend/src/main.py \\\n  --config Data/examples/medium_scenario/ \\\n  --output results/medium_test/\n</code></pre>"},{"location":"mvp/development/examples/#scenario-structure","title":"Scenario Structure","text":""},{"location":"mvp/development/examples/#json-based-scenarios","title":"JSON-based Scenarios","text":"<p>Typical structure: <pre><code>scenario_name/\n\u251c\u2500\u2500 scenario.json          # Main configuration\n\u251c\u2500\u2500 tracks.json            # Track definitions\n\u251c\u2500\u2500 workshops.json         # Workshop configuration\n\u251c\u2500\u2500 locomotives.json       # Locomotive fleet\n\u251c\u2500\u2500 routes.json            # Route definitions\n\u251c\u2500\u2500 topology.json          # Network topology\n\u251c\u2500\u2500 process_times.json     # Timing parameters\n\u2514\u2500\u2500 trains.csv             # Train schedule\n</code></pre></p>"},{"location":"mvp/development/examples/#csv-based-scenarios","title":"CSV-based Scenarios","text":"<p>Alternative structure: <pre><code>csv_scenario/\n\u251c\u2500\u2500 scenario.csv           # Main configuration\n\u251c\u2500\u2500 tracks.csv             # Track definitions\n\u251c\u2500\u2500 workshops.csv          # Workshop configuration\n\u251c\u2500\u2500 locomotives.csv        # Locomotive fleet\n\u251c\u2500\u2500 routes.csv             # Route definitions\n\u251c\u2500\u2500 trains.csv             # Train schedule\n\u2514\u2500\u2500 wagons.csv             # Wagon details\n</code></pre></p>"},{"location":"mvp/development/examples/#creating-custom-scenarios","title":"Creating Custom Scenarios","text":""},{"location":"mvp/development/examples/#1-copy-existing-scenario","title":"1. Copy Existing Scenario","text":"<pre><code>cp -r Data/examples/medium_scenario/ Data/examples/my_scenario/\n</code></pre>"},{"location":"mvp/development/examples/#2-edit-configuration","title":"2. Edit Configuration","text":"<p>Edit <code>scenario.json</code>: <pre><code>{\n  \"id\": \"my_scenario\",\n  \"start_date\": \"2025-01-01T00:00:00\",\n  \"end_date\": \"2025-01-02T00:00:00\",\n  \"tracks_file\": \"tracks.json\",\n  \"workshops_file\": \"workshops.json\",\n  \"locomotives_file\": \"locomotives.json\",\n  \"routes_file\": \"routes.json\",\n  \"trains_file\": \"trains.csv\"\n}\n</code></pre></p>"},{"location":"mvp/development/examples/#3-adjust-parameters","title":"3. Adjust Parameters","text":"<ul> <li>workshops.json: Change retrofit_stations count</li> <li>trains.csv: Modify arrival times and wagon counts</li> <li>tracks.json: Adjust track capacities</li> </ul>"},{"location":"mvp/development/examples/#4-run-simulation","title":"4. Run Simulation","text":"<pre><code>uv run python popupsim/backend/src/main.py --config Data/examples/my_scenario/\n</code></pre>"},{"location":"mvp/development/examples/#scenario-documentation","title":"Scenario Documentation","text":"<p>Each major scenario includes a README.md with: - Scenario description - Configuration details - Expected behavior - Known issues (if any)</p> <p>Example READMEs: - <code>Data/examples/small_scenario/README.md</code> - <code>Data/examples/medium_scenario/README.md</code> - <code>Data/examples/large_scenario/README.md</code> - <code>Data/examples/csv_scenario/README.md</code></p>"},{"location":"mvp/development/examples/#testing-scenarios","title":"Testing Scenarios","text":"<p>All scenarios are used in automated tests:</p> <pre><code># Run all scenario tests\nuv run pytest popupsim/backend/tests/\n\n# Run specific scenario test\nuv run pytest popupsim/backend/tests/ -k \"test_medium_scenario\"\n</code></pre>"},{"location":"mvp/development/examples/#performance-benchmarks","title":"Performance Benchmarks","text":"<p>Performance varies by scenario size:</p> Scenario Trains Wagons Typical Runtime two_trains 2 ~7 &lt; 1 second medium_scenario ~4 ~160 &lt; 5 seconds large_scenario ~10 ~500 &lt; 30 seconds <p>Note: Actual performance depends on hardware and configuration.</p>"},{"location":"mvp/development/examples/#troubleshooting","title":"Troubleshooting","text":""},{"location":"mvp/development/examples/#scenario-wont-load","title":"Scenario Won't Load","text":"<p>Check: 1. All referenced files exist 2. JSON syntax is valid 3. CSV files have correct headers 4. File paths in scenario.json are correct</p>"},{"location":"mvp/development/examples/#validation-errors","title":"Validation Errors","text":"<p>Common issues: - Missing required fields - Invalid date formats - Track references don't exist - Workshop has no retrofit stations</p>"},{"location":"mvp/development/examples/#simulation-errors","title":"Simulation Errors","text":"<p>Check: - Sufficient track capacity - Locomotives available - Routes defined between all tracks - Process times are positive</p>"},{"location":"mvp/development/examples/#further-reading","title":"Further Reading","text":"<ul> <li>File Formats - Detailed format specifications</li> <li>Configuration Validation - Validation rules</li> <li>Architecture - System architecture</li> </ul>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/","title":"Konzept PopUpSim","text":"<p>zur Simulation der schlagartigen Umr\u00fcstung auf DAK</p> <p>April 2025</p> <p>Frederik Sch\u00e4fer DB Cargo AG</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#anderungshistorie","title":"\u00c4nderungshistorie","text":"Version Datum Beschreibung 1.0 28.03.2025 Erster Entwurf"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#inhaltsverzeichnis","title":"Inhaltsverzeichnis","text":"<ol> <li>Zusammenfassung</li> <li>Abk\u00fcrzungen / Glossar</li> <li>Einordnung und Zusammenh\u00e4nge</li> <li>3.1 DAK Migration: ca. 500 Tsd. Wagen sind umzubauen</li> <li>3.2 DAK Migration DSS: Unterst\u00fctzung von Planung &amp; Durchf\u00fchrung</li> <li>3.3 PopUp Sim: Erste Demo f\u00fcr Big-Bang-Simulation vorhanden</li> <li>PopUpSim: Die Zielvision</li> <li>4.1 User-Stories aus verschiedenen Phasen der Migration</li> <li>4.2 Ablauf der Anwendung</li> <li>MVP: Gesch\u00e4ftslogik zuerst</li> <li>Ausblick: Mit fachlich relevanten Ergebnissen n\u00e4chste Schritte ansto\u00dfen</li> </ol>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#abbildungsverzeichnis","title":"Abbildungsverzeichnis","text":"<ul> <li>Abb. 1: Ablauf der Anwendung</li> <li>Abb. 2: Konfiguration im Prototyp von PopUpSim</li> <li>Abb. 3: Visualisierung des Simulationsablaufs in PopUpSim Prototyp</li> <li>Abb. 4: Mock-Up Visualisierung Simulationsablauf in PopUpSim</li> <li>Abb. 5: Mock-Up Ansicht Statistik</li> </ul>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#1-zusammenfassung","title":"1 Zusammenfassung","text":"<p>Der kurze Zeitraum der europaweiten, schlagartigen Umr\u00fcstung einer Teilflotte von G\u00fcterwagen, genannt \u201eBig Bang\", im Rahmen der DAK Migration ist ein kritischer Moment, der durch eine Simulation sowohl strategisch als auch im Detail zu planen und validieren ist.</p> <p>Daf\u00fcr wurde bereits ein Prototyp \u201ePopUpSim\" erstellt, der zu einem Minimal Viable Product (MVP) ausgebaut werden soll. Da der Big-Bang methodisch weitgehend getrennt von der \u00fcbrigen DAK Migration betrachtet werden kann, eignet er sich f\u00fcr ein separates Modul im Rahmen eines gr\u00f6\u00dferen \u201eDAC Migration DSS\".</p> <p>Im Rahmen der MVP Entwicklung steht die Simulation (=Gesch\u00e4ftslogik, Abbildung der Abl\u00e4ufe) im Vordergrund. Eine angemessene Visualisierung der Ergebnisse (\u201eFilm\" Simulationsablauf, Statistiken) soll ebenfalls umgesetzt werden. Die Benutzer:innen Schnittstelle, insbesondere f\u00fcr den Aufbau der Szenarien (Komfort Dateneingabe, Anlage von Gleistopologie usw.) kann auf sehr niedrigen Niveau gehalten werden, um Aufw\u00e4nde gering zu halten. Ebenso k\u00f6nnen auf Ebene MVP die nicht-funktionalen Anforderungen auf ein sehr geringes Ma\u00df reduziert werden.</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#2-abkurzungen-glossar","title":"2 Abk\u00fcrzungen / Glossar","text":"Abk\u00fcrzung Erkl\u00e4rung Big-Bang Zeitraum von wenigen Wochen in denen eine Vielzahl von vorger\u00fcsteten Wagen von Schraubkupplung auf Digitale Automatische Kupplung umger\u00fcstet werden. DAK / DAC Digital Automatische Kupplung DAC-Ready Migrationsmethode bei der der Umbau zweischrittig erfolgt. Zuerst werden die Wagen f\u00fcr die DAK vorger\u00fcstet, behalten aber \u00e4u\u00dferlich die Schraubkupplungen. In einem zweiten, vom Arbeitsaufwand her auf ein Minimum reduziertem Schritt (\u2192Big Bang) werden Schraubkupplungen entfernt und DAK-Kupplungsk\u00f6pfe aufgesetzt. DSS Decision Support System, Entscheidungsunterst\u00fctzungssystem MVP Minimal Viable Product (minimales gebrauchstaugliches Produkt) Pop-Up-Werkstatt Werkstatt, in der vorger\u00fcstete Wagen in gro\u00dfer Anzahl von Schraubkupplung auf Digitale Automatische Kupplung umger\u00fcstet werden. H\u00e4ufig sind diese Werkst\u00e4tten nur vor\u00fcbergehend f\u00fcr diesen Zweck eingerichtet."},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#3-einordnung-und-zusammenhange","title":"3 Einordnung und Zusammenh\u00e4nge","text":""},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#31-dak-migration-ca-500-tsd-wagen-sind-umzubauen","title":"3.1 DAK Migration: ca. 500 Tsd. Wagen sind umzubauen","text":"<p>Im Rahmen der DAK Migration werden europaweit rund 500 Tsd. G\u00fcterwagen, Lokomotiven und Arbeitsfahrzeuge von der Schraubkupplung auf die Digitale Automatische Kupplung (DAK) umger\u00fcstet. Stand heute findet die fl\u00e4chendeckende Migration in den Jahren 2029-2034 statt.</p> <p>F\u00fcr die Durchf\u00fchrung der DAK-Migration wurden verschiedene Methoden entwickelt. Eine aussichtsreiche, aber auch sehr anspruchsvolle Methode, ist DAC Ready. Diese sieht vor, dass aufw\u00e4ndige Umbauarbeiten \u00fcber einen l\u00e4ngeren Zeitraum (z.B. 4 Jahre) verteilt in den \u00fcblichen Werkst\u00e4tten durchgef\u00fchrt werden. Die Wagen verlassen die Werkstatt wieder mit Schraubkupplungen. In einem kurzen Zeitraum (z.B. 3 Wochen), dem sogenannten Big-Bang, wird die Schraubkupplung entfernt und mit nur noch vergleichsweise geringem Aufwand der DAK-Kupplungskopf eingesetzt. So werden l\u00e4ngere Betriebsunterbrechungen oder -erschwernisse durch inkompatible Kupplungen an Wagen vermieden. Die Abl\u00e4ufe im Big-Bang allerdings sind zeitkritisch und erfordern die Behandlung vieler Wagen.</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#32-dak-migration-dss-unterstutzung-von-planung-durchfuhrung","title":"3.2 DAK Migration DSS: Unterst\u00fctzung von Planung &amp; Durchf\u00fchrung","text":"<p>Die Planung der DAK-Migration bedarf aufgrund der Gr\u00f6\u00dfe des Vorhabens, der Vielzahl der Beteiligten, der hohen verkehrlichen Verflechtungen im G\u00fcterverkehr sowie der hohen Bedeutung einer reibungslosen Migration eines besonderen Entscheidungsunterst\u00fctzungssysteme (\u201eDAC Migration DSS\").</p> <p>Das konzipierte DAC Migration DSS soll mehrere Module umfassen, die auf die verschiedenen Phasen (Strategische Planung, Detailplanung, Umsetzungsmonitoring) der Migration ausgelegt sind.</p> <p>Die Kernfunktionalit\u00e4t des DAC Migration DSS besteht in einem mathematischen Modell, dass die Zusammenh\u00e4nge zwischen den Kapazit\u00e4ten der Kupplungshersteller und Werkst\u00e4tten, den Umbaubedarfen unter Ber\u00fccksichtigung der Anzahl der Wagen und ihrer verkehrlichen Verwendung sowie den strategischen Zielen der Migration auf makroskopische Ebene abbildet und optimiert.</p> <p>Eine andere wichtige Funktionalit\u00e4t ist die Simulation der Vorg\u00e4nge im Big-Bang, an dieser Stelle setzt PopUpSim an. Dieser Funktionalit\u00e4t kommt in allen Phasen eine hohe Bedeutung zu. Da hier methodisch ein anderer Ansatz zum Einsatz kommt (mikroskopisch, Simulation) und die vorhandenen Bez\u00fcge zur Kernfunktionalit\u00e4t sich reduzieren lassen, eignet sich die Simulation sehr gut f\u00fcr eine gesonderte Entwicklung.</p> <p>Das DAC Migration DSS ist als Open-Source-Software (Apache 2.0 Lizenz) konzipiert. Es soll allen Interessierten m\u00f6glich sein, die Arbeitsweise des Systems zu verstehen und eigene Untersuchungen mit eigenen Daten und Parametern durchzuf\u00fchren. In der Detailplanungsphase soll es allen Betroffenen f\u00fcr unternehmensinterne Planungen sowie f\u00fcr die \u00fcbergeordnete Planung auf europ\u00e4ischer Ebene zur Verf\u00fcgung stehen und f\u00fcr besondere unternehmensspezifische Sachverhalte anpassbar sein. Selbes gilt f\u00fcr die Umsetzungsphase, wobei hier Erweiterungen f\u00fcr Echtzeitdaten erforderlich sind.</p> <p>Das DAC Migration DSS ist ein von der Open-Rail-Association angenommenes Projekt, ein Repository auf Git-Hub wurde bereits eingerichtet.</p> <p>\ud83d\udd17 Repository: https://github.com/OpenRailAssociation/dac-migration-dss</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#33-popup-sim-erste-demo-fur-big-bang-simulation-vorhanden","title":"3.3 PopUp Sim: Erste Demo f\u00fcr Big-Bang-Simulation vorhanden","text":"<p>Im Rahmen des gemeinsamen Hackatons von DB, SBB und \u00d6BB \u201e3-L\u00e4nderhack\" wurde 2024 unter dem Namen \u201ePopUpSim\" ein funktionsf\u00e4higer aber vom Umfang her sehr stark reduzierter Prototyp f\u00fcr eine Big-Bang-Simulation entwickelt.</p> <p>\ud83d\udd17 Demo: https://openrail-playground.github.io/PopupSim/ (\u201eStatische Daten Laden\" klicken)</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#4-popupsim-die-zielvision","title":"4 PopUpSim: Die Zielvision","text":""},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#41-user-stories-aus-verschiedenen-phasen-der-migration","title":"4.1 User-Stories aus verschiedenen Phasen der Migration","text":"<p>Die Funktionalit\u00e4t von PopUpSim wird in allen Phasen der Migration ben\u00f6tigt. Hier eine Auswahl von typischen User-Stories von PopUpSim:</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#strategische-phase","title":"Strategische Phase","text":"<p>\u2022 Als strategische:r Migrationsplaner:in m\u00f6chte ich standardisierte Entw\u00fcrfe f\u00fcr Pop-Up Werkst\u00e4tten entwickeln, um diese dem Projekt zur Verf\u00fcgung zu stellen.</p> <p>\u2022 Als strategische:r Migrationsplaner:in m\u00f6chte ich absch\u00e4tzen, welcher Durchsatz von Wagen in einer Pop-Up-Werkstatt mit bestimmten Layout m\u00f6glich ist, um zu sehen, wie viele Werkst\u00e4tten ben\u00f6tigt werden.</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#detailplanungsphase","title":"Detailplanungsphase","text":"<p>\u2022 Als Planer:in in einem Unternehmen m\u00f6chte ich einfach Infrastrukturdaten importieren und den Gleisen komfortabel Funktionen zuweisen, um schnell weiter arbeiten zu k\u00f6nnen.</p> <p>\u2022 Als Planer:in im Unternehmen m\u00f6chte ich eine Absch\u00e4tzung, wie viele Wagen die von mir geplante Werkstatt umr\u00fcsten kann, um zu sehen, ob die Kapazit\u00e4t ausreichend ist oder weiter erh\u00f6ht werden muss.</p> <p>\u2022 Als Planer:in im Unternehmen m\u00f6chte ich den Output grafisch und tabellarisch \u00fcbersichtlich dargestellt bekommen, damit ich die Ergebnisse schnell verstehe.</p> <p>\u2022 Als Deployment Manger:in m\u00f6chte ich sehen, ob die Planungen der einzelnen Unternehmen zusammenpassen, um zu erkennen, ob auf europ\u00e4ischer Ebene das strategische Ziel erreichbar ist.</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#umsetzungsphase","title":"Umsetzungsphase","text":"<p>\u2022 Als Disponent:in m\u00f6chte ich wissen, welche Wagen als n\u00e4chstes der Werkstatt zugef\u00fchrt werden sollen, damit ich Dispositionsentscheidungen treffen kann.</p> <p>\u2022 Als Deployment Manger:in m\u00f6chte ich den Fortschritt \u00fcberwachen um ggf. Gegenma\u00dfnahmen einleiten zu k\u00f6nnen.</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#42-ablauf-der-anwendung","title":"4.2 Ablauf der Anwendung","text":"<p> Infrastrukturdaten \u2192 Datenvorbereitung \u2192 Simulation (=Gesch\u00e4ftslogik) \u2192 Ergebnisvisualisierung</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#421-datenvorbereitung-szenarioaufbau","title":"4.2.1 Datenvorbereitung &amp; Szenarioaufbau","text":"<p>Am Anfang einer Anwendung von PopUpSim steht der Aufbau der f\u00fcr die Simulation zur Verf\u00fcgung stehenden Gleisinfrastruktur und die Festlegung von Ressource und Parametern. Das beinhaltet:</p> <p>\u2022 Aufbau der Gleistopologie (ggf. Import aus bestehender Quelle, z.B. DaVit)</p> <p>\u2022 Die Zuweisung von spezifischen Funktionalit\u00e4ten im Rahmen der DAK-Migration (z.B. Gl. 12 in Musterstadt ist auf 455 m L\u00e4nge Sammelgleis)</p> <p>\u2022 Anlegen von Ressourcen wie Werkst\u00e4tte, Loks und Wagenmeister:innen</p> <p>\u2022 Konfiguration weiterer Parameter wie z.B. Zeitverbr\u00e4uche (Die Werkstatt braucht x min zur Umr\u00fcstung eines Wagens, die Fahrt von Beispielstadt nach Musterort dauert 85 min.)</p> <p>\u2022 Missionen f\u00fcr Betriebsmittel festlegen (z.B. Lok 1 holt Wagen ab, sobald Gleis 12 in Musterstadt zu 80% voll ist und f\u00e4hrt zu Werkstattbahnhof Beispielort)</p> <p></p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#422-simulation-vom-betrieb-in-die-werkstatt-und-zuruck","title":"4.2.2 Simulation: Vom Betrieb in die Werkstatt und zur\u00fcck","text":"<p>Die Simulation besteht auf folgenden wesentlichen Teilen:</p> <p>\u2022 Selektionsmechanismus: Die Auswahl von Wagen f\u00fcr die Zuf\u00fchrung zur Umr\u00fcstung an bestimmten Punkten.</p> <p>\u2022 Das Bewegen von Wagen zwischen einzelnen Standorten im Rahmen des Umbauvorgangs (Sammelgleis, Zuf\u00fchrungsgleis, Werkstatt, Sammelgleis f\u00fcr Parkplatz, Parkplatz) unter Verwendung von Ressourcen wie Gleiskapazit\u00e4t, Rangierlokomotiven, Werkstattkapazit\u00e4t, Personalen f\u00fcr Zugvorbereitung sowie Zeitverbr\u00e4uchen.</p> <p>\u2022 R\u00fcckf\u00fchren der Wagen in den Betrieb.</p> <p>Nicht abgebildet werden: - Die einzelnen Umr\u00fcstungshandlungen am Wagen sofern der Wagen nicht bewegt wird (Abgrenzung zu einer allgemeinen Werkstattsimulation) - Fahrzeiten zwischen verschiedenen Gleisen nur pauschalisiert angenommen und keine tiefergehende Berechnung z.B. aufgrund von Streckenbelegung durch andere Z\u00fcge oder Fahrdynamik (Abgrenzung zu eisenbahnbetriebswissenschaftlicher Simulation)</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#423-ergebnisvisualisierung-film-und-statistik","title":"4.2.3 Ergebnisvisualisierung: \u201eFilm\" und \u201eStatistik\"","text":"<p>Sowohl der Ablauf der Simulation kann als \u201eFilm Simulationsablauf\" verfolgt werden und es steht eine Ansicht mit Kennzahlen, Graphen und Diagrammen zur Verf\u00fcgung.</p> <p></p> <p></p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#5-mvp-geschaftslogik-zuerst","title":"5 MVP: Gesch\u00e4ftslogik zuerst","text":"<p>Mit dem im Rahmen des 3-LH erstellten Prototypen von PopUpSim ist es gelungen, die Aufgaben der Simulation des \u201eBig-Bangs\" zu verdeutlichen und auch zu zeigen, dass alle ben\u00f6tigten Bestandteile auf einem noch unterhalb der Gebrauchstauglichkeit liegendem Niveau in kurzer Zeit implementierbar sind.</p> <p>Der n\u00e4chste Schritt der Entwicklung ist ein \u201eMinimal Viable Produkt\", das eine Gebrauchstauglichkeit aufweisen muss, d.h. es muss in der Lage sein, reale Probleme zu l\u00f6sen und die Ergebnisse angemessen darzustellen.</p> <p>Dementsprechend liegt der Schwerpunkt auf der Implementierung der Gesch\u00e4ftslogik (=Simulation). Bei Nutzerschnittstelle und -erfahrung sind, insbesondere bei der Dateneingabe, deutliche Abstriche m\u00f6glich. Die Visualisierung sollte hingegen einen gewissen Reifegrad erreichen, da dies ein zentraler Hebel f\u00fcr die Akzeptanz durch Praktiker:innen und damit weiterer Entwicklungsschritte ist.</p>"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#nicht-funktionale-anforderungen","title":"Nicht-funktionale Anforderungen","text":"Aspekt Anforderung Ziel der Anwendung Erstellen und Bewerten von Beispielpl\u00e4nen f\u00fcr Pop-Up-Workshops im begrenzten Umfang Art der Anwendung Einfach, z.B. auf lokalen Rechner der Anwender:innen Schutzklasse Niedrig, Output dient der unternehmens\u00fcbergreifenden Diskussion. Sp\u00e4teres Anheben der Schutzklasse soll ohne \u00fcberm\u00e4\u00dfigen Aufwand m\u00f6glich sein. Vertraulichkeitsklasse Vergleichbar DB offen, relevante Ergebnisse werden ver\u00f6ffentlicht. Sp\u00e4teres Anheben der Vertraulichkeitsklasse soll ohne \u00fcberm\u00e4\u00dfigen Aufwand m\u00f6glich sein. Anwender:innen Stark begrenzte Anzahl versierter Anwender:innen Sprache Schnittstelle Deutsch, Englisch zul\u00e4ssig (z.B. bei Weitergabe von Fehlermeldungen aus Datenbanken, Paketen u.\u00c4.). Sp\u00e4tere Mehrsprachigkeit soll herstellbar sein."},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#datenaufbereitung-szenarioaufbau","title":"Datenaufbereitung &amp; Szenarioaufbau","text":"Funktion Anforderung Gleistopologie aufbauen Manuell \u00fcber z.B. csv, json, \u2026. Rendern (optional: in Echtzeit) des Gleisplans m\u00f6glich. Optional: Eingabemaske, rudiment\u00e4re Plausibilit\u00e4tskontrolle Funktionszuweisung der Gleise Manuell \u00fcber z.B. csv, json, \u2026. Optional: Eingabemaske Anlage Ressourcen Manuell \u00fcber. z.B. csv, json, \u2026. Optional: Eingabemaske Konfiguration &amp; Zeitverbr\u00e4uche Manuell \u00fcber z.B. csv, json, \u2026. Optional: Eingabemaske, Berechnungshilfe Definition von Missionen / Entscheidungsregeln Manuell \u00fcber z.B. csv, json, Begrenzte Anzahl an Entscheidungsm\u00f6glichkeiten. Optional: rudiment\u00e4re Plausibilit\u00e4tskontrolle, Eingabemaske"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#simulation","title":"Simulation","text":"Aspekt Anforderung Anzahl der Elemente (Wagen usw.) Ca. 10.000 (wenn m\u00f6glich von vornherein Simulation effizient anlegen um sp\u00e4tere Erweiterung zu vereinfachen) Vollst\u00e4ndigkeit Vollst\u00e4ndige Abbildung der Gesch\u00e4ftslogik aufgrund von vorgegebenen Zeitverbr\u00e4uchen, Entscheidungsregeln usw. Verhalten an Grenzen des simulierten Bereichs Keine eisenbahnbetriebliche Simulation. Keine Simulation von Eisenbahnverkehr au\u00dferhalb des definierten Simulationsmodells. Einfach Regeln"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#visualisierung","title":"Visualisierung","text":"Funktion Anforderung Ablaufdarstellung Ja, Darstellung vorgegebener Gleisplan, Ressourcen und zentraler Kennzahlen. Hervorhebung bestimmter Elemente (z.B. ausgew\u00e4hlter Wagen). Optional: Durch Klicken auf z.B. Wagen weitere Informationen Statistiken Statistiken inkl. Visualisierung zu wichtigen Kenngr\u00f6\u00dfen"},{"location":"requirements/250321_KonzeptPopUpSim_Entwurf/#6-ausblick-mit-fachlich-relevanten-ergebnissen-nachste-schritte-anstoen","title":"6 Ausblick: Mit fachlich relevanten Ergebnissen n\u00e4chste Schritte ansto\u00dfen","text":"<p>Mit dem oben definierten MVP kann ein begrenzter Anwender:innenkreis relevante fachliche Ergebnisse erzeugen, die bei ansprechender Visualisierung auf gro\u00dfes Interesse sto\u00dfen werden.</p> <p>F\u00fcr die fl\u00e4chendeckende Planung der Migration, ist eine Simulation f\u00fcr jede einzelne Werkstatt anzulegen. Hierf\u00fcr eignet sich das skizzierte MVP noch nicht, weitere Entwicklungsschritte sind notwendig, die beauftragt oder durch die Community geleistet werden m\u00fcssen.</p> <p>Das skizzierte MVP ist dazu geeignet, Impulse f\u00fcr die Entwickler:innen-Community als auch die Anwender:innen-Community zu setzen.</p> <p>Konzept PopUpSim | Frederik Sch\u00e4fer DB Cargo | April 2025</p>"},{"location":"requirements/use-cases/","title":"User Stories - PopUpSim","text":"<p>The user stories listed here are based on [1].</p>"},{"location":"requirements/use-cases/#strategic-phase","title":"Strategic Phase","text":""},{"location":"requirements/use-cases/#us-001-develop-standardized-pop-up-workshops","title":"US-001: Develop Standardized Pop-Up Workshops","text":"<p>As a Strategic Migration Planner I want to develop standardized designs for Pop-Up workshops, so that I can provide them to the project.</p>"},{"location":"requirements/use-cases/#us-002-estimate-throughput-for-workshop-layouts","title":"US-002: Estimate Throughput for Workshop Layouts","text":"<p>As a Strategic Migration Planner I want to estimate what throughput of wagons is possible in a Pop-Up workshop with a specific layout, so that I can see how many workshops are needed.</p>"},{"location":"requirements/use-cases/#detail-planning-phase","title":"Detail Planning Phase","text":""},{"location":"requirements/use-cases/#us-003-import-infrastructure-data","title":"US-003: Import Infrastructure Data","text":"<p>As a Company Planner I want to easily import infrastructure data and conveniently assign functions to tracks, so that I can continue working quickly.</p>"},{"location":"requirements/use-cases/#us-004-assess-capacity-for-planned-workshop","title":"US-004: Assess Capacity for Planned Workshop","text":"<p>As a Company Planner I want to get an estimate of how many wagons my planned workshop can retrofit, so that I can see if the capacity is sufficient or needs to be increased.</p>"},{"location":"requirements/use-cases/#us-005-clear-results-presentation","title":"US-005: Clear Results Presentation","text":"<p>As a Company Planner I want to get the output presented clearly in graphical and tabular form, so that I can quickly understand the results.</p>"},{"location":"requirements/use-cases/#us-006-european-planning-validation","title":"US-006: European Planning Validation","text":"<p>As a Deployment Manager I want to see if the plans of individual companies fit together, so that I can determine if the strategic goal is achievable at the European level.</p>"},{"location":"requirements/use-cases/#implementation-phase","title":"Implementation Phase","text":""},{"location":"requirements/use-cases/#us-007-support-dispatch-decisions","title":"US-007: Support Dispatch Decisions","text":"<p>As a Dispatcher I want to know which wagons should be fed to the workshop next, so that I can make dispatch decisions.</p>"},{"location":"requirements/use-cases/#us-008-progress-monitoring","title":"US-008: Progress Monitoring","text":"<p>As a Deployment Manager I want to monitor progress, so that I can initiate countermeasures if necessary.</p>"},{"location":"requirements/use-cases/#domain-context","title":"Domain Context","text":""},{"location":"requirements/use-cases/#big-bang-scenario","title":"Big Bang Scenario","text":"<p>The user stories refer to the rapid retrofit of approximately 500,000 freight wagons from screw coupling to Digital Automatic Coupling (DAC) in a short period (approximately 3 weeks).</p>"},{"location":"requirements/use-cases/#pop-up-workshops","title":"Pop-Up Workshops","text":"<p>Temporarily established workshops where pre-equipped wagons are finally retrofitted from screw coupling to DAC in large numbers.</p>"},{"location":"requirements/use-cases/#simulation-scope","title":"Simulation Scope","text":"<ul> <li>Microscopic simulation of individual wagons and resources</li> <li>Focus on workshop operations, not on general railway operations simulation</li> </ul>"},{"location":"requirements/use-cases/#references","title":"References","text":"<p>[1] Sch\u00e4fer, Frederik (2025). Concept PopUpSim: Draft. DB Cargo AG.     PDF | Markdown</p>"},{"location":"tutorial/","title":"PopUpSim Configuration Tutorial","text":"<p>This tutorial guides you through installing and configuring PopUpSim using the <code>ten_trains_two_days</code> example scenario. You'll learn about each configuration file, available parameters, and how they affect the simulation.</p>"},{"location":"tutorial/#tutorial-contents","title":"Tutorial Contents","text":"<ol> <li>Installation Guide - Installing Python, uv, and PopUpSim (including non-admin scenarios)</li> <li>Overview - Understanding the scenario structure</li> <li>Scenario Configuration - Main scenario settings and references</li> <li>Topology Configuration - Network nodes and edges</li> <li>Track Configuration - Track types and properties</li> <li>Workshop Configuration - Workshop setup and capacity</li> <li>Process Times Configuration - Operation durations</li> <li>Locomotive Configuration - Shunting resources</li> <li>Routes Configuration - Movement paths between tracks</li> <li>Train Schedule Configuration - Wagon arrivals and properties</li> <li>Running Your Simulation - Executing and analyzing results</li> </ol>"},{"location":"tutorial/#quick-start","title":"Quick Start","text":"<p>First time user? Start with the Installation Guide to set up Python, uv, and PopUpSim.</p> <p>To run the example scenario used in this tutorial:</p> <pre><code>cd dac-migration-dss-popupsim\nuv run python popupsim/backend/src/main.py --scenario Data/examples/ten_trains_two_days/ --output output/tutorial/\n</code></pre>"},{"location":"tutorial/#scenario-overview","title":"Scenario Overview","text":"<p>The <code>ten_trains_two_days</code> scenario simulates: - 10 trains arriving over 2 days - 224 wagons requiring DAC retrofit - 2 workshops with 2 retrofit stations each - 15 parking tracks for wagon storage - 2 collection tracks for incoming trains - 1 shunting locomotive for wagon movements</p> <p>This medium-complexity scenario demonstrates realistic workshop operations and helps you understand how to configure your own scenarios.</p>"},{"location":"tutorial/#learning-path","title":"Learning Path","text":"<p>If you're new to PopUpSim: 1. Start with Installation Guide to set up your environment 2. Continue with Overview to understand the file structure 3. Follow the chapters in order to learn each configuration aspect 4. Experiment by modifying values in the example files 5. Run simulations to see how changes affect results</p> <p>If you're experienced: - Jump to specific chapters for reference - Experiment with different parameter values - Check configuration examples in each chapter</p>"},{"location":"tutorial/#next-steps","title":"Next Steps","text":"<p>Begin with Chapter 0: Installation Guide if you haven't installed PopUpSim yet, or jump to Chapter 1: Overview to understand the scenario structure and file organization.</p>"},{"location":"tutorial/00-installation/","title":"Installation Guide","text":"<p>This guide covers different ways to install PopUpSim and its dependencies, including scenarios where you don't have administrative rights.</p>"},{"location":"tutorial/00-installation/#overview","title":"Overview","text":"<p>Good news: You only need to install uv - it will automatically manage Python for you!</p> <p>uv is a fast Python package manager that can: - Install and manage Python versions automatically - Create isolated virtual environments - Install project dependencies - Run Python scripts</p>"},{"location":"tutorial/00-installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>uv package manager - Installation methods covered below</li> <li>Python 3.13+ - uv will install this automatically if needed</li> </ul>"},{"location":"tutorial/00-installation/#step-1-install-uv-package-manager","title":"Step 1: Install uv Package Manager","text":"<p>uv is a fast Python package manager. Choose the installation method that works for your system.</p>"},{"location":"tutorial/00-installation/#option-1-powershell-windows-recommended","title":"Option 1: PowerShell (Windows - Recommended)","text":"<p>If donwload of uv fails it selbst to deactivate your VPN connection (if you use one).</p> <p>Open the commandline or a powershel: <pre><code>powershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n</code></pre> to install uv. If you run in administrative mode the installation of uv is done system-wide. Otherwise uv will be installed in your user directory (<code>%USERPROFILE%\\.cargo\\bin\\</code>).</p> <p>Add to PATH (if needed):</p> <p>In most cases this is not necessary since uv will automatically adjust the PATH variable.</p> <p>If <code>uv</code> command is not found after installation:</p> <ol> <li>Open System Properties \u2192 Environment Variables</li> <li>Under \"User variables\", find or create <code>Path</code></li> <li>Add: <code>%USERPROFILE%\\.cargo\\bin</code></li> <li>Restart your terminal</li> </ol>"},{"location":"tutorial/00-installation/#option-2-using-pipx-cross-platform","title":"Option 2: Using pipx (Cross-Platform)","text":"<p>Recommended for users without admin rights.</p> <p>First, install pipx if you don't have it:</p> <pre><code>python -m pip install --user pipx\npython -m pipx ensurepath\n</code></pre> <p>Then install uv:</p> <pre><code>pipx install uv\n</code></pre> <p>Advantages: - No admin rights required - Installs in user directory - Isolated from system Python - Works on Windows, Linux, and macOS</p>"},{"location":"tutorial/00-installation/#option-3-using-pip-cross-platform","title":"Option 3: Using pip (Cross-Platform)","text":"<p>Simple but less isolated:</p> <pre><code>pip install --user uv\n</code></pre> <p>Note: This installs uv in your user Python packages directory.</p>"},{"location":"tutorial/00-installation/#option-4-standalone-installer-linuxmacos","title":"Option 4: Standalone Installer (Linux/macOS)","text":"<pre><code>curl -LsSf https://astral.sh/uv/install.sh | sh\n</code></pre> <p>This installs uv in <code>~/.cargo/bin/</code>.</p> <p>Add to PATH (if needed):</p> <p>Add to your <code>~/.bashrc</code> or <code>~/.zshrc</code>:</p> <pre><code>export PATH=\"$HOME/.cargo/bin:$PATH\"\n</code></pre> <p>Then reload:</p> <pre><code>source ~/.bashrc  # or source ~/.zshrc\n</code></pre>"},{"location":"tutorial/00-installation/#option-5-manual-download-windows-no-admin","title":"Option 5: Manual Download (Windows - No Admin)","text":"<ol> <li>Download uv from GitHub releases</li> <li>Extract to a folder in your user directory (e.g., <code>C:\\Users\\YourName\\uv\\</code>)</li> <li>Add that folder to your user PATH:</li> <li>Search for \"Environment Variables\" in Windows</li> <li>Edit \"Path\" under \"User variables\"</li> <li>Add your uv folder path</li> <li>Restart terminal</li> </ol>"},{"location":"tutorial/00-installation/#verify-uv-installation","title":"Verify uv Installation","text":"<p>After installation, verify uv is working:</p> <pre><code>uv --version\n</code></pre> <p>You should see something like <code>uv 0.x.x</code>.</p>"},{"location":"tutorial/00-installation/#step-2-get-popupsim","title":"Step 2: Get PopUpSim","text":""},{"location":"tutorial/00-installation/#option-a-using-git-recommended","title":"Option A: Using Git (Recommended)","text":"<p>If you have git installed:</p> <pre><code>git clone https://github.com/open-rail-association/dac-migration-dss-popupsim.git\ncd dac-migration-dss-popupsim\n</code></pre>"},{"location":"tutorial/00-installation/#option-b-download-zip-no-git-required","title":"Option B: Download ZIP (No Git Required)","text":"<ol> <li>Visit: https://github.com/OpenRailAssociation/dac-migration-dss-popupsim/archive/refs/heads/main.zipp</li> <li>Extract the ZIP file to your desired location</li> <li>Open terminal and navigate to the extracted folder:</li> </ol> <pre><code>cd dac-migration-dss-popupsim-main\n</code></pre>"},{"location":"tutorial/00-installation/#step-3-install-popupsim-dependencies","title":"Step 3: Install PopUpSim Dependencies","text":"<p>Navigate to the PopUpSim directory and run:</p> <pre><code>uv sync\n</code></pre> <p>This command: - Automatically installs Python 3.13+ if not present (no manual Python installation needed!) - Creates a virtual environment - Installs all required dependencies - Sets up the project for use</p> <p>Note: This does NOT require administrative rights - everything is installed in the project directory.</p>"},{"location":"tutorial/00-installation/#step-4-verify-installation","title":"Step 4: Verify Installation","text":"<p>Run a test simulation:</p> <pre><code>uv run python popupsim/backend/src/main.py --scenario Data/examples/demo/ --output output/test/\n</code></pre> <p>If the simulation runs successfully, you're all set!</p>"},{"location":"tutorial/00-installation/#optional-start-the-dashboard","title":"Optional: Start the Dashboard","text":"<p>View results in the web-based dashboard (run in a separate terminal):</p> <p>Windows: <pre><code>run_dashboard.bat\n</code></pre></p> <p>Linux/macOS: <pre><code>uv run streamlit run popupsim/frontend/streamlit_dashboard.py\n</code></pre></p> <p>On the first run it will ask you to enter your E-Mail. Leave empty and just press return/enter.</p> <p>A browser window (of your default browser) will open and pointing at the adress:  http://localhost:8501</p>"},{"location":"tutorial/00-installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"tutorial/00-installation/#uv-command-not-found","title":"\"uv: command not found\"","text":"<p>Problem: uv is not in your PATH.</p> <p>Solution:</p> <p>Windows: 1. Find where uv was installed (usually <code>%USERPROFILE%\\.cargo\\bin\\</code>) 2. Add to user PATH environment variable 3. Restart terminal</p> <p>Linux/macOS: <pre><code>export PATH=\"$HOME/.cargo/bin:$PATH\"\nsource ~/.bashrc  # or ~/.zshrc\n</code></pre></p>"},{"location":"tutorial/00-installation/#python-version-too-old-or-no-python-found","title":"\"Python version too old\" or \"No Python found\"","text":"<p>Problem: uv needs to install Python but can't.</p> <p>Solution:</p> <p>uv will automatically download and install Python 3.13+ when you run <code>uv sync</code>. If this fails:</p> <pre><code># Explicitly tell uv to install Python 3.13\nuv python install 3.13\n\n# Then run sync\nuv sync\n</code></pre> <p>Alternative: If you already have Python installed but it's too old: <pre><code># Use uv's managed Python\nuv sync --python 3.13\n</code></pre></p>"},{"location":"tutorial/00-installation/#permission-denied-during-installation","title":"\"Permission denied\" during installation","text":"<p>Problem: Trying to install in system directories without admin rights.</p> <p>Solution: - Use <code>--user</code> flag with pip: <code>pip install --user uv</code> - Or use pipx (recommended): <code>pipx install uv</code> - Or use PowerShell method (installs in user directory)</p>"},{"location":"tutorial/00-installation/#ssl-certificate-error","title":"\"SSL Certificate Error\"","text":"<p>Problem: Corporate firewall or proxy blocking downloads.</p> <p>Solution: 1. Contact your IT department for proxy settings 2. Or download files manually and install offline 3. Or use <code>--trusted-host</code> flag (not recommended for security)</p>"},{"location":"tutorial/00-installation/#uv-sync-fails-with-no-python-interpreter-found","title":"uv sync fails with \"No Python interpreter found\"","text":"<p>Problem: uv can't find or install Python.</p> <p>Solution:</p> <pre><code># Let uv install Python 3.13 automatically\nuv python install 3.13\n\n# Then sync\nuv sync\n</code></pre> <p>If you have Python installed manually: <pre><code># Point uv to your Python installation\nuv sync --python python3.13\n\n# Or specify full path\nuv sync --python C:\\Users\\YourName\\AppData\\Local\\Programs\\Python\\Python313\\python.exe\n</code></pre></p>"},{"location":"tutorial/00-installation/#virtual-environment-issues","title":"Virtual environment issues","text":"<p>Problem: Conflicts with existing virtual environments.</p> <p>Solution: 1. Delete <code>.venv</code> folder in project directory 2. Run <code>uv sync</code> again</p>"},{"location":"tutorial/00-installation/#installation-for-different-scenarios","title":"Installation for Different Scenarios","text":""},{"location":"tutorial/00-installation/#scenario-1-corporate-windows-pc-no-admin-rights","title":"Scenario 1: Corporate Windows PC (No Admin Rights)","text":"<pre><code># Install uv using PowerShell (user install)\npowershell -ExecutionPolicy ByPass -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n\n# Add to PATH if needed\n$env:Path += \";$env:USERPROFILE\\.cargo\\bin\"\n\n# Download PopUpSim ZIP\n# Extract to C:\\Users\\YourName\\Documents\\PopUpSim\n\n# Navigate and install\ncd C:\\Users\\YourName\\Documents\\PopUpSim\nuv sync\n\n# Run test\nuv run python popupsim/backend/src/main.py --scenario Data/examples/demo/ --output output/\n</code></pre>"},{"location":"tutorial/00-installation/#scenario-2-linux-server-no-root-access","title":"Scenario 2: Linux Server (No Root Access)","text":"<pre><code># Install uv in user directory\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n\n# Add to PATH\necho 'export PATH=\"$HOME/.cargo/bin:$PATH\"' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n\n# Clone PopUpSim\ngit clone https://github.com/open-rail-association/dac-migration-dss-popupsim.git\ncd dac-migration-dss-popupsim\n\n# Install dependencies\nuv sync\n\n# Run test\nuv run python popupsim/backend/src/main.py --scenario Data/examples/demo/ --output output/\n</code></pre>"},{"location":"tutorial/00-installation/#scenario-3-shared-computer-multiple-users","title":"Scenario 3: Shared Computer (Multiple Users)","text":"<p>Each user should:</p> <pre><code># Install uv in their own user directory\npipx install uv\n\n# Clone PopUpSim to their home directory\ncd ~\ngit clone https://github.com/open-rail-association/dac-migration-dss-popupsim.git\ncd dac-migration-dss-popupsim\n\n# Install dependencies (creates .venv in project folder)\nuv sync\n\n# Run simulations\nuv run python popupsim/backend/src/main.py --scenario Data/examples/demo/ --output output/\n</code></pre>"},{"location":"tutorial/00-installation/#scenario-4-air-gapped-system-no-internet","title":"Scenario 4: Air-Gapped System (No Internet)","text":"<ol> <li>On a connected computer:</li> <li>Download uv installer for your OS from GitHub releases</li> <li>Download PopUpSim ZIP from GitHub</li> <li> <p>Download Python 3.13+ standalone installer from python.org (optional - uv can use it)</p> </li> <li> <p>Transfer files to air-gapped system</p> </li> <li> <p>On air-gapped system:</p> </li> <li>Install uv manually</li> <li>Extract PopUpSim</li> <li>If you have Python installer, install it first</li> <li>Run <code>uv sync</code> (uv will use installed Python or you may need to cache dependencies)</li> </ol>"},{"location":"tutorial/00-installation/#next-steps","title":"Next Steps","text":"<p>After successful installation:</p> <ol> <li>Run example scenarios - See Getting Started for commands</li> <li>Follow the tutorial - Start with Tutorial Overview</li> <li>Create your own scenarios - Modify example configurations</li> </ol>"},{"location":"tutorial/00-installation/#getting-help","title":"Getting Help","text":"<p>If you encounter issues:</p> <ol> <li>Check GitHub Issues</li> <li>Review uv documentation</li> <li>Ask in project discussions</li> </ol>"},{"location":"tutorial/00-installation/#summary-of-installation-methods","title":"Summary of Installation Methods","text":"Method Admin Required Best For Difficulty PowerShell (Windows) No Windows users Easy pipx No All platforms, no admin Easy pip --user No Simple install Easy Standalone installer No Linux/macOS Medium Manual download No Restricted environments Medium <p>Recommendation: Use pipx for maximum compatibility and isolation, especially if you don't have admin rights.</p>"},{"location":"tutorial/01-overview/","title":"Chapter 1: Overview","text":""},{"location":"tutorial/01-overview/#scenario-structure","title":"Scenario Structure","text":"<p>A PopUpSim scenario consists of multiple configuration files that work together to define the simulation. The <code>ten_trains_two_days</code> scenario contains 8 files:</p> <pre><code>ten_trains_two_days/\n\u251c\u2500\u2500 scenario.json           # Main configuration and file references\n\u251c\u2500\u2500 topology.json           # Network structure (e.g. track length)\n\u251c\u2500\u2500 tracks.json            # Track definitions and types\n\u251c\u2500\u2500 workshops.json         # Workshop configurations\n\u251c\u2500\u2500 process_times.json     # Operation durations\n\u251c\u2500\u2500 locomotive.json        # Shunting locomotive resources\n\u251c\u2500\u2500 routes.json           # Movement paths between tracks including durations\n\u2514\u2500\u2500 train_schedule.csv    # Wagon arrivals and properties\n</code></pre>"},{"location":"tutorial/01-overview/#file-relationships","title":"File Relationships","text":"<p>The files are interconnected, wehere the sceario.json links all of them togeher.</p> <ol> <li>scenario.json - Entry point that references all other files</li> <li>topology.json - Defines edges (track segments) used by tracks.json</li> <li>tracks.json - Defines tracks using edges from topology.json</li> <li>workshops.json - References workshop tracks from tracks.json</li> <li>routes.json - Defines paths between tracks from tracks.json</li> <li>locomotive.json - References home tracks from tracks.json</li> <li>train_schedule.csv - References track types from tracks.json</li> <li>process_times.json - Standalone timing parameters</li> </ol>"},{"location":"tutorial/01-overview/#configuration-flow","title":"Configuration Flow","text":"<pre><code>scenario.json (entry point)\n    \u251c\u2500&gt; topology.json (network structure)\n    \u251c\u2500&gt; tracks.json (uses topology edges)\n    \u251c\u2500&gt; workshops.json (uses tracks)\n    \u251c\u2500&gt; routes.json (uses tracks)\n    \u251c\u2500&gt; locomotive.json (uses tracks)\n    \u251c\u2500&gt; train_schedule.csv (uses track types)\n    \u2514\u2500&gt; process_times.json (timing parameters)\n</code></pre>"},{"location":"tutorial/01-overview/#file-formats","title":"File Formats","text":"<ul> <li>JSON files - Structured configuration with validation</li> <li>CSV file - Tabular data for train schedules (easier to edit in spreadsheets)</li> </ul>"},{"location":"tutorial/01-overview/#validation","title":"Validation","text":"<p>PopUpSim validates all configuration files on startup: - Required fields must be present - References between files must be valid - Values must be within acceptable ranges - Data types must match specifications</p> <p>If validation fails, PopUpSim provides detailed error messages indicating which file and field caused the issue.</p>"},{"location":"tutorial/01-overview/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 2: Scenario Configuration to learn about the main scenario settings.</p>"},{"location":"tutorial/02-scenario-configuration/","title":"Chapter 2: Scenario Configuration","text":""},{"location":"tutorial/02-scenario-configuration/#file-scenariojson","title":"File: scenario.json","text":"<p>The scenario.json file is the entry point for your simulation. It defines metadata, simulation timeframe, selection strategies, and references to all other configuration files.</p>"},{"location":"tutorial/02-scenario-configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>{\n  \"id\": \"test_scenario_01\",\n  \"description\": \"DAC retrofit simulation\",\n  \"version\": \"1.0.0\",\n  \"start_date\": \"2025-12-01T00:00:00+00:00\",\n  \"end_date\": \"2025-12-20T00:00:00+00:00\",\n  \"track_selection_strategy\": \"least_occupied\",\n  \"workshop_selection_strategy\": \"least_occupied\",\n  \"parking_selection_strategy\": \"least_occupied\",\n  \"references\": {\n    \"locomotives\": \"locomotive.json\",\n    \"process_times\": \"process_times.json\",\n    \"routes\": \"routes.json\",\n    \"trains\": \"train_schedule.csv\",\n    \"topology\": \"topology.json\",\n    \"tracks\": \"tracks.json\",\n    \"workshops\": \"workshops.json\"\n  }\n}\n</code></pre>"},{"location":"tutorial/02-scenario-configuration/#parameters","title":"Parameters","text":""},{"location":"tutorial/02-scenario-configuration/#metadata","title":"Metadata","text":"Parameter Type Description Example <code>id</code> string Unique scenario identifier <code>\"test_scenario_01\"</code> <code>description</code> string Human-readable description <code>\"DAC retrofit simulation\"</code> <code>version</code> string Scenario version (semantic versioning) <code>\"1.0.0\"</code>"},{"location":"tutorial/02-scenario-configuration/#simulation-timeframe","title":"Simulation Timeframe","text":"Parameter Type Description Example <code>start_date</code> ISO 8601 datetime Simulation start time (UTC) <code>\"2025-12-01T00:00:00+00:00\"</code> <code>end_date</code> ISO 8601 datetime Simulation end time (UTC) <code>\"2025-12-20T00:00:00+00:00\"</code> <p>Important:  - Use ISO 8601 format with timezone (<code>+00:00</code> for UTC) - End date must be after start date - All train arrivals in train_schedule.csv must fall within this timeframe</p>"},{"location":"tutorial/02-scenario-configuration/#selection-strategies","title":"Selection Strategies","text":"<p>These strategies determine how the simulation selects resources when multiple options are available:</p> Parameter Type Available Values Description <code>track_selection_strategy</code> string <code>\"least_occupied\"</code>, <code>\"first_available\"</code> How to select parking tracks for wagons <code>workshop_selection_strategy</code> string <code>\"least_occupied\"</code>, <code>\"first_available\"</code> How to select workshops for retrofit operations <code>parking_selection_strategy</code> string <code>\"least_occupied\"</code>, <code>\"first_available\"</code> How to select parking locations for completed wagons <p>Strategy Descriptions:</p> <ul> <li>least_occupied - Selects the resource with the most available capacity (balances load)</li> <li>first_available - Selects the first resource with any available capacity (simpler, may create bottlenecks)</li> </ul> <p>Effect on Simulation: - <code>least_occupied</code> typically results in better resource utilization and throughput - <code>first_available</code> may be faster to compute but can lead to uneven resource usage - For realistic scenarios, <code>least_occupied</code> is recommended</p>"},{"location":"tutorial/02-scenario-configuration/#references","title":"References","text":"<p>The <code>references</code> object maps logical names to configuration filenames. All paths are relative to the scenario directory.</p> Key Required Description Typical Filename <code>locomotives</code> Yes Locomotive configuration <code>locomotive.json</code> <code>process_times</code> Yes Operation timing parameters <code>process_times.json</code> <code>routes</code> Yes Movement paths between tracks <code>routes.json</code> <code>trains</code> Yes Train schedule and wagon data <code>train_schedule.csv</code> <code>topology</code> Yes Network structure <code>topology.json</code> <code>tracks</code> Yes Track definitions <code>tracks.json</code> <code>workshops</code> Yes Workshop configurations <code>workshops.json</code> <p>Note: All referenced files must exist in the scenario directory, or PopUpSim will fail validation.</p>"},{"location":"tutorial/02-scenario-configuration/#common-modifications","title":"Common Modifications","text":""},{"location":"tutorial/02-scenario-configuration/#extending-simulation-duration","title":"Extending Simulation Duration","text":"<p>To simulate a longer period:</p> <pre><code>{\n  \"start_date\": \"2025-12-01T00:00:00+00:00\",\n  \"end_date\": \"2025-12-31T23:59:59+00:00\"\n}\n</code></pre>"},{"location":"tutorial/02-scenario-configuration/#changing-selection-strategy","title":"Changing Selection Strategy","text":"<p>To test different resource allocation approaches:</p> <pre><code>{\n  \"track_selection_strategy\": \"first_available\",\n  \"workshop_selection_strategy\": \"least_occupied\",\n  \"parking_selection_strategy\": \"least_occupied\"\n}\n</code></pre>"},{"location":"tutorial/02-scenario-configuration/#validation-rules","title":"Validation Rules","text":"<ul> <li><code>id</code> must be unique across scenarios</li> <li><code>start_date</code> must be before <code>end_date</code></li> <li>All referenced files must exist</li> <li>Selection strategies must use valid values</li> <li>Dates must be in ISO 8601 format with timezone</li> </ul>"},{"location":"tutorial/02-scenario-configuration/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 3: Topology Configuration to learn about network structure.</p>"},{"location":"tutorial/03-topology-configuration/","title":"Chapter 3: Topology Configuration","text":""},{"location":"tutorial/03-topology-configuration/#file-topologyjson","title":"File: topology.json","text":"<p>The topology.json file defines the physical network structure of your railway yard. It specifies nodes (connection points) and edges (track segments) that form the foundation for track definitions.</p>"},{"location":"tutorial/03-topology-configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>{\n  \"nodes\": [1, 2],\n  \"edges\": {\n    \"parking1\": {\"nodes\": [1, 2], \"length\": 150.0},\n    \"parking2\": {\"nodes\": [1, 2], \"length\": 270.0},\n    \"collection1\": {\"nodes\": [1, 2], \"length\": 500.0},\n    \"WS1\": {\"nodes\": [1, 2], \"length\": 260.0},\n    \"WS2\": {\"nodes\": [1, 2], \"length\": 260.0},\n    \"Mainline\": {\"nodes\": [1, 2], \"length\": 8000.0}\n  }\n}\n</code></pre>"},{"location":"tutorial/03-topology-configuration/#structure","title":"Structure","text":"<p>PopUpSim will use a node edge model of the track network in the future. This is not implemented in the MVP since PopUpSim will not e.g. take connectivity between tracks into account. Only track length is important till now.</p>"},{"location":"tutorial/03-topology-configuration/#nodes","title":"Nodes","text":"<p>The nodes are currently unused in PopUpSim. They become imporant when the full node edge model for representing the track network.</p> <p>Nodes represent connection points in the railway network (e.g., switches, junctions).</p> <pre><code>\"nodes\": [1, 2]\n</code></pre> <ul> <li>Type: Array of integers</li> <li>Purpose: Define connection points for edges</li> <li>Example: <code>[1, 2]</code> creates two nodes</li> </ul> <p>In the ten_trains_two_days scenario: - Only 2 nodes are used (simplified topology) - All tracks connect between these two nodes - This represents a linear yard layout</p>"},{"location":"tutorial/03-topology-configuration/#edges","title":"Edges","text":"<p>Edges represent physical track segments connecting nodes. The node definitions are currently unused. The length is important.</p> <pre><code>\"edges\": {\n  \"edge_id\": {\n    \"nodes\": [start_node, end_node],\n    \"length\": length_in_meters\n  }\n}\n</code></pre> Parameter Type Description Unit <code>edge_id</code> string Unique identifier for the edge - <code>nodes</code> array[int, int] Start and end node IDs - <code>length</code> float Physical length of the track segment meters"},{"location":"tutorial/03-topology-configuration/#example-edges","title":"Example Edges","text":"<p>Here the nodes are just defined, they have no real meaning but are necessary to define the edges.</p>"},{"location":"tutorial/03-topology-configuration/#parking-tracks","title":"Parking Tracks","text":"<pre><code>\"parking1\": {\"nodes\": [1, 2], \"length\": 150.0},\n\"parking2\": {\"nodes\": [1, 2], \"length\": 270.0}\n</code></pre> <ul> <li>Short to medium length (100-600m)</li> <li>Used for wagon storage</li> <li>Length determines wagon capacity</li> </ul>"},{"location":"tutorial/03-topology-configuration/#collection-tracks","title":"Collection Tracks","text":"<pre><code>\"collection1\": {\"nodes\": [1, 2], \"length\": 500.0},\n\"collection2\": {\"nodes\": [1, 2], \"length\": 500.0}\n</code></pre> <ul> <li>Medium length (500m)</li> <li>Used for incoming train reception</li> <li>Must accommodate full train lengths</li> </ul>"},{"location":"tutorial/03-topology-configuration/#workshop-tracks","title":"Workshop Tracks","text":"<pre><code>\"WS1\": {\"nodes\": [1, 2], \"length\": 260.0},\n\"WS2\": {\"nodes\": [1, 2], \"length\": 260.0}\n</code></pre> <ul> <li>Medium length (260m)</li> <li>Used for retrofit operations</li> <li>Length affects workshop capacity</li> </ul>"},{"location":"tutorial/03-topology-configuration/#mainline","title":"Mainline","text":"<pre><code>\"Mainline\": {\"nodes\": [1, 2], \"length\": 8000.0}\n</code></pre> <ul> <li>Very long (8000m)</li> <li>Connects different yard areas</li> <li>Represents main circulation path</li> </ul>"},{"location":"tutorial/03-topology-configuration/#track-length-considerations","title":"Track Length Considerations","text":"<p>Track length directly affects capacity:</p> <p>Wagon Capacity Calculation: <pre><code>capacity = floor(track_length / wagon_length)\n</code></pre></p> <p>Example: - Track length: 260m - Average wagon length: 20m - Capacity: 260 / 20 = 13 wagons</p> <p>Typical Wagon Lengths: - Short wagons: 15-17m - Medium wagons: 18-22m - Long wagons: &gt;23m</p> <p>Note: Average values are only here for elucidation. The code itself uses the given lengths in meters defined for each wagon.</p>"},{"location":"tutorial/03-topology-configuration/#common-modifications","title":"Common Modifications","text":""},{"location":"tutorial/03-topology-configuration/#adding-a-new-parking-track","title":"Adding a New Parking Track","text":"<pre><code>\"parking17\": {\"nodes\": [1, 2], \"length\": 300.0}\n</code></pre> <p>Then reference it in tracks.json: <pre><code>{\"id\": \"parking17\", \"name\": \"Additional parking\", \"edges\": [\"parking17\"], \"type\": \"parking\"}\n</code></pre></p>"},{"location":"tutorial/03-topology-configuration/#adjusting-track-capacity","title":"Adjusting Track Capacity","text":"<p>To increase capacity, increase length:</p> <pre><code>\"parking1\": {\"nodes\": [1, 2], \"length\": 300.0}  // Was 150.0\n</code></pre> <p>This doubles the wagon capacity from ~7 to ~15 wagons.</p>"},{"location":"tutorial/03-topology-configuration/#creating-complex-topologies","title":"Creating Complex Topologies","text":"<p>For more realistic yards with multiple connection points:</p> <pre><code>{\n  \"nodes\": [1, 2, 3, 4],\n  \"edges\": {\n    \"main_entry\": {\"nodes\": [1, 2], \"length\": 500.0},\n    \"branch_left\": {\"nodes\": [2, 3], \"length\": 300.0},\n    \"branch_right\": {\"nodes\": [2, 4], \"length\": 300.0},\n    \"parking_a\": {\"nodes\": [3, 3], \"length\": 200.0},\n    \"parking_b\": {\"nodes\": [4, 4], \"length\": 200.0}\n  }\n}\n</code></pre>"},{"location":"tutorial/03-topology-configuration/#validation-rules","title":"Validation Rules","text":"<ul> <li>All node IDs in edges must exist in the nodes array</li> <li>Edge IDs must be unique</li> <li>Lengths must be positive numbers</li> <li>Each edge must connect exactly 2 nodes</li> <li>Edge IDs referenced in tracks.json must exist here</li> </ul>"},{"location":"tutorial/03-topology-configuration/#effect-on-simulation","title":"Effect on Simulation","text":"<ul> <li>Track length determines wagon capacity</li> <li>Network structure affects routing complexity</li> <li>Node count impacts route calculation performance</li> <li>Edge naming must match references in tracks.json</li> </ul>"},{"location":"tutorial/03-topology-configuration/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 4: Track Configuration to learn how edges become functional tracks.</p>"},{"location":"tutorial/04-track-configuration/","title":"Chapter 4: Track Configuration","text":""},{"location":"tutorial/04-track-configuration/#file-tracksjson","title":"File: tracks.json","text":"<p>The tracks.json file defines functional tracks by assigning types and properties to the physical edges defined in topology.json. Track types determine how the simulation uses each track.</p>"},{"location":"tutorial/04-track-configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>{\n  \"tracks\": [\n    {\"id\": \"parking1\", \"name\": \"Parking track\", \"edges\": [\"parking1\"], \"type\": \"parking\"},\n    {\"id\": \"collection1\", \"name\": \"Collection track\", \"edges\": [\"collection1\"], \"type\": \"collection\"},\n    {\"id\": \"WS1\", \"edges\": [\"WS1\"], \"type\": \"workshop\"},\n    {\"id\": \"loco_parking\", \"edges\": [\"loco_parking\"], \"type\": \"rescource_parking\"},\n    {\"id\": \"Mainline\", \"name\": \"Mainline connecting yards\", \"edges\": [\"Mainline\"], \"type\": \"mainline\"}\n  ]\n}\n</code></pre>"},{"location":"tutorial/04-track-configuration/#track-structure","title":"Track Structure","text":"<p>Each track definition contains:</p> Parameter Type Required Description <code>id</code> string Yes Unique track identifier <code>name</code> string No Human-readable track name <code>edges</code> array[string] Yes List of edge IDs from topology.json <code>type</code> string Yes Track type (determines function)"},{"location":"tutorial/04-track-configuration/#track-types","title":"Track Types","text":""},{"location":"tutorial/04-track-configuration/#parking","title":"parking","text":"<p>Purpose: Store wagons waiting for retrofit or after completion</p> <pre><code>{\"id\": \"parking1\", \"name\": \"Parking track\", \"edges\": [\"parking1\"], \"type\": \"parking\"}\n</code></pre> <p>Characteristics: - Used for wagon storage - Capacity based on edge length - Selected by <code>parking_selection_strategy</code> - Multiple parking tracks improve throughput</p> <p>In ten_trains_two_days: 15 parking tracks (parking1-parking16, excluding parking4)</p>"},{"location":"tutorial/04-track-configuration/#collection","title":"collection","text":"<p>Purpose: Receive incoming trains and temporarily hold wagons</p> <pre><code>{\"id\": \"collection1\", \"name\": \"Collection track\", \"edges\": [\"collection1\"], \"type\": \"collection\"}\n</code></pre> <p>Characteristics: - First destination for arriving trains - Must accommodate full train lengths - Wagons are distributed from here to parking or retrofit - Typically 2-4 collection tracks needed</p> <p>In ten_trains_two_days: 2 collection tracks</p>"},{"location":"tutorial/04-track-configuration/#workshop","title":"workshop","text":"<p>Purpose: Dedicated tracks for workshop operations</p> <pre><code>{\"id\": \"WS1\", \"edges\": [\"WS1\"], \"type\": \"workshop\"}\n</code></pre> <p>Characteristics: - Associated with workshop definitions in workshops.json - Wagons undergo retrofit here - Capacity affects workshop throughput - Number of tracks = number of workshops</p> <p>In ten_trains_two_days: 2 workshop tracks (WS1, WS2)</p>"},{"location":"tutorial/04-track-configuration/#retrofit","title":"retrofit","text":"<p>Purpose: Staging area for wagons ready for retrofit</p> <pre><code>{\"id\": \"retrofit\", \"edges\": [\"retrofit\"], \"type\": \"retrofit\"}\n</code></pre> <p>Characteristics: - Holds wagons waiting for workshop availability - Acts as a buffer between parking and workshop - Reduces workshop idle time</p> <p>In ten_trains_two_days: 1 retrofit track</p>"},{"location":"tutorial/04-track-configuration/#retrofitted","title":"retrofitted","text":"<p>Purpose: Staging area for completed wagons</p> <pre><code>{\"id\": \"retrofitted\", \"edges\": [\"retrofitted\"], \"type\": \"retrofitted\"}\n</code></pre> <p>Characteristics: - Holds wagons after retrofit completion - Wagons distributed from here to final parking - Prevents workshop blocking</p> <p>In ten_trains_two_days: 1 retrofitted track</p>"},{"location":"tutorial/04-track-configuration/#rescource_parking","title":"rescource_parking","text":"<p>Purpose: Home location for locomotives and other resources</p> <pre><code>{\"id\": \"loco_parking\", \"edges\": [\"loco_parking\"], \"type\": \"rescource_parking\"}\n</code></pre> <p>Characteristics: - Locomotives return here when idle - Referenced in locomotive.json as \"home track\" - Typically one per locomotive</p> <p>In ten_trains_two_days: 2 resource parking tracks</p>"},{"location":"tutorial/04-track-configuration/#mainline","title":"mainline","text":"<p>Purpose: Main circulation path connecting yard areas</p> <pre><code>{\"id\": \"Mainline\", \"name\": \"Mainline connecting yards\", \"edges\": [\"Mainline\"], \"type\": \"mainline\"}\n</code></pre> <p>Characteristics: - Used in route definitions - Represents main yard circulation - Not used for wagon storage - Typically very long</p> <p>In ten_trains_two_days: 1 mainline track</p>"},{"location":"tutorial/04-track-configuration/#multi-edge-tracks","title":"Multi-Edge Tracks","text":"<p>Tracks can span multiple edges:</p> <pre><code>{\"id\": \"long_track\", \"edges\": [\"edge1\", \"edge2\", \"edge3\"], \"type\": \"parking\"}\n</code></pre> <p>Total length: Sum of all edge lengths Use case: Modeling tracks that span multiple physical segments</p>"},{"location":"tutorial/04-track-configuration/#track-naming","title":"Track Naming","text":"<p>The <code>name</code> field is optional but recommended for clarity:</p> <pre><code>{\"id\": \"parking1\", \"name\": \"North side parking track 1\", \"edges\": [\"parking1\"], \"type\": \"parking\"}\n</code></pre> <ul> <li>Used in logs and reports</li> <li>Helps identify tracks during analysis</li> <li>Not used for simulation logic</li> </ul>"},{"location":"tutorial/04-track-configuration/#common-modifications","title":"Common Modifications","text":""},{"location":"tutorial/04-track-configuration/#adding-more-parking-capacity","title":"Adding More Parking Capacity","text":"<p>Add new parking tracks:</p> <pre><code>{\"id\": \"parking17\", \"name\": \"Additional parking\", \"edges\": [\"parking17\"], \"type\": \"parking\"},\n{\"id\": \"parking18\", \"name\": \"Additional parking\", \"edges\": [\"parking18\"], \"type\": \"parking\"}\n</code></pre> <p>Effect: Increases total parking capacity, reduces waiting times</p>"},{"location":"tutorial/04-track-configuration/#adding-workshop-capacity","title":"Adding Workshop Capacity","text":"<p>Add workshop tracks (must also update workshops.json):</p> <pre><code>{\"id\": \"WS3\", \"edges\": [\"WS3\"], \"type\": \"workshop\"}\n</code></pre>"},{"location":"tutorial/04-track-configuration/#changing-track-type","title":"Changing Track Type","text":"<p>Convert a parking track to collection:</p> <pre><code>{\"id\": \"parking16\", \"name\": \"Converted to collection\", \"edges\": [\"parking16\"], \"type\": \"collection\"}\n</code></pre> <p>Effect: Changes how the simulation uses this track</p>"},{"location":"tutorial/04-track-configuration/#validation-rules","title":"Validation Rules","text":"<ul> <li>Track IDs must be unique</li> <li>All edge IDs must exist in topology.json</li> <li>Track types must be valid values</li> <li>Workshop tracks must have corresponding entries in workshops.json</li> <li>Resource parking tracks must be referenced in locomotive.json</li> </ul>"},{"location":"tutorial/04-track-configuration/#effect-on-simulation","title":"Effect on Simulation","text":"<ul> <li>Track type determines operational role</li> <li>Number of tracks affects capacity and throughput</li> <li>Track distribution impacts resource utilization</li> <li>Edge references determine physical capacity</li> </ul>"},{"location":"tutorial/04-track-configuration/#track-type-summary","title":"Track Type Summary","text":"Type Purpose Typical Count Capacity Impact parking Wagon storage 10-20 High - more = better throughput collection Train reception 2-4 Medium - must fit trains workshop Retrofit operations 1-3 Critical - bottleneck point retrofit Pre-workshop staging 1-2 Medium - buffer for workshops retrofitted Post-workshop staging 1-2 Medium - prevents blocking rescource_parking Locomotive home 1 per loco Low - resource management mainline Circulation 1 Low - routing only"},{"location":"tutorial/04-track-configuration/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 5: Workshop Configuration to learn about workshop setup.</p>"},{"location":"tutorial/05-workshop-configuration/","title":"Chapter 5: Workshop Configuration","text":""},{"location":"tutorial/05-workshop-configuration/#file-workshopsjson","title":"File: workshops.json","text":"<p>The workshops.json file defines retrofit workshops, their capacity, and associated tracks. Workshops are the critical bottleneck in the simulation where wagons receive DAC retrofits.</p>"},{"location":"tutorial/05-workshop-configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>{\n  \"metadata\": {\n    \"description\": \"Workshop configurations for DAC retrofit operations\",\n    \"version\": \"1.0.0\",\n    \"created\": \"2024-01-15\"\n  },\n  \"workshops\": [\n    {\n      \"id\": \"WS_01\",\n      \"name\": \"First workshop\",\n      \"retrofit_stations\": 2,\n      \"track\": \"track_WS1\"\n    },\n    {\n      \"id\": \"WS_02\",\n      \"name\": \"Second workshop\",\n      \"retrofit_stations\": 2,\n      \"track\": \"track_WS2\"\n    }\n  ]\n}\n</code></pre>"},{"location":"tutorial/05-workshop-configuration/#structure","title":"Structure","text":""},{"location":"tutorial/05-workshop-configuration/#metadata","title":"Metadata","text":"<p>Optional metadata for documentation:</p> Parameter Type Description <code>description</code> string Workshop configuration description <code>version</code> string Configuration version <code>created</code> string Creation date"},{"location":"tutorial/05-workshop-configuration/#workshop-definitions","title":"Workshop Definitions","text":"<p>Each workshop in the <code>workshops</code> array:</p> Parameter Type Required Description <code>id</code> string Yes Unique workshop identifier <code>name</code> string No Human-readable workshop name <code>retrofit_stations</code> integer Yes Number of parallel retrofit stations <code>track</code> string Yes Associated track ID from tracks.json"},{"location":"tutorial/05-workshop-configuration/#parameters-explained","title":"Parameters Explained","text":""},{"location":"tutorial/05-workshop-configuration/#id","title":"id","text":"<p>Unique identifier for the workshop:</p> <pre><code>\"id\": \"WS_01\"\n</code></pre> <ul> <li>Must be unique across all workshops</li> <li>Used in logs and reports</li> <li>Referenced internally by simulation</li> </ul>"},{"location":"tutorial/05-workshop-configuration/#name","title":"name","text":"<p>Human-readable workshop name:</p> <pre><code>\"name\": \"First workshop\"\n</code></pre> <ul> <li>Optional but recommended</li> <li>Used in reports and visualizations</li> <li>Helps identify workshops during analysis</li> </ul>"},{"location":"tutorial/05-workshop-configuration/#retrofit_stations","title":"retrofit_stations","text":"<p>Number of parallel retrofit stations in the workshop:</p> <pre><code>\"retrofit_stations\": 2\n</code></pre> <p>Critical Parameter: - Determines how many wagons can be retrofitted simultaneously - Directly affects workshop throughput - More stations = higher capacity but higher cost - This is the ONLY capacity constraint - track length is not checked</p> <p>Throughput Calculation: <pre><code>wagons_per_hour = (retrofit_stations * 60) / wagon_retrofit_time\n</code></pre></p> <p>Example: - 2 stations, 60-minute retrofit time - Throughput: (2 \u00d7 60) / 60 = 2 wagons/hour - Daily capacity: 2 \u00d7 24 = 48 wagons/day</p> <p>Typical Values: - Small workshop: 1-2 stations - Medium workshop: 2-4 stations - Large workshop: 4-8 stations</p>"},{"location":"tutorial/05-workshop-configuration/#track","title":"track","text":"<p>Reference to the workshop track:</p> <pre><code>\"track\": \"track_WS1\"\n</code></pre> <ul> <li>Must match a track ID from tracks.json</li> <li>Track must have type \"workshop\"</li> <li>Track length does NOT affect capacity (only retrofit_stations matter)</li> </ul>"},{"location":"tutorial/05-workshop-configuration/#workshop-capacity-analysis","title":"Workshop Capacity Analysis","text":""},{"location":"tutorial/05-workshop-configuration/#station-count-impact","title":"Station Count Impact","text":"Stations Wagons/Hour (60min retrofit) Daily Capacity Use Case 1 1 24 Small operations 2 2 48 Standard workshop 4 4 96 High-volume workshop 8 8 192 Industrial-scale <p>Important: The number of retrofit_stations is the ONLY capacity constraint. The simulation pulls exactly as many wagons from the retrofit staging track as there are available stations. Track length is not checked.</p>"},{"location":"tutorial/05-workshop-configuration/#common-modifications","title":"Common Modifications","text":""},{"location":"tutorial/05-workshop-configuration/#increasing-workshop-capacity","title":"Increasing Workshop Capacity","text":"<p>Add more retrofit stations:</p> <pre><code>{\n  \"id\": \"WS_01\",\n  \"name\": \"First workshop - expanded\",\n  \"retrofit_stations\": 4,  // Was 2\n  \"track\": \"track_WS1\"\n}\n</code></pre> <p>Effect: - Doubles throughput - Reduces wagon waiting times - Processes 4 wagons simultaneously instead of 2</p>"},{"location":"tutorial/05-workshop-configuration/#adding-a-new-workshop","title":"Adding a New Workshop","text":"<pre><code>{\n  \"id\": \"WS_03\",\n  \"name\": \"Third workshop\",\n  \"retrofit_stations\": 2,\n  \"track\": \"track_WS3\"\n}\n</code></pre> <p>Requirements: 1. Add edge in topology.json: <code>\"WS3\": {\"nodes\": [1, 2], \"length\": 260.0}</code> 2. Add track in tracks.json: <code>{\"id\": \"WS3\", \"edges\": [\"WS3\"], \"type\": \"workshop\"}</code> 3. Add routes connecting WS3 to other tracks in routes.json</p> <p>Note: Track length can be any reasonable value - it doesn't affect workshop capacity. Only <code>retrofit_stations</code> determines how many wagons are processed simultaneously.</p> <p>Effect: - Increases total retrofit capacity - Improves throughput - Reduces bottlenecks</p>"},{"location":"tutorial/05-workshop-configuration/#asymmetric-workshop-configuration","title":"Asymmetric Workshop Configuration","text":"<p>Different workshops with different capacities:</p> <pre><code>{\n  \"workshops\": [\n    {\n      \"id\": \"WS_01\",\n      \"name\": \"Small workshop\",\n      \"retrofit_stations\": 1,\n      \"track\": \"track_WS1\"\n    },\n    {\n      \"id\": \"WS_02\",\n      \"name\": \"Large workshop\",\n      \"retrofit_stations\": 4,\n      \"track\": \"track_WS2\"\n    }\n  ]\n}\n</code></pre> <p>Use case: Modeling existing infrastructure with varying capacities</p>"},{"location":"tutorial/05-workshop-configuration/#workshop-selection-strategy","title":"Workshop Selection Strategy","text":"<p>The <code>workshop_selection_strategy</code> in scenario.json determines how wagons are assigned to workshops:</p> <p>least_occupied: <pre><code>Workshop 1: 1/2 stations busy \u2192 50% utilization\nWorkshop 2: 2/2 stations busy \u2192 100% utilization\n\u2192 Wagon assigned to Workshop 1\n</code></pre></p> <p>first_available: <pre><code>Workshop 1: 1/2 stations busy \u2192 available\nWorkshop 2: 2/2 stations busy \u2192 full\n\u2192 Wagon assigned to Workshop 1 (first with capacity)\n</code></pre></p>"},{"location":"tutorial/05-workshop-configuration/#validation-rules","title":"Validation Rules","text":"<ul> <li>Workshop IDs must be unique</li> <li><code>retrofit_stations</code> must be positive integer</li> <li>Referenced tracks must exist in tracks.json</li> <li>Referenced tracks must have type \"workshop\"</li> <li>At least one workshop must be defined</li> </ul>"},{"location":"tutorial/05-workshop-configuration/#effect-on-simulation","title":"Effect on Simulation","text":"<ul> <li>retrofit_stations is the primary throughput determinant</li> <li>Number of workshops provides redundancy and capacity</li> <li>Track assignment affects spatial distribution</li> <li>Workshop capacity often becomes the simulation bottleneck</li> </ul>"},{"location":"tutorial/05-workshop-configuration/#performance-considerations","title":"Performance Considerations","text":""},{"location":"tutorial/05-workshop-configuration/#bottleneck-analysis","title":"Bottleneck Analysis","text":"<p>If workshops are the bottleneck: - Wagons queue at retrofit staging tracks - Parking tracks fill up - Collection tracks may block</p> <p>Solutions: 1. Increase <code>retrofit_stations</code> in workshops.json 2. Add more workshops 3. Optimize workshop selection strategy</p>"},{"location":"tutorial/05-workshop-configuration/#capacity-planning","title":"Capacity Planning","text":"<p>Rule of thumb: <pre><code>required_stations = (total_wagons \u00d7 wagon_retrofit_time) / (simulation_duration \u00d7 60)\n</code></pre></p> <p>Example: - 224 wagons - 60-minute retrofit time - 48-hour simulation (2880 minutes) - Required: (224 \u00d7 60) / 2880 = 4.67 \u2192 5 stations minimum</p> <p>ten_trains_two_days has 4 stations (2 workshops \u00d7 2 stations) \u2192 Expect some queuing</p>"},{"location":"tutorial/05-workshop-configuration/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 6: Process Times Configuration to learn about operation durations.</p>"},{"location":"tutorial/06-process-times-configuration/","title":"Chapter 6: Process Times Configuration","text":""},{"location":"tutorial/06-process-times-configuration/#file-process_timesjson","title":"File: process_times.json","text":"<p>The process_times.json file defines the duration of various operations in the simulation. These timing parameters directly affect throughput, resource utilization, and overall simulation performance.</p>"},{"location":"tutorial/06-process-times-configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>{\n  \"wagon_retrofit_time\": 60.0,\n  \"train_to_hump_delay\": 0.0,\n  \"wagon_hump_interval\": 0.0,\n  \"screw_coupling_time\": 3.0,\n  \"screw_decoupling_time\": 5.0,\n  \"dac_coupling_time\": 0.5,\n  \"dac_decoupling_time\": 0.5\n}\n</code></pre>"},{"location":"tutorial/06-process-times-configuration/#parameters","title":"Parameters","text":"<p>All time values are in minutes unless otherwise specified.</p>"},{"location":"tutorial/06-process-times-configuration/#wagon_retrofit_time","title":"wagon_retrofit_time","text":"<p>Time required to retrofit one wagon with DAC:</p> <pre><code>\"wagon_retrofit_time\": 60.0\n</code></pre> Value Description Throughput Impact 30.0 Fast retrofit (30 min) High throughput 60.0 Standard retrofit (1 hour) Medium throughput 120.0 Slow retrofit (2 hours) Low throughput <p>Critical Parameter: - Directly affects workshop throughput - Longer time = more bottlenecks - Shorter time = higher capacity requirements</p> <p>Throughput Calculation: <pre><code>wagons_per_station_per_day = (24 \u00d7 60) / wagon_retrofit_time\n</code></pre></p> <p>Examples: - 30 min: 48 wagons/station/day - 60 min: 24 wagons/station/day - 120 min: 12 wagons/station/day</p> <p>Realistic Values: - Quick retrofit: 30-45 minutes - Standard retrofit: 60-90 minutes - Complex retrofit: 120-180 minutes</p>"},{"location":"tutorial/06-process-times-configuration/#train_to_hump_delay","title":"train_to_hump_delay","text":"<p>Delay before train wagons can be distributed:</p> <pre><code>\"train_to_hump_delay\": 0.0\n</code></pre> <p>Purpose: Models administrative or safety delays after train arrival</p> Value Description 0.0 Immediate processing (current setting) 5.0 5-minute safety check 15.0 15-minute inspection <p>Effect: - Adds delay to all arriving trains - Increases collection track occupancy - May create arrival bottlenecks</p> <p>Current Setting: 0.0 (no delay) for simplified simulation</p>"},{"location":"tutorial/06-process-times-configuration/#wagon_hump_interval","title":"wagon_hump_interval","text":"<p>Time interval between distributing individual wagons:</p> <pre><code>\"wagon_hump_interval\": 0.0\n</code></pre> <p>Purpose: Models the time to separate and route individual wagons from a train</p> Value Description 0.0 Instant distribution (current setting) 1.0 1 minute per wagon 2.0 2 minutes per wagon <p>Effect: - Longer interval = slower train processing - Affects collection track occupancy - Impacts locomotive utilization</p> <p>Example: - 30-wagon train with 2-minute interval - Total distribution time: 30 \u00d7 2 = 60 minutes</p> <p>Current Setting: 0.0 (instant) for simplified simulation</p>"},{"location":"tutorial/06-process-times-configuration/#screw_coupling_time","title":"screw_coupling_time","text":"<p>Time to couple wagons using traditional screw couplers:</p> <pre><code>\"screw_coupling_time\": 3.0\n</code></pre> <p>Purpose: Models coupling wagons that haven't been retrofitted yet</p> Value Description 2.0 Fast coupling 3.0 Standard coupling (current) 5.0 Slow/careful coupling <p>When Used: - Coupling non-retrofitted wagons - Initial train assembly - Moving wagons to retrofit</p> <p>Realistic Values: 2-5 minutes per coupling operation</p>"},{"location":"tutorial/06-process-times-configuration/#screw_decoupling_time","title":"screw_decoupling_time","text":"<p>Time to decouple wagons using traditional screw couplers:</p> <pre><code>\"screw_decoupling_time\": 5.0\n</code></pre> <p>Purpose: Models decoupling wagons that haven't been retrofitted yet</p> Value Description 3.0 Fast decoupling 5.0 Standard decoupling (current) 7.0 Slow/careful decoupling <p>When Used: - Separating non-retrofitted wagons - Train disassembly - Individual wagon movements</p> <p>Note: Typically slower than coupling due to safety procedures</p> <p>Realistic Values: 3-7 minutes per decoupling operation</p>"},{"location":"tutorial/06-process-times-configuration/#dac_coupling_time","title":"dac_coupling_time","text":"<p>Time to couple wagons using Digital Automatic Couplers:</p> <pre><code>\"dac_coupling_time\": 0.5\n</code></pre> <p>Purpose: Models coupling retrofitted wagons with DAC</p> Value Description 0.5 Automatic coupling (current) 1.0 Semi-automatic <p>When Used: - Coupling retrofitted wagons - Final train assembly - Moving completed wagons</p> <p>Key Advantage: Much faster than screw coupling (0.5 vs 3.0 minutes)</p> <p>Realistic Values: 0.5-1.0 minutes (automatic operation)</p>"},{"location":"tutorial/06-process-times-configuration/#dac_decoupling_time","title":"dac_decoupling_time","text":"<p>Time to decouple wagons using Digital Automatic Couplers:</p> <pre><code>\"dac_decoupling_time\": 0.5\n</code></pre> <p>Purpose: Models decoupling retrofitted wagons with DAC</p> Value Description 0.5 Automatic decoupling (current) 1.0 Semi-automatic <p>When Used: - Separating retrofitted wagons - Parking operations - Final distribution</p> <p>Key Advantage: Much faster than screw decoupling (0.5 vs 5.0 minutes)</p> <p>Realistic Values: 0.5-1.0 minutes (automatic operation)</p>"},{"location":"tutorial/06-process-times-configuration/#couplingdecoupling-comparison","title":"Coupling/Decoupling Comparison","text":"Operation Screw Coupler DAC Time Savings Coupling 3.0 min 0.5 min 83% faster Decoupling 5.0 min 0.5 min 90% faster Round trip 8.0 min 1.0 min 87.5% faster <p>Simulation Impact: DAC significantly reduces shunting operation time</p>"},{"location":"tutorial/06-process-times-configuration/#common-modifications","title":"Common Modifications","text":""},{"location":"tutorial/06-process-times-configuration/#faster-retrofit-operations","title":"Faster Retrofit Operations","text":"<p>Simulate improved workshop efficiency:</p> <pre><code>{\n  \"wagon_retrofit_time\": 45.0,  // Was 60.0\n  \"screw_coupling_time\": 2.5,   // Was 3.0\n  \"screw_decoupling_time\": 4.0  // Was 5.0\n}\n</code></pre> <p>Effect: - Increases throughput by 25% - Reduces workshop bottlenecks - Improves resource utilization</p>"},{"location":"tutorial/06-process-times-configuration/#realistic-train-processing","title":"Realistic Train Processing","text":"<p>Add delays for safety and inspection:</p> <pre><code>{\n  \"train_to_hump_delay\": 10.0,    // Was 0.0\n  \"wagon_hump_interval\": 1.5      // Was 0.0\n}\n</code></pre> <p>Effect: - More realistic simulation - Increases collection track occupancy - May reveal arrival bottlenecks</p>"},{"location":"tutorial/06-process-times-configuration/#slower-coupling-operations","title":"Slower Coupling Operations","text":"<p>Model less experienced crews:</p> <pre><code>{\n  \"screw_coupling_time\": 5.0,     // Was 3.0\n  \"screw_decoupling_time\": 7.0,   // Was 5.0\n  \"dac_coupling_time\": 1.0,       // Was 0.5\n  \"dac_decoupling_time\": 1.0      // Was 0.5\n}\n</code></pre> <p>Effect: - Increases locomotive utilization - Longer wagon movement times - May create shunting bottlenecks</p>"},{"location":"tutorial/06-process-times-configuration/#validation-rules","title":"Validation Rules","text":"<ul> <li>All values must be non-negative numbers</li> <li>Time values are in minutes</li> <li>Zero values are allowed (instant operations)</li> <li>Decoupling typically \u2265 coupling time</li> </ul>"},{"location":"tutorial/06-process-times-configuration/#effect-on-simulation","title":"Effect on Simulation","text":""},{"location":"tutorial/06-process-times-configuration/#primary-bottleneck-wagon_retrofit_time","title":"Primary Bottleneck: wagon_retrofit_time","text":"<p>This parameter typically dominates simulation performance:</p> <pre><code>Total retrofit time = wagon_count \u00d7 wagon_retrofit_time / retrofit_stations\n</code></pre> <p>Example (ten_trains_two_days): - 224 wagons \u00d7 60 minutes / 4 stations = 3,360 minutes = 56 hours</p>"},{"location":"tutorial/06-process-times-configuration/#secondary-impact-couplingdecoupling","title":"Secondary Impact: Coupling/Decoupling","text":"<p>Affects locomotive utilization and wagon movement:</p> <pre><code>Movement time = travel_time + coupling_time + decoupling_time\n</code></pre> <p>Example: - Travel: 1 minute - Screw decouple: 5 minutes - Screw couple: 3 minutes - Total: 9 minutes per movement</p>"},{"location":"tutorial/06-process-times-configuration/#optimization-strategy","title":"Optimization Strategy","text":"<ol> <li>Reduce retrofit time \u2192 Biggest throughput impact</li> <li>Optimize coupling operations \u2192 Improves shunting efficiency</li> <li>Minimize delays \u2192 Reduces idle time</li> <li>Balance all parameters \u2192 Realistic simulation</li> </ol>"},{"location":"tutorial/06-process-times-configuration/#performance-tuning","title":"Performance Tuning","text":""},{"location":"tutorial/06-process-times-configuration/#high-throughput-scenario","title":"High Throughput Scenario","text":"<pre><code>{\n  \"wagon_retrofit_time\": 30.0,\n  \"train_to_hump_delay\": 0.0,\n  \"wagon_hump_interval\": 0.0,\n  \"screw_coupling_time\": 2.0,\n  \"screw_decoupling_time\": 3.0,\n  \"dac_coupling_time\": 0.5,\n  \"dac_decoupling_time\": 0.5\n}\n</code></pre>"},{"location":"tutorial/06-process-times-configuration/#realistic-scenario","title":"Realistic Scenario","text":"<pre><code>{\n  \"wagon_retrofit_time\": 75.0,\n  \"train_to_hump_delay\": 15.0,\n  \"wagon_hump_interval\": 2.0,\n  \"screw_coupling_time\": 4.0,\n  \"screw_decoupling_time\": 6.0,\n  \"dac_coupling_time\": 1.0,\n  \"dac_decoupling_time\": 1.0\n}\n</code></pre>"},{"location":"tutorial/06-process-times-configuration/#conservative-scenario","title":"Conservative Scenario","text":"<pre><code>{\n  \"wagon_retrofit_time\": 120.0,\n  \"train_to_hump_delay\": 20.0,\n  \"wagon_hump_interval\": 3.0,\n  \"screw_coupling_time\": 5.0,\n  \"screw_decoupling_time\": 7.0,\n  \"dac_coupling_time\": 1.5,\n  \"dac_decoupling_time\": 1.5\n}\n</code></pre>"},{"location":"tutorial/06-process-times-configuration/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 7: Locomotive Configuration to learn about shunting resources.</p>"},{"location":"tutorial/07-locomotive-configuration/","title":"Chapter 7: Locomotive Configuration","text":""},{"location":"tutorial/07-locomotive-configuration/#file-locomotivejson","title":"File: locomotive.json","text":"<p>The locomotive.json file defines shunting locomotives used to move wagons between tracks. Locomotives are critical resources that can become bottlenecks if insufficient capacity is provided.</p> <p>\u26a0\ufe0f IMPORTANT LIMITATION: The current implementation is only tested and validated for single locomotive operation. While the configuration supports multiple locomotives, using more than one locomotive may cause issues because: - The simulation has no real track network model - Track sharing between locomotives on the same route is not prevented - Only job-level conflicts are prevented (same job not executed twice, no simultaneous movements on same route) - Physical track occupancy conflicts are not modeled</p> <p>Recommendation: Use only one locomotive in your scenarios until multi-locomotive support is fully implemented.</p>"},{"location":"tutorial/07-locomotive-configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>{\n  \"metadata\": {\n    \"description\": \"locomotive configurations for DAC retrofit operations\",\n    \"version\": \"1.0.0\",\n    \"created\": \"2024-01-15\"\n  },\n  \"locomotives\": [\n    {\n      \"id\": \"LOCO_01\",\n      \"name\": \"Shunting loco\",\n      \"home track\": \"track_19\"\n    }\n  ]\n}\n</code></pre>"},{"location":"tutorial/07-locomotive-configuration/#structure","title":"Structure","text":""},{"location":"tutorial/07-locomotive-configuration/#metadata","title":"Metadata","text":"<p>Optional metadata for documentation:</p> Parameter Type Description <code>description</code> string Locomotive configuration description <code>version</code> string Configuration version <code>created</code> string Creation date"},{"location":"tutorial/07-locomotive-configuration/#locomotive-definitions","title":"Locomotive Definitions","text":"<p>Each locomotive in the <code>locomotives</code> array:</p> Parameter Type Required Description <code>id</code> string Yes Unique locomotive identifier <code>name</code> string No Human-readable locomotive name <code>home track</code> string Yes Track ID where locomotive parks when idle"},{"location":"tutorial/07-locomotive-configuration/#parameters-explained","title":"Parameters Explained","text":""},{"location":"tutorial/07-locomotive-configuration/#id","title":"id","text":"<p>Unique identifier for the locomotive:</p> <pre><code>\"id\": \"LOCO_01\"\n</code></pre> <ul> <li>Must be unique across all locomotives</li> <li>Used in logs and reports</li> <li>Referenced internally by simulation</li> </ul> <p>Naming Convention: - <code>LOCO_01</code>, <code>LOCO_02</code>, etc. for sequential numbering - <code>SHUNT_A</code>, <code>SHUNT_B</code> for functional naming - <code>LOCO_NORTH</code>, <code>LOCO_SOUTH</code> for location-based naming</p>"},{"location":"tutorial/07-locomotive-configuration/#name","title":"name","text":"<p>Human-readable locomotive name:</p> <pre><code>\"name\": \"Shunting loco\"\n</code></pre> <ul> <li>Optional but recommended</li> <li>Used in reports and visualizations</li> <li>Helps identify locomotives during analysis</li> </ul> <p>Examples: - \"Main shunting locomotive\" - \"Backup shunting unit\" - \"Heavy-duty shunter\"</p>"},{"location":"tutorial/07-locomotive-configuration/#home-track","title":"home track","text":"<p>Track where the locomotive returns when idle:</p> <pre><code>\"home track\": \"track_19\"\n</code></pre> <p>Requirements: - Must reference a track ID from tracks.json - Track should have type \"rescource_parking\" - Track must be accessible via routes</p> <p>Purpose: - Defines locomotive starting position - Idle locomotives return here - Affects travel time to first task</p>"},{"location":"tutorial/07-locomotive-configuration/#locomotive-operations","title":"Locomotive Operations","text":""},{"location":"tutorial/07-locomotive-configuration/#task-assignment","title":"Task Assignment","text":"<p>Locomotives perform wagon movements: 1. Travel from current location to source track 2. Couple to wagon(s) 3. Travel to destination track 4. Decouple wagon(s) 5. Return to home track or next task</p>"},{"location":"tutorial/07-locomotive-configuration/#resource-contention","title":"Resource Contention","text":"<p>With only one locomotive: - Tasks are queued - Wagons wait for locomotive availability - Locomotive utilization may reach 100%</p> <p>With multiple locomotives: - Tasks can be parallelized - Reduced waiting times - Better throughput</p>"},{"location":"tutorial/07-locomotive-configuration/#common-modifications","title":"Common Modifications","text":""},{"location":"tutorial/07-locomotive-configuration/#adding-more-locomotives","title":"Adding More Locomotives","text":"<p>\u26a0\ufe0f WARNING: Multi-locomotive operation is not fully tested. Use at your own risk.</p> <p>Increase shunting capacity:</p> <pre><code>{\n  \"locomotives\": [\n    {\n      \"id\": \"LOCO_01\",\n      \"name\": \"Primary shunting loco\",\n      \"home track\": \"track_19\"\n    },\n    {\n      \"id\": \"LOCO_02\",\n      \"name\": \"Secondary shunting loco\",\n      \"home track\": \"loco_parking\"\n    }\n  ]\n}\n</code></pre> <p>Requirements: 1. Add home track in topology.json (if new) 2. Add home track in tracks.json with type \"rescource_parking\" 3. Add routes connecting home track to other tracks</p> <p>Known Limitations: - No physical track conflict detection between locomotives - Locomotives may attempt to use the same track segment simultaneously - Only route-level and job-level conflicts are prevented - May cause unrealistic behavior or simulation errors</p> <p>Effect (if working correctly): - Doubles shunting capacity - Reduces wagon waiting times - Improves overall throughput</p>"},{"location":"tutorial/07-locomotive-configuration/#distributed-locomotive-placement","title":"Distributed Locomotive Placement","text":"<p>\u26a0\ufe0f WARNING: Multi-locomotive operation is not fully tested. Use at your own risk.</p> <p>Place locomotives in different yard areas:</p> <pre><code>{\n  \"locomotives\": [\n    {\n      \"id\": \"LOCO_NORTH\",\n      \"name\": \"North yard shunter\",\n      \"home track\": \"loco_parking_north\"\n    },\n    {\n      \"id\": \"LOCO_SOUTH\",\n      \"name\": \"South yard shunter\",\n      \"home track\": \"loco_parking_south\"\n    }\n  ]\n}\n</code></pre> <p>Intended Benefit: Reduces average travel distance to tasks</p> <p>Known Limitations: Physical track conflicts not prevented</p>"},{"location":"tutorial/07-locomotive-configuration/#specialized-locomotives","title":"Specialized Locomotives","text":"<p>Different locomotives for different tasks (future enhancement):</p> <pre><code>{\n  \"locomotives\": [\n    {\n      \"id\": \"LOCO_HEAVY\",\n      \"name\": \"Heavy shunter\",\n      \"home track\": \"track_19\",\n      \"capacity\": \"high\"\n    },\n    {\n      \"id\": \"LOCO_LIGHT\",\n      \"name\": \"Light shunter\",\n      \"home track\": \"loco_parking\",\n      \"capacity\": \"low\"\n    }\n  ]\n}\n</code></pre> <p>Note: Current MVP doesn't support specialized attributes, but structure allows future extension</p>"},{"location":"tutorial/07-locomotive-configuration/#locomotive-capacity-planning","title":"Locomotive Capacity Planning","text":""},{"location":"tutorial/07-locomotive-configuration/#utilization-analysis","title":"Utilization Analysis","text":"<p>Locomotive utilization depends on: - Number of wagon movements - Movement duration (travel + coupling/decoupling) - Number of locomotives</p> <p>Formula: <pre><code>utilization = (total_movement_time) / (simulation_duration \u00d7 locomotive_count)\n</code></pre></p>"},{"location":"tutorial/07-locomotive-configuration/#capacity-requirements","title":"Capacity Requirements","text":"<p>Rule of thumb: <pre><code>required_locomotives = ceil(total_movements \u00d7 avg_movement_time / simulation_duration)\n</code></pre></p> <p>Example (ten_trains_two_days): - 224 wagons - ~4 movements per wagon (collection \u2192 parking \u2192 retrofit \u2192 workshop \u2192 retrofitted \u2192 parking) - 896 total movements - ~10 minutes per movement (travel + coupling/decoupling) - 48-hour simulation (2880 minutes) - Required: ceil(896 \u00d7 10 / 2880) = ceil(3.11) = 4 locomotives</p> <p>Current scenario has 1 locomotive \u2192 Expect high utilization and queuing</p>"},{"location":"tutorial/07-locomotive-configuration/#bottleneck-detection","title":"Bottleneck Detection","text":"<p>Signs that locomotives are a bottleneck: - Locomotive utilization &gt; 80% - Long wagon waiting times - Idle workshops waiting for wagons - Parking tracks not filling efficiently</p> <p>Solution: Add more locomotives</p>"},{"location":"tutorial/07-locomotive-configuration/#validation-rules","title":"Validation Rules","text":"<ul> <li>Locomotive IDs must be unique</li> <li>Home track must exist in tracks.json</li> <li>Home track should have type \"rescource_parking\"</li> <li>At least one locomotive must be defined</li> <li>Home track must be reachable via routes</li> </ul>"},{"location":"tutorial/07-locomotive-configuration/#effect-on-simulation","title":"Effect on Simulation","text":""},{"location":"tutorial/07-locomotive-configuration/#single-locomotive-current-recommended","title":"Single Locomotive (Current - Recommended)","text":"<p>Advantages: - Simple configuration - Easy to analyze - Lower operational cost - Fully tested and validated</p> <p>Disadvantages: - Potential bottleneck - High utilization - Sequential operations only</p> <p>Best for: - All current scenarios (only tested configuration) - Small scenarios (&lt; 100 wagons) - Testing configurations - Cost-sensitive operations</p>"},{"location":"tutorial/07-locomotive-configuration/#multiple-locomotives-experimental-not-recommended","title":"Multiple Locomotives (Experimental - Not Recommended)","text":"<p>\u26a0\ufe0f WARNING: Not fully tested. May cause simulation errors or unrealistic behavior.</p> <p>Intended Advantages: - Parallel operations - Lower utilization per locomotive - Better throughput - Redundancy</p> <p>Known Issues: - No physical track conflict detection - Locomotives may occupy same track simultaneously - Unrealistic behavior possible - Not validated in testing</p> <p>Disadvantages: - Higher operational cost - More complex coordination - Requires more parking space</p> <p>Use only if: - You understand the limitations - You can validate results manually - You're willing to accept potential errors</p>"},{"location":"tutorial/07-locomotive-configuration/#performance-considerations","title":"Performance Considerations","text":""},{"location":"tutorial/07-locomotive-configuration/#optimal-locomotive-count","title":"Optimal Locomotive Count","text":"<p>Under-capacity (too few): - Locomotives become bottleneck - Wagons wait excessively - Workshops may idle - Poor throughput</p> <p>Optimal capacity: - 60-80% locomotive utilization - Minimal wagon waiting - Workshops stay busy - Good throughput</p> <p>Over-capacity (too many): - Low locomotive utilization - Diminishing returns - Higher operational cost - No throughput improvement</p>"},{"location":"tutorial/07-locomotive-configuration/#monitoring-metrics","title":"Monitoring Metrics","text":"<p>Track these metrics to assess locomotive capacity: - Locomotive utilization percentage - Average wagon waiting time for movement - Number of queued movement tasks - Idle time per locomotive</p>"},{"location":"tutorial/07-locomotive-configuration/#integration-with-other-components","title":"Integration with Other Components","text":""},{"location":"tutorial/07-locomotive-configuration/#routes-routesjson","title":"Routes (routes.json)","text":"<p>Locomotives use routes to travel between tracks: - Home track must have routes to all operational tracks - Missing routes prevent locomotive access - Route duration affects movement time</p>"},{"location":"tutorial/07-locomotive-configuration/#process-times-process_timesjson","title":"Process Times (process_times.json)","text":"<p>Coupling/decoupling times affect locomotive utilization: - Longer times = higher utilization - Shorter times = more movements possible</p>"},{"location":"tutorial/07-locomotive-configuration/#tracks-tracksjson","title":"Tracks (tracks.json)","text":"<p>Home track configuration: - Must be type \"rescource_parking\" - Should be centrally located - Must have sufficient capacity</p>"},{"location":"tutorial/07-locomotive-configuration/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 8: Routes Configuration to learn about movement paths between tracks.</p>"},{"location":"tutorial/08-routes-configuration/","title":"Chapter 8: Routes Configuration","text":""},{"location":"tutorial/08-routes-configuration/#file-routesjson","title":"File: routes.json","text":"<p>The routes.json file defines movement paths between tracks. Routes specify which tracks can be reached from other tracks, the path taken, and the travel duration. Proper route configuration is essential for locomotive operations.</p>"},{"location":"tutorial/08-routes-configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>{\n  \"routes\": [\n    {\n      \"id\": \"track_19_collection1\",\n      \"duration\": 1.0,\n      \"path\": [\"track_19\", \"Mainline\", \"collection1\"]\n    },\n    {\n      \"id\": \"collection1_retrofit\",\n      \"duration\": 1.0,\n      \"path\": [\"collection1\", \"Mainline\", \"retrofit\"]\n    },\n    {\n      \"id\": \"retrofit_WS1\",\n      \"duration\": 1.0,\n      \"path\": [\"retrofit\", \"Mainline\", \"WS1\"]\n    },\n    {\n      \"id\": \"WS1_retrofitted\",\n      \"duration\": 1.0,\n      \"path\": [\"WS1\", \"Mainline\", \"retrofitted\"]\n    },\n    {\n      \"id\": \"retrofitted_parking1\",\n      \"duration\": 1.0,\n      \"path\": [\"retrofitted\", \"parking1\"]\n    }\n  ]\n}\n</code></pre>"},{"location":"tutorial/08-routes-configuration/#route-structure","title":"Route Structure","text":"<p>Each route definition contains:</p> Parameter Type Required Description <code>id</code> string Yes Unique route identifier <code>duration</code> float Yes Travel time in minutes <code>path</code> array[string] Yes Ordered list of track IDs"},{"location":"tutorial/08-routes-configuration/#parameters-explained","title":"Parameters Explained","text":""},{"location":"tutorial/08-routes-configuration/#id","title":"id","text":"<p>Unique identifier for the route:</p> <pre><code>\"id\": \"track_19_collection1\"\n</code></pre> <p>Naming Convention: - Format: <code>source_destination</code> - Example: <code>track_19_collection1</code> (from track_19 to collection1) - Clear naming helps debugging</p> <p>Requirements: - Must be unique across all routes - Used in logs and reports</p>"},{"location":"tutorial/08-routes-configuration/#duration","title":"duration","text":"<p>Travel time for the route in minutes:</p> <pre><code>\"duration\": 1.0\n</code></pre> Value Description Use Case 0.5 Very short (30 seconds) Adjacent tracks 1.0 Short (1 minute) Standard yard movement 2.0 Medium (2 minutes) Cross-yard movement 5.0 Long (5 minutes) Distant tracks <p>Factors Affecting Duration: - Physical distance - Speed limits - Track complexity - Switch operations</p> <p>Current Scenario: All routes use 1.0 minute (simplified)</p>"},{"location":"tutorial/08-routes-configuration/#path","title":"path","text":"<p>Ordered sequence of tracks from source to destination:</p> <pre><code>\"path\": [\"track_19\", \"Mainline\", \"collection1\"]\n</code></pre> <p>Structure: - First element: Source track - Middle elements: Intermediate tracks (e.g., mainline) - Last element: Destination track</p> <p>Requirements: - All track IDs must exist in tracks.json - Path must be physically possible - Minimum 2 tracks (source and destination)</p>"},{"location":"tutorial/08-routes-configuration/#route-types","title":"Route Types","text":""},{"location":"tutorial/08-routes-configuration/#direct-routes","title":"Direct Routes","text":"<p>No intermediate tracks:</p> <pre><code>{\n  \"id\": \"retrofitted_parking1\",\n  \"duration\": 1.0,\n  \"path\": [\"retrofitted\", \"parking1\"]\n}\n</code></pre> <p>Use case: Adjacent tracks with direct connection</p>"},{"location":"tutorial/08-routes-configuration/#via-mainline","title":"Via Mainline","text":"<p>Routes through main circulation path:</p> <pre><code>{\n  \"id\": \"track_19_collection1\",\n  \"duration\": 1.0,\n  \"path\": [\"track_19\", \"Mainline\", \"collection1\"]\n}\n</code></pre> <p>Use case: Most yard movements (standard pattern)</p>"},{"location":"tutorial/08-routes-configuration/#multi-hop-routes","title":"Multi-Hop Routes","text":"<p>Multiple intermediate tracks:</p> <pre><code>{\n  \"id\": \"parking1_WS2\",\n  \"duration\": 2.0,\n  \"path\": [\"parking1\", \"collection1\", \"Mainline\", \"WS2\"]\n}\n</code></pre> <p>Use case: Complex yard layouts</p>"},{"location":"tutorial/08-routes-configuration/#route-patterns-in-ten_trains_two_days","title":"Route Patterns in ten_trains_two_days","text":""},{"location":"tutorial/08-routes-configuration/#locomotive-home-to-operational-tracks","title":"Locomotive Home to Operational Tracks","text":"<p>Locomotive starts at track_19, needs routes to all areas:</p> <pre><code>{\"id\": \"track_19_collection1\", \"duration\": 1.0, \"path\": [\"track_19\", \"Mainline\", \"collection1\"]},\n{\"id\": \"track_19_collection2\", \"duration\": 1.0, \"path\": [\"track_19\", \"Mainline\", \"collection2\"]},\n{\"id\": \"track_19_retrofit\", \"duration\": 1.0, \"path\": [\"track_19\", \"Mainline\", \"retrofit\"]},\n{\"id\": \"track_19_WS1\", \"duration\": 1.0, \"path\": [\"track_19\", \"Mainline\", \"WS1\"]},\n{\"id\": \"track_19_WS2\", \"duration\": 1.0, \"path\": [\"track_19\", \"Mainline\", \"WS2\"]},\n{\"id\": \"track_19_retrofitted\", \"duration\": 1.0, \"path\": [\"track_19\", \"Mainline\", \"retrofitted\"]}\n</code></pre>"},{"location":"tutorial/08-routes-configuration/#return-routes-to-locomotive-home","title":"Return Routes to Locomotive Home","text":"<p>Locomotive returns from operational tracks:</p> <pre><code>{\"id\": \"collection1_track_19\", \"duration\": 1.0, \"path\": [\"collection1\", \"Mainline\", \"track_19\"]},\n{\"id\": \"collection2_track_19\", \"duration\": 1.0, \"path\": [\"collection2\", \"Mainline\", \"track_19\"]},\n{\"id\": \"retrofit_track_19\", \"duration\": 1.0, \"path\": [\"retrofit\", \"Mainline\", \"track_19\"]},\n{\"id\": \"WS1_track_19\", \"duration\": 1.0, \"path\": [\"WS1\", \"Mainline\", \"track_19\"]},\n{\"id\": \"WS2_track_19\", \"duration\": 1.0, \"path\": [\"WS2\", \"Mainline\", \"track_19\"]},\n{\"id\": \"retrofitted_track_19\", \"duration\": 1.0, \"path\": [\"retrofitted\", \"Mainline\", \"track_19\"]}\n</code></pre>"},{"location":"tutorial/08-routes-configuration/#operational-flow-routes","title":"Operational Flow Routes","text":"<p>Wagon movement through retrofit process:</p> <pre><code>{\"id\": \"collection1_retrofit\", \"duration\": 1.0, \"path\": [\"collection1\", \"Mainline\", \"retrofit\"]},\n{\"id\": \"collection2_retrofit\", \"duration\": 1.0, \"path\": [\"collection2\", \"Mainline\", \"retrofit\"]},\n{\"id\": \"retrofit_WS1\", \"duration\": 1.0, \"path\": [\"retrofit\", \"Mainline\", \"WS1\"]},\n{\"id\": \"retrofit_WS2\", \"duration\": 1.0, \"path\": [\"retrofit\", \"Mainline\", \"WS2\"]},\n{\"id\": \"WS1_retrofitted\", \"duration\": 1.0, \"path\": [\"WS1\", \"Mainline\", \"retrofitted\"]},\n{\"id\": \"WS2_retrofitted\", \"duration\": 1.0, \"path\": [\"WS2\", \"Mainline\", \"retrofitted\"]}\n</code></pre>"},{"location":"tutorial/08-routes-configuration/#parking-distribution-routes","title":"Parking Distribution Routes","text":"<p>From retrofitted track to parking:</p> <pre><code>{\"id\": \"retrofitted_parking1\", \"duration\": 1.0, \"path\": [\"retrofitted\", \"parking1\"]},\n{\"id\": \"retrofitted_parking2\", \"duration\": 1.0, \"path\": [\"retrofitted\", \"parking2\"]},\n{\"id\": \"retrofitted_parking3\", \"duration\": 1.0, \"path\": [\"retrofitted\", \"parking3\"]},\n...\n{\"id\": \"retrofitted_parking16\", \"duration\": 1.0, \"path\": [\"retrofitted\", \"Mainline\", \"parking16\"]}\n</code></pre> <p>Note: Some parking tracks have direct routes, others via mainline</p>"},{"location":"tutorial/08-routes-configuration/#route-completeness","title":"Route Completeness","text":""},{"location":"tutorial/08-routes-configuration/#required-routes","title":"Required Routes","text":"<p>For proper operation, ensure routes exist for:</p> <ol> <li>Locomotive home \u2192 All operational tracks</li> <li>All operational tracks \u2192 Locomotive home</li> <li>Collection \u2192 Retrofit staging</li> <li>Retrofit staging \u2192 Workshops</li> <li>Workshops \u2192 Retrofitted staging</li> <li>Retrofitted staging \u2192 Parking tracks</li> </ol>"},{"location":"tutorial/08-routes-configuration/#bidirectional-routes","title":"Bidirectional Routes","text":"<p>Most routes need bidirectional pairs:</p> <pre><code>{\"id\": \"A_to_B\", \"duration\": 1.0, \"path\": [\"A\", \"B\"]},\n{\"id\": \"B_to_A\", \"duration\": 1.0, \"path\": [\"B\", \"A\"]}\n</code></pre> <p>Exception: One-way flows (e.g., retrofitted \u2192 parking may not need reverse)</p>"},{"location":"tutorial/08-routes-configuration/#common-modifications","title":"Common Modifications","text":""},{"location":"tutorial/08-routes-configuration/#adding-routes-for-new-track","title":"Adding Routes for New Track","text":"<p>When adding a new parking track (parking17):</p> <pre><code>{\n  \"id\": \"retrofitted_parking17\",\n  \"duration\": 1.0,\n  \"path\": [\"retrofitted\", \"Mainline\", \"parking17\"]\n}\n</code></pre>"},{"location":"tutorial/08-routes-configuration/#adding-routes-for-new-workshop","title":"Adding Routes for New Workshop","text":"<p>When adding a third workshop (WS3):</p> <pre><code>{\"id\": \"track_19_WS3\", \"duration\": 1.0, \"path\": [\"track_19\", \"Mainline\", \"WS3\"]},\n{\"id\": \"WS3_track_19\", \"duration\": 1.0, \"path\": [\"WS3\", \"Mainline\", \"track_19\"]},\n{\"id\": \"retrofit_WS3\", \"duration\": 1.0, \"path\": [\"retrofit\", \"Mainline\", \"WS3\"]},\n{\"id\": \"WS3_retrofitted\", \"duration\": 1.0, \"path\": [\"WS3\", \"Mainline\", \"retrofitted\"]}\n</code></pre>"},{"location":"tutorial/08-routes-configuration/#realistic-travel-times","title":"Realistic Travel Times","text":"<p>Model actual yard distances:</p> <pre><code>{\"id\": \"track_19_collection1\", \"duration\": 0.5, \"path\": [\"track_19\", \"collection1\"]},\n{\"id\": \"track_19_WS1\", \"duration\": 2.0, \"path\": [\"track_19\", \"Mainline\", \"WS1\"]},\n{\"id\": \"WS1_parking15\", \"duration\": 3.5, \"path\": [\"WS1\", \"Mainline\", \"parking15\"]}\n</code></pre> <p>Effect: More realistic simulation, affects locomotive utilization</p>"},{"location":"tutorial/08-routes-configuration/#complex-yard-layout","title":"Complex Yard Layout","text":"<p>Multiple mainlines or circulation paths:</p> <pre><code>{\n  \"id\": \"north_to_south\",\n  \"duration\": 5.0,\n  \"path\": [\"north_area\", \"mainline_north\", \"junction\", \"mainline_south\", \"south_area\"]\n}\n</code></pre>"},{"location":"tutorial/08-routes-configuration/#validation-rules","title":"Validation Rules","text":"<ul> <li>Route IDs must be unique</li> <li>All track IDs in path must exist in tracks.json</li> <li>Duration must be positive</li> <li>Path must have at least 2 tracks</li> <li>First track = source, last track = destination</li> </ul>"},{"location":"tutorial/08-routes-configuration/#effect-on-simulation","title":"Effect on Simulation","text":""},{"location":"tutorial/08-routes-configuration/#travel-time-impact","title":"Travel Time Impact","text":"<p>Route duration affects: - Locomotive utilization - Wagon waiting times - Overall throughput</p> <p>Example: - 1-minute routes: Low impact on utilization - 5-minute routes: Significant impact, may need more locomotives</p>"},{"location":"tutorial/08-routes-configuration/#route-availability","title":"Route Availability","text":"<p>Missing routes cause: - Simulation errors - Unreachable tracks - Blocked operations</p> <p>Always verify: All necessary routes exist for operational flow</p>"},{"location":"tutorial/08-routes-configuration/#route-optimization","title":"Route Optimization","text":"<p>Shortest Path: - Minimize intermediate tracks - Reduce travel time - Improve efficiency</p> <p>Realistic Path: - Follow actual yard layout - Include necessary intermediate tracks - Model real operations</p>"},{"location":"tutorial/08-routes-configuration/#performance-considerations","title":"Performance Considerations","text":""},{"location":"tutorial/08-routes-configuration/#route-count","title":"Route Count","text":"<p>ten_trains_two_days has 33 routes: - Locomotive home: 12 routes (6 out, 6 back) - Operational flow: 6 routes - Parking distribution: 15 routes</p> <p>Scaling: - More tracks = more routes needed - N tracks may need O(N\u00b2) routes for full connectivity - Focus on necessary routes only</p>"},{"location":"tutorial/08-routes-configuration/#route-lookup","title":"Route Lookup","text":"<p>Simulation finds routes by source-destination pair: - Fast lookup with proper indexing - Route count has minimal performance impact - Missing routes cause errors, not slowdowns</p>"},{"location":"tutorial/08-routes-configuration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"tutorial/08-routes-configuration/#no-route-found-error","title":"\"No route found\" Error","text":"<p>Cause: Missing route definition</p> <p>Solution: Add route from source to destination: <pre><code>{\"id\": \"source_destination\", \"duration\": 1.0, \"path\": [\"source\", \"Mainline\", \"destination\"]}\n</code></pre></p>"},{"location":"tutorial/08-routes-configuration/#track-not-found-in-path-error","title":"\"Track not found in path\" Error","text":"<p>Cause: Route references non-existent track</p> <p>Solution: Verify all tracks in path exist in tracks.json</p>"},{"location":"tutorial/08-routes-configuration/#unreachable-tracks","title":"Unreachable Tracks","text":"<p>Symptom: Wagons never reach certain tracks</p> <p>Solution: Verify bidirectional routes exist</p>"},{"location":"tutorial/08-routes-configuration/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 9: Train Schedule Configuration to learn about wagon arrivals and properties.</p>"},{"location":"tutorial/09-train-schedule-configuration/","title":"Chapter 9: Train Schedule Configuration","text":""},{"location":"tutorial/09-train-schedule-configuration/#file-train_schedulecsv","title":"File: train_schedule.csv","text":"<p>The train_schedule.csv file defines when trains arrive, which wagons they contain, and wagon properties. This is the primary input for simulation workload.</p>"},{"location":"tutorial/09-train-schedule-configuration/#file-format","title":"File Format","text":"<p>CSV file with semicolon (<code>;</code>) delimiter:</p> <pre><code>train_id;wagon_id;arrival_time;length;is_loaded;needs_retrofit;Track\nT1;W0001;2025-12-01T06:00:00+00:00;15.9;False;True;collection\nT1;W0002;2025-12-01T06:00:00+00:00;16.1;False;True;collection\nT2;W0007;2025-12-01T10:48:00+00:00;18.8;False;True;collection\n</code></pre>"},{"location":"tutorial/09-train-schedule-configuration/#column-definitions","title":"Column Definitions","text":"Column Type Required Description <code>train_id</code> string Yes Train identifier (groups wagons) <code>wagon_id</code> string Yes Unique wagon identifier <code>arrival_time</code> ISO 8601 datetime Yes When train arrives (UTC) <code>length</code> float Yes Wagon length in meters <code>is_loaded</code> boolean Yes Whether wagon carries cargo <code>needs_retrofit</code> boolean Yes Whether wagon requires DAC retrofit <code>Track</code> string Yes Track type for arrival (typically \"collection\")"},{"location":"tutorial/09-train-schedule-configuration/#parameters-explained","title":"Parameters Explained","text":""},{"location":"tutorial/09-train-schedule-configuration/#train_id","title":"train_id","text":"<p>Identifier grouping wagons into trains:</p> <pre><code>train_id\nT1\nT1\nT1\nT2\nT2\n</code></pre> <p>Characteristics: - All wagons with same train_id arrive together - Wagons are processed as a group initially - Train_id must be unique per arrival time</p> <p>Naming Convention: - <code>T1</code>, <code>T2</code>, <code>T3</code>, ... for sequential numbering - <code>TRAIN_001</code>, <code>TRAIN_002</code> for formal naming - <code>NORTH_01</code>, <code>SOUTH_01</code> for location-based naming</p> <p>In ten_trains_two_days: T1 through T10 (10 trains)</p>"},{"location":"tutorial/09-train-schedule-configuration/#wagon_id","title":"wagon_id","text":"<p>Unique identifier for each wagon:</p> <pre><code>wagon_id\nW0001\nW0002\nW0003\n</code></pre> <p>Requirements: - Must be globally unique - Used for tracking throughout simulation - Appears in output reports</p> <p>Naming Convention: - <code>W0001</code>, <code>W0002</code>, ... for sequential numbering - Zero-padded for sorting (W0001 vs W1)</p> <p>In ten_trains_two_days: W0001 through W0224 (224 wagons)</p>"},{"location":"tutorial/09-train-schedule-configuration/#arrival_time","title":"arrival_time","text":"<p>When the train arrives at the yard:</p> <pre><code>arrival_time\n2025-12-01T06:00:00+00:00\n2025-12-01T10:48:00+00:00\n2025-12-02T06:00:00+00:00\n</code></pre> <p>Format: ISO 8601 with timezone (<code>YYYY-MM-DDTHH:MM:SS+00:00</code>)</p> <p>Requirements: - Must be within scenario start_date and end_date - All wagons in same train have identical arrival_time - Use UTC timezone (+00:00)</p> <p>Arrival Pattern in ten_trains_two_days: - Day 1: 5 trains (T1-T5) at 06:00, 10:48, 15:36, 20:24, 01:12 - Day 2: 5 trains (T6-T10) at 06:00, 10:48, 15:36, 20:24, 01:12 - Regular 4h 48min intervals</p>"},{"location":"tutorial/09-train-schedule-configuration/#length","title":"length","text":"<p>Physical length of wagon in meters:</p> <pre><code>length\n15.9\n16.1\n20.4\n23.5\n</code></pre> <p>Typical Values: - Short wagons: 15.0 - 17.0 m - Medium wagons: 17.1 - 22.0 m - Long wagons: 22.1 - 25.0 m</p> <p>Effect on Simulation: - Determines track capacity usage - Affects how many wagons fit on tracks - Realistic distribution improves accuracy</p> <p>In ten_trains_two_days: Random distribution between 15.0 and 25.0 meters</p>"},{"location":"tutorial/09-train-schedule-configuration/#is_loaded","title":"is_loaded","text":"<p>Whether wagon carries cargo:</p> <pre><code>is_loaded\nFalse\nFalse\nTrue\nFalse\n</code></pre> <p>Values: - <code>True</code>: Wagon carries cargo (heavier, may affect operations) - <code>False</code>: Empty wagon</p> <p>Current Implementation: - Tracked for future enhancements - May affect retrofit time in future versions - Currently informational only</p> <p>In ten_trains_two_days: Mostly False, some True (realistic mix)</p>"},{"location":"tutorial/09-train-schedule-configuration/#needs_retrofit","title":"needs_retrofit","text":"<p>Whether wagon requires DAC retrofit:</p> <pre><code>needs_retrofit\nTrue\nTrue\nFalse\nTrue\n</code></pre> <p>Values: - <code>True</code>: Wagon needs retrofit (enters retrofit process) - <code>False</code>: Wagon already has DAC (bypasses retrofit)</p> <p>Effect on Simulation: - <code>True</code>: Wagon goes through full retrofit process - <code>False</code>: Wagon may go directly to parking or exit</p> <p>In ten_trains_two_days: Mostly True (220/224 wagons need retrofit)</p> <p>Use Cases: - Model mixed fleets (some already retrofitted) - Test partial retrofit scenarios - Simulate phased migration</p>"},{"location":"tutorial/09-train-schedule-configuration/#track","title":"Track","text":"<p>Track type where train arrives:</p> <pre><code>Track\ncollection\ncollection\ncollection\n</code></pre> <p>Typical Value: <code>\"collection\"</code></p> <p>Purpose: - Indicates track type for arrival - Usually \"collection\" for incoming trains - Must match track type in tracks.json</p> <p>Current Implementation: All trains arrive at \"collection\" tracks</p>"},{"location":"tutorial/09-train-schedule-configuration/#train-composition-examples","title":"Train Composition Examples","text":""},{"location":"tutorial/09-train-schedule-configuration/#small-train-6-wagons","title":"Small Train (6 wagons)","text":"<pre><code>train_id;wagon_id;arrival_time;length;is_loaded;needs_retrofit;Track\nT1;W0001;2025-12-01T06:00:00+00:00;15.9;False;True;collection\nT1;W0002;2025-12-01T06:00:00+00:00;16.1;False;True;collection\nT1;W0003;2025-12-01T06:00:00+00:00;20.4;False;True;collection\nT1;W0004;2025-12-01T06:00:00+00:00;23.5;False;True;collection\nT1;W0005;2025-12-01T06:00:00+00:00;18.4;False;True;collection\nT1;W0006;2025-12-01T06:00:00+00:00;16.6;False;True;collection\n</code></pre> <p>Total length: 110.9 meters</p>"},{"location":"tutorial/09-train-schedule-configuration/#large-train-32-wagons","title":"Large Train (32 wagons)","text":"<pre><code>train_id;wagon_id;arrival_time;length;is_loaded;needs_retrofit;Track\nT2;W0007;2025-12-01T10:48:00+00:00;18.8;False;True;collection\nT2;W0008;2025-12-01T10:48:00+00:00;22.3;False;True;collection\n...\nT2;W0038;2025-12-01T10:48:00+00:00;21.7;False;True;collection\n</code></pre> <p>Total length: ~640 meters (32 wagons \u00d7 ~20m average)</p>"},{"location":"tutorial/09-train-schedule-configuration/#mixed-train-loaded-and-empty","title":"Mixed Train (loaded and empty)","text":"<pre><code>train_id;wagon_id;arrival_time;length;is_loaded;needs_retrofit;Track\nT4;W0076;2025-12-01T20:24:00+00:00;24.5;True;True;collection\nT4;W0077;2025-12-01T20:24:00+00:00;18.4;False;True;collection\nT4;W0093;2025-12-01T20:24:00+00:00;19.1;True;True;collection\n</code></pre> <p>Realistic: Mix of loaded and empty wagons</p>"},{"location":"tutorial/09-train-schedule-configuration/#partially-retrofitted-train","title":"Partially Retrofitted Train","text":"<pre><code>train_id;wagon_id;arrival_time;length;is_loaded;needs_retrofit;Track\nT3;W0062;2025-12-01T15:36:00+00:00;18.4;False;False;collection\nT3;W0063;2025-12-01T15:36:00+00:00;18.6;False;True;collection\nT4;W0080;2025-12-01T20:24:00+00:00;19.7;False;False;collection\n</code></pre> <p>Use case: Some wagons already have DAC</p>"},{"location":"tutorial/09-train-schedule-configuration/#arrival-schedule-analysis","title":"Arrival Schedule Analysis","text":""},{"location":"tutorial/09-train-schedule-configuration/#ten_trains_two_days-schedule","title":"ten_trains_two_days Schedule","text":"Train Arrival Time Wagons Avg Length Loaded Need Retrofit T1 Day 1, 06:00 6 18.5m 0 6 T2 Day 1, 10:48 32 20.0m 0 32 T3 Day 1, 15:36 27 20.2m 0 26 T4 Day 1, 20:24 30 20.1m 2 28 T5 Day 2, 01:12 9 18.6m 2 9 T6 Day 2, 06:00 21 19.5m 1 20 T7 Day 2, 10:48 28 20.3m 2 28 T8 Day 2, 15:36 33 20.0m 0 33 T9 Day 2, 20:24 32 20.2m 2 32 T10 Day 3, 01:12 6 20.3m 2 6 <p>Total: 224 wagons, 220 need retrofit</p>"},{"location":"tutorial/09-train-schedule-configuration/#arrival-pattern","title":"Arrival Pattern","text":"<p>Interval: 4 hours 48 minutes (288 minutes)</p> <p>Distribution: - Realistic irregular train sizes - Mix of small (6-9) and large (30-33) trains - Spread over 2 days</p>"},{"location":"tutorial/09-train-schedule-configuration/#common-modifications","title":"Common Modifications","text":""},{"location":"tutorial/09-train-schedule-configuration/#adding-more-trains","title":"Adding More Trains","text":"<p>Extend the schedule:</p> <pre><code>T11;W0225;2025-12-03T06:00:00+00:00;19.5;False;True;collection\nT11;W0226;2025-12-03T06:00:00+00:00;20.1;False;True;collection\n</code></pre> <p>Requirements: - Unique wagon IDs - Arrival time within scenario timeframe - Update scenario end_date if needed</p>"},{"location":"tutorial/09-train-schedule-configuration/#changing-arrival-frequency","title":"Changing Arrival Frequency","text":"<p>More frequent arrivals:</p> <pre><code>T1;W0001;2025-12-01T06:00:00+00:00;...\nT2;W0007;2025-12-01T08:00:00+00:00;...  # 2 hours later\nT3;W0039;2025-12-01T10:00:00+00:00;...  # 2 hours later\n</code></pre> <p>Effect: Higher workload, tests capacity limits</p>"},{"location":"tutorial/09-train-schedule-configuration/#uniform-train-sizes","title":"Uniform Train Sizes","text":"<p>All trains with 20 wagons:</p> <pre><code>T1;W0001;...;20.0;False;True;collection\n...\nT1;W0020;...;20.0;False;True;collection\nT2;W0021;...;20.0;False;True;collection\n...\nT2;W0040;...;20.0;False;True;collection\n</code></pre> <p>Effect: Predictable workload, easier analysis</p>"},{"location":"tutorial/09-train-schedule-configuration/#peak-load-scenario","title":"Peak Load Scenario","text":"<p>Multiple trains arriving simultaneously:</p> <pre><code>T1;W0001;2025-12-01T06:00:00+00:00;...\nT2;W0007;2025-12-01T06:00:00+00:00;...  # Same time\nT3;W0039;2025-12-01T06:00:00+00:00;...  # Same time\n</code></pre> <p>Effect: Stress test collection track capacity</p>"},{"location":"tutorial/09-train-schedule-configuration/#validation-rules","title":"Validation Rules","text":"<ul> <li>Wagon IDs must be unique across entire file</li> <li>Arrival times must be within scenario timeframe</li> <li>All wagons in same train must have identical arrival_time</li> <li>Length must be positive</li> <li>Boolean fields must be True or False</li> <li>Track type must match available track types</li> </ul>"},{"location":"tutorial/09-train-schedule-configuration/#effect-on-simulation","title":"Effect on Simulation","text":""},{"location":"tutorial/09-train-schedule-configuration/#workload","title":"Workload","text":"<p>Total wagons needing retrofit determines: - Required workshop capacity - Simulation duration - Resource requirements</p> <p>Formula: <pre><code>min_duration = (wagons_needing_retrofit \u00d7 retrofit_time) / (workshops \u00d7 stations)\n</code></pre></p> <p>ten_trains_two_days: - 220 wagons \u00d7 60 min / (2 workshops \u00d7 2 stations) = 3,300 minutes = 55 hours</p>"},{"location":"tutorial/09-train-schedule-configuration/#arrival-pattern_1","title":"Arrival Pattern","text":"<p>Affects: - Collection track utilization - Parking track fill rate - Workshop queue buildup</p> <p>Steady arrivals: Consistent workload Burst arrivals: Peak capacity testing Sparse arrivals: Underutilization testing</p>"},{"location":"tutorial/09-train-schedule-configuration/#train-size-distribution","title":"Train Size Distribution","text":"<p>Affects: - Collection track capacity requirements - Locomotive utilization patterns - Wagon distribution complexity</p>"},{"location":"tutorial/09-train-schedule-configuration/#creating-custom-schedules","title":"Creating Custom Schedules","text":""},{"location":"tutorial/09-train-schedule-configuration/#using-spreadsheet-software","title":"Using Spreadsheet Software","text":"<ol> <li>Open Excel/LibreOffice Calc</li> <li>Create columns: train_id, wagon_id, arrival_time, length, is_loaded, needs_retrofit, Track</li> <li>Fill in data</li> <li>Save as CSV with semicolon delimiter</li> </ol>"},{"location":"tutorial/09-train-schedule-configuration/#programmatic-generation","title":"Programmatic Generation","text":"<p>Python script example:</p> <pre><code>import csv\nfrom datetime import datetime, timedelta\n\nwith open('train_schedule.csv', 'w', newline='') as f:\n    writer = csv.writer(f, delimiter=';')\n    writer.writerow(['train_id', 'wagon_id', 'arrival_time', 'length', 'is_loaded', 'needs_retrofit', 'Track'])\n\n    wagon_id = 1\n    for train in range(1, 11):\n        arrival = datetime(2025, 12, 1, 6, 0) + timedelta(hours=4.8 * (train - 1))\n        for wagon in range(20):\n            writer.writerow([\n                f'T{train}',\n                f'W{wagon_id:04d}',\n                arrival.strftime('%Y-%m-%dT%H:%M:%S+00:00'),\n                round(15 + random.random() * 10, 1),\n                'False',\n                'True',\n                'collection'\n            ])\n            wagon_id += 1\n</code></pre>"},{"location":"tutorial/09-train-schedule-configuration/#next-steps","title":"Next Steps","text":"<p>Continue to Chapter 10: Running Your Simulation to learn how to execute and analyze results.</p>"},{"location":"tutorial/10-running-simulation/","title":"Chapter 10: Running Your Simulation","text":""},{"location":"tutorial/10-running-simulation/#running-popupsim","title":"Running PopUpSim","text":"<p>Now that you understand all configuration files, let's run the simulation and analyze results.</p>"},{"location":"tutorial/10-running-simulation/#basic-execution","title":"Basic Execution","text":""},{"location":"tutorial/10-running-simulation/#command-syntax","title":"Command Syntax","text":"<pre><code>uv run python popupsim/backend/src/main.py --scenario &lt;scenario_path&gt; --output &lt;output_path&gt;\n</code></pre>"},{"location":"tutorial/10-running-simulation/#running-ten_trains_two_days","title":"Running ten_trains_two_days","text":"<pre><code>cd dac-migration-dss-popupsim\nuv run python popupsim/backend/src/main.py --scenario Data/examples/ten_trains_two_days/ --output output/tutorial/\n</code></pre> <p>Parameters: - <code>--scenario</code>: Path to scenario directory containing configuration files - <code>--output</code>: Path where results will be saved</p>"},{"location":"tutorial/10-running-simulation/#viewing-results","title":"Viewing Results","text":""},{"location":"tutorial/10-running-simulation/#using-the-dashboard","title":"Using the Dashboard","text":"<p>PopUpSim includes a web-based dashboard for interactive result visualization.</p> <p>Start the dashboard (in a separate terminal):</p> <p>Windows: <pre><code>run_dashboard.bat\n</code></pre></p> <p>Linux/macOS: <pre><code>uv run streamlit run popupsim/frontend/streamlit_dashboard.py\n</code></pre></p> <p>The dashboard opens at http://localhost:8501</p> <p>Dashboard Tabs:</p> <ol> <li>\ud83d\udcca Overview - High-level KPIs and operational dashboard</li> <li>Total wagons, retrofitted count, completion rate</li> <li>Wagon flow visualization</li> <li>Locomotive activity breakdown</li> <li> <p>Workshop bay utilization</p> </li> <li> <p>\ud83d\ude83 Wagon Flow - Detailed wagon journey analysis</p> </li> <li>Gantt charts showing wagon movements over time</li> <li>Status distribution (retrofitted, parked, rejected)</li> <li>Track occupancy visualization</li> <li> <p>Individual wagon journey timelines</p> </li> <li> <p>\ud83c\udfed Workshop Performance - Workshop efficiency metrics</p> </li> <li>Utilization percentages per workshop</li> <li>Throughput (wagons/hour)</li> <li> <p>Workshop comparison table</p> </li> <li> <p>\ud83d\ude82 Locomotive Operations - Shunting resource analysis</p> </li> <li>Activity breakdown (moving, parking, coupling, decoupling)</li> <li>Utilization percentages</li> <li> <p>Time distribution charts</p> </li> <li> <p>\ud83d\udee4\ufe0f Track Capacity - Track usage analysis</p> </li> <li>Utilization per track (color-coded: green &lt; 70%, yellow 70-85%, red &gt; 85%)</li> <li> <p>Capacity charts</p> </li> <li> <p>\u274c Rejected Wagons - Analysis of wagons that couldn't be processed</p> </li> <li>Rejection reasons (loaded, no retrofit needed, track full)</li> <li> <p>Detailed rejection list</p> </li> <li> <p>\ud83d\udd0d Event Log - Searchable simulation event viewer</p> </li> <li>Filter by event type</li> <li> <p>Search functionality</p> </li> <li> <p>\ud83d\udccb Process Log - Detailed process execution log</p> </li> <li>Filter by process type</li> <li>Search functionality</li> </ol> <p>Important: Run the dashboard in a separate terminal window so you can continue running simulations while viewing results.</p>"},{"location":"tutorial/10-running-simulation/#using-output-files","title":"Using Output Files","text":"<p>Alternatively, analyze results directly from the output files.</p>"},{"location":"tutorial/10-running-simulation/#execution-process","title":"Execution Process","text":""},{"location":"tutorial/10-running-simulation/#1-configuration-loading","title":"1. Configuration Loading","text":"<p>PopUpSim loads and validates all configuration files:</p> <pre><code>Loading scenario: Data/examples/ten_trains_two_days/\n\u251c\u2500 Reading scenario.json\n\u251c\u2500 Loading topology.json\n\u251c\u2500 Loading tracks.json\n\u251c\u2500 Loading workshops.json\n\u251c\u2500 Loading process_times.json\n\u251c\u2500 Loading locomotive.json\n\u251c\u2500 Loading routes.json\n\u2514\u2500 Loading train_schedule.csv\n</code></pre> <p>Validation checks: - File existence - JSON/CSV syntax - Required fields - Data types - Cross-references between files</p>"},{"location":"tutorial/10-running-simulation/#2-simulation-initialization","title":"2. Simulation Initialization","text":"<p>Creates simulation environment:</p> <pre><code>Initializing simulation...\n\u251c\u2500 Creating 224 wagons\n\u251c\u2500 Setting up 2 workshops (4 retrofit stations)\n\u251c\u2500 Configuring 15 parking tracks\n\u251c\u2500 Initializing 1 locomotive\n\u2514\u2500 Building route network (33 routes)\n</code></pre>"},{"location":"tutorial/10-running-simulation/#3-simulation-execution","title":"3. Simulation Execution","text":"<p>Runs discrete event simulation:</p> <pre><code>Running simulation...\nSimulation time: 2025-12-01 00:00:00 to 2025-12-20 00:00:00\n\u251c\u2500 Processing train arrivals\n\u251c\u2500 Managing wagon movements\n\u251c\u2500 Executing retrofit operations\n\u251c\u2500 Tracking resource utilization\n\u2514\u2500 Collecting metrics\n</code></pre> <p>Progress indicators: - Current simulation time - Events processed - Wagons completed</p>"},{"location":"tutorial/10-running-simulation/#4-results-generation","title":"4. Results Generation","text":"<p>Creates output files and visualizations:</p> <pre><code>Generating results...\n\u251c\u2500 Writing CSV reports\n\u251c\u2500 Creating visualizations\n\u2514\u2500 Saving summary statistics\n</code></pre>"},{"location":"tutorial/10-running-simulation/#output-files","title":"Output Files","text":""},{"location":"tutorial/10-running-simulation/#directory-structure","title":"Directory Structure","text":"<pre><code>output/tutorial/\n\u251c\u2500\u2500 metrics/\n\u2502   \u251c\u2500\u2500 wagon_metrics.csv\n\u2502   \u251c\u2500\u2500 workshop_metrics.csv\n\u2502   \u2514\u2500\u2500 locomotive_metrics.csv\n\u251c\u2500\u2500 visualizations/\n\u2502   \u251c\u2500\u2500 throughput_over_time.png\n\u2502   \u251c\u2500\u2500 workshop_utilization.png\n\u2502   \u2514\u2500\u2500 wagon_flow.png\n\u2514\u2500\u2500 summary.json\n</code></pre>"},{"location":"tutorial/10-running-simulation/#wagon-metrics-wagon_metricscsv","title":"Wagon Metrics (wagon_metrics.csv)","text":"<p>Detailed information for each wagon:</p> Column Description wagon_id Unique wagon identifier arrival_time When wagon arrived retrofit_start When retrofit began retrofit_end When retrofit completed departure_time When wagon left system total_time Total time in system waiting_time Time spent waiting retrofit_time Time spent in retrofit <p>Use for: - Individual wagon analysis - Identifying delays - Calculating statistics</p>"},{"location":"tutorial/10-running-simulation/#workshop-metrics-workshop_metricscsv","title":"Workshop Metrics (workshop_metrics.csv)","text":"<p>Workshop performance data:</p> Column Description workshop_id Workshop identifier total_wagons Wagons processed utilization Percentage of time busy avg_queue_length Average wagons waiting max_queue_length Maximum wagons waiting <p>Use for: - Capacity analysis - Bottleneck identification - Utilization optimization</p>"},{"location":"tutorial/10-running-simulation/#locomotive-metrics-locomotive_metricscsv","title":"Locomotive Metrics (locomotive_metrics.csv)","text":"<p>Locomotive performance data:</p> Column Description locomotive_id Locomotive identifier total_movements Number of wagon movements utilization Percentage of time busy total_distance Total distance traveled idle_time Time spent idle <p>Use for: - Resource planning - Utilization analysis - Capacity requirements</p>"},{"location":"tutorial/10-running-simulation/#summary-statistics-summaryjson","title":"Summary Statistics (summary.json)","text":"<p>High-level simulation results:</p> <pre><code>{\n  \"scenario_id\": \"test_scenario_01\",\n  \"simulation_duration\": \"19 days\",\n  \"total_wagons\": 224,\n  \"wagons_retrofitted\": 220,\n  \"avg_throughput\": 11.6,\n  \"avg_wagon_time\": 1234.5,\n  \"workshop_utilization\": 0.78,\n  \"locomotive_utilization\": 0.65\n}\n</code></pre>"},{"location":"tutorial/10-running-simulation/#analyzing-results","title":"Analyzing Results","text":""},{"location":"tutorial/10-running-simulation/#key-performance-indicators","title":"Key Performance Indicators","text":""},{"location":"tutorial/10-running-simulation/#throughput","title":"Throughput","text":"<p>Wagons per day: <pre><code>throughput = wagons_retrofitted / simulation_days\n</code></pre></p> <p>Target: Depends on scenario requirements</p> <p>ten_trains_two_days expected: ~110 wagons/day (220 wagons / 2 days)</p>"},{"location":"tutorial/10-running-simulation/#workshop-utilization","title":"Workshop Utilization","text":"<p>Percentage of time workshops are busy: <pre><code>utilization = busy_time / total_time\n</code></pre></p> <p>Interpretation: - &lt; 60%: Under-utilized (excess capacity) - 60-80%: Well-balanced - 80-95%: High utilization (efficient) - &gt; 95%: Bottleneck (consider expansion)</p>"},{"location":"tutorial/10-running-simulation/#average-wagon-time","title":"Average Wagon Time","text":"<p>Total time wagon spends in system: <pre><code>avg_time = sum(departure_time - arrival_time) / wagon_count\n</code></pre></p> <p>Components: - Waiting time (queuing) - Movement time (shunting) - Retrofit time (workshop)</p> <p>Target: Minimize while maintaining throughput</p>"},{"location":"tutorial/10-running-simulation/#locomotive-utilization","title":"Locomotive Utilization","text":"<p>Percentage of time locomotives are busy: <pre><code>utilization = (movement_time + coupling_time) / total_time\n</code></pre></p> <p>Interpretation: - &lt; 50%: Over-capacity - 50-70%: Well-balanced - 70-90%: High utilization - &gt; 90%: Bottleneck (add locomotives)</p>"},{"location":"tutorial/10-running-simulation/#bottleneck-identification","title":"Bottleneck Identification","text":""},{"location":"tutorial/10-running-simulation/#workshop-bottleneck","title":"Workshop Bottleneck","text":"<p>Symptoms: - Workshop utilization &gt; 90% - Long wagon waiting times - Growing retrofit queue - Idle parking capacity</p> <p>Solutions: 1. Add retrofit stations (workshops.json) 2. Add more workshops 3. Optimize workshop selection strategy</p>"},{"location":"tutorial/10-running-simulation/#locomotive-bottleneck","title":"Locomotive Bottleneck","text":"<p>Symptoms: - Locomotive utilization &gt; 85% - Long movement queues - Idle workshops waiting for wagons - Delayed wagon distributions</p> <p>Solutions: 1. Optimize route durations (routes.json) 2. Reduce coupling/decoupling times (process_times.json) 3. Improve locomotive placement 4. \u26a0\ufe0f Add more locomotives (locomotive.json) - EXPERIMENTAL, not fully tested</p>"},{"location":"tutorial/10-running-simulation/#track-capacity-bottleneck","title":"Track Capacity Bottleneck","text":"<p>Symptoms: - Parking tracks at capacity - Collection tracks blocking - Wagons waiting for track space</p> <p>Solutions: 1. Add more parking tracks (topology.json, tracks.json) 2. Increase track lengths (topology.json) 3. Optimize track selection strategy 4. Improve wagon distribution</p>"},{"location":"tutorial/10-running-simulation/#optimization-workflow","title":"Optimization Workflow","text":""},{"location":"tutorial/10-running-simulation/#1-baseline-run","title":"1. Baseline Run","text":"<p>Run with default configuration:</p> <pre><code>uv run python popupsim/backend/src/main.py --scenario Data/examples/ten_trains_two_days/ --output output/baseline/\n</code></pre> <p>Analyze: - Identify bottlenecks - Note utilization rates - Record throughput</p>"},{"location":"tutorial/10-running-simulation/#2-targeted-improvements","title":"2. Targeted Improvements","text":"<p>Modify configuration based on bottlenecks:</p> <p>If workshop bottleneck: <pre><code>// workshops.json\n\"retrofit_stations\": 3  // Was 2\n</code></pre></p> <p>If locomotive bottleneck: <pre><code>// routes.json - optimize travel times\n{\"id\": \"track_19_collection1\", \"duration\": 0.5, \"path\": [\"track_19\", \"collection1\"]}\n</code></pre></p> <p>Note: Adding locomotives is not recommended (experimental feature, not fully tested)</p>"},{"location":"tutorial/10-running-simulation/#3-comparison-run","title":"3. Comparison Run","text":"<p>Run with modifications:</p> <pre><code>uv run python popupsim/backend/src/main.py --scenario Data/examples/ten_trains_two_days/ --output output/improved/\n</code></pre> <p>Compare: - Throughput change - Utilization improvements - Cost vs. benefit</p>"},{"location":"tutorial/10-running-simulation/#4-iteration","title":"4. Iteration","text":"<p>Repeat until targets met: - Adjust parameters - Run simulation - Analyze results - Refine configuration</p>"},{"location":"tutorial/10-running-simulation/#common-scenarios","title":"Common Scenarios","text":""},{"location":"tutorial/10-running-simulation/#scenario-1-increase-throughput","title":"Scenario 1: Increase Throughput","text":"<p>Goal: Process 300 wagons in 2 days (150/day)</p> <p>Approach: 1. Calculate required capacity: 300 wagons \u00d7 60 min / 2880 min = 6.25 stations 2. Add workshop capacity (workshops.json): 3 workshops \u00d7 2 stations = 6 stations 3. Add parking tracks for increased volume 4. Optimize route durations if locomotive utilization is high 5. Run and verify throughput</p>"},{"location":"tutorial/10-running-simulation/#scenario-2-reduce-costs","title":"Scenario 2: Reduce Costs","text":"<p>Goal: Minimize resources while maintaining throughput</p> <p>Approach: 1. Run baseline with current configuration 2. Identify over-utilized resources (utilization &lt; 60%) 3. Reduce excess capacity 4. Verify throughput maintained 5. Calculate cost savings</p>"},{"location":"tutorial/10-running-simulation/#scenario-3-handle-peak-loads","title":"Scenario 3: Handle Peak Loads","text":"<p>Goal: Process burst of 100 wagons arriving simultaneously</p> <p>Approach: 1. Modify train_schedule.csv with simultaneous arrivals 2. Increase collection track capacity 3. Add temporary parking capacity 4. Run simulation 5. Verify no blocking or excessive delays</p>"},{"location":"tutorial/10-running-simulation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"tutorial/10-running-simulation/#simulation-errors","title":"Simulation Errors","text":""},{"location":"tutorial/10-running-simulation/#no-route-found","title":"\"No route found\"","text":"<p>Error: Cannot find route from track A to track B</p> <p>Solution: Add missing route in routes.json: <pre><code>{\"id\": \"A_to_B\", \"duration\": 1.0, \"path\": [\"A\", \"Mainline\", \"B\"]}\n</code></pre></p>"},{"location":"tutorial/10-running-simulation/#track-capacity-exceeded","title":"\"Track capacity exceeded\"","text":"<p>Error: Too many wagons for track length</p> <p>Solution:  - Increase track length in topology.json - Add more tracks - Improve wagon distribution</p>"},{"location":"tutorial/10-running-simulation/#invalid-arrival-time","title":"\"Invalid arrival time\"","text":"<p>Error: Train arrival outside scenario timeframe</p> <p>Solution: Adjust arrival_time in train_schedule.csv or extend scenario dates</p>"},{"location":"tutorial/10-running-simulation/#performance-issues","title":"Performance Issues","text":""},{"location":"tutorial/10-running-simulation/#slow-simulation","title":"Slow Simulation","text":"<p>Causes: - Very large scenarios (&gt; 1000 wagons) - Complex route networks - Long simulation duration</p> <p>Solutions: - Reduce simulation timeframe - Simplify route network - Use faster hardware</p>"},{"location":"tutorial/10-running-simulation/#high-memory-usage","title":"High Memory Usage","text":"<p>Causes: - Many wagons - Detailed metrics collection</p> <p>Solutions: - Process in batches - Reduce metric granularity - Increase available RAM</p>"},{"location":"tutorial/10-running-simulation/#best-practices","title":"Best Practices","text":""},{"location":"tutorial/10-running-simulation/#configuration-management","title":"Configuration Management","text":"<ol> <li>Version control: Use git for configuration files</li> <li>Naming conventions: Clear, consistent file and ID naming</li> <li>Documentation: Comment complex configurations</li> <li>Backups: Keep baseline configurations</li> </ol>"},{"location":"tutorial/10-running-simulation/#experimentation","title":"Experimentation","text":"<ol> <li>One change at a time: Isolate variable effects</li> <li>Document changes: Track what was modified</li> <li>Compare results: Use consistent output directories</li> <li>Validate results: Sanity-check metrics</li> </ol>"},{"location":"tutorial/10-running-simulation/#reporting","title":"Reporting","text":"<ol> <li>Save all outputs: Keep complete result sets</li> <li>Screenshot visualizations: Document key findings</li> <li>Export metrics: Use CSV for further analysis</li> <li>Summarize findings: Create executive summaries</li> </ol>"},{"location":"tutorial/10-running-simulation/#next-steps","title":"Next Steps","text":""},{"location":"tutorial/10-running-simulation/#further-learning","title":"Further Learning","text":"<ul> <li>Explore other example scenarios (demo, ten_trains_two_days)</li> <li>Read Architecture Documentation</li> <li>Review Development Guide</li> </ul>"},{"location":"tutorial/10-running-simulation/#creating-your-own-scenarios","title":"Creating Your Own Scenarios","text":"<ol> <li>Copy an existing scenario as template</li> <li>Modify configuration files for your use case</li> <li>Start with small scale for testing</li> <li>Gradually increase complexity</li> <li>Validate results against expectations</li> </ol>"},{"location":"tutorial/10-running-simulation/#contributing","title":"Contributing","text":"<ul> <li>Share your scenarios with the community</li> <li>Report issues on GitHub</li> <li>Suggest improvements</li> <li>Contribute code enhancements</li> </ul>"},{"location":"tutorial/10-running-simulation/#conclusion","title":"Conclusion","text":"<p>You now understand how to: - Configure all PopUpSim input files - Run simulations with different parameters - Analyze results and identify bottlenecks - Optimize configurations for better performance</p> <p>Happy simulating!</p> <p>Tutorial Complete</p> <p>Return to Tutorial Home for overview and navigation.</p>"}]}